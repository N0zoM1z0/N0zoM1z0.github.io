<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Reverse-Other | ULGANOY</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="记录一些reverse题目">
<meta property="og:type" content="article">
<meta property="og:title" content="Reverse-Other">
<meta property="og:url" content="http://n0zom1z0.github.io/Reverse-Other/index.html">
<meta property="og:site_name" content="ULGANOY">
<meta property="og:description" content="记录一些reverse题目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/12/17/YpD7sKfL3v5MNCT.png">
<meta property="og:image" content="https://s2.loli.net/2024/01/04/5DfGocJ3RINlFEs.png">
<meta property="og:image" content="https://s2.loli.net/2024/01/24/wjebRFKkmsa3dL7.png">
<meta property="og:image" content="http://n0zom1z0.github.io/Reverse-Other/images/image.png">
<meta property="og:image" content="http://n0zom1z0.github.io/Reverse-Other/images/image-1.png">
<meta property="og:image" content="http://n0zom1z0.github.io/Reverse-Other/images/image-2.png">
<meta property="og:image" content="http://n0zom1z0.github.io/Reverse-Other/images/image-3.png">
<meta property="og:image" content="http://n0zom1z0.github.io/Reverse-Other/images/image-4.png">
<meta property="article:published_time" content="2023-12-08T09:49:26.000Z">
<meta property="article:modified_time" content="2024-02-23T23:38:52.743Z">
<meta property="article:author" content="ULGANOY">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/12/17/YpD7sKfL3v5MNCT.png">
  
    <link rel="alternate" href="/atom.xml" title="ULGANOY" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ULGANOY</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Kitauji Fightooooo!</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://N0zoM1z0.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Reverse-Other" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/Reverse-Other/" class="article-date">
  <time class="dt-published" datetime="2023-12-08T09:49:26.000Z" itemprop="datePublished">2023-12-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF-Reverse/">CTF-Reverse</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Reverse-Other
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>记录一些reverse题目</p>
<span id="more"></span>

<h1 id="moectf2023"><a href="#moectf2023" class="headerlink" title="moectf2023"></a>moectf2023</h1><h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><p>IDA打开跟进 很容易发现关键代码:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( Msg != <span class="number">273</span> )</span><br><span class="line">        <span class="keyword">return</span> DefWindowProcW(hWndParent, Msg, wParam, lParam);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)wParam == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        DlgItem = GetDlgItem(hWndParent, <span class="number">2</span>);</span><br><span class="line">        GetWindowTextW(DlgItem, String, <span class="number">1024</span>);</span><br><span class="line">        sub_150C94(String);</span><br><span class="line">        v13 = <span class="number">0</span>;</span><br><span class="line">        sub_150A0A(v7, v8);</span><br><span class="line">        LOBYTE(v13) = <span class="number">1</span>;</span><br><span class="line">        sub_150C94(a91);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_1531AB(v7, v6) )</span><br><span class="line">          MessageBoxW(hWndParent, Text, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          MessageBoxW(hWndParent, <span class="string">L&quot;Sorry, flag error.&quot;</span>, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        sub_1529B8(v6);</span><br><span class="line">        LOBYTE(v13) = <span class="number">0</span>;</span><br><span class="line">        sub_1529B8(v7);</span><br><span class="line">        v13 = <span class="number">-1</span>;</span><br><span class="line">        sub_1529B8(v8);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>跟进 sub_150A0A(v7, v8); 会发现里面进行了 (-5)^0x51 操作<br>后面进行了strcmp的check<br>这里比较的另一个数组提取有点奇怪<br>动调会被反调试掉 setip跳到这里之前得到的值也不对<br>注意到check前面还有句: <code>sub_150C94(a91);</code><br>查看a91的值猜想可能是比较数组 因为这个 sub_150c94没有改变值<br>所以最后exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x3E</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x70</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x38</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x7C</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x1A</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x7F</span>, <span class="number">0x00</span>, <span class="number">0x3C</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x00</span>, <span class="number">0x29</span>]</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span>(x!=<span class="number">0</span>):</span><br><span class="line">        c.append(x)</span><br><span class="line">enc = c</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((x^<span class="number">0x51</span>)+<span class="number">5</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># moectf&#123;GU1&amp;&amp;W1nd0w2_Pr1m3r!!!&#125;</span></span><br></pre></td></tr></table></figure>
<p>看WP说可以直接输入所以可能字符得到加密值来比较得到(因为是单字节加密) 但是我动调截不到对应值… 以后再来看吧</p>
<h2 id="unwind"><a href="#unwind" class="headerlink" title="unwind"></a>unwind</h2><p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+0h] [ebp-100h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_ECC063);</span><br><span class="line">  sub_EC13E3();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to moectf2023!!! Now you find YunZh1Jun&#x27;s revenge!!!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know TEA(an encryption algorithm)? Do you know unwind in SEH? &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I believe you can understand them! So let me check your flag~&quot;</span>);</span><br><span class="line">  sub_EC10CD(<span class="string">&quot;Input:&quot;</span>, v4);</span><br><span class="line">  sub_EC13CA(<span class="string">&quot;%64s&quot;</span>, (<span class="type">char</span>)&amp;byte_ECA578);</span><br><span class="line">  MEMORY[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  sub_EC10FF();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Right flag! Have fun in moectf2023~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大大的红色 MEMORY来触发内存访问异常<br>根据异常处理可以找到会跳转到这里</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">loc_EC5928:</span><br><span class="line">;   __except(loc_EC5922) <span class="comment">// owned by EC5908</span></span><br><span class="line">mov     esp, [ebp+ms_exc.old_esp]</span><br><span class="line">push    offset aDx3906  ; <span class="string">&quot;DX3906&quot;</span></span><br><span class="line">push    offset byte_ECA578 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">push    offset aDoctor3 ; <span class="string">&quot;doctor3&quot;</span></span><br><span class="line">push    offset dword_ECA580 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">push    offset aFux1aoyun ; <span class="string">&quot;FUX1AOYUN&quot;</span></span><br><span class="line">push    offset dword_ECA588 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">push    offset aR3verier ; <span class="string">&quot;R3verier&quot;</span></span><br><span class="line">push    offset dword_ECA590 ; <span class="type">unsigned</span> <span class="type">int</span> *</span><br><span class="line">call    j_XXTEA</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0F</span>FFFFFFEh</span><br></pre></td></tr></table></figure>

<p>代码那儿标注错了(应该只是tea&#x2F;xtea)<br>总之会先经过第一遍的四次tea加密</p>
<p>动调会发现输入的input会被分成8组 (每组两个)<br>查看交叉引用会发现后面还调用了tea加密 在这里</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">; <span class="keyword">struct</span> _EXCEPTION_REGISTRATION_RECORD *<span class="title function_">sub_EC1820</span><span class="params">()</span></span><br><span class="line">sub_EC1820 proc near</span><br><span class="line"></span><br><span class="line">var_E4= dword ptr <span class="number">-0E4</span>h</span><br><span class="line">var_10= byte ptr <span class="number">-10</span>h</span><br><span class="line">var_C= dword ptr <span class="number">-0</span>Ch</span><br><span class="line">var_4= dword ptr <span class="number">-4</span></span><br><span class="line"></span><br><span class="line">push    ebp</span><br><span class="line">mov     ebp, esp</span><br><span class="line">sub     esp, <span class="number">0</span>D0h</span><br><span class="line">push    ebx</span><br><span class="line">push    esi</span><br><span class="line">push    edi</span><br><span class="line">lea     edi, [ebp+var_10]</span><br><span class="line">mov     ecx, <span class="number">4</span></span><br><span class="line">mov     eax, <span class="number">0</span>CCCCCCCCh</span><br><span class="line">rep stosd</span><br><span class="line">mov     eax, ___security_cookie</span><br><span class="line">xor     eax, ebp</span><br><span class="line">mov     [ebp+var_4], eax</span><br><span class="line">mov     [ebp+var_C], offset j_ENCRPYT</span><br><span class="line">push    [ebp+var_C]</span><br><span class="line">push    large dword ptr fs:<span class="number">0</span></span><br><span class="line">mov     large fs:<span class="number">0</span>, esp</span><br><span class="line"><span class="type">int</span>     <span class="number">3</span>               ; Trap to Debugger</span><br><span class="line">mov     eax, [esp+<span class="number">0E4</span>h+var_E4]</span><br><span class="line">mov     large fs:<span class="number">0</span>, eax</span><br><span class="line">add     esp, <span class="number">8</span></span><br><span class="line">pop     edi</span><br><span class="line">pop     esi</span><br><span class="line">pop     ebx</span><br><span class="line">mov     ecx, [ebp+var_4]</span><br><span class="line">xor     ecx, ebp        ; StackCookie</span><br><span class="line">call    j_@__security_check_cookie@<span class="number">4</span> ; __security_check_cookie(x)</span><br><span class="line">add     esp, <span class="number">0</span>D0h</span><br><span class="line">cmp     ebp, esp</span><br><span class="line">call    j___RTC_CheckEsp</span><br><span class="line">mov     esp, ebp</span><br><span class="line">pop     ebp</span><br><span class="line">retn</span><br><span class="line">sub_EC1820 endp</span><br></pre></td></tr></table></figure>

<p>注意到这里的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mov     eax, ___security_cookie</span><br><span class="line">xor     eax, ebp</span><br><span class="line">mov     [ebp+var_4], eax</span><br><span class="line">mov     [ebp+var_C], offset j_ENCRYPT</span><br><span class="line">push    [ebp+var_C]</span><br><span class="line">push    large dword ptr fs:<span class="number">0</span></span><br><span class="line">mov     large fs:<span class="number">0</span>, esp</span><br></pre></td></tr></table></figure>

<p>是在xor还原scopetable检查栈帧完整性过后 新的一个__try块之前 插入了一个异常链表节点(这里我改名了)<br>第一次被 RtlDispatchException 调用，紧接着在栈展开时又被调用一次 (被加入异常链表的函数每次异常触发会被调用两次!!!)<br>所以说这个ENCRYPT(tea)被调用了两次 也就是后4组是连续tea了两次的!!!</p>
<p>而第一次的四次tea加密只有一遍是因为这时只是触发异常跳到对应的except handler地方 直接调用了4次tea(不是作为异常链表中的handler function)<br>所以不会在展开的时候再遍历一遍<br>同时也要注意到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00</span>EC598F                         loc_EC598F:                             ; DATA XREF: .rdata:stru_EC92E8↓o</span><br><span class="line">.text:<span class="number">00</span>EC598F                         ;   __except filter <span class="comment">// owned by EC597A</span></span><br><span class="line">.text:<span class="number">00</span>EC598F B8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                          mov     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">00</span>EC5994 C3                                      retn</span><br></pre></td></tr></table></figure>

<p>这里的返回值1就是 EXCEPTION_EXECUTE_HANDLER 所以会进行全局展开<br>再借文章的话来阐释更清楚一点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">既然有了前面知识的铺垫，那么这一段汇编代码理解起来应该没有什么难度：</span><br><span class="line">注意到 .text:0041590F 处会触发了一个读写非法地址异常，往下紧接着就是 __except filter，它直接返回了 1，</span><br><span class="line">也就是 EXCEPTION_EXECUTE_HANDLER，根据前面的知识，</span><br><span class="line">__except_handler4 在获取 FilterFunc 后会根据调用 filter 并根据 FilterResult 决定下一步的操作，</span><br><span class="line">这里为 1，故会进行全局展开，也就是接着调用 RtlUnwind，</span><br><span class="line">RtlUnwind 又会起一个 EH4_EXCEPTION_REGISTRATION-&gt;Handler，也就是我们这里的 __except 块</span><br></pre></td></tr></table></figure>


<p>然后将那四个字符串分别对应4个DWORD KEY[] 逆就行了</p>
<h1 id="miniLCTF2021"><a href="#miniLCTF2021" class="headerlink" title="miniLCTF2021"></a>miniLCTF2021</h1><h2 id="sub"><a href="#sub" class="headerlink" title="sub"></a>sub</h2><p>参考:<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41890599/article/details/102642043"> + </a></p>
<p>考察点是傀儡进程注入<br>在track师傅博客瞅到 就做了做</p>
<p>首先用CFF查看 发现有一个节区比较奇怪 节区名为  .what?<br>IDA查看main<br>很经典的进程注入结构</p>
<ol>
<li>以挂起的方式创建一个进程</li>
<li>卸载该进程的内存映射 i.e 清空进程虚拟内存空间中的内容</li>
<li>获取该进程的CONTEXT上下文结构</li>
<li>将要注入的内存读取到内存中</li>
<li>在傀儡进程中申请足够的内存空间</li>
<li>将要注入的程序写入申请的空间</li>
<li>设置CONTEXT上下文的eax为程序入口点 ebx+8为程序基址</li>
<li>恢复线程</li>
</ol>
<p>理解这一点后 注意到<br>sub_401000((int)Block, ElementCount);<br>是对 段进行xor 0x64 操作<br>将 .what?段dump出来 xor后得到隐藏PE文件<br>IDA逆向<br>一个简单的变换操作<br>正常流程解出来是假flag<br>注意到有Tls 查看发现替换了函数地址<br>用真正的加密函数逆向得到真flag<br><strong>miniLctf{Re_1s_s0_1nt4r4st1ng!!}</strong></p>
<hr>
<hr>
<p>源码的函数替换实现:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> (*check)(<span class="type">char</span>* flag, <span class="type">int</span> len) = fake_check;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">fake_check</span><span class="params">(...)</span>...</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">true_check</span><span class="params">(...)</span>...</span></span><br></pre></td></tr></table></figure>

<h1 id="miniLCTF2022"><a href="#miniLCTF2022" class="headerlink" title="miniLCTF2022"></a>miniLCTF2022</h1><h2 id="lemon"><a href="#lemon" class="headerlink" title="lemon"></a>lemon</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">0: const 25 ; &lt;module &#x27;main&#x27;&gt; </span><br><span class="line">5: module 1 590</span><br><span class="line">11: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">16: store 0 0</span><br><span class="line">19: const 26 ; &lt;module &#x27;src&#x27;&gt; </span><br><span class="line">24: module 6 590</span><br><span class="line">30: const 27 ; 221492336 </span><br><span class="line">35: store 0 0</span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br><span class="line">80: store 0 1</span><br><span class="line">83: const 32 ; n </span><br><span class="line">88: const 33 ; __init__ </span><br><span class="line">93: define 0 0 1 2 377</span><br><span class="line">102: array 0</span><br><span class="line">107: self</span><br><span class="line">108: const 34 ; enc </span><br><span class="line">113: setattr</span><br><span class="line">114: array 0</span><br><span class="line">119: self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">126: const 36 ; 330150339 </span><br><span class="line">131: const 37 ; 665229750 </span><br><span class="line">136: const 38 ; 1030425184 </span><br><span class="line">141: const 39 ; 626644061 </span><br><span class="line">146: const 40 ; 861166604 </span><br><span class="line">151: const 41 ; 521761774 </span><br><span class="line">156: const 42 ; 586337393 </span><br><span class="line">161: const 43 ; 167708778 </span><br><span class="line">166: const 44 ; 495518230 </span><br><span class="line">171: const 45 ; 459905620 </span><br><span class="line">176: const 46 ; 47689903 </span><br><span class="line">181: const 47 ; 541128627 </span><br><span class="line">186: const 48 ; 735310319 </span><br><span class="line">191: const 49 ; 924471115 </span><br><span class="line">196: const 50 ; 66957703 </span><br><span class="line">201: const 51 ; 827308967 </span><br><span class="line">206: const 52 ; 4680810 </span><br><span class="line">211: const 53 ; 618187854 </span><br><span class="line">216: const 54 ; 1041878913 </span><br><span class="line">221: const 55 ; 424705310 </span><br><span class="line">226: const 56 ; 258515107 </span><br><span class="line">231: const 57 ; 301365991 </span><br><span class="line">236: const 58 ; 238089888 </span><br><span class="line">241: const 59 ; 126810196 </span><br><span class="line">246: const 60 ; 160092960 </span><br><span class="line">251: const 61 ; 333469062 </span><br><span class="line">256: const 62 ; 524809386 </span><br><span class="line">261: const 63 ; 334234642 </span><br><span class="line">266: const 64 ; 532732060 </span><br><span class="line">271: const 65 ; 701306806 </span><br><span class="line">276: const 66 ; 755999918 </span><br><span class="line">281: const 67 ; 219942343 </span><br><span class="line">286: const 68 ; 37219027 </span><br><span class="line">291: const 69 ; 76267819 </span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc </span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1</span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1</span><br><span class="line">366: jmp 321</span><br><span class="line">371: const 75 ; nil </span><br><span class="line">376: return</span><br><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0 2</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz 476</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append </span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br><span class="line">482: const 78 ; sign </span><br><span class="line">487: const 80 ; RunMe </span><br><span class="line">492: class 4 0</span><br><span class="line">495: store 0 2</span><br><span class="line">498: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">503: const 81 ; [+] Starting... </span><br><span class="line">508: call 1</span><br><span class="line">510: pop</span><br><span class="line">511: load 0 2</span><br><span class="line">514: const 79 ; 35 </span><br><span class="line">519: call 1</span><br><span class="line">521: store 0 5</span><br><span class="line">524: load 0 5</span><br><span class="line">527: const 78 ; sign </span><br><span class="line">532: getattr</span><br><span class="line">533: load 0 5</span><br><span class="line">536: const 71 ; res </span><br><span class="line">541: getattr</span><br><span class="line">542: load 0 5</span><br><span class="line">545: const 34 ; enc </span><br><span class="line">550: getattr</span><br><span class="line">551: call 2</span><br><span class="line">553: pop</span><br><span class="line">554: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">559: load 0 5</span><br><span class="line">562: const 35 ; flag </span><br><span class="line">567: getattr</span><br><span class="line">568: call 1</span><br><span class="line">570: pop</span><br><span class="line">571: const 23 ; &lt;function &#x27;print&#x27;&gt; </span><br><span class="line">576: const 82 ; [+] Done! </span><br><span class="line">581: call 1</span><br><span class="line">583: pop</span><br><span class="line">584: const 75 ; nil </span><br><span class="line">589: return</span><br></pre></td></tr></table></figure>

<p>lemon官方文档全挂了。。。<br>磕磕绊绊还原一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">seed = <span class="number">0xd33b470</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next</span>():</span><br><span class="line">    <span class="keyword">global</span> seed</span><br><span class="line">    seed = (seed * <span class="number">0xdeadbeef</span> + <span class="number">0xb14cb12d</span>) % <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RunMe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,n</span>):</span><br><span class="line">        self.enc = []</span><br><span class="line">        self.flag = []</span><br><span class="line">        self.res = [<span class="number">2141786733</span>, <span class="number">76267819</span>, <span class="number">37219027</span>, <span class="number">219942343</span>, <span class="number">755999918</span>, <span class="number">701306806</span>, <span class="number">532732060</span>, <span class="number">334234642</span>, <span class="number">524809386</span>, <span class="number">333469062</span>, <span class="number">160092960</span>, <span class="number">126810196</span>, <span class="number">238089888</span>, <span class="number">301365991</span>, <span class="number">258515107</span>, <span class="number">424705310</span>, <span class="number">1041878913</span>, <span class="number">618187854</span>, <span class="number">4680810</span>, <span class="number">827308967</span>, <span class="number">66957703</span>, <span class="number">924471115</span>, <span class="number">735310319</span>, <span class="number">541128627</span>, <span class="number">47689903</span>, <span class="number">459905620</span>, <span class="number">495518230</span>, <span class="number">167708778</span>, <span class="number">586337393</span>, <span class="number">521761774</span>, <span class="number">861166604</span>, <span class="number">626644061</span>, <span class="number">1030425184</span>, <span class="number">665229750</span>, <span class="number">330150339</span>]</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; n):</span><br><span class="line">            self.enc.append(<span class="built_in">next</span>())</span><br><span class="line">            i = i + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">35</span>) :</span><br><span class="line">            self.flag.append(x[i] ^ y[i])</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Starting...&quot;</span>)</span><br><span class="line"></span><br><span class="line">my_run = RunMe(<span class="number">35</span>)</span><br><span class="line">my_run.sign(my_run.enc, my_run.res)</span><br><span class="line"><span class="built_in">print</span>(my_run.flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Done!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是用python运行得不到结果… 貌似是取模运算不太一样? 总之要还原成lemon后用它自己的编译器运行</p>
<p>大致记录一下吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const 27 ; 221492336    // LCG</span><br><span class="line">35: store 0 0 </span><br><span class="line">38: const 28 ; next </span><br><span class="line">43: define 0 0 0 0 80</span><br><span class="line">52: load 1 0</span><br><span class="line">55: const 29 ; 3735928559 </span><br><span class="line">60: mul</span><br><span class="line">61: const 30 ; 2974593325 </span><br><span class="line">66: add</span><br><span class="line">67: const 31 ; 4294967295 </span><br><span class="line">72: mod</span><br><span class="line">73: store 1 0  // (a*3735928559+2974593325)%4294967295</span><br><span class="line">76: load 1 0</span><br><span class="line">79: return</span><br></pre></td></tr></table></figure>

<p>这里define就是lemon定义函数的格式 前面的const就是函数名<br>这里的 load 1 0 加载的是全局变量const 27<br>就是一个LCG的过程 初始seed为 const 27</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self</span><br><span class="line">120: const 35 ; flag </span><br><span class="line">125: setattr</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">296: const 70 ; 2141786733 </span><br><span class="line">301: array 35</span><br><span class="line">306: self</span><br><span class="line">307: const 71 ; res </span><br><span class="line">312: setattr</span><br><span class="line">313: const 72 ; 0 </span><br><span class="line">318: store 0 1</span><br></pre></td></tr></table></figure>

<p>这里是将这一大堆数循环存入 res里<br>而且要注意 由于是压栈 所以这数组是倒序的 也就是 [2141786733,…,330150339]!!!</p>
<p>然后是这一段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">321: load 0 1</span><br><span class="line">324: load 0 0</span><br><span class="line">327: lt</span><br><span class="line">328: jz 371</span><br><span class="line">333: self</span><br><span class="line">334: const 34 ; enc      // 循环存储到 enc[]</span><br><span class="line">339: getattr</span><br><span class="line">340: const 73 ; append </span><br><span class="line">345: getattr</span><br><span class="line">346: load 1 1</span><br><span class="line">349: call 0</span><br><span class="line">351: call 1     </span><br><span class="line">353: pop</span><br><span class="line">354: load 0 1</span><br><span class="line">357: const 74 ; 1 </span><br><span class="line">362: add</span><br><span class="line">363: store 0 1   // +=1</span><br><span class="line">366: jmp 321</span><br></pre></td></tr></table></figure>

<p>这里的call 0  call 1   是 append 和 next<br>所以是 enc.append(next()) 也就是把LCG每次变换的seed存入enc数组</p>
<p>然后是这段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">377: const 33 ; __init__ </span><br><span class="line">382: const 76 ; x </span><br><span class="line">387: const 77 ; y </span><br><span class="line">392: const 78 ; sign </span><br><span class="line">397: define 0 0 2 3 482</span><br><span class="line">406: const 72 ; 0 </span><br><span class="line">411: store 0 2</span><br><span class="line">414: load 0   // loop 414-471</span><br><span class="line">417: const 79 ; 35 </span><br><span class="line">422: lt</span><br><span class="line">423: jz          // for 0~35</span><br><span class="line">428: self</span><br><span class="line">429: const 35 ; flag </span><br><span class="line">434: getattr</span><br><span class="line">435: const 73 ; append         // flag.append()</span><br><span class="line">440: getattr</span><br><span class="line">441: load 0 0</span><br><span class="line">444: load 0 2</span><br><span class="line">447: getitem</span><br><span class="line">448: load 0 1</span><br><span class="line">451: load 0 2</span><br><span class="line">454: getitem</span><br><span class="line">455: bxor      // xor!</span><br><span class="line">456: call 1</span><br><span class="line">458: pop</span><br><span class="line">459: load 0 2</span><br><span class="line">462: const 74 ; 1 </span><br><span class="line">467: add</span><br><span class="line">468: store 0 2</span><br><span class="line">471: jmp 414</span><br><span class="line">476: const 75 ; nil </span><br><span class="line">481: return</span><br></pre></td></tr></table></figure>

<p>定义了一个sign函数<br>以及x y<br>逐位xor后存入flag数组</p>
<p>最后就是创建一个RunMe CLASS<br>调用其中的函数打印flag<br>大致流程就这样吧 这鬼lemon官方文档挂了确实难搞…</p>
<h2 id="NOTRC4"><a href="#NOTRC4" class="headerlink" title="NOTRC4"></a>NOTRC4</h2><p>好题欸<br>RISC-V指令集<br>神奇的Ghidra可以反编译…<br>第一次使用 首先要new一个project 然后ImportFile就可以分析了<br>在IDA中也能看出来这是一个opcode的题<br>查看函数(其中有自己写的注释)<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Globals starting with &#x27;_&#x27; overlap smaller symbols at the same address */</span></span><br><span class="line"></span><br><span class="line"><span class="function">undefined8 <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  undefined8 uVar1;</span><br><span class="line">  undefined8 OPCODE;</span><br><span class="line">  undefined8 local_78;</span><br><span class="line">  undefined8 local_70;</span><br><span class="line">  undefined8 local_68;</span><br><span class="line">  undefined8 local_60;</span><br><span class="line">  undefined8 local_58;</span><br><span class="line">  undefined8 local_50;</span><br><span class="line">  undefined8 local_48;</span><br><span class="line">  undefined8 local_40;</span><br><span class="line">  undefined8 local_38;</span><br><span class="line">  undefined8 local_30;</span><br><span class="line">  undefined8 local_28;</span><br><span class="line">  undefined8 local_20;</span><br><span class="line">  <span class="type">long</span> local_18;</span><br><span class="line">  </span><br><span class="line">  local_18 = ___stack_chk_guard;</span><br><span class="line">  OPCODE = <span class="number">0</span>;</span><br><span class="line">  local_78 = <span class="number">0</span>;</span><br><span class="line">  local_70 = <span class="number">0</span>;</span><br><span class="line">  local_68 = <span class="number">0</span>;</span><br><span class="line">  local_60 = <span class="number">0</span>;</span><br><span class="line">  local_58 = <span class="number">0</span>;</span><br><span class="line">  local_50 = <span class="number">0</span>;</span><br><span class="line">  local_48 = <span class="number">0</span>;</span><br><span class="line">  local_40 = <span class="number">0</span>;</span><br><span class="line">  local_38 = <span class="number">0</span>;</span><br><span class="line">  local_30 = <span class="number">0</span>;</span><br><span class="line">  local_28 = <span class="number">0</span>;</span><br><span class="line">  local_20 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">FUN_00100740</span>(<span class="string">&quot;Input your flag&quot;</span>,<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">FUN_00100720</span>(&amp;DAT_00100d78,&amp;INPUT_VALUE);</span><br><span class="line">  <span class="built_in">SET_OPCODE_AND_FUNCTIONS</span>((undefined4 *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">EXECUTE_UNDER_OPCODE</span>((<span class="type">int</span> *)&amp;OPCODE);</span><br><span class="line">  <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  uVar1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (___stack_chk_guard != local_18) &#123;</span><br><span class="line">    <span class="built_in">FUN_00100730</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uVar1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设置opcode以及对应函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SET_OPCODE_AND_FUNCTIONS</span><span class="params">(undefined4 *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *param_1 = <span class="number">0</span>;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">6</span>) = <span class="number">0xf1</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">8</span>) = F1_CHECK_FLAG;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">10</span>) = <span class="number">0xf2</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0xc</span>) = F2_FUN_00100bfe;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0xe</span>) = <span class="number">0xf3</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x10</span>) = F3_FUN_00100974;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x12</span>) = <span class="number">0xf4</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x14</span>) = F4_FUN_00100a10;</span><br><span class="line">  *(undefined *)(param_1 + <span class="number">0x16</span>) = <span class="number">0xf5</span>;</span><br><span class="line">  *(code **)(param_1 + <span class="number">0x18</span>) = F5_SAVE_CHANGED_VALUE;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">EXECUTE_UNDER_OPCODE</span><span class="params">(<span class="type">int</span> *param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ((&amp;DAT_00102018)[*param_1] != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">EXECUTE</span>(param_1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的-1就是0xff 结束条件<br>先导出opcode<br>这个可以通过后面函数确定是 DAT_00102018 处的数据<br>导出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span><br></pre></td></tr></table></figure>

<p>可以发现其实是两组重复</p>
<p>F3函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F3_FUN_00100974</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 21 74 62 64  dbt! */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102008;</span><br><span class="line">                    <span class="comment">/* 73 64 79 79  yyds */</span></span><br><span class="line">  *(<span class="type">long</span> *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">       *(<span class="type">long</span> *)(&amp;INPUT_VALUE + (<span class="type">long</span>)(<span class="type">int</span>)((byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] + <span class="number">1</span>) * <span class="number">8</span>) +</span><br><span class="line">       DAT_00102010;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将内存中数据注释出来 这里结合main中的输入知道是将输入分别加上了十六进制值 0x64627421 0x79796473</p>
<p>F4函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"><span class="comment">/* 0xe1 0xe2分别对应每次加密的两轮 */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F4_FUN_00100a10</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* 0xe1 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1f</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">2</span>) =</span><br><span class="line">         DAT_00102008 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">4</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">                    <span class="comment">/* 0xe2 */</span></span><br><span class="line">  <span class="keyword">if</span> ((&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>] == <span class="number">-0x1e</span>) &#123;</span><br><span class="line">    *(ulong *)(in_a0 + <span class="number">4</span>) =</span><br><span class="line">         DAT_00102010 +</span><br><span class="line">         ((*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &gt;&gt;</span><br><span class="line">          ((<span class="type">long</span>)-(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U) |</span><br><span class="line">         (*(ulong *)(in_a0 + <span class="number">4</span>) ^ *(ulong *)(in_a0 + <span class="number">2</span>)) &lt;&lt;</span><br><span class="line">         ((<span class="type">long</span>)(<span class="type">int</span>)*(undefined8 *)(in_a0 + <span class="number">2</span>) &amp; <span class="number">0x3f</span>U));</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>刚好对应opcode里的两个F4 分别是两组相似的加密 结合上一个函数知道这里的 <code>*int_a0+2 *int_a0+4</code> 就是两个input<br>然后到F2函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F2_FUN_00100bfe</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  </span><br><span class="line">                    <span class="comment">/* if xxx&lt;0b */</span></span><br><span class="line">  <span class="keyword">if</span> (DAT_00102108 &lt; (<span class="type">int</span>)(uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">2</span>]) &#123;</span><br><span class="line">                    <span class="comment">/* opcode-4 --&gt; 回到前面两个f4开头的地方</span></span><br><span class="line"><span class="comment">                       也就是说两次f4重复了12遍！！！ */</span></span><br><span class="line">    *in_a0 = *in_a0 - (uint)(byte)(&amp;DAT_00102018)[*in_a0 + <span class="number">1</span>];</span><br><span class="line">    DAT_00102108 = DAT_00102108 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    DAT_00102108 = <span class="number">0</span>;</span><br><span class="line">    *in_a0 = *in_a0 + <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里挺巧妙的  结合opcode的数据 f2 04 0b<br>知道这里其实是一个 0b次的循环 若&lt;0b则PC-4 也就是回到前面两个F4开始的地方<br>所以前面的两次F4重复了12次</p>
<p>后面的和第一轮相似 只是F3取数据从02开始取得 也就是input的后两个</p>
<p>最后F1函数 check函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Unknown calling convention -- yet parameter storage is locked */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">F1_CHECK_FLAG</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *in_a0;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (local_14 = <span class="number">0</span>; local_14 &lt; <span class="number">4</span>; local_14 = local_14 + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (*(<span class="type">long</span> *)(&amp;DAT_001020c8 + (<span class="type">long</span>)local_14 * <span class="number">8</span>) !=</span><br><span class="line">        *(<span class="type">long</span> *)(&amp;DAT_00102030 + (<span class="type">long</span>)local_14 * <span class="number">8</span>)) &#123;</span><br><span class="line">      <span class="built_in">FUN_00100760</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">FUN_00100750</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *in_a0 = *in_a0 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将 0x001020c8与0x00102030的值比较<br>在Ghidra中转到bytes查看 c8处是?说明是我们输入的数据 导出30处的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 </span><br><span class="line">cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span><br></pre></td></tr></table></figure>

<p>注意它的比较方式 long 和 +8 说明这是四个数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x4bc21dbb95ef82ca 0xf57becae71b547be</span><br><span class="line">0x80a1bdab15e7f6cd 0xa3c793d7e1776385</span><br></pre></td></tr></table></figure>

<p>对应还原加密代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="comment"># f3</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>] += <span class="number">0x64627421</span></span><br><span class="line">    <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>] += <span class="number">0x79796473</span></span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">        <span class="comment"># 0xe1</span></span><br><span class="line">        v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 0xe2</span></span><br><span class="line">        v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">        v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br></pre></td></tr></table></figure>

<p>这种加密貌似也是一种feistel结构吧 所以加解密对称的 原来的左移改为右移 调换语句块顺序就能逆回来v1^v2的值</p>
<p>解密代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">opcode:</span></span><br><span class="line"><span class="string">f3 00 f4 e1 f4 e2 f2 04 0b f5 f3 02 f4 e1 f4 e2 f2 04 0b f5 f1 ff</span></span><br><span class="line"><span class="string">check值:</span></span><br><span class="line"><span class="string">ca 82 ef 95 bb 1d c2 4b be 47 b5 71 ae ec 7b f5 cd f6 e7 15 ab bd a1 80 85 63 77 e1 d7 93 c7 a3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">input</span> = [</span><br><span class="line">    <span class="number">0x4BC21DBB95EF82CA</span>,</span><br><span class="line">    <span class="number">0xF57BECAE71B547BE</span>,</span><br><span class="line">    <span class="number">0x80A1BDAB15E7F6CD</span>,</span><br><span class="line">    <span class="number">0xA3C793D7E1776385</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        <span class="comment"># f3</span></span><br><span class="line">        v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">        v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">        v1 += <span class="number">0x64627421</span></span><br><span class="line">        v2 += <span class="number">0x79796473</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>): <span class="comment"># f4</span></span><br><span class="line">            <span class="comment"># 0xe1</span></span><br><span class="line">            v1 = <span class="number">0x64627421</span>+(((v2^v1)&gt;&gt;((-v2)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v2&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 0xe2</span></span><br><span class="line">            v2 = <span class="number">0x79796473</span>+(((v2^v1)&gt;&gt;((-v1)&amp;<span class="number">0x3f</span>))|((v2^v1)&lt;&lt;(v1&amp;<span class="number">0x3f</span>)))</span><br><span class="line">            v1 &amp;= <span class="number">0xffffffffffffffff</span> <span class="comment"># ulong</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v1,v2</span>):</span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    v = (v2&lt;&lt;((-v1)&amp;<span class="number">0x3f</span>))|(v2&gt;&gt;(v1&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v2 = v^v1</span><br><span class="line">    v2 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v = (v1&lt;&lt;((-v2)&amp;<span class="number">0x3f</span>))|(v1&gt;&gt;(v2&amp;<span class="number">0x3f</span>))</span><br><span class="line">    v &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    v1 = v^v2</span><br><span class="line">    v1 &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">    <span class="keyword">return</span> v1,v2</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    v1 = <span class="built_in">input</span>[i*<span class="number">2</span>]</span><br><span class="line">    v2 = <span class="built_in">input</span>[i*<span class="number">2</span>+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        v1,v2 = decrypt(v1,v2)</span><br><span class="line">    v1 -= <span class="number">0x64627421</span></span><br><span class="line">    v2 -= <span class="number">0x79796473</span></span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(v1)[::-<span class="number">1</span>]+long_to_bytes(v2)[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># I_hate_U_r1sc-V!</span></span><br></pre></td></tr></table></figure>

<h1 id="NCTF2022"><a href="#NCTF2022" class="headerlink" title="NCTF2022"></a>NCTF2022</h1><h2 id="ez-rev"><a href="#ez-rev" class="headerlink" title="ez_rev"></a>ez_rev</h2><p>平时得多写脚本 还有端序问题啊！！！ 写个代码写了好久 难绷…<br>进IDA<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 *v4; <span class="comment">// rbx</span></span><br><span class="line">  __int128 *v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v6; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v7; <span class="comment">// rdx</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;dword_55EC99F560A0);</span><br><span class="line">  <span class="keyword">if</span> ( dword_55EC99F560A0 == <span class="string">&#x27;FTCN&#x27;</span> &amp;&amp; byte_55EC99F560A4 == <span class="string">&#x27;&#123;&#x27;</span> &amp;&amp; byte_55EC99F560C9 == <span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; !byte_55EC99F560CA )</span><br><span class="line">  &#123;                                             <span class="comment">// len=42</span></span><br><span class="line">    v4 = (<span class="type">unsigned</span> __int8 *)&amp;unk_55EC99F560A5;  <span class="comment">// input 去头</span></span><br><span class="line">    v5 = &amp;xmmword_55EC99F560E0;                 <span class="comment">// 初始为0</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = v4;</span><br><span class="line">      v4 += <span class="number">4</span>;</span><br><span class="line">      <span class="built_in">sub_55EC99F53290</span>(v6, &amp;asc_55EC99F56060, v5);<span class="comment">// v6 ~ v5  四个字符一次变换 每次变换会改变v5的值 然后后面check的xmmword就是v5值的拼接</span></span><br><span class="line">      v5 = (__int128 *)(v7 + <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v4 != (<span class="type">unsigned</span> __int8 *)((<span class="type">char</span> *)&amp;unk_55EC99F560A5 + <span class="number">36</span>) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( xmmword_55EC99F560E0 == xmmword_55EC99F56020</span><br><span class="line">    &amp;&amp; xmmword_55EC99F560F0 == xmmword_55EC99F56030</span><br><span class="line">    &amp;&amp; dword_55EC99F56040 == dword_55EC99F56100 )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加密函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_55EC99F53290</span><span class="params">(<span class="type">unsigned</span> __int8 *a1, <span class="type">char</span> *a2, _BYTE *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v3 = (<span class="type">unsigned</span> __int8)a2[<span class="number">3</span>];                  <span class="comment">// v3=0x75</span></span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">  v5 = *a2;                                     <span class="comment">// v5=0x7E</span></span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">  v8 = (<span class="type">unsigned</span> __int8)a2[<span class="number">1</span>];                  <span class="comment">// v8=0x1F</span></span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (*a2 + v3);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = a2[<span class="number">2</span>];</span><br><span class="line">  v12 = v3 * (v6 + v7);</span><br><span class="line">  v13 = (v3 + v11) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (v11 - v5);</span><br><span class="line">  v15 = v5 * (v9 + v4);</span><br><span class="line">  *a3 = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(v6 * (v8 - v3));</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (v8 - v3) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (v8 - v3) + (v8 + v5) * (v9 - v6) + v10 - v15;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动调发现逻辑就是取四个字符一组进行加密处理 直接枚举爆破</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">enc</span><span class="params">(<span class="type">unsigned</span> __int8 *a1,<span class="type">unsigned</span> <span class="type">char</span> *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// di</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// si</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// r8</span></span><br><span class="line"></span><br><span class="line">	v3=<span class="number">0x75</span>;</span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">	v5=<span class="number">0x7E</span>;</span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v7 = a1[<span class="number">1</span>];</span><br><span class="line">	v8=<span class="number">0x1F</span>;</span><br><span class="line">  v9 = a1[<span class="number">2</span>];</span><br><span class="line">  v10 = (v6 + v4) * (<span class="number">0x7E</span> + <span class="number">0x75</span>);                 <span class="comment">// a2[0]=0x7E</span></span><br><span class="line">  v11 = <span class="number">0x19</span>;</span><br><span class="line">  v12 = <span class="number">0x75</span> * (v6 + v7);</span><br><span class="line">  v13 = (<span class="number">0x75</span> + <span class="number">0x19</span>) * (v7 - v4);</span><br><span class="line">  v14 = v4 * (<span class="number">0x19</span> - <span class="number">0x7E</span>);</span><br><span class="line">  v15 = <span class="number">0x7E</span> * (v9 + v4);</span><br><span class="line">  a3[<span class="number">0</span>] = v14 + v10 + v13 - v12;</span><br><span class="line">  a3[<span class="number">2</span>] = v15 + v14;</span><br><span class="line">  a3[<span class="number">1</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0X75</span>) + v12;</span><br><span class="line">  a3[<span class="number">3</span>] = v6 * (<span class="number">0x1F</span> - <span class="number">0x75</span>) + (<span class="number">0x1f</span> + <span class="number">0x7e</span>) * (v9 - v6) + v10 - v15;</span><br><span class="line">	a3[<span class="number">0</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">1</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">2</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">	a3[<span class="number">3</span>]&amp;=<span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a1[<span class="number">4</span>],a3[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> c1[]=&#123;<span class="number">122</span>,<span class="number">173</span>,<span class="number">239</span>,<span class="number">153</span>,<span class="number">5</span>,<span class="number">109</span>,<span class="number">118</span>,<span class="number">172</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c2[]=&#123;</span><br><span class="line">		<span class="number">8</span>,<span class="number">175</span>,<span class="number">216</span>,<span class="number">235</span>,<span class="number">67</span>,<span class="number">10</span>,<span class="number">100</span>,<span class="number">242</span>,<span class="number">117</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c3[]=&#123;</span><br><span class="line">		<span class="number">46</span>,<span class="number">130</span>,<span class="number">13</span>,<span class="number">42</span>,<span class="number">159</span>,<span class="number">127</span>,<span class="number">47</span>,<span class="number">201</span>,<span class="number">181</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> c4[]=&#123;</span><br><span class="line">		<span class="number">186</span>,<span class="number">140</span>,<span class="number">248</span>,<span class="number">22</span>,<span class="number">200</span>,<span class="number">190</span>,<span class="number">169</span>,<span class="number">71</span>,<span class="number">51</span></span><br><span class="line">	&#125;;</span><br><span class="line">	string flag=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> _=<span class="number">0</span>;_&lt;<span class="number">9</span>;_++)&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">32</span>;a&lt;=<span class="number">128</span>;a++)</span><br><span class="line">		&#123;</span><br><span class="line"><span class="comment">//		cout&lt;&lt;a&lt;&lt;&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">32</span>;b&lt;=<span class="number">128</span>;b++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> c=<span class="number">32</span>;c&lt;=<span class="number">128</span>;c++)</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> d=<span class="number">32</span>;d&lt;=<span class="number">128</span>;d++)</span><br><span class="line">				&#123;</span><br><span class="line">					a1[<span class="number">0</span>]=a,a1[<span class="number">1</span>]=b,a1[<span class="number">2</span>]=c,a1[<span class="number">3</span>]=d;</span><br><span class="line">					<span class="built_in">enc</span>(a1,a3);</span><br><span class="line">					<span class="keyword">if</span>(a3[<span class="number">0</span>]==c1[_]&amp;&amp;a3[<span class="number">1</span>]==c2[_]&amp;&amp;a3[<span class="number">2</span>]==c3[_]&amp;&amp;a3[<span class="number">3</span>]==c4[_])&#123;</span><br><span class="line">						cout&lt;&lt;<span class="built_in">char</span>(a)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(b)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(c)&lt;&lt;<span class="string">&quot;&quot;</span>&lt;&lt;<span class="built_in">char</span>(d)&lt;&lt;<span class="string">&quot;&quot;</span>;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>flag</strong> : NCTF{f6dffab6-173f-4bb1-a973-62f3f8254eba}</p>
<h2 id="just-run-it"><a href="#just-run-it" class="headerlink" title="just_run_it"></a>just_run_it</h2><p>神奇的cosmopolitan Linux Windows都能跑<br>找到关键函数 先输一个16的key 再输flag<br>输入的key做了一个乱序的映射 可以通过动调找到对应关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">428100: 1234567890abcdef</span><br><span class="line">428180: 1267358c49bd0aef</span><br></pre></td></tr></table></figure>

<p>key的逻辑是先乱序一道 然后作了个xor 再乱序一道 然后与unk_425180 check<br>对应还原 得到<br><code>W1lc0menctf2o2o!</code></p>
<p>然后后面的加密发现sbox Google常量发现是sm4<br>找到enc值 <a target="_blank" rel="noopener" href="https://the-x.cn/zh-cn/cryptography/Sm4.aspx">在线网站</a> 解就完了</p>
<p><strong>NCTF{b23a271e-2b15-4bb5-9719-738cffb83919}</strong></p>
<h1 id="NCTF2018"><a href="#NCTF2018" class="headerlink" title="NCTF2018"></a>NCTF2018</h1><h2 id="wcyvm"><a href="#wcyvm" class="headerlink" title="wcyvm"></a>wcyvm</h2><p>一道虚拟机opcode的题<br>逆出flag不难(事实上 意外的简单…) 但是整体opcode有些点还是需要仔细琢磨的<br>在之前做的几道基础上增加了一点寻址方式的考察</p>
<p>逐个分析:<br>case 0x8<br>寄存器赋值<br>case 0x9<br>这里没怎么搞懂</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sub_40096D</span>(v4[*(_DWORD *)(v5[<span class="number">0</span>] + <span class="number">4</span>) - <span class="number">1</span>], &amp;v4[<span class="number">4</span>], v5);</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_QWORD *__fastcall <span class="title">sub_40096D</span><span class="params">(_DWORD *a1, _DWORD **a2, _QWORD *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a1 = *(*a2)++;</span><br><span class="line">  result = a3;</span><br><span class="line">  *a3 += <span class="number">8LL</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结合case 0xa的类似代码 我是把这里归为类似push&#x2F;pop 这种堆栈操作</p>
<p>case 0xa</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sub_400927</span>(v4[*(_DWORD *)(v5[<span class="number">0</span>] + <span class="number">4</span>) - <span class="number">1</span>], &amp;v4[<span class="number">4</span>], v5);</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_QWORD *__fastcall <span class="title">sub_400927</span><span class="params">(_DWORD *a1, _QWORD *a2, _QWORD *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a2 -= <span class="number">4LL</span>;</span><br><span class="line">  *(_DWORD *)*a2 = *a1;</span><br><span class="line">  result = a3;</span><br><span class="line">  *a3 += <span class="number">8LL</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>case 0xb<br>getchar<br>case 0xc<br>putchar<br>case 0xd<br>cmp 只是这里置标志位的方法比较独特 结合后面je&#x2F;jne分析其实跟正常置0&#x2F;1作用是一样的<br>case 0xe<br>jmp<br>case 0xf<br>jne<br>case 0x10<br>je<br>case 0x11<br>inc<br>case 0x12<br>dec<br>case 0x13<br>add<br>case 0x14<br>sub<br>case 0x15<br>xor<br>case 0x16<br>and<br>case 0x17<br>or<br>case 0x19 ~ case 0x1c<br>四种不同的赋值(变量类型不同)<br>case 0x1d<br>mul<br>case 0x64<br>check_flag</p>
<p>这么处理 打印出来的字节码就是这种:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">0 mov v4[0] 0</span><br><span class="line">3 mov v4[2] 70</span><br><span class="line">6 jmp 13</span><br><span class="line">8 push v4[0]</span><br><span class="line">10 pop v4[1]</span><br><span class="line">12 mov v4[0] getchar()</span><br><span class="line">13 push v4[0]</span><br><span class="line">15 push v4[1]</span><br><span class="line">17 pop v4[0]</span><br><span class="line">19 inc v4[0]</span><br><span class="line">21 cmp v4[0] v4[2]</span><br><span class="line">24 jne 8</span><br><span class="line">26 mov v4[0] 0</span><br><span class="line">29 mov v4[2] 71</span><br><span class="line">32 jmp 13</span><br><span class="line">34 push v4[0]</span><br><span class="line">36 mov v4[1] v4[5]</span><br><span class="line">39 mul v4[0] 4</span><br><span class="line">42 sub v4[1] v4[0]</span><br><span class="line">45 mov v4[0] v4[1]</span><br><span class="line">48 mov v4[0] v4[0]</span><br><span class="line">51 mul v4[0] 110</span><br><span class="line">54 add v4[0] 99</span><br><span class="line">57 xor v4[0] 116</span><br><span class="line">60 add v4[0] 102</span><br><span class="line">63 mov v4[1] v4[0]</span><br><span class="line">66 pop v4[0]</span><br><span class="line">68 inc v4[0]</span><br><span class="line">70 cmp v4[0] v4[2]</span><br><span class="line">73 jne 34</span><br><span class="line">75 check_flag</span><br></pre></td></tr></table></figure>

<p>可以发现 有几个点真的很奇怪 但是对于input的变换一眼就能看出来…<br>同时 在check_flag中能找到对应的enc[] 爆破解就完了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x000036D3</span>, <span class="number">0x00002AFF</span>, <span class="number">0x00002ACB</span>, <span class="number">0x00002B95</span>, <span class="number">0x00002B95</span>, <span class="number">0x00002B95</span>, <span class="number">0x0000169F</span>, <span class="number">0x0000186D</span>, <span class="number">0x000018D7</span>, <span class="number">0x00001611</span>, <span class="number">0x000018D7</span>, <span class="number">0x00002B95</span>, <span class="number">0x00002C23</span>, <span class="number">0x00002CA9</span>, <span class="number">0x00001611</span>, <span class="number">0x00001611</span>, <span class="number">0x000018D7</span>, <span class="number">0x00002AFF</span>, <span class="number">0x00001849</span>, <span class="number">0x000018FB</span>, <span class="number">0x00002ACB</span>, <span class="number">0x00002A71</span>, <span class="number">0x00001735</span>, <span class="number">0x000018D7</span>, <span class="number">0x00001611</span>, <span class="number">0x00002ACB</span>, <span class="number">0x000015DD</span>, <span class="number">0x000018D7</span>, <span class="number">0x00002C23</span>, <span class="number">0x0000169F</span>, <span class="number">0x000015DD</span>, <span class="number">0x00002B95</span>, <span class="number">0x0000169F</span>, <span class="number">0x0000156B</span>, <span class="number">0x0000186D</span>, <span class="number">0x00002AFF</span>, <span class="number">0x00001611</span>, <span class="number">0x00001611</span>, <span class="number">0x000015DD</span>, <span class="number">0x00002AFF</span>, <span class="number">0x00002C23</span>, <span class="number">0x00002ACB</span>, <span class="number">0x000015DD</span>, <span class="number">0x000015DD</span>, <span class="number">0x0000186D</span>, <span class="number">0x00001849</span>, <span class="number">0x00002B95</span>, <span class="number">0x0000156B</span>, <span class="number">0x00001735</span>, <span class="number">0x000018FB</span>, <span class="number">0x000018FB</span>, <span class="number">0x00002A71</span>, <span class="number">0x00002AFF</span>, <span class="number">0x00001735</span>, <span class="number">0x00002C23</span>, <span class="number">0x000015DD</span>, <span class="number">0x000018D7</span>, <span class="number">0x00002A71</span>, <span class="number">0x000018D7</span>, <span class="number">0x000018D7</span>, <span class="number">0x00002C23</span>, <span class="number">0x00002AFF</span>, <span class="number">0x0000156B</span>, <span class="number">0x00002C23</span>, <span class="number">0x0000169F</span>, <span class="number">0x000035AF</span>, <span class="number">0x00002CA9</span>, <span class="number">0x000032B5</span>, <span class="number">0x00002AFF</span>, <span class="number">0x00003039</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span>(c==<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        y = (<span class="number">110</span>*x+<span class="number">99</span>)^<span class="number">116</span></span><br><span class="line">        y += <span class="number">102</span></span><br><span class="line">        <span class="keyword">if</span>(y==c):</span><br><span class="line">            flag += <span class="built_in">chr</span>(x)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(flag[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># nctf&#123;3e1ce77b70e4cb9941d6800aec022c813d03e70a274ba96c722fed72783dddac&#125;</span></span><br></pre></td></tr></table></figure>

<p>flag:<br><strong>nctf{3e1ce77b70e4cb9941d6800aec022c813d03e70a274ba96c722fed72783dddac}</strong></p>
<hr>
<hr>
<p>至于为什么倒序 其实字节码可以看出来<br>这里:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">36 mov v4[1] v4[5]</span><br><span class="line">39 mul v4[0] 4</span><br><span class="line">42 sub v4[1] v4[0]</span><br><span class="line">45 mov v4[0] v4[1]</span><br><span class="line">48 mov v4[0] v4[0]</span><br></pre></td></tr></table></figure>

<p>这里的v4[5]就是我们input放入的栈的栈顶指针<br>可以看到这里是 sub v4[1] v4[0] 所以是从栈顶取的 也就是入栈顺序倒序<br>48处那个看似没用的语句是将v4[0]地址对应的值赋给v4[0] 相当于取地址<br>这就是前面那4个变量类型不同的赋值</p>
<p>最后 得到flag又去看了看其他师傅的写法 对那四个赋值区别有了更深了解<br>0x19:<br>直接赋值 mov a1 a2</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_QWORD *__fastcall <span class="title">sub_400858</span><span class="params">(_DWORD *a1, _DWORD *a2, _QWORD *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a1 = *a2;</span><br><span class="line">  result = a3;</span><br><span class="line">  *a3 += <span class="number">12LL</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>0x1a:<br>取a2的地址给a1 lea a1 a2</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_QWORD *__fastcall <span class="title">sub_400889</span><span class="params">(_DWORD *a1, <span class="type">int</span> a2, _QWORD *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a1 = a2;</span><br><span class="line">  result = a3;</span><br><span class="line">  *a3 += <span class="number">12LL</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>0x1b:<br>寄存器间接寻址 mov a1 [a2]</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_QWORD *__fastcall <span class="title">sub_4008BA</span><span class="params">(_DWORD *a1, <span class="type">unsigned</span> <span class="type">int</span> *a2, _QWORD *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a1 = *(_DWORD *)*a2;</span><br><span class="line">  result = a3;</span><br><span class="line">  *a3 += <span class="number">12LL</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>0x1c:<br>mov [a1] a2</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_QWORD *__fastcall <span class="title">sub_4008EF</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, _DWORD *a2, _QWORD *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *(_DWORD *)*a1 = *a2;</span><br><span class="line">  result = a3;</span><br><span class="line">  *a3 += <span class="number">12LL</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽说字节码还是有点怪 但是理解opcode本质后 题目的训练目的就达到了</p>
<h1 id="NUAACTF2020"><a href="#NUAACTF2020" class="headerlink" title="NUAACTF2020"></a>NUAACTF2020</h1><h2 id="demium"><a href="#demium" class="headerlink" title="demium"></a>demium</h2><p>32位.NET<br>dnspy找半天找不到关键函数 搁着就没找到入口点…<br>瞎翻函数列表 翻到个 	internal unsafe static void EncryptStr(char* input)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">unsafe</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EncryptStr</span>(<span class="params"><span class="built_in">char</span>* input</span>)</span></span><br><span class="line">    &#123; <span class="comment">// H[]作为索引  W中的下标取得是 H[xxx]*2  刚好H:0~69      W: 0~136</span></span><br><span class="line">        $ArrayType$$$BY0EF@H $ArrayType$$$BY0EF@H = <span class="number">45</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">4</span>) = <span class="number">15</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">8</span>) = <span class="number">67</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">12</span>) = <span class="number">61</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">16</span>) = <span class="number">8</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">20</span>) = <span class="number">68</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">24</span>) = <span class="number">9</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">28</span>) = <span class="number">39</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">32</span>) = <span class="number">60</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">36</span>) = <span class="number">2</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">40</span>) = <span class="number">56</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">44</span>) = <span class="number">63</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">48</span>) = <span class="number">36</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">52</span>) = <span class="number">38</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">56</span>) = <span class="number">28</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">60</span>) = <span class="number">29</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">64</span>) = <span class="number">57</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">68</span>) = <span class="number">50</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">72</span>) = <span class="number">1</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">76</span>) = <span class="number">0</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">80</span>) = <span class="number">51</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">84</span>) = <span class="number">52</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">88</span>) = <span class="number">17</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">92</span>) = <span class="number">3</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">96</span>) = <span class="number">26</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">100</span>) = <span class="number">21</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">104</span>) = <span class="number">40</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">108</span>) = <span class="number">11</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">112</span>) = <span class="number">37</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">116</span>) = <span class="number">16</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">120</span>) = <span class="number">31</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">124</span>) = <span class="number">22</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">128</span>) = <span class="number">32</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">132</span>) = <span class="number">19</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">136</span>) = <span class="number">33</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">140</span>) = <span class="number">4</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">144</span>) = <span class="number">66</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">148</span>) = <span class="number">53</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">152</span>) = <span class="number">65</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">156</span>) = <span class="number">25</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">160</span>) = <span class="number">41</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">164</span>) = <span class="number">44</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">168</span>) = <span class="number">20</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">172</span>) = <span class="number">7</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">176</span>) = <span class="number">12</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">180</span>) = <span class="number">18</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">184</span>) = <span class="number">64</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">188</span>) = <span class="number">30</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">192</span>) = <span class="number">49</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">196</span>) = <span class="number">58</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">200</span>) = <span class="number">10</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">204</span>) = <span class="number">62</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">208</span>) = <span class="number">24</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">212</span>) = <span class="number">43</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">216</span>) = <span class="number">48</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">220</span>) = <span class="number">46</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">224</span>) = <span class="number">6</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">228</span>) = <span class="number">47</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">232</span>) = <span class="number">13</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">236</span>) = <span class="number">35</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">240</span>) = <span class="number">42</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">244</span>) = <span class="number">14</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">248</span>) = <span class="number">59</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">252</span>) = <span class="number">23</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">256</span>) = <span class="number">27</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">260</span>) = <span class="number">34</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">264</span>) = <span class="number">54</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">268</span>) = <span class="number">55</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@H + <span class="number">272</span>) = <span class="number">5</span>;</span><br><span class="line">        $ArrayType$$$BY0EF@_W $ArrayType$$$BY0EF@_W = <span class="number">65</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">2</span>) = <span class="number">66</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">4</span>) = <span class="number">67</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">6</span>) = <span class="number">68</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">8</span>) = <span class="number">69</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">10</span>) = <span class="number">70</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">12</span>) = <span class="number">71</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">14</span>) = <span class="number">72</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">16</span>) = <span class="number">73</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">18</span>) = <span class="number">74</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">20</span>) = <span class="number">75</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">22</span>) = <span class="number">76</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">24</span>) = <span class="number">77</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">26</span>) = <span class="number">78</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">28</span>) = <span class="number">79</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">30</span>) = <span class="number">80</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">32</span>) = <span class="number">81</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">34</span>) = <span class="number">82</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">36</span>) = <span class="number">83</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">38</span>) = <span class="number">84</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">40</span>) = <span class="number">85</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">42</span>) = <span class="number">86</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">44</span>) = <span class="number">87</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">46</span>) = <span class="number">88</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">48</span>) = <span class="number">89</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">50</span>) = <span class="number">90</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">52</span>) = <span class="number">97</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">54</span>) = <span class="number">98</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">56</span>) = <span class="number">99</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">58</span>) = <span class="number">100</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">60</span>) = <span class="number">101</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">62</span>) = <span class="number">102</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">64</span>) = <span class="number">103</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">66</span>) = <span class="number">104</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">68</span>) = <span class="number">105</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">70</span>) = <span class="number">106</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">72</span>) = <span class="number">107</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">74</span>) = <span class="number">108</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">76</span>) = <span class="number">109</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">78</span>) = <span class="number">110</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">80</span>) = <span class="number">111</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">82</span>) = <span class="number">112</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">84</span>) = <span class="number">113</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">86</span>) = <span class="number">114</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">88</span>) = <span class="number">115</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">90</span>) = <span class="number">116</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">92</span>) = <span class="number">117</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">94</span>) = <span class="number">118</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">96</span>) = <span class="number">119</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">98</span>) = <span class="number">120</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">100</span>) = <span class="number">121</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">102</span>) = <span class="number">122</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">104</span>) = <span class="number">48</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">106</span>) = <span class="number">49</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">108</span>) = <span class="number">50</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">110</span>) = <span class="number">51</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">112</span>) = <span class="number">52</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">114</span>) = <span class="number">53</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">116</span>) = <span class="number">54</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">118</span>) = <span class="number">55</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">120</span>) = <span class="number">56</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">122</span>) = <span class="number">57</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">124</span>) = <span class="number">92</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">126</span>) = <span class="number">47</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">128</span>) = <span class="number">43</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">130</span>) = <span class="number">45</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">132</span>) = <span class="number">95</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">134</span>) = <span class="number">123</span>;</span><br><span class="line">        *(<span class="keyword">ref</span> $ArrayType$$$BY0EF@_W + <span class="number">136</span>) = <span class="number">125</span>;</span><br><span class="line">        <span class="built_in">char</span>* ptr = input;</span><br><span class="line">        <span class="keyword">if</span> (*input != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">                ptr++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (*(<span class="built_in">short</span>*)ptr != <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">int</span> num = ptr - input / <span class="number">2</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">string</span> text = <span class="literal">null</span>;</span><br><span class="line">        <span class="built_in">int</span> num2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> &lt; num)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (;;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> num3 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (;;)</span><br><span class="line">                &#123;</span><br><span class="line">                    $ArrayType$$$BY0EF@_W* ptr2 = &amp;$ArrayType$$$BY0EF@_W;</span><br><span class="line">                    <span class="keyword">do</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        ptr2 += <span class="number">2</span> / <span class="keyword">sizeof</span>($ArrayType$$$BY0EF@_W);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">while</span> (*(<span class="built_in">short</span>*)ptr2 != <span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span> (num3 &gt;= ptr2 - <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W / <span class="keyword">sizeof</span>($ArrayType$$$BY0EF@_W) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">goto</span> IL_52F;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (*(num2 * <span class="number">2</span> + input) == *(num3 * <span class="number">2</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W))</span><br><span class="line">                    <span class="comment">// 找索引    input[num2] == W[num3]</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">goto</span> IL_510;</span><br><span class="line">                    &#125;</span><br><span class="line">                    num3++;</span><br><span class="line">                &#125;</span><br><span class="line">                IL_53B:</span><br><span class="line">                num2++;</span><br><span class="line">                <span class="keyword">if</span> (num2 &gt;= num)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">                IL_510:</span><br><span class="line">                <span class="keyword">if</span> (num3 != <span class="number">-1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    text += (<span class="built_in">char</span>)(*(*(num3 * <span class="number">4</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@H) * <span class="number">2</span> + <span class="keyword">ref</span> $ArrayType$$$BY0EF@_W));</span><br><span class="line">                    <span class="comment">// text += W[ 2*H[num3] ]</span></span><br><span class="line">                    <span class="keyword">goto</span> IL_53B;</span><br><span class="line">                &#125;</span><br><span class="line">                IL_52F:</span><br><span class="line">                text += <span class="string">&quot;=&quot;</span>;   <span class="comment">// base64???</span></span><br><span class="line">                <span class="keyword">goto</span> IL_53B;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Console.WriteLine(text);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这里大致分析下就知道是两次索引变换 逆回去即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">$ArrayType$$$BY0EF@_W $ArrayType$$$BY0EF@_W = 65;</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@_W + 136) = 125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">s = s[:-<span class="number">1</span>]</span><br><span class="line">W = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    c = c.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    W.append(c[<span class="number">1</span>].strip())</span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">$ArrayType$$$BY0EF@H $ArrayType$$$BY0EF@H = 45;</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        *(ref $ArrayType$$$BY0EF@H + 272) = 5;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">s = s[:-<span class="number">1</span>]</span><br><span class="line">H = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    c = c.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    H.append(c[<span class="number">1</span>].strip())</span><br><span class="line">W = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> W]</span><br><span class="line">H = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> H]</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;W1og39p2Kp+2_Zpx2&#123;/yF&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    x = <span class="built_in">ord</span>(enc[i])</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">69</span>):</span><br><span class="line">        <span class="keyword">if</span> W[j]==x:</span><br><span class="line">            pos = j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    poss = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">69</span>):</span><br><span class="line">        <span class="keyword">if</span>(H[j]==pos):</span><br><span class="line">            poss = j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(W[poss]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># flag&#123;Do_you_know_CLR&#125;</span></span><br></pre></td></tr></table></figure>

<p>看到flag中的CLR 去学习了一波<br>CLR: 公共语言运行库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">公共语言运行库 (CLR) 是 .NET Framework 的核心，为所有 .NET Framework 代码提供执行环境。 在 CLR 中运行的代码称为托管代码。 </span><br><span class="line">CLR 提供执行程序所需的各种函数和服务，包括实时 (JIT) 编译、分配和管理内存、强制类型安全、异常处理、线程管理和安全性。</span><br></pre></td></tr></table></figure>

<p>这… 看了看官方题解 说的是这里的exe是一个带有.net环境的exe，也就是运行在CLR环境下的代码<br>然后题解说从IDA打开可以定位到可以函数的token: 6000008h 并不是一个真正的地址，而是C#中的函数metatoken，是C#用于定位函数集中每个函数的一个独一无二的标识符<br>所以再用dnspy打开时就可以用token来快速定位了 确实打开&lt; Module &gt;下能找到一系列带有token的函数 学到了</p>
<h1 id="DUCTF2023"><a href="#DUCTF2023" class="headerlink" title="DUCTF2023"></a>DUCTF2023</h1><h2 id="nt-flag-checker"><a href="#nt-flag-checker" class="headerlink" title="nt_flag_checker"></a>nt_flag_checker</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Q 7937</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ZETA 2805</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 256</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> POINTS[N] = &#123;<span class="number">4074</span>, <span class="number">1455</span>, <span class="number">891</span>, <span class="number">5096</span>, <span class="number">28</span>, <span class="number">6122</span>, <span class="number">2068</span>, <span class="number">704</span>, <span class="number">4580</span>, <span class="number">6480</span>, <span class="number">4182</span>, <span class="number">5243</span>, <span class="number">2685</span>, <span class="number">1102</span>, <span class="number">2504</span>, <span class="number">3812</span>, <span class="number">211</span>, <span class="number">1006</span>, <span class="number">7596</span>, <span class="number">1530</span>, <span class="number">799</span>, <span class="number">5539</span>, <span class="number">727</span>, <span class="number">3313</span>, <span class="number">1335</span>, <span class="number">1226</span>, <span class="number">6120</span>, <span class="number">2296</span>, <span class="number">2504</span>, <span class="number">447</span>, <span class="number">1902</span>, <span class="number">3393</span>, <span class="number">6614</span>, <span class="number">3827</span>, <span class="number">1532</span>, <span class="number">116</span>, <span class="number">5742</span>, <span class="number">7236</span>, <span class="number">80</span>, <span class="number">2688</span>, <span class="number">7754</span>, <span class="number">1563</span>, <span class="number">1918</span>, <span class="number">3739</span>, <span class="number">6177</span>, <span class="number">6805</span>, <span class="number">4307</span>, <span class="number">2005</span>, <span class="number">5423</span>, <span class="number">611</span>, <span class="number">2984</span>, <span class="number">7520</span>, <span class="number">1011</span>, <span class="number">6977</span>, <span class="number">4891</span>, <span class="number">3979</span>, <span class="number">5721</span>, <span class="number">539</span>, <span class="number">4055</span>, <span class="number">4990</span>, <span class="number">2175</span>, <span class="number">564</span>, <span class="number">4938</span>, <span class="number">4655</span>, <span class="number">6569</span>, <span class="number">7444</span>, <span class="number">6491</span>, <span class="number">2228</span>, <span class="number">4736</span>, <span class="number">1548</span>, <span class="number">5946</span>, <span class="number">6654</span>, <span class="number">4460</span>, <span class="number">4072</span>, <span class="number">6491</span>, <span class="number">7305</span>, <span class="number">2156</span>, <span class="number">2147</span>, <span class="number">3373</span>, <span class="number">4322</span>, <span class="number">6628</span>, <span class="number">4691</span>, <span class="number">6763</span>, <span class="number">6320</span>, <span class="number">37</span>, <span class="number">4509</span>, <span class="number">7870</span>, <span class="number">4644</span>, <span class="number">4028</span>, <span class="number">7076</span>, <span class="number">2827</span>, <span class="number">1921</span>, <span class="number">2992</span>, <span class="number">7316</span>, <span class="number">4806</span>, <span class="number">1375</span>, <span class="number">7264</span>, <span class="number">1471</span>, <span class="number">7446</span>, <span class="number">3743</span>, <span class="number">4069</span>, <span class="number">7613</span>, <span class="number">1284</span>, <span class="number">7933</span>, <span class="number">3439</span>, <span class="number">6909</span>, <span class="number">4150</span>, <span class="number">1543</span>, <span class="number">2862</span>, <span class="number">3452</span>, <span class="number">5114</span>, <span class="number">131</span>, <span class="number">246</span>, <span class="number">1700</span>, <span class="number">5230</span>, <span class="number">6932</span>, <span class="number">7176</span>, <span class="number">6984</span>, <span class="number">6837</span>, <span class="number">183</span>, <span class="number">2960</span>, <span class="number">2006</span>, <span class="number">6865</span>, <span class="number">1741</span>, <span class="number">3669</span>, <span class="number">7709</span>, <span class="number">7777</span>, <span class="number">5212</span>, <span class="number">6425</span>, <span class="number">3948</span>, <span class="number">5257</span>, <span class="number">7185</span>, <span class="number">4391</span>, <span class="number">4539</span>, <span class="number">2458</span>, <span class="number">1407</span>, <span class="number">2293</span>, <span class="number">1669</span>, <span class="number">3473</span>, <span class="number">5785</span>, <span class="number">6692</span>, <span class="number">7882</span>, <span class="number">4209</span>, <span class="number">4828</span>, <span class="number">3434</span>, <span class="number">4506</span>, <span class="number">5839</span>, <span class="number">6578</span>, <span class="number">6587</span>, <span class="number">7797</span>, <span class="number">2449</span>, <span class="number">6569</span>, <span class="number">3129</span>, <span class="number">1508</span>, <span class="number">4449</span>, <span class="number">6797</span>, <span class="number">1769</span>, <span class="number">4347</span>, <span class="number">7250</span>, <span class="number">751</span>, <span class="number">3892</span>, <span class="number">4899</span>, <span class="number">2216</span>, <span class="number">1746</span>, <span class="number">926</span>, <span class="number">1803</span>, <span class="number">3985</span>, <span class="number">705</span>, <span class="number">7416</span>, <span class="number">7029</span>, <span class="number">3965</span>, <span class="number">732</span>, <span class="number">4212</span>, <span class="number">175</span>, <span class="number">5538</span>, <span class="number">5673</span>, <span class="number">7441</span>, <span class="number">1352</span>, <span class="number">233</span>, <span class="number">1949</span>, <span class="number">7343</span>, <span class="number">2137</span>, <span class="number">3740</span>, <span class="number">1802</span>, <span class="number">3616</span>, <span class="number">6728</span>, <span class="number">5792</span>, <span class="number">433</span>, <span class="number">606</span>, <span class="number">6487</span>, <span class="number">4409</span>, <span class="number">4080</span>, <span class="number">1699</span>, <span class="number">967</span>, <span class="number">2789</span>, <span class="number">6314</span>, <span class="number">3146</span>, <span class="number">7452</span>, <span class="number">510</span>, <span class="number">4973</span>, <span class="number">1970</span>, <span class="number">5900</span>, <span class="number">5413</span>, <span class="number">1254</span>, <span class="number">146</span>, <span class="number">7665</span>, <span class="number">5124</span>, <span class="number">3622</span>, <span class="number">6258</span>, <span class="number">4063</span>, <span class="number">3456</span>, <span class="number">5228</span>, <span class="number">1387</span>, <span class="number">7359</span>, <span class="number">5885</span>, <span class="number">997</span>, <span class="number">3072</span>, <span class="number">884</span>, <span class="number">2780</span>, <span class="number">0</span>, <span class="number">222</span>, <span class="number">4840</span>, <span class="number">1193</span>, <span class="number">4913</span>, <span class="number">984</span>, <span class="number">2608</span>, <span class="number">2291</span>, <span class="number">1551</span>, <span class="number">6595</span>, <span class="number">7810</span>, <span class="number">5811</span>, <span class="number">7147</span>, <span class="number">682</span>, <span class="number">5000</span>, <span class="number">4413</span>, <span class="number">7743</span>, <span class="number">6106</span>, <span class="number">4231</span>, <span class="number">4336</span>, <span class="number">6047</span>, <span class="number">3478</span>, <span class="number">1935</span>, <span class="number">6396</span>, <span class="number">2303</span>, <span class="number">4407</span>, <span class="number">6919</span>, <span class="number">4488</span>, <span class="number">5276</span>, <span class="number">2171</span>, <span class="number">5376</span>, <span class="number">7662</span>, <span class="number">700</span>, <span class="number">3059</span>, <span class="number">1277</span>, <span class="number">4674</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">br</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="type">int</span> y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">        y &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        y |= (x &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">powmod</span><span class="params">(<span class="type">int</span> base, <span class="type">int</span> <span class="built_in">exp</span>, <span class="type">int</span> mod)</span> &#123;</span><br><span class="line">    base %= mod;</span><br><span class="line">    <span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">exp</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">exp</span> &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            res = (res * base) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">        base = (base * base) % mod;</span><br><span class="line">        <span class="built_in">exp</span> &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">transform</span><span class="params">(<span class="type">int</span> r[N])</span> &#123;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">128</span>;</span><br><span class="line">    <span class="keyword">while</span>(l &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(start &lt; <span class="number">256</span>) &#123;</span><br><span class="line">            <span class="type">int</span> zeta = powmod(ZETA, br(k++), Q);</span><br><span class="line">            <span class="keyword">for</span>(j = start; j &lt; start + l; j++) &#123;</span><br><span class="line">                <span class="type">int</span> t = (zeta * r[j + l]) % Q;</span><br><span class="line">                r[j + l] = (r[j] - t) % Q;</span><br><span class="line">                r[j] = (r[j] + t) % Q;</span><br><span class="line">            &#125;</span><br><span class="line">            start = j + l;</span><br><span class="line">        &#125;</span><br><span class="line">        l &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">poly_eval</span><span class="params">(<span class="type">int</span> r[N], <span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="type">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        s *= x;</span><br><span class="line">        s += r[N - i - <span class="number">1</span>];</span><br><span class="line">        s %= Q;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;What is the flag? &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> inp[N];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%256s&quot;</span>, inp);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> poly[N] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(inp);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        poly[i] = inp[i] * <span class="number">61</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    transform(poly);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> good = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>((poly_eval(poly, i) - POINTS[i<span class="number">-1</span>]) % Q != <span class="number">0</span>) &#123;</span><br><span class="line">            good = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(good) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Incorrect!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h2 id="wrong-signal"><a href="#wrong-signal" class="headerlink" title="wrong-signal"></a>wrong-signal</h2><p>没搞懂逻辑啊 虽说猜到是个maze 但是这个sigaction属实没搞懂<br>等找到WP(带点解析的…)再来看吧</p>
<h2 id="SPACEGAME"><a href="#SPACEGAME" class="headerlink" title="SPACEGAME"></a>SPACEGAME</h2><p>lua逆向…<br>思路倒是学到了 全局hook的思想 打印关键信息(哪个函数kill了进程)<br>然后给他override掉 开启无敌模式<br>但是对lua不熟悉 以后再来看吧</p>
<h1 id="ACTF2022"><a href="#ACTF2022" class="headerlink" title="ACTF2022"></a>ACTF2022</h1><h2 id="dropper"><a href="#dropper" class="headerlink" title="dropper"></a>dropper</h2><p>逆了好久好久…</p>
<p>IDA打开 main<br>将函数符号化后逻辑比较清晰</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+30h] [rbp+0h] BYREF</span></span><br><span class="line">  HMODULE ModuleHandleW; <span class="comment">// [rsp+38h] [rbp+8h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+58h] [rbp+28h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+78h] [rbp+48h]</span></span><br><span class="line">  __int64 v10[<span class="number">3</span>]; <span class="comment">// [rsp+98h] [rbp+68h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// [rsp+B4h] [rbp+84h]</span></span><br><span class="line">  <span class="type">int</span> ExitCode[<span class="number">9</span>]; <span class="comment">// [rsp+D4h] [rbp+A4h] BYREF</span></span><br><span class="line">  HANDLE hHandle[<span class="number">3</span>]; <span class="comment">// [rsp+F8h] [rbp+C8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v14[<span class="number">26</span>]; <span class="comment">// [rsp+130h] [rbp+100h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+1B4h] [rbp+184h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">106</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF6D0925100, argv, envp);</span><br><span class="line">  sub_7FF6D09013D4();</span><br><span class="line">  ModuleHandleW = GetModuleHandleW(<span class="number">0</span>i64);</span><br><span class="line">  v8 = FindResourceWqword_7FF6D091AA58(ModuleHandleW, <span class="number">101</span>i64, <span class="number">256</span>i64);<span class="comment">// 加载了自带resource 256</span></span><br><span class="line">  v9 = LoadResourceqword_7FF6D091AA60(ModuleHandleW, v8);</span><br><span class="line">  v10[<span class="number">0</span>] = LockResourceqword_7FF6D091AA68(v9);</span><br><span class="line">  v11 = SizeOfResourceqword_7FF6D091AA70(ModuleHandleW, v8);</span><br><span class="line">  v10[<span class="number">0</span>] = sub_7FF6D09013D9(v10[<span class="number">0</span>], v11);       <span class="comment">// ^=0x73 解密</span></span><br><span class="line">  ExitCode[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  j_memset(hHandle, <span class="number">0</span>, <span class="keyword">sizeof</span>(hHandle));</span><br><span class="line">  j_memset(v14, <span class="number">0</span>, <span class="keyword">sizeof</span>(v14));</span><br><span class="line">  LOWORD(v15) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_7FF6D09015C3((<span class="type">int</span>)hHandle, (<span class="type">int</span>)v14, v10[<span class="number">0</span>], (<span class="type">int</span>)&amp;v15, <span class="number">2u</span>i64) )</span><br><span class="line">  &#123;</span><br><span class="line">    WaitForSingleObject(hHandle[<span class="number">0</span>], <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">    GetExitCodeProcess(hHandle[<span class="number">0</span>], (LPDWORD)ExitCode);</span><br><span class="line">    CloseHandle(hHandle[<span class="number">1</span>]);</span><br><span class="line">    CloseHandle(hHandle[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_7FF6D09014B0();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里加载了程序内的资源 256  然后xor 0x73进行解密<br>找到256资源xor后dump出来</p>
<p>main 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v6; <span class="comment">// r8</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 BASE64_INPUT; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v10; <span class="comment">// r8</span></span><br><span class="line">  __int64 v11; <span class="comment">// rax</span></span><br><span class="line">  __int64 v12; <span class="comment">// rax</span></span><br><span class="line">  __int64 v13; <span class="comment">// rax</span></span><br><span class="line">  __int64 v14; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">72</span>]; <span class="comment">// [rsp+28h] [rbp+8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">2040</span>]; <span class="comment">// [rsp+70h] [rbp+50h] BYREF</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v19)(_QWORD, __int64); <span class="comment">// [rsp+868h] [rbp+848h]</span></span><br><span class="line">  __int64 v20; <span class="comment">// [rsp+888h] [rbp+868h]</span></span><br><span class="line">  <span class="type">char</span> v21[<span class="number">3576</span>]; <span class="comment">// [rsp+8B0h] [rbp+890h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v22[<span class="number">64</span>]; <span class="comment">// [rsp+16A8h] [rbp+1688h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v23[<span class="number">64</span>]; <span class="comment">// [rsp+16E8h] [rbp+16C8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *v24; <span class="comment">// [rsp+1728h] [rbp+1708h]</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v25)(_QWORD, _QWORD); <span class="comment">// [rsp+1748h] [rbp+1728h]</span></span><br><span class="line">  <span class="type">void</span> *v26; <span class="comment">// [rsp+1768h] [rbp+1748h]</span></span><br><span class="line">  <span class="type">char</span> v27; <span class="comment">// [rsp+1788h] [rbp+1768h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *v28; <span class="comment">// [rsp+1F78h] [rbp+1F58h]</span></span><br><span class="line">  <span class="type">char</span> v29[<span class="number">64</span>]; <span class="comment">// [rsp+1F98h] [rbp+1F78h] BYREF</span></span><br><span class="line">  __int64 v30; <span class="comment">// [rsp+1FD8h] [rbp+1FB8h]</span></span><br><span class="line">  <span class="type">void</span> *v31; <span class="comment">// [rsp+1FF8h] [rbp+1FD8h]</span></span><br><span class="line">  <span class="type">char</span> v32[<span class="number">64</span>]; <span class="comment">// [rsp+2018h] [rbp+1FF8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v33[<span class="number">64</span>]; <span class="comment">// [rsp+2058h] [rbp+2038h] BYREF</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v34)(_QWORD, _QWORD); <span class="comment">// [rsp+2098h] [rbp+2078h]</span></span><br><span class="line">  <span class="type">int</span> v35; <span class="comment">// [rsp+20B4h] [rbp+2094h]</span></span><br><span class="line">  <span class="type">int</span> v36; <span class="comment">// [rsp+20D4h] [rbp+20B4h]</span></span><br><span class="line">  __int64 tmp_string; <span class="comment">// [rsp+20E8h] [rbp+20C8h]</span></span><br><span class="line">  __int64 v38; <span class="comment">// [rsp+20F0h] [rbp+20D0h]</span></span><br><span class="line">  <span class="type">void</span> (__fastcall ***v39)(_QWORD, _QWORD); <span class="comment">// [rsp+20F8h] [rbp+20D8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v16;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1726</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v36 = <span class="number">0</span>;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, argv, envp);</span><br><span class="line">  tmp_string = sub_7FF7ECAD128A((__int64)v22, (__int64)&amp;unk_7FF7ECAEE168, <span class="number">5</span>i64);</span><br><span class="line">  v38 = tmp_string;</span><br><span class="line">  sub_7FF7ECAD1735(<span class="built_in">std</span>::<span class="built_in">cout</span>, tmp_string);</span><br><span class="line">  sub_7FF7ECAD119A((__int64)v22);</span><br><span class="line">  sub_7FF7ECAD17DF((__int64)v17);</span><br><span class="line">  sub_7FF7ECAD1032(<span class="built_in">std</span>::<span class="built_in">cin</span>, v17);</span><br><span class="line">  tmp_string = STRLEN_0((__int64)v17);</span><br><span class="line">  v7 = GET_C_STR((__int64)v17, v5, v6);</span><br><span class="line">  BASE64_INPUT = sub_7FF7ECAD1320(v7, (<span class="type">unsigned</span> <span class="type">int</span>)tmp_string);<span class="comment">// base64</span></span><br><span class="line">  sub_7FF7ECAD1050((__int64)v17, BASE64_INPUT); <span class="comment">// v13=v6 ?</span></span><br><span class="line">  v24 = v23;</span><br><span class="line">  tmp_string = sub_7FF7ECAD1136((__int64)v23, (__int64)v17);</span><br><span class="line">  sub_7FF7ECAD1244(v18, tmp_string);</span><br><span class="line">  v26 = operator new(<span class="number">2016u</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( v26 )</span><br><span class="line">  &#123;</span><br><span class="line">    v28 = &amp;v27;</span><br><span class="line">    tmp_string = sub_7FF7ECAD128A((__int64)v29, (__int64)&amp;unk_7FF7ECAEF300, <span class="number">360</span>i64);</span><br><span class="line">    v38 = tmp_string;</span><br><span class="line">    v36 |= <span class="number">1u</span>;</span><br><span class="line">    v11 = GET_C_STR(tmp_string, v9, v10);</span><br><span class="line">    v12 = STRING_TO_BIGNUM((__int64)v28, v11);</span><br><span class="line">    v39 = (<span class="type">void</span> (__fastcall ***)(_QWORD, _QWORD))sub_7FF7ECAD1433((__int64)v26, v12);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v39 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v25 = v39;</span><br><span class="line">  v19 = v39;</span><br><span class="line">  <span class="keyword">if</span> ( (v36 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v36 &amp;= ~<span class="number">1u</span>;</span><br><span class="line">    sub_7FF7ECAD119A((__int64)v29);</span><br><span class="line">  &#125;</span><br><span class="line">  j_TO_CALCULATION((__int64)v19);               <span class="comment">// calcultaion</span></span><br><span class="line">  v31 = operator new(<span class="number">0x7D4</span>ui64);</span><br><span class="line">  <span class="keyword">if</span> ( v31 )</span><br><span class="line">    tmp_string = STR_COPY_0((__int64)v31, (__int64)v18);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    tmp_string = <span class="number">0</span>i64;</span><br><span class="line">  v30 = tmp_string;</span><br><span class="line">  v20 = tmp_string;</span><br><span class="line">  (**v19)(v19, tmp_string);</span><br><span class="line">  SUB(v20, (__int64)v21, (__int64)(v19 + <span class="number">1</span>));   <span class="comment">// !</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_7FF7ECAD1014((__int64)v21) )</span><br><span class="line">  &#123;</span><br><span class="line">    tmp_string = sub_7FF7ECAD128A((__int64)v32, (__int64)&amp;unk_7FF7ECAEF910, <span class="number">4</span>i64);</span><br><span class="line">    v38 = tmp_string;</span><br><span class="line">    v13 = sub_7FF7ECAD1735(<span class="built_in">std</span>::<span class="built_in">cout</span>, tmp_string);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v13, sub_7FF7ECAD105A);</span><br><span class="line">    sub_7FF7ECAD119A((__int64)v32);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    tmp_string = sub_7FF7ECAD128A((__int64)v33, (__int64)&amp;unk_7FF7ECAEF920, <span class="number">5</span>i64);</span><br><span class="line">    v38 = tmp_string;</span><br><span class="line">    v14 = sub_7FF7ECAD1735(<span class="built_in">std</span>::<span class="built_in">cout</span>, tmp_string);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v14, sub_7FF7ECAD105A);</span><br><span class="line">    sub_7FF7ECAD119A((__int64)v33);</span><br><span class="line">  &#125;</span><br><span class="line">  v34 = v19;</span><br><span class="line">  <span class="keyword">if</span> ( v19 )</span><br><span class="line">    tmp_string = sub_7FF7ECAD1316((__int64)v34, <span class="number">1</span>i64);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    tmp_string = <span class="number">0</span>i64;</span><br><span class="line">  v35 = <span class="number">0</span>;</span><br><span class="line">  sub_7FF7ECAD119A((__int64)v17);</span><br><span class="line">  <span class="keyword">return</span> v35;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里很考察基本功 能否将一些函数正确符号化便于审代码<br>STRLEN:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECADCEA0</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF604A, a2, a3);</span><br><span class="line">  <span class="keyword">return</span> *(_QWORD *)(a1 + <span class="number">24</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GET_C_STR:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECADA8E0</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+28h] [rbp+8h]</span></span><br><span class="line"></span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF604A, a2, a3);</span><br><span class="line">  v4 = a1 + <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_7FF7ECAD17C1(a1) )</span><br><span class="line">    <span class="keyword">return</span> sub_7FF7ECAD17FD(*(_QWORD *)(a1 + <span class="number">8</span>));</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重点是要识别出if(v26)中的那个STRING_TO_NUM！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">sub_7FF7ECAD6890</span><span class="params">(_DWORD *a1, <span class="type">const</span> <span class="type">char</span> *a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+A4h] [rbp+84h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+C4h] [rbp+A4h]</span></span><br><span class="line"></span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  j_memset(a1, <span class="number">0</span>, <span class="number">0x7D0</span>ui64);</span><br><span class="line">  v7 = j_strlen(a2);</span><br><span class="line">  a1[<span class="number">500</span>] = v7 / <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v7 % <span class="number">4</span> )</span><br><span class="line">    ++a1[<span class="number">500</span>];</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = v7 - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -= <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    v5 = i - <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i - <span class="number">3</span> &lt; <span class="number">0</span> )</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( j = v5; j &lt;= i; ++j )</span><br><span class="line">      v4 = <span class="number">10</span> * v4 + a2[j] - <span class="number">48</span>;                <span class="comment">// char -&gt; num!!!</span></span><br><span class="line">    a1[v6++] = v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在sub_7FF7ECAD1433中可以看到有个虚函数表<br>能跳转到关键函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">CALCALCAL</span><span class="params">(__int64 a1, _DWORD *a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  v3 = &amp;v78;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">10918</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v90, (__int64)&amp;unk_7FF7ECAEE000, <span class="number">48</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v7 = GET_C_STR(v110, v5, v6);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v79, v7);</span><br><span class="line">  sub_7FF7ECAD119A(v90, v8, v9);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v91, (__int64)&amp;unk_7FF7ECAEE0C0, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v12 = GET_C_STR(v110, v10, v11);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v80, v12);</span><br><span class="line">  sub_7FF7ECAD119A(v91, v13, v14);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v92, (__int64)&amp;unk_7FF7ECAEE180, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v17 = GET_C_STR(v110, v15, v16);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v81, v17);</span><br><span class="line">  sub_7FF7ECAD119A(v92, v18, v19);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v93, (__int64)&amp;unk_7FF7ECAEE230, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v22 = GET_C_STR(v110, v20, v21);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v82, v22);</span><br><span class="line">  sub_7FF7ECAD119A(v93, v23, v24);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v94, (__int64)&amp;unk_7FF7ECAEE2C0, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v27 = GET_C_STR(v110, v25, v26);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v83, v27);</span><br><span class="line">  sub_7FF7ECAD119A(v94, v28, v29);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v95, (__int64)&amp;unk_7FF7ECAEE370, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v32 = GET_C_STR(v110, v30, v31);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v84, v32);</span><br><span class="line">  sub_7FF7ECAD119A(v95, v33, v34);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v96, (__int64)&amp;unk_7FF7ECAEE400, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v37 = GET_C_STR(v110, v35, v36);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v85, v37);</span><br><span class="line">  sub_7FF7ECAD119A(v96, v38, v39);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v97, (__int64)&amp;unk_7FF7ECAEE490, <span class="number">36</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v42 = GET_C_STR(v110, v40, v41);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v86, v42);</span><br><span class="line">  sub_7FF7ECAD119A(v97, v43, v44);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v98, (__int64)&amp;unk_7FF7ECAEE520, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v47 = GET_C_STR(v110, v45, v46);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v87, v47);</span><br><span class="line">  sub_7FF7ECAD119A(v98, v48, v49);</span><br><span class="line">  v110 = sub_7FF7ECAD128A((__int64)v99, (__int64)&amp;unk_7FF7ECAEE5D0, <span class="number">42</span>i64);</span><br><span class="line">  v111 = v110;</span><br><span class="line">  v52 = GET_C_STR(v110, v50, v51);</span><br><span class="line">  STRING_TO_BIGNUM((__int64)v88, v52);</span><br><span class="line">  sub_7FF7ECAD119A(v99, v53, v54);</span><br><span class="line">  STR_COPY_0(v89, (__int64)a2, v55);</span><br><span class="line">  v56 = j_ADD((__int64)v89, (__int64)v100, (__int64)v79);</span><br><span class="line">  STR_COPY(v89, v56, v57);</span><br><span class="line">  v58 = j_MUL((__int64)v89, (__int64)v101, (__int64)v80);</span><br><span class="line">  STR_COPY(v89, v58, v59);</span><br><span class="line">  v60 = SUB((__int64)v89, (__int64)v102, (__int64)v81);</span><br><span class="line">  STR_COPY(v89, v60, v61);</span><br><span class="line">  v62 = j_ADD((__int64)v89, (__int64)v103, (__int64)v82);</span><br><span class="line">  STR_COPY(v89, v62, v63);</span><br><span class="line">  v64 = j_MUL((__int64)v89, (__int64)v104, (__int64)v83);</span><br><span class="line">  STR_COPY(v89, v64, v65);</span><br><span class="line">  v66 = SUB((__int64)v89, (__int64)v105, (__int64)v84);</span><br><span class="line">  STR_COPY(v89, v66, v67);</span><br><span class="line">  v68 = j_ADD((__int64)v89, (__int64)v106, (__int64)v85);</span><br><span class="line">  STR_COPY(v89, v68, v69);</span><br><span class="line">  v70 = SUB((__int64)v89, (__int64)v107, (__int64)v86);</span><br><span class="line">  STR_COPY(v89, v70, v71);</span><br><span class="line">  v72 = j_ADD((__int64)v89, (__int64)v108, (__int64)v87);</span><br><span class="line">  STR_COPY(v89, v72, v73);</span><br><span class="line">  v74 = SUB((__int64)v89, (__int64)v109, (__int64)v88);</span><br><span class="line">  STR_COPY(v89, v74, v75);</span><br><span class="line">  <span class="keyword">return</span> STR_COPY(a2, (__int64)v89, v76);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里通过前面分析得到的SRTING_TO_NUM等函数可以知道这里是以万进制在做大数运算</p>
<p>ADD</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">ADD</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">500</span>]; <span class="comment">// [rsp+30h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+800h] [rbp+7E0h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+824h] [rbp+804h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+844h] [rbp+824h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+C14h] [rbp+BF4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">530</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  STR_COPY_0((__int64)v7, a1);</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(a3 + <span class="number">2000</span>) &lt;= *(_DWORD *)(a1 + <span class="number">2000</span>) )</span><br><span class="line">    v11 = *(_DWORD *)(a1 + <span class="number">2000</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v11 = *(_DWORD *)(a3 + <span class="number">2000</span>);</span><br><span class="line">  v10 = v11;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v10; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v7[j] += *(_DWORD *)(a3 + <span class="number">4</span>i64 * j);</span><br><span class="line">    <span class="keyword">if</span> ( v7[j] &gt; <span class="number">9999</span> )                         <span class="comment">// 进位</span></span><br><span class="line">    &#123;</span><br><span class="line">      ++v7[j + <span class="number">1</span>];</span><br><span class="line">      v7[j] -= <span class="number">10000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v7[v10] )</span><br><span class="line">    v8 = v10 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v8 = v10;</span><br><span class="line">  STR_COPY_0(a2, (__int64)v7);</span><br><span class="line">  <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MUL:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">MUL</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">500</span>]; <span class="comment">// [rsp+30h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+800h] [rbp+7E0h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+824h] [rbp+804h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+844h] [rbp+824h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+864h] [rbp+844h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+884h] [rbp+864h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+8A4h] [rbp+884h]</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// [rsp+C84h] [rbp+C64h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">562</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v7);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; *(_DWORD *)(a1 + <span class="number">2000</span>); ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    v14 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; *(_DWORD *)(a3 + <span class="number">2000</span>); ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = v11 + v7[k + j] + *(_DWORD *)(a3 + <span class="number">4</span>i64 * k) * *(_DWORD *)(a1 + <span class="number">4</span>i64 * j);</span><br><span class="line">      <span class="keyword">if</span> ( v12 &lt;= <span class="number">9999</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v11 = <span class="number">0</span>;</span><br><span class="line">        v7[k + j] = v12;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v13 = v12 % <span class="number">10000</span>;</span><br><span class="line">        v11 = v12 / <span class="number">10000</span>;</span><br><span class="line">        v7[k + j] = v12 % <span class="number">10000</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v14 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v11 )</span><br><span class="line">      v7[k + j] = v11;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( m = k + j; !v7[m - <span class="number">1</span>] &amp;&amp; m &gt; <span class="number">1</span>; --m )</span><br><span class="line">    ;</span><br><span class="line">  STR_COPY_0(a2, (__int64)v7);</span><br><span class="line">  <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SUB:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECAD8500</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line">  <span class="type">int</span> v11[<span class="number">500</span>]; <span class="comment">// [rsp+B0h] [rbp+90h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+880h] [rbp+860h]</span></span><br><span class="line">  <span class="type">int</span> v13[<span class="number">890</span>]; <span class="comment">// [rsp+8B0h] [rbp+890h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1058</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v11);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v13);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_7FF7ECAD140B(a1, a3) )</span><br><span class="line">  &#123;</span><br><span class="line">    STR_COPY((__int64)v11, a1);</span><br><span class="line">    STR_COPY((__int64)v13, a3);</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    STR_COPY((__int64)v11, a3);</span><br><span class="line">    STR_COPY((__int64)v13, a1);</span><br><span class="line">    v10 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = v12;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v9; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v11[j] &gt;= v13[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      v11[j] -= v13[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = j + <span class="number">1</span>; !v11[k]; ++k )</span><br><span class="line">        ;</span><br><span class="line">      --v11[k--];</span><br><span class="line">      <span class="keyword">while</span> ( k &gt; j )</span><br><span class="line">        v11[k--] += <span class="number">9999</span>;</span><br><span class="line">      v11[j] += <span class="number">10000</span> - v13[j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v12 = v9;</span><br><span class="line">  <span class="keyword">while</span> ( !v11[v12 - <span class="number">1</span>] &amp;&amp; v12 &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    --v12;</span><br><span class="line">    --v9;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v10 )</span><br><span class="line">    v11[v9 - <span class="number">1</span>] = -v11[v9 - <span class="number">1</span>];</span><br><span class="line">  STR_COPY_0(a2, (__int64)v11);</span><br><span class="line">  <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>符号化函数后会发现92行又调用了SUB 而且参数是v19和v21<br>结合后面紧跟着的sub_7FF7ECAD1014函数发现是一个check函数 检查值是否为0<br>那么前面的SUB的值就是我们想要的最终值<br>最后动调把需要的大整数值全部提取出来 按照初始 <code>+*-+*-+*-+-+-</code> 的逆序逆回去<br>就能得到inputbase64处理后的值<br>注意到最后check处 v20-&gt;tmp_string-&gt;v18 找到v18出现的地方 <code> sub_7FF7ECAD1244(v18, tmp_string);</code><br>查看这个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7ECADBC50</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v10[<span class="number">2036</span>]; <span class="comment">// [rsp+30h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11[<span class="number">11</span>]; <span class="comment">// [rsp+824h] [rbp+804h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">2048</span>]; <span class="comment">// [rsp+850h] [rbp+830h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v13[<span class="number">2048</span>]; <span class="comment">// [rsp+1050h] [rbp+1030h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v14[<span class="number">2048</span>]; <span class="comment">// [rsp+1850h] [rbp+1830h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">3584</span>]; <span class="comment">// [rsp+2050h] [rbp+2030h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">2024</span>]; <span class="comment">// [rsp+2E50h] [rbp+2E30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+3638h] [rbp+3618h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v9;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">3086</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_7FF7ECAF60F2, a2, a3);</span><br><span class="line">  sub_7FF7ECAD14B5((__int64)v10);</span><br><span class="line">  <span class="keyword">for</span> ( v11[<span class="number">0</span>] = <span class="number">0</span>; ; ++v11[<span class="number">0</span>] )                <span class="comment">// 对base64input转换</span></span><br><span class="line">  &#123;</span><br><span class="line">    v17 = v11[<span class="number">0</span>];</span><br><span class="line">    v5 = STRLEN_0(a2);</span><br><span class="line">    <span class="keyword">if</span> ( v17 &gt;= v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    sub_7FF7ECAD16E5(v12, <span class="number">128</span>i64);              <span class="comment">// 128： ascii码</span></span><br><span class="line">    sub_7FF7ECAD1578(v12, v13, v11);</span><br><span class="line">    v6 = (<span class="type">char</span> *)sub_7FF7ECAD1118(a2, v11[<span class="number">0</span>]);</span><br><span class="line">    sub_7FF7ECAD16E5(v14, (<span class="type">unsigned</span> <span class="type">int</span>)*v6);</span><br><span class="line">    j_MUL(v14, v15, v13);</span><br><span class="line">    v7 = j_ADD(v10, v16, v15);</span><br><span class="line">    STR_COPY((__int64)v10, v7);</span><br><span class="line">  &#125;</span><br><span class="line">  STR_COPY_0(a1, (__int64)v10);</span><br><span class="line">  sub_7FF7ECAD119A(a2);</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实就是将base64input的每个ASCII码以128进制变成大整数</p>
<p>所以最后得到的大整数除128取余就能得到base64input</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">keys = [<span class="number">0</span>,</span><br><span class="line">        <span class="number">64584540291872516627894939590684951703479643371381420434698676192916126802789388</span>,</span><br><span class="line">        <span class="number">11783410410469738048283152171898507679537812634841032055361622989575562121323526</span>,</span><br><span class="line">        <span class="number">55440851777679184418972581091796582321001517732868509947716453414109025036506793</span>,</span><br><span class="line">        <span class="number">17867047589171477574847737912328753108849304549280205992204587760361310317983607</span>,</span><br><span class="line">        <span class="number">7537302706582391238853817483600228733479333152488218477840149847189049516952787</span>,</span><br><span class="line">        <span class="number">80793226935699295824618519685638809874579343342564712419235587177713165502121664</span>,</span><br><span class="line">        <span class="number">14385283226689171523445844388769467232023411467394422980403729848631619308579599</span>,</span><br><span class="line">        <span class="number">55079029772840138145785005601340325789675668817561045403173659223377346727295749</span>,</span><br><span class="line">        <span class="number">71119332457202863671922045224905384620742912949065190274173724688764272313900465</span>,</span><br><span class="line">        <span class="number">57705573952449699620072104055030025886984180500734382250587152417040141679598894</span>]</span><br><span class="line">key11 = <span class="number">834572051814337070469744559761199605121805728622619480039894407167152612470842477813941120780374570205930952883661000998715107231695919001238818879944773516507366865633886966330912156402063735306303966193481658066437563587241718036562480496368592194719092339868512773222711600878782903109949779245500098606570248830570792028831133949440164219842871034275938433</span></span><br><span class="line">t = <span class="number">0</span></span><br><span class="line">t += key11</span><br><span class="line">t += keys[<span class="number">10</span>]</span><br><span class="line">t -= keys[<span class="number">9</span>]</span><br><span class="line">t += keys[<span class="number">8</span>]</span><br><span class="line">t -= keys[<span class="number">7</span>]</span><br><span class="line">t += keys[<span class="number">6</span>]</span><br><span class="line">t //= keys[<span class="number">5</span>]</span><br><span class="line">t -= keys[<span class="number">4</span>]</span><br><span class="line">t += keys[<span class="number">3</span>]</span><br><span class="line">t //= keys[<span class="number">2</span>]</span><br><span class="line">t -= keys[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"><span class="keyword">while</span> t%<span class="number">128</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(t%<span class="number">128</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    t//=<span class="number">128</span></span><br><span class="line"><span class="comment"># QUNURntkcjBwcDNyXzFzX3YzcnlfaW50M3Izc3QxbmdfMWQ3YTkwYTYzMDM5ODMxYzdmY2FhNTNiNzY2ZDViMmQhISEhIX0=</span></span><br><span class="line"><span class="comment"># ACTF&#123;dr0pp3r_1s_v3ry_int3r3st1ng_1d7a90a63039831c7fcaa53b766d5b2d!!!!!&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<hr>
<p>真就ACTF的easy难度(指31solves)。。。 orz<br>水平还差很多 还得继续学</p>
<h1 id="NewStarCTF2023-Week5"><a href="#NewStarCTF2023-Week5" class="headerlink" title="NewStarCTF2023 Week5"></a>NewStarCTF2023 Week5</h1><p>这就是 “<strong>新生赛</strong>“ 难度吗??? 。。。</p>
<h2 id="Fish"><a href="#Fish" class="headerlink" title="Fish"></a>Fish</h2><p>隔了好久再来看熟练多了<br>IDA打开 main啥都没有<br>看汇编<br>大量的这种类型的花指令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401</span>A12                 jz      <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A14                 jnz     <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>以前我的做法是将这两个全部patch掉 但这种只适用于一两个这种❀的情况<br>如果有很多的话这种patch会影响到IDA对后续语句的识别 比如这题如果这么patch那么关键常量就找不到了<br>正确做法是将jnz后的那个指令字节patch为nop(90)<br>为了方便批量化操作 general打开操作码显示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401</span>A12 <span class="number">74</span> <span class="number">03</span>                                   jz      <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A14 <span class="number">75</span> <span class="number">01</span>                                   jnz     <span class="type">short</span> near ptr loc_401A16+<span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A16</span><br></pre></td></tr></table></figure>

<p>当我们识别到 74 75 后将之后的位置设为90即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">start = <span class="number">0x4019FC</span></span><br><span class="line">end = <span class="number">0x401AD8</span></span><br><span class="line"><span class="keyword">while</span> start&lt;end:</span><br><span class="line">    <span class="keyword">if</span>((get_wide_byte(start)==<span class="number">0x74</span>) <span class="keyword">and</span> (get_wide_byte(start+<span class="number">2</span>)==<span class="number">0x75</span>)):</span><br><span class="line">        ida_bytes.patch_byte(start+<span class="number">4</span>,<span class="number">0x90</span>)</span><br><span class="line">    start += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] OK !&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这样patch后再将main全部选中按C Force一下就可以得到正常的源码了<br>这样的话汇编大致是这种形式</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401</span>A17                                                                 ; sub_4019FE+<span class="number">16</span>↑j</span><br><span class="line">.text:<span class="number">0000000000401</span>A17 <span class="number">48</span> B8 <span class="number">4</span>E <span class="number">65</span> <span class="number">77</span> <span class="number">53</span> <span class="number">74</span> <span class="number">61</span>                 mov     rax, <span class="number">7261745377654</span>Eh</span><br><span class="line">.text:<span class="number">0000000000401</span>A17 <span class="number">72</span> <span class="number">00</span></span><br><span class="line">.text:<span class="number">0000000000401</span>A21 <span class="number">48</span> <span class="number">89</span> <span class="number">45</span> <span class="number">10</span>                             mov     [rbp+<span class="number">30</span>h+var_20], rax</span><br><span class="line">.text:<span class="number">0000000000401</span>A25 <span class="number">74</span> <span class="number">03</span>                                   jz      <span class="type">short</span> loc_401A2A</span><br><span class="line">.text:<span class="number">0000000000401</span>A27 <span class="number">75</span> <span class="number">01</span>                                   jnz     <span class="type">short</span> loc_401A2A</span><br><span class="line">.text:<span class="number">0000000000401</span>A29 <span class="number">90</span>                                      nop</span><br></pre></td></tr></table></figure>

<p>可以看到这里mov rax … 这里的值就是 <code>NewStar</code> 这是最初patch会影响到的语句块！<br>然后main是这个样子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line">__int64 __fastcall <span class="title function_">sub_4019FE</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">96</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+80h] [rbp+0h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+84h] [rbp+4h] BYREF</span></span><br><span class="line">  __int64 v7[<span class="number">4</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_402660(a1, a2, a3);</span><br><span class="line">  v7[<span class="number">0</span>] = <span class="number">0x7261745377654E</span>i64;</span><br><span class="line">  <span class="built_in">memset</span>(Str1, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str1));</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  sub_401951(<span class="number">0</span>i64, &amp;v6);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str1);</span><br><span class="line">  sub_4016C1(v7);</span><br><span class="line">  ((<span class="type">void</span> (__fastcall *)(<span class="type">char</span> *))sub_40188B)(Str1);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, &amp;Str2) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;WOW!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;I believe you can do it!&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用FindCrypt插件Ctrl+F一看发现是BlowFish加密<br>在strcmp那儿可以拿到check值 key猜测是 “NewStar”<br>找个<a href="https://www.lddgo.net/encrypt/blowfish" target="_blank">在线网站</a>解就完了<br>注意选择 nopadding</p>
<p>flag : flag{YouGotit!!Yougoit!!!!TheFifthPZGALAXYLEVEL}</p>
<p>其实最后发现可以将整个程序按照这种patch处理后Force一下能看到完整程序流<br>MAIN</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">MAIN</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">96</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+80h] [rbp+0h]</span></span><br><span class="line">  __int64 v6[<span class="number">4</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_402660(argc, argv, envp);</span><br><span class="line">  v6[<span class="number">0</span>] = <span class="number">0x7261745377654E</span>i64;</span><br><span class="line">  <span class="built_in">memset</span>(Str1, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str1));</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  sub_401951();</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str1);</span><br><span class="line">  sub_4016C1((<span class="type">const</span> <span class="type">char</span> *)v6);</span><br><span class="line">  sub_40188B(Str1);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, (<span class="type">const</span> <span class="type">char</span> *)&amp;loc_40403F + <span class="number">1</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;WOW!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;I believe you can do it!&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_4016C1 应该就是根据NewStar来生成后续密钥</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__fastcall <span class="title function_">sub_4016C1</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+24h] [rbp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+28h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+2Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+34h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="type">char</span> *)<span class="built_in">strlen</span>(a1);</span><br><span class="line">  v4 = (<span class="type">int</span>)result;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  j = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( j &lt;= <span class="number">17</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 &lt;&lt; <span class="number">8</span>) | (<span class="type">unsigned</span> __int8)a1[v6];</span><br><span class="line">      v6 = (v6 + <span class="number">1</span>) % v4;</span><br><span class="line">    &#125;</span><br><span class="line">    result = (<span class="type">char</span> *)&amp;loc_40407F + <span class="number">1</span>;</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * j++ + <span class="number">1</span>) ^= v5;</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">17</span>; j += <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4015DE(&amp;v3, &amp;v2);</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * j + <span class="number">1</span>) = v3;</span><br><span class="line">    result = (<span class="type">char</span> *)&amp;loc_40407F + <span class="number">1</span>;</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * j + <span class="number">5</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; i += <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_4015DE(&amp;v3, &amp;v2);</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;loc_4040FF + <span class="number">1024</span> * (__int64)j + <span class="number">4</span> * i + <span class="number">1</span>) = v3;</span><br><span class="line">      result = (<span class="type">char</span> *)&amp;loc_4040FF + <span class="number">1</span>;</span><br><span class="line">      *(_DWORD *)((<span class="type">char</span> *)&amp;loc_4040FF + <span class="number">1024</span> * (__int64)j + <span class="number">4</span> * i + <span class="number">5</span>) = v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_40188B 标准BlowFish加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_40188B</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *v1; <span class="comment">// rbx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+24h] [rbp-5Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+28h] [rbp-58h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+2Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// [rsp+30h] [rbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-44h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="built_in">strlen</span>(a1) / <span class="number">8</span>;</span><br><span class="line">  v6 = (<span class="type">char</span> *)a1;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)i &gt;= v5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v4 = sub_403000(*(<span class="type">unsigned</span> <span class="type">int</span> *)v6);</span><br><span class="line">    v3 = sub_403000(*((<span class="type">unsigned</span> <span class="type">int</span> *)v6 + <span class="number">1</span>));</span><br><span class="line">    sub_4015DE(&amp;v4, &amp;v3);</span><br><span class="line">    *(_DWORD *)v6 = sub_403000(v4);</span><br><span class="line">    v1 = v6 + <span class="number">4</span>;</span><br><span class="line">    *v1 = sub_403000(v3);</span><br><span class="line">    v6 += <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在sub_4015DE中可以看到BlowFish的常量 0x9216D5D9 和 0x8979FB1B(dword_4040C4)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> *__fastcall <span class="title function_">sub_4015DE</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, <span class="type">unsigned</span> <span class="type">int</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *a1 ^= *(_DWORD *)((<span class="type">char</span> *)&amp;loc_40407F + <span class="number">4</span> * i + <span class="number">1</span>);</span><br><span class="line">    *a2 ^= sub_401530(*a1);</span><br><span class="line">    v3 = *a1;</span><br><span class="line">    *a1 = *a2;</span><br><span class="line">    *a2 = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = *a1;</span><br><span class="line">  *a1 = *a2;</span><br><span class="line">  *a2 = v4;</span><br><span class="line">  *a2 ^= <span class="number">0x9216D5D9</span>;</span><br><span class="line">  result = a1;</span><br><span class="line">  *a1 ^= dword_4040C4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Genshin"><a href="#Genshin" class="headerlink" title="Genshin"></a>Genshin</h2><p>考察的是erlang beam文件逆向<br>先下载好erlang编译器工具<br>然后通过这种方式(搜了一圈也不知道怎么找到这条反汇编命令的…)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">io:format(<span class="string">&quot;~p~n&quot;</span>,[beam_disasm:file(<span class="string">&quot;genshin.beam&quot;</span>)]).</span><br></pre></td></tr></table></figure>

<p>注意结尾要有’.’ !!!<br>可以得到文件的字节码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&#123;beam_file,genshin,</span><br><span class="line">    [&#123;main,<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;module_info,<span class="number">0</span>,<span class="number">11</span>&#125;,&#123;module_info,<span class="number">1</span>,<span class="number">13</span>&#125;],</span><br><span class="line">    [&#123;vsn,[<span class="number">294325075297162417208450880208266398775</span>]&#125;],</span><br><span class="line">    [&#123;version,<span class="string">&quot;8.3.1&quot;</span>&#125;,</span><br><span class="line">     &#123;options,[]&#125;,</span><br><span class="line">     &#123;source,</span><br><span class="line">         [<span class="number">47</span>,<span class="number">109</span>,<span class="number">110</span>,<span class="number">116</span>,<span class="number">47</span>,<span class="number">100</span>,<span class="number">47</span>,<span class="number">67</span>,<span class="number">84</span>,<span class="number">70</span>,<span class="number">47</span>,<span class="number">20986</span>,<span class="number">39064</span>,<span class="number">47</span>,<span class="number">50</span>,<span class="number">48</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">45</span>,</span><br><span class="line">          <span class="number">56</span>,<span class="number">45</span>,<span class="number">100</span>,<span class="number">117</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">101</span>,<span class="number">105</span>,<span class="number">115</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">47</span>,<span class="number">103</span>,<span class="number">101</span>,<span class="number">110</span>,<span class="number">115</span>,<span class="number">104</span>,<span class="number">105</span>,</span><br><span class="line">          <span class="number">110</span>,<span class="number">46</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">108</span>]&#125;],</span><br><span class="line">    [&#123;function,main,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">         [&#123;label,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;line,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,main&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">2</span>&#125;,</span><br><span class="line">          &#123;test,is_nonempty_list,&#123;f,<span class="number">3</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;get_list,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">1</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;test,is_nil,&#123;f,<span class="number">3</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">1</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;call_only,<span class="number">1</span>,&#123;genshin,check,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;label,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;move,</span><br><span class="line">              &#123;literal,<span class="string">&quot;Usage: xxxxxxxx genshin.beam &lt;input_string&gt;~n&quot;</span>&#125;,</span><br><span class="line">              &#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">2</span>&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;&#125;]&#125;,</span><br><span class="line">     &#123;function,check,<span class="number">1</span>,<span class="number">5</span>,</span><br><span class="line">         [&#123;line,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,check&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">5</span>&#125;,</span><br><span class="line">          &#123;test,is_list,&#123;f,<span class="number">4</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;allocate,<span class="number">1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">0</span>&#125;,&#123;y,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;literal,[<span class="number">21407</span>,<span class="number">31070</span>,<span class="number">46</span>,<span class="number">46</span>,<span class="number">46</span>,<span class="number">126</span>,<span class="number">110</span>]&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;call_ext,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;integer,<span class="number">1</span>&#125;,&#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;move,nil,&#123;x,<span class="number">2</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;y,<span class="number">0</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;init_yregs,&#123;<span class="built_in">list</span>,[&#123;y,<span class="number">0</span>&#125;]&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">5</span>&#125;,</span><br><span class="line">          &#123;call,<span class="number">3</span>,&#123;genshin,transform,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">6</span>&#125;,</span><br><span class="line">          &#123;call_ext,<span class="number">1</span>,&#123;extfunc,erlang,list_to_binary,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;test,is_eq_exact,</span><br><span class="line">              &#123;f,<span class="number">6</span>&#125;,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">0</span>&#125;,&#123;t_bitstring,<span class="number">8</span>,<span class="literal">false</span>&#125;&#125;,</span><br><span class="line">               &#123;literal,</span><br><span class="line">                   &lt;&lt;<span class="number">107</span>,<span class="number">114</span>,<span class="number">102</span>,<span class="number">103</span>,<span class="number">130</span>,<span class="number">68</span>,<span class="number">118</span>,<span class="number">106</span>,<span class="number">107</span>,<span class="number">119</span>,<span class="number">88</span>,<span class="number">109</span>,<span class="number">131</span>,<span class="number">70</span>,</span><br><span class="line">                     <span class="number">114</span>,<span class="number">130</span>,<span class="number">122</span>,<span class="number">81</span>,<span class="number">111</span>,<span class="number">40</span>,<span class="number">107</span>,<span class="number">77</span>,<span class="number">76</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">73</span>,<span class="number">72</span>,<span class="number">101</span>&gt;&gt;&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;literal,[<span class="number">21551</span>,<span class="number">21160</span>,<span class="number">65281</span>,<span class="number">126</span>,<span class="number">110</span>]&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">7</span>&#125;,</span><br><span class="line">          &#123;call_ext_last,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">6</span>&#125;,</span><br><span class="line">          &#123;move,&#123;literal,[<span class="number">20851</span>,<span class="number">38381</span>,<span class="number">126</span>,<span class="number">110</span>]&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">8</span>&#125;,</span><br><span class="line">          &#123;call_ext_last,<span class="number">1</span>,&#123;extfunc,io,format,<span class="number">1</span>&#125;,<span class="number">1</span>&#125;]&#125;,</span><br><span class="line">     &#123;function,transform,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">         [&#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">7</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,transform&#125;,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">8</span>&#125;,</span><br><span class="line">          &#123;test,is_nonempty_list,&#123;f,<span class="number">9</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;get_list,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">              &#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;,&#123;integer,<span class="number">1</span>&#125;],</span><br><span class="line">              &#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;test_heap,<span class="number">2</span>,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;put_list,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">2</span>&#125;&#125;,</span><br><span class="line">          &#123;call_only,<span class="number">3</span>,&#123;genshin,transform,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;label,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;test,is_nil,&#123;f,<span class="number">7</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,lists,reverse,<span class="number">1</span>&#125;&#125;]&#125;,</span><br><span class="line">     &#123;function,module_info,<span class="number">0</span>,<span class="number">11</span>,</span><br><span class="line">         [&#123;line,<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,module_info&#125;,<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;move,&#123;atom,genshin&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,erlang,get_module_info,<span class="number">1</span>&#125;&#125;]&#125;,</span><br><span class="line">     &#123;function,module_info,<span class="number">1</span>,<span class="number">13</span>,</span><br><span class="line">         [&#123;line,<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">12</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,module_info&#125;,<span class="number">1</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">13</span>&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;move,&#123;atom,genshin&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">2</span>,&#123;extfunc,erlang,get_module_info,<span class="number">2</span>&#125;&#125;]&#125;]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>慢慢分析字节码吧…</p>
<p>这里是最后的check is_eq_exact</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;test,is_eq_exact,</span><br><span class="line">              &#123;f,<span class="number">6</span>&#125;,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">0</span>&#125;,&#123;t_bitstring,<span class="number">8</span>,<span class="literal">false</span>&#125;&#125;,</span><br><span class="line">               &#123;literal,</span><br><span class="line">                   &lt;&lt;<span class="number">107</span>,<span class="number">114</span>,<span class="number">102</span>,<span class="number">103</span>,<span class="number">130</span>,<span class="number">68</span>,<span class="number">118</span>,<span class="number">106</span>,<span class="number">107</span>,<span class="number">119</span>,<span class="number">88</span>,<span class="number">109</span>,<span class="number">131</span>,<span class="number">70</span>,</span><br><span class="line">                     <span class="number">114</span>,<span class="number">130</span>,<span class="number">122</span>,<span class="number">81</span>,<span class="number">111</span>,<span class="number">40</span>,<span class="number">107</span>,<span class="number">77</span>,<span class="number">76</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">73</span>,<span class="number">72</span>,<span class="number">101</span>&gt;&gt;&#125;]&#125;,</span><br></pre></td></tr></table></figure>

<p>接着往前找到transform函数<br>在网上搜了搜beam字节码 找到一些例子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;gc_bif,<span class="built_in">abs</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">2</span>,[&#123;x,<span class="number">0</span>&#125;],&#123;x,<span class="number">0</span>&#125;&#125;. <span class="comment">//用x0去调用bif函数abs，存储结果到x0寄存器，</span></span><br><span class="line"></span><br><span class="line">&#123;gc_bif,<span class="built_in">abs</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">2</span>,[&#123;x,<span class="number">1</span>&#125;],&#123;x,<span class="number">1</span>&#125;&#125;. <span class="comment">//用x1去调用bif函数abs，存储结果到x1寄存器，</span></span><br><span class="line"></span><br><span class="line">&#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">2</span>,[&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">1</span>&#125;],&#123;x,<span class="number">0</span>&#125;&#125;. <span class="comment">//执行bif函数+， x0+x1，结果放入x0寄存器</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有了这些例子再看transform</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;function,transform,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">         [&#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">7</span>&#125;,</span><br><span class="line">          &#123;func_info,&#123;atom,genshin&#125;,&#123;atom,transform&#125;,<span class="number">3</span>&#125;,</span><br><span class="line">          &#123;label,<span class="number">8</span>&#125;,</span><br><span class="line">          &#123;test,is_nonempty_list,&#123;f,<span class="number">9</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;get_list,&#123;x,<span class="number">0</span>&#125;,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">              &#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;,&#123;integer,<span class="number">1</span>&#125;],</span><br><span class="line">              &#123;x,<span class="number">1</span>&#125;&#125;,</span><br><span class="line">          &#123;test_heap,<span class="number">2</span>,<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;put_list,&#123;x,<span class="number">3</span>&#125;,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">2</span>&#125;&#125;,</span><br><span class="line">          &#123;call_only,<span class="number">3</span>,&#123;genshin,transform,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;label,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;test,is_nil,&#123;f,<span class="number">7</span>&#125;,[&#123;x,<span class="number">0</span>&#125;]&#125;,</span><br><span class="line">          &#123;move,&#123;x,<span class="number">2</span>&#125;,&#123;x,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">9</span>&#125;,</span><br><span class="line">          &#123;call_ext_only,<span class="number">1</span>,&#123;extfunc,lists,reverse,<span class="number">1</span>&#125;&#125;]&#125;,</span><br></pre></td></tr></table></figure>

<p>重点在这一部分:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;line,<span class="number">10</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">              &#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br><span class="line">          &#123;line,<span class="number">11</span>&#125;,</span><br><span class="line">          &#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">              &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              [&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;,&#123;integer,<span class="number">1</span>&#125;],</span><br><span class="line">              &#123;x,<span class="number">1</span>&#125;&#125;,</span><br></pre></td></tr></table></figure>

<p>bxor这里:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;gc_bif,<span class="string">&#x27;bxor&#x27;</span>,</span><br><span class="line">    &#123;f,<span class="number">0</span>&#125;,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    [&#123;x,<span class="number">3</span>&#125;,&#123;tr,&#123;x,<span class="number">1</span>&#125;,&#123;t_integer,&#123;<span class="number">1</span>,<span class="string">&#x27;+inf&#x27;</span>&#125;&#125;&#125;],</span><br><span class="line">    &#123;x,<span class="number">3</span>&#125;&#125;,</span><br></pre></td></tr></table></figure>
<p>大致是 {x,1} xor (t_integer+1)  然后结果存给 {x,3}</p>
<p>再看下面的’+’: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;gc_bif,<span class="string">&#x27;+&#x27;</span>,&#123;f,<span class="number">0</span>&#125;,<span class="number">4</span>,[&#123;tr,&#123;x,<span class="number">3</span>&#125;,&#123;t_integer,any&#125;&#125;,&#123;integer,<span class="number">4</span>&#125;],&#123;x,<span class="number">3</span>&#125;&#125;,</span><br></pre></td></tr></table></figure>

<p>这里是 {x,3}+4这种运算 最后结果存回 {x,3}<br>再下面的’+’应该是循环的ecx++</p>
<p>所以加密逻辑:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag[i] = (flag[i]^(i+<span class="number">1</span>))+<span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>从enc[]逆回去即可得到flag<br>flag: <strong>flag{Funny_erLang_x0r__:)__}</strong></p>
<hr>
<hr>
<p>这种搜索资料的能力和通过例子学习新知识的能力也要多培养 练习<br>不得不感慨赛时做出了的3位佬tql orz</p>
<h2 id="easy-js2"><a href="#easy-js2" class="headerlink" title="easy_js2"></a>easy_js2</h2><p>wasm文件逆向<br>这种类型确实也见过好多次了<br>Edge查看源代码把output.wasm dump下来<br>跟着<a href="https://xz.aliyun.com/t/5170" target="_blank">这篇</a>操作<br>直接用 .&#x2F;wasm2c wasm.wasm -o wasm.c 反编译得到c代码<br>这里容易出现缺失libcrypto-1_1-x64.dll 网上下一个贴到这个文件夹下就行了(<del>吸取经验教训 别乱往C:&#x2F;&#x2F;system32里加dll…</del>)<br>但这里一直出现 0000004: error: bad magic value ….<br>还是先挂着吧 以后再来看</p>
<h1 id="2023强网杯"><a href="#2023强网杯" class="headerlink" title="2023强网杯"></a>2023强网杯</h1><p>赛时跟着学校队伍打了打 就做了道re签到…</p>
<h2 id="ez-re"><a href="#ez-re" class="headerlink" title="ez_re"></a>ez_re</h2><p>赛时看了看 一大堆while 当时以为考察的是类似opcode的vm<br>…<br>IDA打开 看main 完全没头绪 除了一个假flag check和一大堆while似乎找不到其他有用的点<br>好在函数很少 一个个点开看</p>
<p>sub_1260:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_1260</span><span class="params">(__int64 a1, _QWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  *a2 = <span class="number">0LL</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">1605141220</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( v4 == <span class="number">-1641808572</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *a2 ^= (<span class="type">unsigned</span> __int64)*(<span class="type">unsigned</span> __int8 *)(a1 + v5) &lt;&lt; (<span class="number">24</span> - <span class="number">8</span> * (<span class="type">unsigned</span> __int8)v5);</span><br><span class="line">      v4 = <span class="number">-27338749</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">-285296236</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">-27338749</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v5;</span><br><span class="line">      v4 = <span class="number">1605141220</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="number">-285296236</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v5 &lt; <span class="number">4</span> )</span><br><span class="line">        v2 = <span class="number">-1641808572</span>;</span><br><span class="line">      v4 = v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又是用来混淆的v4… 其实核心就 <code>*a2 ^= xxx&lt;&lt;(24/16/8/0)</code><br>也就是将char-&gt;int之类的</p>
<p>sub_13A0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_13A0</span><span class="params">(__int64 a1, <span class="type">unsigned</span> __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  __int64 *v7; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+14h] [rbp-5Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+18h] [rbp-58h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+1Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+24h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+28h] [rbp-48h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+2Ch] [rbp-44h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v18; <span class="comment">// [rsp+30h] [rbp-40h]</span></span><br><span class="line">  __int64 v19; <span class="comment">// [rsp+38h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// [rsp+40h] [rbp-30h]</span></span><br><span class="line">  <span class="type">bool</span> v21; <span class="comment">// [rsp+46h] [rbp-2Ah]</span></span><br><span class="line">  <span class="type">bool</span> v22; <span class="comment">// [rsp+47h] [rbp-29h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *v23; <span class="comment">// [rsp+48h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *v24; <span class="comment">// [rsp+50h] [rbp-20h]</span></span><br><span class="line">  __int64 *v25; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v26; <span class="comment">// [rsp+60h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v26 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v21 = ((((_BYTE)dword_8100 - <span class="number">1</span>) * (_BYTE)dword_8100) &amp; <span class="number">1</span>) == <span class="number">0</span>;</span><br><span class="line">  v22 = dword_80D0 &lt; <span class="number">10</span>;</span><br><span class="line">  v20 = <span class="number">-1362590688</span>;</span><br><span class="line">  v19 = a1;</span><br><span class="line">  v18 = a2;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v17 = v20;</span><br><span class="line">          v16 = v20 + <span class="number">1362590688</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v20 != <span class="number">-1362590688</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          v2 = <span class="number">68268958</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v22 || v21 )</span><br><span class="line">            v2 = <span class="number">-1082117606</span>;</span><br><span class="line">          v20 = v2;</span><br><span class="line">        &#125;</span><br><span class="line">        v15 = v17 + <span class="number">1082117606</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v17 != <span class="number">-1082117606</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v3 = <span class="number">68268958</span>;</span><br><span class="line">        v23 = &amp;v8;</span><br><span class="line">        v24 = &amp;v8;</span><br><span class="line">        v25 = (__int64 *)(&amp;v8 - <span class="number">2</span>);</span><br><span class="line">        v8 = v18;</span><br><span class="line">        *(_DWORD *)v25 = <span class="number">0</span>;</span><br><span class="line">        *(_DWORD *)v25 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( dword_80D0 &lt; <span class="number">10</span> || ((((_BYTE)dword_8100 - <span class="number">1</span>) * (_BYTE)dword_8100) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v3 = <span class="number">753533903</span>;</span><br><span class="line">        v20 = v3;</span><br><span class="line">      &#125;</span><br><span class="line">      v14 = v17 - <span class="number">68268958</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v17 != <span class="number">68268958</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v7 = (__int64 *)(&amp;v8 - <span class="number">2</span>);</span><br><span class="line">      v8 = v18;</span><br><span class="line">      *(_DWORD *)v7 = <span class="number">0</span>;</span><br><span class="line">      *(_DWORD *)v7 = <span class="number">0</span>;</span><br><span class="line">      v20 = <span class="number">-1082117606</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v13 = v17 - <span class="number">462079399</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v17 == <span class="number">462079399</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v12 = v17 - <span class="number">753533903</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v17 == <span class="number">753533903</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v20 = <span class="number">949053677</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v11 = v17 - <span class="number">949053677</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v17 == <span class="number">949053677</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v4 = <span class="number">462079399</span>;</span><br><span class="line">        <span class="keyword">if</span> ( *(<span class="type">int</span> *)v25 &lt; <span class="number">4</span> )</span><br><span class="line">          v4 = <span class="number">1315991260</span>;</span><br><span class="line">        v20 = v4;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v10 = v17 - <span class="number">1315991260</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v17 == <span class="number">1315991260</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v5 = <span class="number">8</span> * *(_DWORD *)v25;</span><br><span class="line">          v8 = *v23;</span><br><span class="line">          *(_BYTE *)(*v24 + *(<span class="type">int</span> *)v25) = v8 &gt;&gt; (<span class="number">24</span> - (<span class="type">unsigned</span> __int8)v5);</span><br><span class="line">          v20 = <span class="number">1547077251</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v9 = v17 - <span class="number">1547077251</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v17 == <span class="number">1547077251</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            ++*(_DWORD *)v25;</span><br><span class="line">            v20 = <span class="number">949053677</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类似 一大堆while混淆 实则就是 int-&gt;char之类的功能</p>
<p>sub_1670:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_1670</span><span class="params">(<span class="type">unsigned</span> __int64 a1, <span class="type">char</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 &gt;&gt; (<span class="number">32</span> - a2)) ^ (a1 &lt;&lt; a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>移位xor操作 多半是跟加密有关</p>
<p>sub_16F0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_16F0</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+8h] [rbp-B8h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+10h] [rbp-B0h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v11; <span class="comment">// [rsp+20h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+28h] [rbp-98h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+88h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+8Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">bool</span> v15; <span class="comment">// [rsp+9Fh] [rbp-21h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v16; <span class="comment">// [rsp+A0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+A8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">4</span>]; <span class="comment">// [rsp+B0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">4</span>]; <span class="comment">// [rsp+B4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v20; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v20 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v17 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="keyword">sizeof</span>(v18));</span><br><span class="line">  sub_13A0(a1, (<span class="type">unsigned</span> __int64)s);</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">1269377601</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">while</span> ( v13 == <span class="number">-1404100861</span> )</span><br><span class="line">                    v13 = <span class="number">1269377601</span>;</span><br><span class="line">                  <span class="keyword">if</span> ( v13 != <span class="number">-1075359453</span> )</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                  ++v14;</span><br><span class="line">                  v13 = <span class="number">1980171296</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> ( v13 != <span class="number">-979710400</span> )</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                v2 = <span class="number">-80865339</span>;</span><br><span class="line">                v15 = v14 &lt; <span class="number">4</span>;</span><br><span class="line">                <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">                  v2 = <span class="number">-741238317</span>;</span><br><span class="line">                v13 = v2;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> ( v13 != <span class="number">-741238317</span> )</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              v3 = <span class="number">-424386296</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v15 )</span><br><span class="line">                v3 = <span class="number">1085063542</span>;</span><br><span class="line">              v13 = v3;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( v13 != <span class="number">-424386296</span> )</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            v6 = <span class="number">957279085</span>;</span><br><span class="line">            <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">              v6 = <span class="number">-243308292</span>;</span><br><span class="line">            v13 = v6;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> ( v13 != <span class="number">-418270464</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          v4 = <span class="number">-1075359453</span>;</span><br><span class="line">          <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">            v4 = <span class="number">1980171296</span>;</span><br><span class="line">          v13 = v4;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v13 != <span class="number">-243308292</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        sub_1260((__int64)v18, &amp;v17);</span><br><span class="line">        v12 = v17;</span><br><span class="line">        v11 = sub_1670(v17, <span class="number">13</span>) ^ v12;</span><br><span class="line">        v7 = <span class="number">957279085</span>;</span><br><span class="line">        v17 = sub_1670(v17, <span class="number">23</span>) ^ v11;</span><br><span class="line">        v16 = v17;</span><br><span class="line">        <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v7 = <span class="number">218969482</span>;</span><br><span class="line">        v13 = v7;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v13 != <span class="number">-80865339</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v13 = <span class="number">-979710400</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v13 == <span class="number">218969482</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">switch</span> ( v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">957279085</span>:</span><br><span class="line">        sub_1260((__int64)v18, &amp;v17);</span><br><span class="line">        v10 = v17;</span><br><span class="line">        v9 = sub_1670(v17, <span class="number">13</span>) ^ v10;</span><br><span class="line">        v17 = sub_1670(v17, <span class="number">23</span>) ^ v9;</span><br><span class="line">        v13 = <span class="number">-243308292</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1085063542</span>:</span><br><span class="line">        v18[v14] = byte_6130[(<span class="type">unsigned</span> __int8)s[v14]];</span><br><span class="line">        v13 = <span class="number">-418270464</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1269377601</span>:</span><br><span class="line">        v1 = <span class="number">-80865339</span>;</span><br><span class="line">        <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v1 = <span class="number">-979710400</span>;</span><br><span class="line">        v13 = v1;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        v5 = <span class="number">-1075359453</span>;</span><br><span class="line">        ++v14;</span><br><span class="line">        <span class="keyword">if</span> ( dword_811C &lt; <span class="number">10</span> || ((((_BYTE)dword_80EC - <span class="number">1</span>) * (_BYTE)dword_80EC) &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">          v5 = <span class="number">-1404100861</span>;</span><br><span class="line">        v13 = v5;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v16;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里出现了 byte_6130<br>点击查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.rodata:0000000000006130 byte_6130       db 0D6h, 90h, 0E9h, 0FEh, 0CCh, 0E1h, 3Dh, 0B7h, 16h, 0B6h</span><br><span class="line">.rodata:0000000000006130                                         ; DATA XREF: sub_16F0:loc_1954↑o</span><br><span class="line">.rodata:0000000000006130                                         ; sub_1BC0+339↑o ...</span><br><span class="line">.rodata:000000000000613A                 db 14h, 0C2h, 28h, 0FBh, 2Ch, 5, 2Bh, 67h, 9Ah, 76h, 2Ah</span><br><span class="line">.rodata:0000000000006145                 db 0BEh, 4, 0C3h, 0AAh, 44h, 13h, 26h, 49h, 86h, 6, 99h</span><br><span class="line">.rodata:0000000000006150                 db 9Ch, 42h, 50h, 0F4h, 91h, 0EFh, 98h, 7Ah, 33h, 54h</span><br><span class="line">.rodata:000000000000615A                 db 0Bh, 43h, 0EDh, 0CFh, 0ACh, 62h, 0E4h, 0B3h, 1Ch, 0A9h</span><br><span class="line">.rodata:0000000000006164                 db 0C9h, 8, 0E8h, 95h, 80h, 0DFh, 94h, 0FAh, 75h, 8Fh</span><br><span class="line">.rodata:000000000000616E                 db 3Fh, 0A6h, 47h, 7, 0A7h, 0FCh, 0F3h, 73h, 17h, 0BAh</span><br><span class="line">.rodata:0000000000006178                 db 83h, 59h, 3Ch, 19h, 0E6h, 85h, 4Fh, 0A8h, 68h, 6Bh</span><br><span class="line">.rodata:0000000000006182                 db 81h, 0B2h, 71h, 64h, 0DAh, 8Bh, 0F8h, 0EBh, 0Fh, 4Bh</span><br><span class="line">.rodata:000000000000618C                 db 70h, 56h, 9Dh, 35h, 1Eh, 24h, 0Eh, 5Eh, 63h, 58h, 0D1h</span><br><span class="line">.rodata:0000000000006197                 db 0A2h, 25h, 22h, 7Ch, 3Bh, 1, 21h, 78h, 87h, 0D4h, 0</span><br><span class="line">.rodata:00000000000061A2                 db 46h, 57h, 9Fh, 0D3h, 27h, 52h, 4Ch, 36h, 2, 0E7h, 0A0h</span><br><span class="line">.rodata:00000000000061AD                 db 0C4h, 0C8h, 9Eh, 0EAh, 0BFh, 8Ah, 0D2h, 40h, 0C7h, 38h</span><br><span class="line">.rodata:00000000000061B7                 db 0B5h, 0A3h, 0F7h, 0F2h, 0CEh, 0F9h, 61h, 15h, 0A1h</span><br><span class="line">.rodata:00000000000061C0                 db 0E0h, 0AEh, 5Dh, 0A4h, 9Bh, 34h, 1Ah, 55h, 0ADh, 93h</span><br><span class="line">.rodata:00000000000061CA                 db 32h, 30h, 0F5h, 8Ch, 0B1h, 0E3h, 1Dh, 0F6h, 0E2h, 2Eh</span><br><span class="line">.rodata:00000000000061D4                 db 82h, 66h, 0CAh, 60h, 0C0h, 29h, 23h, 0ABh, 0Dh, 53h</span><br><span class="line">.rodata:00000000000061DE                 db 4Eh, 6Fh, 0D5h, 0DBh, 37h, 45h, 0DEh, 0FDh, 8Eh, 2Fh</span><br><span class="line">.rodata:00000000000061E8                 db 3, 0FFh, 6Ah, 72h, 6Dh, 6Ch, 5Bh, 51h, 8Dh, 1Bh, 0AFh</span><br><span class="line">.rodata:00000000000061F3                 db 92h, 0BBh, 0DDh, 0BCh, 7Fh, 11h, 0D9h, 5Ch, 41h, 1Fh</span><br><span class="line">.rodata:00000000000061FD                 db 10h, 5Ah, 0D8h, 0Ah, 0C1h, 31h, 88h, 0A5h, 0CDh, 7Bh</span><br><span class="line">.rodata:0000000000006207                 db 0BDh, 2Dh, 74h, 0D0h, 12h, 0B8h, 0E5h, 0B4h, 0B0h, 89h</span><br><span class="line">.rodata:0000000000006211                 db 69h, 97h, 4Ah, 0Ch, 96h, 77h, 7Eh, 65h, 0B9h, 0F1h</span><br><span class="line">.rodata:000000000000621B                 db 9, 0C5h, 6Eh, 0C6h, 84h, 18h, 0F0h, 7Dh, 0ECh, 3Ah</span><br><span class="line">.rodata:0000000000006225                 db 0DCh, 4Dh, 20h, 79h, 0EEh, 5Fh, 3Eh, 0D7h, 0CBh, 39h</span><br><span class="line">.rodata:000000000000622F                 db 48h</span><br></pre></td></tr></table></figure>

<p>这一看就是某种算法的SBOX啊… 把前几个值google一下 就能得到是SM4算法…</p>
<p>sub_1BC0 跟上一个差不多</p>
<p>sub_2220 这里调用了诸如char_2_int SM4等函数<br>猜测这就是主加密部分<br>那么交叉引用查看哪个地方调用了sub_2220<br>找到这里:<br>sub_3580</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_3580</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BOOL4 v1; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v2; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v9; <span class="comment">// [rsp+38h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+5Ch] [rbp-A4h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+60h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+68h] [rbp-98h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v13; <span class="comment">// [rsp+7Ch] [rbp-84h]</span></span><br><span class="line">  __int64 v14[<span class="number">4</span>]; <span class="comment">// [rsp+80h] [rbp-80h]</span></span><br><span class="line">  __int64 v15[<span class="number">2</span>]; <span class="comment">// [rsp+A0h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">64</span>]; <span class="comment">// [rsp+B0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+F0h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v17 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">  v15[<span class="number">0</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">  v15[<span class="number">1</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">  v14[<span class="number">0</span>] = <span class="number">0x7C88631647197506</span>LL;</span><br><span class="line">  v14[<span class="number">1</span>] = <span class="number">0x4A0D7D3FFF55668B</span>LL;</span><br><span class="line">  v14[<span class="number">2</span>] = <span class="number">0xDEC2E93F384ED2F5</span>LL;</span><br><span class="line">  v14[<span class="number">3</span>] = <span class="number">0x3C1FB1746F7F7CDB</span>LL;</span><br><span class="line">  v12 = <span class="number">1</span>;</span><br><span class="line">  v9 = <span class="number">16</span> * (<span class="built_in">strlen</span>(a1) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">  v1 = (<span class="built_in">strlen</span>(a1) &amp; <span class="number">0xF</span>) != <span class="number">0</span>;</span><br><span class="line">  v2 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  sub_2220(v2, (__int64)v15, (__int64)a1, (__int64)s);</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里可以得到6个常量值<br>大致搜索一下<a href="https://zhuanlan.zhihu.com/p/363900323" target="_blank">SM4算法</a> 看看每个模块有没有魔改</p>
<p>这里跟着流程走一遍</p>
<h3 id="SM4的密钥扩展算法"><a href="#SM4的密钥扩展算法" class="headerlink" title="SM4的密钥扩展算法"></a>SM4的密钥扩展算法</h3><h4 id="1-与系统参数异或——初始化密钥"><a href="#1-与系统参数异或——初始化密钥" class="headerlink" title="1.与系统参数异或——初始化密钥"></a>1.与系统参数异或——初始化密钥</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sub_1260(a2, &amp;s);</span><br><span class="line">sub_1260(a2 + <span class="number">4</span>, &amp;v38);</span><br><span class="line">sub_1260(a2 + <span class="number">8</span>, &amp;v39);</span><br><span class="line">sub_1260(a2 + <span class="number">12</span>, &amp;v40);</span><br><span class="line">v36[<span class="number">0</span>] = s ^ <span class="number">0xA3B1BAC6</span>LL;</span><br><span class="line">v36[<span class="number">1</span>] = v38 ^ <span class="number">0x56AA3350</span>;</span><br><span class="line">v36[<span class="number">2</span>] = v39 ^ <span class="number">0x677D9197</span>;</span><br><span class="line">v36[<span class="number">3</span>] = v40 ^ <span class="number">0xB27022DC</span>LL;</span><br></pre></td></tr></table></figure>

<p>与正常参数对比发现没有改</p>
<h4 id="2-轮迭代生成轮密钥"><a href="#2-轮迭代生成轮密钥" class="headerlink" title="2.轮迭代生成轮密钥"></a>2.轮迭代生成轮密钥</h4><p>这里流程比较多<br>逐个检查<br>先看固定参数CKi的值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.rodata:<span class="number">0000000000006030</span> ; _QWORD qword_6030[<span class="number">32</span>]</span><br><span class="line">.rodata:<span class="number">0000000000006030</span> qword_6030      dq <span class="number">70E15</span>h, <span class="number">1</span>C232A31h, <span class="number">383F</span>464Dh, <span class="number">545B</span>6269h, <span class="number">70777E85</span>h</span><br><span class="line">.rodata:<span class="number">0000000000006030</span>                                         ; DATA XREF: sub_2220:loc_282C↑o</span><br><span class="line">.rodata:<span class="number">0000000000006058</span>                 dq <span class="number">8</span>C939AA1h, <span class="number">0</span>A8AFB6BDh, <span class="number">0</span>C4CBD2D9h, <span class="number">0E0</span>E7EEF5h, <span class="number">0F</span>C030A11h</span><br><span class="line">.rodata:<span class="number">0000000000006080</span>                 dq <span class="number">181F</span>262Dh, <span class="number">343B</span>4249h, <span class="number">50575E65</span>h, <span class="number">6</span>C737A81h, <span class="number">888F</span>969Dh</span><br><span class="line">.rodata:<span class="number">00000000000060</span>A8                 dq <span class="number">0</span>A4ABB2B9h, <span class="number">0</span>C0C7CED5h, <span class="number">0</span>DCE3EAF1h, <span class="number">0F</span>8FF060Dh, <span class="number">141B</span>2229h</span><br><span class="line">.rodata:<span class="number">00000000000060</span>D0                 dq <span class="number">30373E45</span>h, <span class="number">4</span>C535A61h, <span class="number">686F</span>767Dh, <span class="number">848B</span>9299h, <span class="number">0</span>A0A7AEB5h</span><br><span class="line">.rodata:<span class="number">00000000000060F</span>8                 dq <span class="number">0B</span>CC3CAD1h, <span class="number">0</span>D8DFE6EDh, <span class="number">0F</span>4FB0209h, <span class="number">10171E25</span>h, <span class="number">2</span>C333A41h</span><br><span class="line">.rodata:<span class="number">0000000000006120</span>                 dq <span class="number">484F</span>565Dh, <span class="number">646B</span>7279h</span><br></pre></td></tr></table></figure>

<p>没有魔改</p>
<p>再检查置换T’</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v12 = v17;</span><br><span class="line">v11 = sub_1670(v17, <span class="number">13</span>) ^ v12;</span><br><span class="line">v7 = <span class="number">957279085</span>;</span><br><span class="line">v17 = sub_1670(v17, <span class="number">23</span>) ^ v11;</span><br></pre></td></tr></table></figure>

<p>这里的sub_1670就是前面的移位xor函数 也没有魔改</p>
<p>最后大致看看迭代方式和轮数也没有改</p>
<p>确定是标准SM4后 找个在线网站<br>需要key和iv</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">v15[<span class="number">0</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">v15[<span class="number">1</span>] = <span class="number">0xEFCDAB8967452301</span>LL;</span><br><span class="line">v14[<span class="number">0</span>] = <span class="number">0x7C88631647197506</span>LL;</span><br><span class="line">v14[<span class="number">1</span>] = <span class="number">0x4A0D7D3FFF55668B</span>LL;</span><br><span class="line">v14[<span class="number">2</span>] = <span class="number">0xDEC2E93F384ED2F5</span>LL;</span><br><span class="line">v14[<span class="number">3</span>] = <span class="number">0x3C1FB1746F7F7CDB</span>LL;</span><br></pre></td></tr></table></figure>

<p>key: 0123456789ABCDEF0123456789ABCDEF<br>这里key和密文都要从小端取(注意)<br>这里有没有IV涉及到是ECB模式还是CBC模式 既然找不到IV就当ECB来解<br>然后选择nopadding<br><img src="https://s2.loli.net/2023/12/17/YpD7sKfL3v5MNCT.png" alt="img"></p>
<p>flag: flag{h3kk0_w0rld_sur3_3n0ugh}</p>
<hr>
<hr>
<p>总结： 合理google某些常量值(SBOX&#x2F;CONSTANT…) 会带来意外之喜…</p>
<h2 id="ezre-强网先锋"><a href="#ezre-强网先锋" class="headerlink" title="ezre(强网先锋)"></a>ezre(强网先锋)</h2><p>ollvm直接插件去混淆</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+12Ch] [rbp-114h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+130h] [rbp-110h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+134h] [rbp-10Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+13Ch] [rbp-104h]</span></span><br><span class="line">  <span class="type">char</span> v11[<span class="number">64</span>]; <span class="comment">// [rsp+140h] [rbp-100h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">64</span>]; <span class="comment">// [rsp+180h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v13[<span class="number">64</span>]; <span class="comment">// [rsp+1C0h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">52</span>]; <span class="comment">// [rsp+200h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+234h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">size_t</span> v16; <span class="comment">// [rsp+238h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome to the CTF world:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  v16 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">base64encode</span>(s, v11, v3);                     <span class="comment">// 变表base64加密</span></span><br><span class="line">  <span class="keyword">while</span> ( v10 &lt; <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">srand</span>(byte_406132);                         <span class="comment">// srand(&#x27;U&#x27;) 每次的随机种子要变...</span></span><br><span class="line">    v4 = <span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span> *)(<span class="type">unsigned</span> <span class="type">int</span>)byte_406130);</span><br><span class="line">    <span class="built_in">sub_401D10</span>(byte_406130, v4);                <span class="comment">// shuffle打乱base64表</span></span><br><span class="line">    <span class="keyword">if</span> ( (v10 &amp; <span class="number">1</span>) != <span class="number">0</span> )                       <span class="comment">// v10=1,3</span></span><br><span class="line">    &#123;</span><br><span class="line">      v5 = <span class="built_in">strlen</span>(v11);</span><br><span class="line">      <span class="built_in">base64encode</span>(v11, v12, v5);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">base64decode</span>(v11, v12);                   <span class="comment">// 变表base64解密</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(v11, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">    <span class="built_in">memcpy</span>(v11, v12, <span class="number">0x32</span>uLL);</span><br><span class="line">    ++v10;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( dword_4062C0 == <span class="number">1</span> )                      <span class="comment">// sub_402230这里把dword_4062C0置为1了顺带把最后的密文数组也xor了一道</span></span><br><span class="line">  &#123;                                             <span class="comment">// 所以应该是走的这个分支</span></span><br><span class="line">    <span class="built_in">sub_402EE0</span>(byte_406130, &amp;byte_406130[<span class="number">64</span>]);  <span class="comment">// copy</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">64</span>; ++i )</span><br><span class="line">      byte_406130[i] = (<span class="number">5</span> * (byte_406130[i] + <span class="number">3</span>)) ^ <span class="number">0x15</span>;<span class="comment">// 对base64表再变换</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j )</span><br><span class="line">      byte_406130[j] ^= <span class="number">0x27</span>u;                  <span class="comment">// 对base64表变换</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_401EB0</span>(v12, v13);                         <span class="comment">// 又有一层加密</span></span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; ; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( k &gt;= <span class="built_in">strlen</span>(v12) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;right!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( byte_406180[k] != v13[k] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于flag的长度 找了一圈都没找到check点<br>其实可以这么来判断 由于最后的enc是48字符<br>&#x3D;&gt; input padding后是36长度 构造34,35,36的padding试一试看退不退出程序就行了</p>
<p>这里静态很麻烦 直接动调提取数据<br>注意到下面有个</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( dword_4062C0 == <span class="number">1</span> )                      <span class="comment">// sub_402230这里把dword_4062C0置为1了顺带把最后的密文数组也xor了一道 然而这是反调试。。。</span></span><br><span class="line">&#123;                                             <span class="comment">// 所以应该是走的这个分支 个鬼。。。</span></span><br><span class="line">  <span class="built_in">sub_402EE0</span>(byte_406130, &amp;byte_406130[<span class="number">64</span>]);  <span class="comment">// copy</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">64</span>; ++i )</span><br><span class="line">    byte_406130[i] = (<span class="number">5</span> * (byte_406130[i] + <span class="number">3</span>)) ^ <span class="number">0x15</span>;<span class="comment">// 对base64表再变换</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j )</span><br><span class="line">    byte_406130[j] ^= <span class="number">0x27</span>u;                  <span class="comment">// 对base64表变换</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很容易想到跟踪dword_4062C0变量<br>之前唯一出现过的地方</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_402230</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+48h] [rbp-118h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// [rsp+4Ch] [rbp-114h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">256</span>]; <span class="comment">// [rsp+50h] [rbp-110h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+150h] [rbp-10h]</span></span><br><span class="line">  FILE *v5; <span class="comment">// [rsp+158h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  stream = <span class="built_in">fopen</span>(<span class="string">&quot;/proc/self/status&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  v5 = stream;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="built_in">fgets</span>(s, <span class="number">256</span>, stream) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(s, <span class="string">&quot;TracerPid:&quot;</span>, <span class="number">0xA</span>uLL) )</span><br><span class="line">    &#123;</span><br><span class="line">      __isoc99_sscanf(s, <span class="string">&quot;TracerPid:\t%d&quot;</span>, &amp;v2);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">fclose</span>(stream);</span><br><span class="line">  <span class="keyword">if</span> ( v2 )                                     <span class="comment">// 屮... 反调试...</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="type">unsigned</span> __int64)i &lt; <span class="number">0x30</span>; ++i )</span><br><span class="line">      byte_406180[i] ^= <span class="number">0x34</span>u;</span><br><span class="line">    dword_4062C0 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不仔细看以为这里潜在的设置了1且修改了最后的enc数组<br>其实这里是个反调试 因为v2初始值是0的 而如果调试的话会发现这里的值会变成非零<br>当然 这里不影响base64表的shuffle变换 所以提取出表</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">table4=<span class="string">&quot;plxXOZtaiUneJIhk7qSYEjD1Km94o0FTu52VQgNL3vCBH8zsA/b+dycGPRMwWfr6&quot;</span></span><br><span class="line">table3=<span class="string">&quot;pnHQwlAveo4DhGg1jE3SsIqJ2mrzxCiNb+Mf0YVd5L8c97/WkOTtuKFZyRBUPX6a&quot;</span></span><br><span class="line">table2=<span class="string">&quot;Hc0xwuZmy3DpQnSgj2LhUtrlVvNYks+BX/MOoETaKqR4eb9WF8ICGzf6id1P75JA&quot;</span></span><br><span class="line">table1=<span class="string">&quot;FGseVD3ibtHWR1czhLnUfJK6SEZ2OyPAIpQoqgY0w49u+7rad5CxljMXvNTBkm/8&quot;</span></span><br><span class="line">table0=<span class="string">&quot;l+USN4J5Rfj0TaVOcnzXiPGZIBpoAExuQtHyKD692hwmqe7/Mgk8v1sdCW3bYFLr&quot;</span></span><br></pre></td></tr></table></figure>

<p>最后还有一层加密</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_401EB0</span><span class="params">(<span class="type">char</span> *a1, <span class="type">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+8Eh] [rbp-52h]</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+8Fh] [rbp-51h]</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">52</span>]; <span class="comment">// [rsp+90h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+C4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+C8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+CCh] [rbp-14h]</span></span><br><span class="line">  <span class="type">char</span> *v9; <span class="comment">// [rsp+D0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> *s; <span class="comment">// [rsp+D8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  s = a1;</span><br><span class="line">  v9 = a2;</span><br><span class="line">  v8 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  v7 = <span class="number">2023</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="number">0x32</span>uLL);</span><br><span class="line">  <span class="built_in">strncpy</span>(v5, &amp;byte_406130[<span class="number">6</span>], <span class="number">21uLL</span>);</span><br><span class="line">  v5[<span class="number">21</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v9, s);</span><br><span class="line">  <span class="keyword">while</span> ( v6 &lt; v8 - <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6 % <span class="number">3</span> == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (v7 + <span class="number">5</span>) % <span class="number">20</span>;</span><br><span class="line">      v3 = v5[v7 + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v6 % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (v7 + <span class="number">7</span>) % <span class="number">19</span>;</span><br><span class="line">      v3 = v5[v7 + <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (v7 + <span class="number">3</span>) % <span class="number">17</span>;</span><br><span class="line">      v3 = v5[v7 + <span class="number">3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    v9[v6] ^= v3;</span><br><span class="line">    v4 = v9[v6++];</span><br><span class="line">    v9[v6] ^= v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逆回去就好了<br>最后的base64table做的是xor 0x27的操作</p>
<p>最终exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64_decode</span>(<span class="params">string,table=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span>):</span><br><span class="line">    result=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string:</span><br><span class="line">        <span class="keyword">if</span> i!=<span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            index=table.index(i)</span><br><span class="line">            result+=(<span class="built_in">bin</span>(index)[<span class="number">2</span>:]).zfill(<span class="number">6</span>)</span><br><span class="line">        <span class="keyword">elif</span> i==<span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            result=result[:-<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">return</span> n2s(<span class="built_in">int</span>(result,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64_encode</span>(<span class="params">input_string,table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span>):</span><br><span class="line">    input_bytes = input_string</span><br><span class="line">    padding = (<span class="number">3</span> - <span class="built_in">len</span>(input_bytes) % <span class="number">3</span>) % <span class="number">3</span></span><br><span class="line">    input_bytes+=padding*<span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">    encoded_chars = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(input_bytes), <span class="number">3</span>):</span><br><span class="line">        chunk = (input_bytes[i] &lt;&lt; <span class="number">16</span>) | (input_bytes[i + <span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | input_bytes[i + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            index = (chunk &gt;&gt; (j * <span class="number">6</span>)) &amp; <span class="number">63</span></span><br><span class="line">            encoded_chars.append(table[index])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,padding+<span class="number">1</span>):</span><br><span class="line">        encoded_chars[-i]=<span class="string">&#x27;=&#x27;</span></span><br><span class="line">    encoded_string = <span class="string">&#x27;&#x27;</span>.join(encoded_chars)</span><br><span class="line">    <span class="keyword">return</span> encoded_string</span><br><span class="line"></span><br><span class="line">base64_table0 = <span class="string">&quot;l+USN4J5Rfj0TaVOcnzXiPGZIBpoAExuQtHyKD692hwmqe7/Mgk8v1sdCW3bYFLr&quot;</span></span><br><span class="line">base64_table1 = <span class="string">&quot;FGseVD3ibtHWR1czhLnUfJK6SEZ2OyPAIpQoqgY0w49u+7rad5CxljMXvNTBkm/8&quot;</span></span><br><span class="line">base64_table2 = <span class="string">&quot;Hc0xwuZmy3DpQnSgj2LhUtrlVvNYks+BX/MOoETaKqR4eb9WF8ICGzf6id1P75JA&quot;</span></span><br><span class="line">base64_table3 = <span class="string">&quot;pnHQwlAveo4DhGg1jE3SsIqJ2mrzxCiNb+Mf0YVd5L8c97/WkOTtuKFZyRBUPX6a&quot;</span></span><br><span class="line">base64_table4 = <span class="string">&quot;plxXOZtaiUneJIhk7qSYEjD1Km94o0FTu52VQgNL3vCBH8zsA/b+dycGPRMwWfr6&quot;</span></span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0x3A</span>, <span class="number">0x2C</span>, <span class="number">0x4B</span>, <span class="number">0x51</span>, <span class="number">0x68</span>, <span class="number">0x46</span>, <span class="number">0x59</span>, <span class="number">0x63</span>, <span class="number">0x24</span>, <span class="number">0x04</span>, <span class="number">0x5E</span>, <span class="number">0x5F</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x2B</span>, <span class="number">0x03</span>, <span class="number">0x29</span>, <span class="number">0x5C</span>, <span class="number">0x74</span>, <span class="number">0x70</span>, <span class="number">0x6A</span>, <span class="number">0x62</span>, <span class="number">0x7F</span>, <span class="number">0x3D</span>, <span class="number">0x2C</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>, <span class="number">0x13</span>, <span class="number">0x06</span>, <span class="number">0x0D</span>, <span class="number">0x06</span>, <span class="number">0x0C</span>, <span class="number">0x4D</span>, <span class="number">0x56</span>, <span class="number">0x0F</span>, <span class="number">0x28</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x76</span>, <span class="number">0x70</span>, <span class="number">0x2B</span>, <span class="number">0x05</span>, <span class="number">0x51</span>, <span class="number">0x68</span>, <span class="number">0x48</span>, <span class="number">0x55</span>, <span class="number">0x24</span>, <span class="number">0x19</span>]</span><br><span class="line">v5 = [<span class="built_in">ord</span>(x)^<span class="number">0x27</span> <span class="keyword">for</span> x <span class="keyword">in</span> base64_table4]</span><br><span class="line">v5 = v5[<span class="number">6</span>:<span class="number">6</span>+<span class="number">21</span>]+[<span class="number">0</span>]</span><br><span class="line">flag = enc</span><br><span class="line">v6 = <span class="number">48</span>-<span class="number">2</span></span><br><span class="line">v7 = <span class="number">8</span></span><br><span class="line">v7s = [<span class="number">3</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> v6&gt;=<span class="number">0</span>:</span><br><span class="line">    v7  = v7s[v6]</span><br><span class="line">    <span class="comment"># print(v7,end=&#x27;,&#x27;)</span></span><br><span class="line">    flag[v6+<span class="number">1</span>] ^= flag[v6]</span><br><span class="line">    <span class="keyword">if</span> v6%<span class="number">3</span>==<span class="number">1</span>:</span><br><span class="line">        flag[v6] ^= v5[v7+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">elif</span> v6%<span class="number">3</span>==<span class="number">2</span>:</span><br><span class="line">        flag[v6] ^= v5[v7+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag[v6] ^= v5[v7+<span class="number">3</span>]</span><br><span class="line">    v6 -= <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(x),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">flag = <span class="string">&quot;WZqSWcUtWBLlOriEfcajWBSRstLlkEfFWR7j/R7dMCDGnp==&quot;</span></span><br><span class="line">flag = base64_decode(flag,table=base64_table4)</span><br><span class="line">flag = base64_encode(flag,table=base64_table3)</span><br><span class="line">flag = base64_decode(flag,table=base64_table2)</span><br><span class="line">flag = base64_encode(flag,table=base64_table1)</span><br><span class="line">flag = base64_decode(flag,table=base64_table0)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line"><span class="comment"># b&#x27;flag&#123;3ea590ccwxehg715264fzxnzepqz\x7f&#x27;</span></span><br></pre></td></tr></table></figure>

<p>有点残缺 但最后一位肯定是} 所以无关紧要</p>
<hr>
<hr>
<p>这题的反调试那里确实把我坑到 所以还是要动调看逻辑 不要盲目下论断<br>还有最后一步加密的时候 各种下标的+1&#x2F;+0 关系不要弄错了…</p>
<h1 id="GDOUCTF2023"><a href="#GDOUCTF2023" class="headerlink" title="GDOUCTF2023"></a>GDOUCTF2023</h1><h2 id="L-S"><a href="#L-S" class="headerlink" title="L!S!"></a>L!S!</h2><p>…<br>根据提示 用IDA的bindiff插件查看两个文件的不同处<br>定位到这里</p>
<p>origin:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="type">void</span> **)*((_QWORD *)sorted_file + v4);</span><br><span class="line">      v7 = *((_DWORD *)v6 + <span class="number">42</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v7 != <span class="number">3</span> &amp;&amp; v7 != <span class="number">9</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">      v8 = *v6;</span><br><span class="line">      <span class="keyword">if</span> ( !src )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_19;</span><br><span class="line">      component = (_BYTE *)last_component(*v6);</span><br><span class="line">      <span class="keyword">if</span> ( *component == <span class="number">46</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = component[(component[<span class="number">1</span>] == <span class="number">46</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> ( !v16 || v16 == <span class="number">47</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *v8 == <span class="number">47</span> )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_19:</span><br><span class="line">        queue_directory(v8, v6[<span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v10 = (<span class="type">void</span> *)file_name_concat(src, v8, <span class="number">0LL</span>);</span><br><span class="line">        queue_directory(v10, v6[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">free</span>(v10);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *((_DWORD *)v6 + <span class="number">42</span>) == <span class="number">9</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      ...</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>patched:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="type">void</span> **)*((_QWORD *)sorted_file + v4);</span><br><span class="line">      v7 = *((_DWORD *)v6 + <span class="number">42</span>);</span><br><span class="line">      v8 = *v6;</span><br><span class="line">      <span class="keyword">if</span> ( v7 != <span class="number">3</span> &amp;&amp; v7 != <span class="number">9</span> )</span><br><span class="line">      &#123;</span><br><span class="line">LABEL_7:</span><br><span class="line">        <span class="keyword">if</span> ( v8 &amp;&amp; !v8[<span class="number">1</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          v19[<span class="number">1</span>] = <span class="number">0x3F7D132A2A252822</span>LL;</span><br><span class="line">          v19[<span class="number">0</span>] = <span class="number">0x7D2E370A180F1604</span>LL;</span><br><span class="line">          v20 = <span class="number">0x31207C7C381320</span>LL;</span><br><span class="line">          v19[<span class="number">2</span>] = <span class="number">0x392A7F3F39132D13</span>LL;</span><br><span class="line">          v18 = v19;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            *(_BYTE *)v18 ^= *(_BYTE *)*v6;</span><br><span class="line">            v18 = (__int64 *)((<span class="type">char</span> *)v18 + <span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( (__int64 *)((<span class="type">char</span> *)&amp;v20 + <span class="number">7</span>) != v18 );</span><br><span class="line">          <span class="built_in">puts</span>((<span class="type">const</span> <span class="type">char</span> *)v19);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !src )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">      component = (_BYTE *)last_component(*v6);</span><br><span class="line">      <span class="keyword">if</span> ( *component == <span class="number">46</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v17 = component[(component[<span class="number">1</span>] == <span class="number">46</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> ( !v17 || v17 == <span class="number">47</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">      &#125;</span><br><span class="line">      ...&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>发现这里v6是一个定值 完全可以爆破(range(256))<br>然后小端序取出v19[0,1,2],v20[0]爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="string">&quot;04160F180A372E7D&quot;</span>,<span class="string">&quot;2228252A2A137D3F&quot;</span>,<span class="string">&quot;132D13393F7F2A39&quot;</span>,<span class="string">&quot;2013387C7C2031&quot;</span>]</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)//<span class="number">2</span>):</span><br><span class="line">        c.append(<span class="built_in">int</span>(s[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> cc <span class="keyword">in</span> c:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(cc^key)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;CTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># HZCTF&#123;b1ndiff_1s_a_us3ful_t00l&#125;</span></span><br></pre></td></tr></table></figure>

<p>这题开始我还想着动调找v6的值 发现程序给我ls后就卡着了…</p>
<h1 id="TPCTF2023"><a href="#TPCTF2023" class="headerlink" title="TPCTF2023"></a>TPCTF2023</h1><p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/0nJHKJjDFrWHgspoVF23xA"> + </a></li>
</ul>
<h2 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h2><p>要用pyinsxxx提取出pyz 必须满足python版本一致<br>Linux下载一个python3.8 然后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3.8 pyxxx.py maze</span><br></pre></td></tr></table></figure>

<p>这样就能成功解包<br>然后终端运行python3.8 也能import maze 来查看内部逻辑<br>运行 help(maze)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">Help on module maze:</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    maze</span><br><span class="line"></span><br><span class="line">CLASSES</span><br><span class="line">    builtins.object</span><br><span class="line">        Q2Fy</span><br><span class="line">        Q2VsbA</span><br><span class="line">        TWF6ZUxhbmc</span><br><span class="line">    </span><br><span class="line">    class Q2Fy(builtins.object)</span><br><span class="line">     |  Q2Fy(value, x, y)</span><br><span class="line">     |  </span><br><span class="line">     |  Methods defined here:</span><br><span class="line">     |  </span><br><span class="line">     |  __init__(self, value, x, y)</span><br><span class="line">     |  </span><br><span class="line">     |  __repr__(self)</span><br><span class="line">     |  </span><br><span class="line">     |  ----------------------------------------------------------------------</span><br><span class="line">     |  Data descriptors defined here:</span><br><span class="line">     |  </span><br><span class="line">     |  __dict__</span><br><span class="line">     |      dictionary for instance variables (if defined)</span><br><span class="line">     |  </span><br><span class="line">     |  __weakref__</span><br><span class="line">:</span><br><span class="line">     |      list of weak references to the object (if defined)</span><br><span class="line">    </span><br><span class="line">    class Q2VsbA(builtins.object)</span><br><span class="line">     |  Q2VsbA(name, value)</span><br><span class="line">     |  </span><br><span class="line">     |  Methods defined here:</span><br><span class="line">     |  </span><br><span class="line">     |  __init__(self, name, value)</span><br><span class="line">     |  </span><br><span class="line">     |  __repr__(self)</span><br><span class="line">     |  </span><br><span class="line">     |  ----------------------------------------------------------------------</span><br><span class="line">     |  Data descriptors defined here:</span><br><span class="line">     |  </span><br><span class="line">     |  __dict__</span><br><span class="line">     |      dictionary for instance variables (if defined)</span><br><span class="line">     |  </span><br><span class="line">     |  __weakref__</span><br><span class="line">     |      list of weak references to the object (if defined)</span><br><span class="line">    </span><br><span class="line">    class TWF6ZUxhbmc(builtins.object)</span><br><span class="line">     |  TWF6ZUxhbmc(code)</span><br><span class="line">     |  </span><br><span class="line">     |  Methods defined here:</span><br><span class="line">     |  </span><br><span class="line">     |  YWRkX2NlbGw(self, code)</span><br><span class="line">     |  </span><br><span class="line">     |  </span><br><span class="line">     |  YWRkX2Z1bmN0aW9u(self, code)</span><br><span class="line">     |  </span><br><span class="line">     |  Z2V0X2NlbGw(self, code)</span><br><span class="line">     |  </span><br><span class="line">     |  Z2V0X3Bvcw(self, pos, direction)</span><br><span class="line">     |  </span><br><span class="line">     |  __init__(self, code)</span><br><span class="line">     |  </span><br><span class="line">     |  aW5pdA(self)</span><br><span class="line">     |  </span><br><span class="line">     |  b3Bw(self, direction)</span><br><span class="line">     |  </span><br><span class="line">     |  c3RlcA(self)</span><br><span class="line">     |  </span><br><span class="line">     |  cnVuX3RpbGxfb3V0cHV0(self)</span><br><span class="line">     |  </span><br><span class="line">     |  ----------------------------------------------------------------------</span><br><span class="line">     |  Data descriptors defined here:</span><br><span class="line">     |  </span><br><span class="line">     |  __dict__</span><br><span class="line">     |      dictionary for instance variables (if defined)</span><br><span class="line">     |  </span><br><span class="line">     |  __weakref__</span><br><span class="line">     |      list of weak references to the object (if defined)</span><br><span class="line">:</span><br><span class="line">     |      list of weak references to the object (if defined)</span><br><span class="line"></span><br><span class="line">FUNCTIONS</span><br><span class="line">    aW5pdF9zZWNyZXQ()</span><br><span class="line">    </span><br><span class="line">    c29sdmU(SvL6VEBRwx) -&gt; &#x27;int&#x27;</span><br><span class="line">    </span><br><span class="line">    exit(status=None, /)</span><br><span class="line">        Exit the interpreter by raising SystemExit(status).</span><br><span class="line">        </span><br><span class="line">        If the status is omitted or None, it defaults to zero (i.e., success).</span><br><span class="line">        If the status is an integer, it will be used as the system exit status.</span><br><span class="line">        If it is another kind of object, it will be printed and the system</span><br><span class="line">        exit status will be one (i.e., failure).</span><br><span class="line">    </span><br><span class="line">    run()</span><br><span class="line"></span><br><span class="line">DATA</span><br><span class="line">    EqdU3uQNCi = [18, 17, 15, 0, 27, 31, 10, 19, 14, 21, 25, 22, 6, 3, 30,...</span><br><span class="line">    UJ9mxXxeoS = &#x27;IyMgIyMgIyMgIyMgIyMgIyMgIyMKIyMgIyMgIyMgXl4gIyMg...gLT4g...</span><br><span class="line">    __test__ = &#123;&#125;</span><br><span class="line">    c2VjcmV0 = [7, 47, 60, 28, 39, 11, 23, 5, 49, 49, 26, 11, 63, 4, 9, 2,...</span><br><span class="line">    regexes = &#123;&#x27;direction&#x27;: &#x27;%[LRUDNlrudn]&#x27;, &#x27;function&#x27;: &#x27;[A-Za-z][A-Za-z0...</span><br><span class="line"></span><br><span class="line">FILE</span><br><span class="line">    /mnt/hgfs/c/Users/asus/Desktop/tmp/c447cfe2-3b00-4b1a-b109-c511fdb23766/maze_extracted/maze.so</span><br><span class="line"></span><br><span class="line">(END)</span><br></pre></td></tr></table></figure>

<p>导出关键数据:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">EqdU3uQNCi =  [<span class="number">18</span>, <span class="number">17</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">27</span>, <span class="number">31</span>, <span class="number">10</span>, <span class="number">19</span>, <span class="number">14</span>, <span class="number">21</span>, <span class="number">25</span>, <span class="number">22</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">30</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">9</span>, <span class="number">26</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">28</span>, <span class="number">16</span>, <span class="number">20</span>, <span class="number">32</span>, <span class="number">12</span>, <span class="number">23</span>, <span class="number">11</span>]</span><br><span class="line"></span><br><span class="line">UJ9mxXxeoS =  IyMgIyMgIyMgIyMgIyMgIyMgIyMKIyMgIyMgIyMgXl4gIyMgXl4gIyMKIyMgIyMgIyMgLi4gIyMgSVogIyMgIyMgIyMgIyMKIyMgJVIgLi4gJUQgIyMgJUQgLi4gLi4gJUwgIyMKIyMgPj4gIyMgLi4gIyMgRUEgKiogUFAgJVUgIyMKIyMgJVUgSUEgVEEgIyMgRUIgKiogUFAgJVUgIyMKIyMgJVUgSUIgVEIgIyMgRUMgKiogUFAgJVUgIyMKIyMgJVUgSUMgVEMgIyMgRUQgKiogUFAgJVUgIyMKIyMgJVUgSUQgVEQgIyMgRUUgKiogUFAgJVUgIyMKIyMgJVUgSUUgVEUgIyMgRUYgKiogUFAgJVUgIyMKIyMgJVUgSUYgVEYgIyMgJVIgKiogSVogJVUgIyMKIyMgJVUgSUcgJUwgIyMgIyMgIyMgIyMgIyMgIyMKIyMgIyMgIyMgIyMgIyMgIyMKClBQIC0+ICs9MQpNTSAtPiAtPTEKSVogLT4gPTAKRUEgLT4gSUYgPT0wIFRIRU4gJVIgRUxTRSAlRApFQiAtPiBJRiA9PTEgVEhFTiAlUiBFTFNFICVECkVDIC0+IElGID09MiBUSEVOICVSIEVMU0UgJUQKRUQgLT4gSUYgPT0zIFRIRU4gJVIgRUxTRSAlRApFRSAtPiBJRiA9PTQgVEhFTiAlUiBFTFNFICVECkVGIC0+IElGID09NSBUSEVOICVSIEVMU0UgJUQKVEEgLT4gSUYgKiogVEhFTiAlTCBFTFNFICVECklBIC0+ID03MgpUQiAtPiBJRiAqKiBUSEVOICVMIEVMU0UgJUQKSUIgLT4gPTczClRDIC0+IElGICoqIFRIRU4gJUwgRUxTRSAlRApJQyAtPiA9ODQKVEQgLT4gSUYgKiogVEhFTiAlTCBFTFNFICVECklEIC0+ID04MApURSAtPiBJRiAqKiBUSEVOICVMIEVMU0UgJUQKSUUgLT4gPTY3ClRGIC0+IElGICoqIFRIRU4gJUwgRUxTRSAlRApJRiAtPiA9ODQKSUcgLT4gPTcwCkxUIC0+IElGID09NiBUSEVOICVEIEVMU0UgJUwK</span><br><span class="line"></span><br><span class="line">c2VjcmV0 =  [<span class="number">7</span>, <span class="number">47</span>, <span class="number">60</span>, <span class="number">28</span>, <span class="number">39</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">5</span>, <span class="number">49</span>, <span class="number">49</span>, <span class="number">26</span>, <span class="number">11</span>, <span class="number">63</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">25</span>, <span class="number">61</span>, <span class="number">36</span>, <span class="number">112</span>, <span class="number">25</span>, <span class="number">15</span>, <span class="number">62</span>, <span class="number">25</span>, <span class="number">3</span>, <span class="number">16</span>, <span class="number">102</span>, <span class="number">38</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">37</span>, <span class="number">4</span>, <span class="number">40</span>]</span><br><span class="line"></span><br><span class="line">regexes =  &#123;<span class="string">&#x27;wall&#x27;</span>: <span class="string">&#x27;##|``&#x27;</span>, <span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;\\.\\.&#x27;</span>, <span class="string">&#x27;splitter&#x27;</span>: <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;pause&#x27;</span>: <span class="string">&#x27;[0-9]&#123;2&#125;&#x27;</span>, <span class="string">&#x27;start&#x27;</span>: <span class="string">&#x27;\\^\\^&#x27;</span>, <span class="string">&#x27;hole&#x27;</span>: <span class="string">&#x27;\\(\\)&#x27;</span>, <span class="string">&#x27;out&#x27;</span>: <span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;in&#x27;</span>: <span class="string">&#x27;&lt;&lt;&#x27;</span>, <span class="string">&#x27;one-use&#x27;</span>: <span class="string">&#x27;--&#x27;</span>, <span class="string">&#x27;direction&#x27;</span>: <span class="string">&#x27;%[LRUDNlrudn]&#x27;</span>, <span class="string">&#x27;signal&#x27;</span>: <span class="string">&#x27;(?&lt;=\\*)[\\*A-Za-z0-9]&#x27;</span>, <span class="string">&#x27;function&#x27;</span>: <span class="string">&#x27;[A-Za-z][A-Za-z0-9]&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后就需要硬逆maze.so<br>前面对maze得信息收集知道只有两个函数 且名字都是直接base64编码得 init_secret和solve<br>慢慢逆 solve<br>可以发现开始是一个b64decode 然后check len&#x3D;&#x3D;33<br>接下来调用了init_secret 然后进行了一个xor<br>xor后可以发现用到了 _c2VjcmV0作为check<br>用mazelang解释器运行一下base64解码出的.mz<br>发现没有输出 ctrl+c终止发现一直重复输出 72738480678470<br>很容易发现就是HITPCTF<br>所以我们调用init_secret后 将c2VjcmV0[i]与key[i]异或即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Python <span class="number">3.8</span><span class="number">.18</span> (default, Aug <span class="number">25</span> <span class="number">2023</span>, <span class="number">13</span>:<span class="number">20</span>:<span class="number">30</span>) </span><br><span class="line">[GCC <span class="number">11.4</span><span class="number">.0</span>] on linux</span><br><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> maze <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>key = <span class="string">&quot;HITPCTF&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>aW5pdF9zZWNyZXQ()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line"><span class="meta">... </span>    x = c2VjcmV0[i]^<span class="built_in">ord</span>(key[i%<span class="number">7</span>])</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(<span class="built_in">chr</span>((x&amp;<span class="number">0xff</span>)),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">TPCTF&#123;yOu_@re_m@sT3r_OF_mAZElaN6&#125;&gt;&gt;&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>TPCTF{yOu_@re_m@sT3r_OF_mAZElaN6}</strong></p>
<h2 id="nanoPyEnc"><a href="#nanoPyEnc" class="headerlink" title="nanoPyEnc"></a>nanoPyEnc</h2><p>很有意思的题<br>一样的 python3.8运行pyinsxxxxx解包<br>主的run.py从secret获取key,enc 对输入进行一个AES_ECB加密 与enc比较<br>在PYZ找到secret 拿出enc&#x2F;key 解AES发现是 flag{test} 假flag<br>注意到导入了三个包 而且PYZ里有这三个 说明不是python原本的</p>
<p>挨个看<br>首先在Crypto.Util.number的sieve_base数组最后发现有一段覆盖enc的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> time.time() % <span class="number">64</span> &lt; <span class="number">1</span>:</span><br><span class="line">    enc = (<span class="number">153</span>, <span class="number">240</span>, <span class="number">237</span>, <span class="number">199</span>, <span class="number">63</span>, <span class="number">44</span>, <span class="number">237</span>, <span class="number">45</span>, <span class="number">25</span>, <span class="number">47</span>, <span class="number">97</span>, <span class="number">154</span>, <span class="number">158</span>, <span class="number">112</span>, <span class="number">46</span>, <span class="number">176</span>, <span class="number">219</span>, <span class="number">247</span>, <span class="number">44</span>, <span class="number">115</span>, <span class="number">169</span>, <span class="number">124</span>, <span class="number">64</span>, <span class="number">63</span>, <span class="number">121</span>, <span class="number">253</span>, <span class="number">250</span>, <span class="number">137</span>, <span class="number">34</span>, <span class="number">144</span>, <span class="number">33</span>, <span class="number">17</span>, <span class="number">182</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">247</span>, <span class="number">249</span>, <span class="number">41</span>, <span class="number">165</span>, <span class="number">114</span>, <span class="number">87</span>, <span class="number">231</span>, <span class="number">222</span>, <span class="number">242</span>, <span class="number">126</span>, <span class="number">30</span>, <span class="number">124</span>, <span class="number">237</span>)</span><br></pre></td></tr></table></figure>

<p>在Crypto.Util.Padding中发现又引入了py3compat<br>查看py3compat 发现覆写了list方法 让传入的s每位xor了1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">list</span>(<span class="params">s</span>):</span><br><span class="line">    _x = time.time() % <span class="number">64</span> &lt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">lambda</span> <span class="number">.0</span> = <span class="literal">None</span>: [ _x ^ x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="number">.0</span> ])(s)</span><br></pre></td></tr></table></figure>

<p>注意到list是python自带的列表方法 在主的run.py被调用了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">encrypted = <span class="built_in">list</span>(encrypt_message(key, message.encode()))</span><br></pre></td></tr></table></figure>

<p>所以再加密后又进行了xor 1的操作 逆向回去就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&#x27;2033-05-18_03:33&#x27;</span></span><br><span class="line">key = key.encode()</span><br><span class="line">enc = [<span class="number">153</span>, <span class="number">240</span>, <span class="number">237</span>, <span class="number">199</span>, <span class="number">63</span>, <span class="number">44</span>, <span class="number">237</span>, <span class="number">45</span>, <span class="number">25</span>, <span class="number">47</span>, <span class="number">97</span>, <span class="number">154</span>, <span class="number">158</span>, <span class="number">112</span>, <span class="number">46</span>, <span class="number">176</span>, <span class="number">219</span>, <span class="number">247</span>, <span class="number">44</span>, <span class="number">115</span>, <span class="number">169</span>, <span class="number">124</span>, <span class="number">64</span>, <span class="number">63</span>, <span class="number">121</span>, <span class="number">253</span>, <span class="number">250</span>, <span class="number">137</span>, <span class="number">34</span>, <span class="number">144</span>, <span class="number">33</span>, <span class="number">17</span>, <span class="number">182</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">247</span>, <span class="number">249</span>, <span class="number">41</span>, <span class="number">165</span>, <span class="number">114</span>, <span class="number">87</span>, <span class="number">231</span>, <span class="number">222</span>, <span class="number">242</span>, <span class="number">126</span>, <span class="number">30</span>, <span class="number">124</span>, <span class="number">237</span>]</span><br><span class="line">enc = [x^<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> enc]</span><br><span class="line">enc = <span class="built_in">bytes</span>(enc)</span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">pt = cipher.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(pt.decode())</span><br></pre></td></tr></table></figure>

<p><strong>TPCTF{83_C4u710U5_0F_PY7hON_k3YW0Rd_sHadOWIN9}</strong></p>
<h1 id="GXYCTF2019"><a href="#GXYCTF2019" class="headerlink" title="GXYCTF2019"></a>GXYCTF2019</h1><h2 id="minecraft"><a href="#minecraft" class="headerlink" title="minecraft"></a>minecraft</h2><p>IDA打开exe的main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)String_to_long(v9) != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = (<span class="type">void</span> *)sub_7FF724273ED0((__int64)&amp;qword_7FF7242AD260, (__int64)&amp;unk_7FF7242A7780);</span><br><span class="line">    _CallMemberFunction0(v7, sub_7FF7242742A0);</span><br><span class="line">    sub_7FF72427F480(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>在dll中找到String_to_long</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">String_to_long</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">void</span> *v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">bool</span> v3; <span class="comment">// [rsp+30h] [rbp-138h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+34h] [rbp-134h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+38h] [rbp-130h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-12Ch]</span></span><br><span class="line">  _QWORD *v7; <span class="comment">// [rsp+48h] [rbp-120h]</span></span><br><span class="line">  <span class="type">void</span> *BASE64_INPUT; <span class="comment">// [rsp+50h] [rbp-118h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+58h] [rbp-110h]</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">8</span>]; <span class="comment">// [rsp+60h] [rbp-108h]</span></span><br><span class="line">  <span class="type">char</span> *v11; <span class="comment">// [rsp+80h] [rbp-E8h]</span></span><br><span class="line">  <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">std</span>::_Container_base0 *v12; <span class="comment">// [rsp+88h] [rbp-E0h]</span></span><br><span class="line">  __int64 v13; <span class="comment">// [rsp+90h] [rbp-D8h]</span></span><br><span class="line">  __int64 v14; <span class="comment">// [rsp+98h] [rbp-D0h]</span></span><br><span class="line">  <span class="type">char</span> *v15; <span class="comment">// [rsp+A0h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">const</span> <span class="keyword">struct</span> <span class="title class_">std</span>::_Container_base0 *v16; <span class="comment">// [rsp+A8h] [rbp-C0h]</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">32</span>]; <span class="comment">// [rsp+B0h] [rbp-B8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">32</span>]; <span class="comment">// [rsp+D0h] [rbp-98h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v19[<span class="number">32</span>]; <span class="comment">// [rsp+F0h] [rbp-78h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v20[<span class="number">32</span>]; <span class="comment">// [rsp+110h] [rbp-58h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v21[<span class="number">32</span>]; <span class="comment">// [rsp+130h] [rbp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v7 = <span class="keyword">operator</span> <span class="built_in">new</span>(<span class="number">0x128</span>ui64);</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    *v7 = <span class="number">9</span>i64;</span><br><span class="line">    <span class="function">eh vector constructor <span class="title">iterator</span><span class="params">(v7 + <span class="number">1</span>, <span class="number">0x20</span>ui64, <span class="number">9u</span>i64, sub_180003C90, (<span class="type">void</span> (__stdcall *)(<span class="type">void</span> *))sub_180003AF0)</span></span>;</span><br><span class="line">    v9 = (__int64)(v7 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v9 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_180003C90</span>(v20);</span><br><span class="line">  v11 = v18;</span><br><span class="line">  v12 = <span class="built_in">sub_180003CE0</span>((<span class="type">const</span> <span class="keyword">struct</span> std::_Container_base0 *)v18, a1);</span><br><span class="line">  BASE64_INPUT = (<span class="type">void</span> *)<span class="built_in">BASE64ENCODE</span>(v12);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)<span class="built_in">LEN0</span>(a1) &gt;= <span class="number">0xA</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_180003A60</span>((__int64)v20, (__int64)BASE64_INPUT);</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v13 = v5;</span><br><span class="line">      <span class="keyword">if</span> ( v5 &gt;= (<span class="type">unsigned</span> __int64)<span class="built_in">LEN0</span>((__int64)v20) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v14 = <span class="built_in">sub_180003900</span>((__int64)v20, (__int64)v17, v5, <span class="number">4</span>);</span><br><span class="line">      <span class="built_in">sub_180003B20</span>(<span class="number">32</span>i64 * i + v9, v14);</span><br><span class="line">      <span class="built_in">sub_180003AF0</span>(v17);</span><br><span class="line">      <span class="built_in">sub_1800039E0</span>(<span class="number">32</span>i64 * i + v9, (__int64)&amp;unk_180034570);</span><br><span class="line">      v5 += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sub_180003C90</span>(v21);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">8</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_180003A90</span>((__int64)v21, <span class="number">32</span>i64 * j + v9);</span><br><span class="line">      v15 = v19;</span><br><span class="line">      v16 = <span class="built_in">sub_180003CE0</span>((<span class="type">const</span> <span class="keyword">struct</span> std::_Container_base0 *)v19, (__int64)v21);</span><br><span class="line">      v10[j] = <span class="built_in">sub_180003390</span>(v16);              <span class="comment">// hash....</span></span><br><span class="line">    &#125;</span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    v2 = (<span class="type">void</span> *)<span class="built_in">sub_180004B90</span>(&amp;qword_18003A200, <span class="string">&quot;-------Checking-----&quot;</span>);</span><br><span class="line">    _CallMemberFunction0(v2, (<span class="built_in">void</span> (__stdcall *)(<span class="type">void</span> *))sub_180004F60);</span><br><span class="line">    <span class="keyword">if</span> ( v10[<span class="number">0</span>] == <span class="number">0x6C43B2A7</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">1</span>] == <span class="number">0x7954FD91</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">2</span>] == <span class="number">0xA3E9532</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">3</span>] == <span class="number">0xB87B5156</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">4</span>] == <span class="number">0xDA847742</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">5</span>] == <span class="number">0x2395E7F3</span></span><br><span class="line">      &amp;&amp; v10[<span class="number">6</span>] == <span class="number">0xA679D954</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = v10[<span class="number">7</span>] == <span class="number">0xE1FAAFF7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sub_180003310</span>(v9, BASE64_INPUT);</span><br><span class="line">    <span class="built_in">sub_180003AF0</span>(v21);</span><br><span class="line">    <span class="built_in">sub_180003AF0</span>(v20);</span><br><span class="line">    <span class="keyword">return</span> v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_180003AF0</span>(v20);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>md 这种函数写法很容易看漏掉某个…<br>这里先是作了个标准base64encode<br>然后四个字符一组(这里动调可以发现前面的base64input被分成了四个字符一组的几个组)<br>进行了hash变换</p>
<p>还藏得挺深的…</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">HASH___</span><span class="params">(__int64 *a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  *a1 ^= <span class="number">0xC6A4A7935BD1E995</span>ui64 * (((<span class="number">0xC6A4A7935BD1E995</span>ui64 * a2) &gt;&gt; <span class="number">47</span>) ^ (<span class="number">0xC6A4A7935BD1E995</span>ui64 * a2));</span><br><span class="line">  *a1 *= <span class="number">0xC6A4A7935BD1E995</span>ui64;</span><br><span class="line">  result = *a1 + <span class="number">0xE6546B64</span>i64;</span><br><span class="line">  *a1 = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么就四个一组爆破 注意细节！ 最后跟enc[]数组check又要将unsigned __int64 转为unsigned int …</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="title">HASH</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> a1,<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> a2)</span></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> result; <span class="comment">// rax</span></span><br><span class="line">  a1 ^= (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span> * ((((<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span> * a2) &gt;&gt; <span class="number">47</span>) ^ ((<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span> * a2));</span><br><span class="line">  a1 *= (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>)<span class="number">0xC6A4A7935BD1E995</span>;</span><br><span class="line">  result = a1 + <span class="number">0xE6546B64</span>;</span><br><span class="line">  a1 = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> enc[]=&#123;<span class="number">0x6C43B2A7</span>,<span class="number">0x7954FD91</span>,<span class="number">0xA3E9532</span>,<span class="number">0xB87B5156</span>,<span class="number">0xDA847742</span>,<span class="number">0x2395E7F3</span>,<span class="number">0xA679D954</span>,<span class="number">0xE1FAAFF7</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> vis = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> n1=<span class="number">32</span>;n1&lt;<span class="number">129</span>&amp;&amp;vis;n1++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> n2=<span class="number">32</span>;n2&lt;<span class="number">129</span>&amp;&amp;vis;n2++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> n3=<span class="number">32</span>;n3&lt;<span class="number">129</span>&amp;&amp;vis;n3++)</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> n4=<span class="number">32</span>;n4&lt;<span class="number">129</span>&amp;&amp;vis;n4++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> res = <span class="number">0</span>;</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n1);</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n2);</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n3);</span><br><span class="line">                        res=<span class="built_in">HASH</span>(res,n4);</span><br><span class="line">                        <span class="keyword">if</span>((<span class="type">unsigned</span> <span class="type">int</span> )res == enc[i])</span><br><span class="line">                        &#123;</span><br><span class="line">                            vis = <span class="number">0</span>;</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>,n1,n2,n3,n4);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后爆破得到 R1hZe0lfaGF2ZV9ub19naXIxX2ZyaWVO<br>base64转一下即可</p>
<h1 id="RoarCTF2019"><a href="#RoarCTF2019" class="headerlink" title="RoarCTF2019"></a>RoarCTF2019</h1><h2 id="Polyre"><a href="#Polyre" class="headerlink" title="Polyre"></a>Polyre</h2><p>务必记录一下<br>神奇的插件 orz<br>在网上搜索ollvm反混淆 大概率搜不到这个神奇的plugin<br><strong>D-810</strong> !!!<br>在github上下载下来 将d-810文件夹和D-810.py移动到.&#x2F;idapro&#x2F;plugin下<br>然后打开IDA(最好用&gt;&#x3D;7.5 &lt;8.0的)ctrl+shift+D<br>启动！ 然后F5<br>控制流平坦化后的main:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">signed</span> __int64 v4; <span class="comment">// [rsp+1E0h] [rbp-110h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+1E8h] [rbp-108h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">48</span>]; <span class="comment">// [rsp+1F0h] [rbp-100h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">60</span>]; <span class="comment">// [rsp+220h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// [rsp+25Ch] [rbp-94h]</span></span><br><span class="line">  <span class="type">char</span> *v11; <span class="comment">// [rsp+260h] [rbp-90h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+26Ch] [rbp-84h]</span></span><br><span class="line">  <span class="type">bool</span> v13; <span class="comment">// [rsp+272h] [rbp-7Eh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v14; <span class="comment">// [rsp+273h] [rbp-7Dh]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+274h] [rbp-7Ch]</span></span><br><span class="line">  <span class="type">char</span> *v16; <span class="comment">// [rsp+278h] [rbp-78h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+284h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [rsp+288h] [rbp-68h]</span></span><br><span class="line">  <span class="type">bool</span> v19; <span class="comment">// [rsp+28Fh] [rbp-61h]</span></span><br><span class="line">  <span class="type">char</span> *v20; <span class="comment">// [rsp+290h] [rbp-60h]</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// [rsp+298h] [rbp-58h]</span></span><br><span class="line">  <span class="type">bool</span> v22; <span class="comment">// [rsp+29Fh] [rbp-51h]</span></span><br><span class="line">  __int64 v23; <span class="comment">// [rsp+2A0h] [rbp-50h]</span></span><br><span class="line">  <span class="type">bool</span> v24; <span class="comment">// [rsp+2AFh] [rbp-41h]</span></span><br><span class="line">  __int64 v25; <span class="comment">// [rsp+2B0h] [rbp-40h]</span></span><br><span class="line">  __int64 v26; <span class="comment">// [rsp+2B8h] [rbp-38h]</span></span><br><span class="line">  __int64 v27; <span class="comment">// [rsp+2C0h] [rbp-30h]</span></span><br><span class="line">  __int64 v28; <span class="comment">// [rsp+2C8h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// [rsp+2D0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v30; <span class="comment">// [rsp+2D4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">char</span> *v31; <span class="comment">// [rsp+2D8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v32; <span class="comment">// [rsp+2E0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v33; <span class="comment">// [rsp+2E4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">bool</span> v34; <span class="comment">// [rsp+2EBh] [rbp-5h]</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="built_in">sizeof</span>(s1));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input:&quot;</span>);</span><br><span class="line">  v11 = s;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v12 = i;</span><br><span class="line">    v13 = i &lt; <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= <span class="number">64</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v14 = s[i];</span><br><span class="line">    v15 = v14;</span><br><span class="line">    <span class="keyword">if</span> ( v14 == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = &amp;s[i];</span><br><span class="line">      *v16 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v17 = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = j;</span><br><span class="line">    v19 = j &lt; <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">if</span> ( j &gt;= <span class="number">6</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v20 = s;</span><br><span class="line">    v4 = *(_QWORD *)&amp;s[<span class="number">8</span> * j];</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; ; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      v21 = k;</span><br><span class="line">      v22 = k &lt; <span class="number">64</span>;</span><br><span class="line">      <span class="keyword">if</span> ( k &gt;= <span class="number">64</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v23 = v4;</span><br><span class="line">      v24 = v4 &lt; <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &lt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v25 = <span class="number">2</span> * v4;</span><br><span class="line">        v26 = <span class="number">2</span> * v4;</span><br><span class="line">        v4 = (<span class="number">2</span> * v4) ^ <span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v27 = v4;</span><br><span class="line">        v28 = <span class="number">2</span> * v4;</span><br><span class="line">        v4 *= <span class="number">2LL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v29 = k;</span><br><span class="line">    &#125;</span><br><span class="line">    v30 = <span class="number">8</span> * j;</span><br><span class="line">    v31 = &amp;s1[<span class="number">8</span> * j];</span><br><span class="line">    *(_QWORD *)v31 = v4;</span><br><span class="line">    v32 = j + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v33 = <span class="built_in">memcmp</span>(s1, &amp;unk_402170, <span class="number">0x30</span>uLL);</span><br><span class="line">  v34 = v33 != <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这不清晰多了…<br>还有一个很烦的点 这个unsigned和signed绕来绕去的…(重点是分析符号位)<br>根据v4&lt;0的分支 乘2再xor一个奇数后肯定是一个奇数<br>而v4&gt;0时直接乘2 肯定是个偶数<br>那么根据奇偶就能知道v4之前是否为负数<br>那么我们逆向还原之前的v4就要保证v4为负数 为了保证这一点需要 |&#x3D; 0x8000000000000000<br>(当个知识点记住吧)<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0xBC8FF26D43536296</span>, <span class="number">0x520100780530EE16</span>, <span class="number">0x4DC0B5EA935F08EC</span>, <span class="number">0x342B90AFD853F450</span>, </span><br><span class="line">    <span class="number">0x8B250EBCAA2C3681</span>, <span class="number">0x55759F81A2C68AE4</span>, <span class="number">0xB0004B7679FA26B3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    x = c</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        <span class="keyword">if</span>(x&amp;<span class="number">1</span>==<span class="number">1</span>):</span><br><span class="line">            x ^= <span class="number">0xB0004B7679FA26B3</span></span><br><span class="line">            x //= <span class="number">2</span></span><br><span class="line">            x |= <span class="number">0x8000000000000000</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x //= <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>((long_to_bytes(x).decode()[::-<span class="number">1</span>]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># flag&#123;6ff29390-6c20-4c56-ba70-a95758e3d1f8&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="网鼎杯2018"><a href="#网鼎杯2018" class="headerlink" title="网鼎杯2018"></a>网鼎杯2018</h1><h2 id="最好的语言"><a href="#最好的语言" class="headerlink" title="最好的语言"></a>最好的语言</h2><p>参考:<br><a href="https://www.wolai.com/ctfhub/hF9r3aJKC7d2uxwZMa85gp" target="_blank"> + </a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">magic 03f30d0a</span><br><span class="line">moddate 6d4a695b (Tue Aug  7 15:29:49 2018)</span><br><span class="line"><span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">argcount</span>&gt;</span> 0 <span class="tag">&lt;/<span class="name">argcount</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">nlocals</span>&gt;</span> 0<span class="tag">&lt;/<span class="name">nlocals</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">stacksize</span>&gt;</span> 5<span class="tag">&lt;/<span class="name">stacksize</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">flags</span>&gt;</span> 0040<span class="tag">&lt;/<span class="name">flags</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">      6400006401006c00005a00006400006402006c01006d02005a0200016400</span><br><span class="line">      006401006c03005a03006400006401006c04005a04006403005a05006404</span><br><span class="line">      008400005a06006405008400005a07006506006505006406002083010065</span><br><span class="line">      070065050064060064070021830100176506006505006407001f83010017</span><br><span class="line">      5a08006500006a090065080083010047486408005a080064010053</span><br><span class="line">   <span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">names</span>&gt;</span> (&#x27;base64&#x27;, &#x27;hashlib&#x27;, &#x27;md5&#x27;, &#x27;random&#x27;, &#x27;string&#x27;, &#x27;f&#x27;, &#x27;_&#x27;, &#x27;____&#x27;, &#x27;e&#x27;, &#x27;b64encode&#x27;)<span class="tag">&lt;/<span class="name">names</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">varnames</span>&gt;</span> ()<span class="tag">&lt;/<span class="name">varnames</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">freevars</span>&gt;</span> ()<span class="tag">&lt;/<span class="name">freevars</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">cellvars</span>&gt;</span> ()<span class="tag">&lt;/<span class="name">cellvars</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filename</span>&gt;</span> &#x27;re2.py&#x27;<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span> &#x27;<span class="tag">&lt;<span class="name">module</span>&gt;</span>&#x27;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">firstlineno</span>&gt;</span> 1<span class="tag">&lt;/<span class="name">firstlineno</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">consts</span>&gt;</span></span><br><span class="line">      -1</span><br><span class="line">      None</span><br><span class="line">      (&#x27;md5&#x27;,)</span><br><span class="line">      &#x27;flag&#123;*******&#125;&#x27;</span><br><span class="line">      <span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">argcount</span>&gt;</span> 1 <span class="tag">&lt;/<span class="name">argcount</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">nlocals</span>&gt;</span> 4<span class="tag">&lt;/<span class="name">nlocals</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">stacksize</span>&gt;</span> 8<span class="tag">&lt;/<span class="name">stacksize</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">flags</span>&gt;</span> 0043<span class="tag">&lt;/<span class="name">flags</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">            6401006a00007401006a02007403006a04006402008302008301007d0100</span><br><span class="line">            6401007d02007846007405007406007c0000830100830100445d32007d03</span><br><span class="line">            007c02007407007408007c00007c0300198301007408007c01007c030064</span><br><span class="line">            0200161983010041830100377d0200713700577c020053</span><br><span class="line">         <span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">names</span>&gt;</span> (&#x27;join&#x27;, &#x27;random&#x27;, &#x27;sample&#x27;, &#x27;string&#x27;, &#x27;digits&#x27;, &#x27;range&#x27;, &#x27;len&#x27;, &#x27;chr&#x27;, &#x27;ord&#x27;)<span class="tag">&lt;/<span class="name">names</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">varnames</span>&gt;</span> (&#x27;b&#x27;, &#x27;__&#x27;, &#x27;___&#x27;, &#x27;i&#x27;)<span class="tag">&lt;/<span class="name">varnames</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">freevars</span>&gt;</span> ()<span class="tag">&lt;/<span class="name">freevars</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">cellvars</span>&gt;</span> ()<span class="tag">&lt;/<span class="name">cellvars</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">filename</span>&gt;</span> &#x27;re2.py&#x27;<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span> &#x27;_&#x27;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">firstlineno</span>&gt;</span> 7<span class="tag">&lt;/<span class="name">firstlineno</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">consts</span>&gt;</span></span><br><span class="line">            None</span><br><span class="line">            &#x27;&#x27;</span><br><span class="line">            4</span><br><span class="line">         <span class="tag">&lt;/<span class="name">consts</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">lnotab</span>&gt;</span> 00011e01060119013001<span class="tag">&lt;/<span class="name">lnotab</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">argcount</span>&gt;</span> 1 <span class="tag">&lt;/<span class="name">argcount</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">nlocals</span>&gt;</span> 2<span class="tag">&lt;/<span class="name">nlocals</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">stacksize</span>&gt;</span> 2<span class="tag">&lt;/<span class="name">stacksize</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">flags</span>&gt;</span> 0043<span class="tag">&lt;/<span class="name">flags</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">            7400008300007d01007c01006a01007c0000830100017c01006a02008300</span><br><span class="line">            0053</span><br><span class="line">         <span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">names</span>&gt;</span> (&#x27;md5&#x27;, &#x27;update&#x27;, &#x27;digest&#x27;)<span class="tag">&lt;/<span class="name">names</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">varnames</span>&gt;</span> (&#x27;a&#x27;, &#x27;___&#x27;)<span class="tag">&lt;/<span class="name">varnames</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">freevars</span>&gt;</span> ()<span class="tag">&lt;/<span class="name">freevars</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">cellvars</span>&gt;</span> ()<span class="tag">&lt;/<span class="name">cellvars</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">filename</span>&gt;</span> &#x27;re2.py&#x27;<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span> &#x27;____&#x27;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">firstlineno</span>&gt;</span> 14<span class="tag">&lt;/<span class="name">firstlineno</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">consts</span>&gt;</span></span><br><span class="line">            None</span><br><span class="line">         <span class="tag">&lt;/<span class="name">consts</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">lnotab</span>&gt;</span> 000109010d01<span class="tag">&lt;/<span class="name">lnotab</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line">      12</span><br><span class="line">      19</span><br><span class="line">      &#x27;U1VQU05pSHdqCEJrQu7FS7Vngk1OTQ58qqghXmt2AUdrcFBBUEU=&#x27;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">consts</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">lnotab</span>&gt;</span> 0c0110010c010c020601090709052f010e01<span class="tag">&lt;/<span class="name">lnotab</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>找到<a href="https://github.com/hinus/railgun/blob/master/src/main/python/rgparser/show.py" target="_blank">项目地址</a><br>这种就自己写几个python程序让源码编译看看结构<br>但tmd python2 …<br>还不如直接硬猜…<br>…<br>佬给的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">f = <span class="string">&#x27;flag&#123;*******&#125;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_</span>(<span class="params">b</span>):</span><br><span class="line">    __ = <span class="string">&#x27;&#x27;</span>.join(random.sample(string.digits,<span class="number">4</span>))</span><br><span class="line">    ___ = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">        ___ += <span class="built_in">chr</span>(<span class="built_in">ord</span>(b[i])^<span class="built_in">ord</span>(__[i % <span class="number">4</span>]))</span><br><span class="line">    <span class="keyword">return</span> ___</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">____</span>(<span class="params">a</span>):</span><br><span class="line">    ___ = md5()</span><br><span class="line">    ___.update(a)</span><br><span class="line">    <span class="keyword">return</span> ___.digest()</span><br><span class="line">e = _(f[:<span class="number">12</span>])+____(f[<span class="number">12</span>:<span class="number">19</span>])+_(f[<span class="number">19</span>:])</span><br><span class="line"><span class="built_in">print</span> base64.b64encode(e)</span><br><span class="line">e = <span class="string">&#x27;U1VQU05pSHdqCEJrQu7FS7Vngk1OTQ58qqghXmt2AUdrcFBBUEU=&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后就爆破md5 还原key…<br>最后得到:<br><strong>flag{PyC_1s_613u21i_N0t_Hard}</strong></p>
<hr>
<hr>
<p>以后有空再来慢慢推吧…<br>题目把dis段删掉后能推出这个来的真的是神仙 orz…</p>
<h1 id="羊城杯2023"><a href="#羊城杯2023" class="headerlink" title="羊城杯2023"></a>羊城杯2023</h1><h2 id="CSGO"><a href="#CSGO" class="headerlink" title="CSGO"></a>CSGO</h2><p>学习到了sharpOD orz<br>IDA的话没办法动调 至少很难动调<br>FindCrypt插件可以发现有base64加密<br>查看交叉引用 在汇编代码中定位到字串</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000049B</span>144                 mov     [rsp+<span class="number">0</span>C8h+var_88], rcx</span><br><span class="line">.text:<span class="number">000000000049B</span>149                 mov     [rsp+<span class="number">0</span>C8h+var_80], rdi</span><br><span class="line">.text:<span class="number">000000000049B</span>14E                 mov     [rsp+<span class="number">0</span>C8h+var_70], rdx</span><br><span class="line">.text:<span class="number">000000000049B</span>153                 lea     rcx, BASE64_table_4D9278 ; <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklm&quot;</span>...</span><br><span class="line">.text:<span class="number">000000000049B</span>15A                 movzx   ebx, byte ptr [rax+rcx+<span class="number">0B</span>h]</span><br><span class="line">.text:<span class="number">000000000049B</span>15F                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">000000000049B</span>161                 call    runtime_intstring</span><br><span class="line">.text:<span class="number">000000000049B</span>166                 mov     rcx, [rsp+<span class="number">0</span>C8h+var_88]</span><br><span class="line">.text:<span class="number">000000000049B</span>16B                 mov     rdi, rax</span><br><span class="line">.text:<span class="number">000000000049B</span>16E                 mov     rsi, rbx</span><br><span class="line">.text:<span class="number">000000000049B</span>171                 <span class="keyword">xor</span>     eax, eax</span><br><span class="line">.text:<span class="number">000000000049B</span>173                 mov     rbx, [rsp+<span class="number">0</span>C8h+var_70]</span><br><span class="line">.text:<span class="number">000000000049B</span>178                 call    runtime_concatstring2</span><br><span class="line">.text:<span class="number">000000000049B</span>17D                 mov     rcx, [rsp+<span class="number">0</span>C8h+var_80]</span><br><span class="line">.text:<span class="number">000000000049B</span>182                 inc     rcx</span><br><span class="line">.text:<span class="number">000000000049B</span>185                 mov     rdx, rax</span><br><span class="line">.text:<span class="number">000000000049B</span>188                 mov     rax, rcx</span><br><span class="line">.text:<span class="number">000000000049B</span>18B                 mov     rcx, rbx</span><br></pre></td></tr></table></figure>

<p>在main的汇编可以找到最后加密对比字符串</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov     rcx, rbx</span><br><span class="line">lea     rbx, aCpqebacrpNZepY ; <span class="string">&quot;cPQebAcRp+n+ZeP+YePEWfP7bej4YefCYd/7cuP&quot;</span>...</span><br><span class="line">call    runtime_memequal</span><br><span class="line">test    al, al</span><br><span class="line">jnz     <span class="type">short</span> loc_49B282</span><br></pre></td></tr></table></figure>

<p>但是直接解发现是乱码<br>那么要么换表 要么base64后还进行了加密<br>但是看密文形式(&#x3D;) 只可能是换表 但只有上面找到的一处lea … ABCD…<br>理论可以动调查看<br>但IDA动调会直接while(1)卡死<br>反调试逻辑也比较复杂<br>这里学习到了用x64dbg的sharpOD插件过掉反调试的方法</p>
<p>搜索安装好插件 把默认勾上的都勾上<br>在x64中搜索ABCD… 定位到代码段<br>下个断点 就能运行了<br>输入flag后一直F9 可以发现出现了一个很大的循环 对base64表进行了变换</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000B</span>5B14 | <span class="number">48</span>:<span class="number">895424</span> <span class="number">58</span>            | mov qword ptr ss:[rsp+<span class="number">58</span>],rdx           | [rsp+<span class="number">58</span>]:<span class="string">&quot;LMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ABCDEFGHI&quot;</span></span><br><span class="line"><span class="number">0000000000B</span>5B15 | <span class="number">48</span>:<span class="number">8</span>D0D <span class="number">1</span>EE10300        | lea rcx,qword ptr ds:[B99278]           | <span class="number">0000000000B</span>99278:<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span></span><br></pre></td></tr></table></figure>

<p>可以发现这里逻辑就是做了一个整体平移 那么提取出变表base64解密即可<br>flag: DASCTF{73913519-A0A6-5575-0F10-DDCBF50FA8CA}</p>
<hr>
<hr>
<p>抽空还得看看具体怎么反调试的 以及IDA怎么反反调试</p>
<p>其实通过这段代码(概率性的F5出来了)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v19 = (<span class="type">unsigned</span> __int8)BASE64_table_4D9278[v25 + <span class="number">11</span>];</span><br><span class="line">v8 = <span class="built_in">runtime_intstring</span>(</span><br><span class="line">       <span class="number">0</span>,</span><br><span class="line">       v19,</span><br><span class="line">       (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>,</span><br><span class="line">       v24,</span><br><span class="line">       (<span class="type">int</span>)v25 + <span class="number">11</span>,</span><br><span class="line">       v12,</span><br><span class="line">       v13,</span><br><span class="line">       v14,</span><br><span class="line">       v15,</span><br><span class="line">       v53,</span><br><span class="line">       v59);</span><br><span class="line"><span class="built_in">LODWORD</span>(v9) = v19;</span><br></pre></td></tr></table></figure>

<p>可以猜到大致是移位11位 外面套了个64的循环 那么应该是取index赋值之类</p>
<h2 id="Blast"><a href="#Blast" class="headerlink" title="Blast"></a>Blast</h2><p>用D810稍微去了点混淆<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  v45 = a1;</span><br><span class="line">  v44 = a2;</span><br><span class="line">  v43 = &amp;v8;</span><br><span class="line">  v42 = &amp;v8;</span><br><span class="line">  v41 = &amp;v8;</span><br><span class="line">  v40 = &amp;v8;</span><br><span class="line">  v46 = <span class="number">0</span>;</span><br><span class="line">  s = (<span class="type">char</span> *)(&amp;v8 - <span class="number">4</span>);</span><br><span class="line">  v38 = &amp;v8 - <span class="number">4</span>;</span><br><span class="line">  v37 = &amp;v8 - <span class="number">24</span>;</span><br><span class="line">  v36 = &amp;v8 - <span class="number">4</span>;</span><br><span class="line">  v35 = &amp;v47;</span><br><span class="line">  v34 = &amp;v8 - <span class="number">4</span>;</span><br><span class="line">  v9 = <span class="built_in">HIDWORD</span>(a2);</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v33 = *v41;</span><br><span class="line">    <span class="keyword">while</span> ( dword_40F9A8 &gt;= <span class="number">10</span> &amp;&amp; dword_40F9A8 &lt; <span class="number">10</span> );</span><br><span class="line">    v32 = v33;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v31 = <span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span> *)(<span class="type">unsigned</span> <span class="type">int</span>)a0123456789abcd);</span><br><span class="line">    <span class="keyword">while</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> );</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v30 = v32 &lt; v31;</span><br><span class="line">    <span class="keyword">while</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> );</span><br><span class="line">    <span class="keyword">if</span> ( !v30 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v29 = *v41;</span><br><span class="line">    <span class="keyword">while</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> );</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v28 = &amp;a0123456789abcd[v29];</span><br><span class="line">    <span class="keyword">while</span> ( dword_40F9A8 &gt;= <span class="number">10</span> &amp;&amp; dword_40F9A8 &lt; <span class="number">10</span> );</span><br><span class="line">    byte_40E060[*v41] = *v28;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      v27 = *v41;</span><br><span class="line">    <span class="keyword">while</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> );</span><br><span class="line">    v26 = v27 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( dword_40F9A8 &gt;= <span class="number">10</span> &amp;&amp; dword_40F9A8 &lt; <span class="number">10</span> )</span><br><span class="line">LABEL_38:</span><br><span class="line">      *v41 = v26;</span><br><span class="line">    *v41 = v26;</span><br><span class="line">    <span class="keyword">if</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_38;</span><br><span class="line">    <span class="keyword">while</span> ( dword_40F9A8 &gt;= <span class="number">10</span> &amp;&amp; dword_40F9A8 &lt; <span class="number">10</span> )</span><br><span class="line">      ;</span><br><span class="line">  &#125;</span><br><span class="line">  v25 = <span class="built_in">gets</span>(INPUT);                            <span class="comment">// INPUT here</span></span><br><span class="line">  *v40 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">LABEL_16:</span><br><span class="line">    v24 = *v40;</span><br><span class="line">  <span class="keyword">while</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> );</span><br><span class="line">  v23 = v24 &lt; <span class="number">47</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v24 &lt; <span class="number">47</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v22 = *v40;</span><br><span class="line">    *s = INPUT[v22];</span><br><span class="line">    <span class="built_in">sub_404010</span>(v37);                            <span class="comment">// md5常量初始化</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v21 = <span class="number">1</span>;</span><br><span class="line">      v20 = <span class="built_in">strlen</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( !((v21 | <span class="number">1</span>) &amp; (dword_40F9A8 &lt; <span class="number">10</span>) | ((<span class="type">unsigned</span> __int8)(~(dword_40F9A8 &lt; <span class="number">10</span>) | v21 ^ <span class="number">1</span>) ^ (((v21 &amp; <span class="number">1</span>) == <span class="number">0</span>) | <span class="number">0xFE</span>)) &amp; <span class="number">1</span>) );</span><br><span class="line">    <span class="keyword">if</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_42;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_404140</span>(v37, s, (<span class="type">unsigned</span> <span class="type">int</span>)v20);</span><br><span class="line">      <span class="built_in">sub_40A510</span>(v37, v38);</span><br><span class="line">      *v36 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( dword_40F9A8 &gt;= <span class="number">10</span> || dword_40F9A8 &lt; <span class="number">10</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">LABEL_42:</span><br><span class="line">      <span class="built_in">sub_404140</span>(v37, s, (<span class="type">unsigned</span> <span class="type">int</span>)v20);</span><br><span class="line">      <span class="built_in">sub_40A510</span>(v37, v38);</span><br><span class="line">      *v36 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v19 = *v36;</span><br><span class="line">      v18 = v19 &lt; <span class="number">16</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v19 &gt;= <span class="number">16</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = *v40;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">          v9 = v10 + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> );</span><br><span class="line">        *v40 = v9;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_16;</span><br><span class="line">      &#125;</span><br><span class="line">      v17 = *v36;</span><br><span class="line">      v16 = v17;</span><br><span class="line">      v15 = *((<span class="type">unsigned</span> __int8 *)v38 + v17);</span><br><span class="line">      v14 = <span class="number">0</span>;</span><br><span class="line">      v13 = <span class="number">16</span>;</span><br><span class="line">      v3 = v35;</span><br><span class="line">      *(_BYTE *)v35 = byte_40E060[v15 / <span class="number">16LL</span>];</span><br><span class="line">      v4 = v36;</span><br><span class="line">      v5 = v34;</span><br><span class="line">      *(_BYTE *)v34 = byte_40E060[*((<span class="type">unsigned</span> __int8 *)v38 + *v36) % <span class="number">16</span>];</span><br><span class="line">      v6 = v40;</span><br><span class="line">      byte_40E700[<span class="number">33</span> * *v40 + <span class="number">2</span> * *v4] = *(_BYTE *)v3;</span><br><span class="line">      byte_40E700[<span class="number">33</span> * *v6 + <span class="number">2</span> * *v4 - (v14 - <span class="number">1</span>)] = *(_BYTE *)v5;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        v12 = *v36;</span><br><span class="line">      <span class="keyword">while</span> ( dword_40F9A8 &gt;= <span class="number">10</span> &amp;&amp; dword_40F9A8 &lt; <span class="number">10</span> );</span><br><span class="line">      v11 = v12 + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( dword_40F9A8 &gt;= <span class="number">10</span> &amp;&amp; dword_40F9A8 &lt; <span class="number">10</span> )</span><br><span class="line">LABEL_44:</span><br><span class="line">        *v36 = v11;</span><br><span class="line">      *v36 = v11;</span><br><span class="line">      <span class="keyword">if</span> ( dword_40F9A8 &lt; <span class="number">10</span> &amp;&amp; dword_40F9A8 &gt;= <span class="number">10</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_44;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_402370</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看着好多do-while 其实就只执行一次<br>FindCrypt找到md5加密特征 同时在sub_404010也找到md5常量<br>再加上找到的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">.data:<span class="number">000000000040E0</span>A0	global	Big_Numbers1_40E0A0	$c0	b<span class="number">&#x27;14</span>d89c38cd0fb23a14be2798d449c182<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E0</span>C1	global	Big_Numbers1_40E0C1	$c0	b<span class="number">&#x27;</span>a94837b18f8f43f29448b40a6e7386ba<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E0</span>E2	global	Big_Numbers1_40E0E2	$c0	b<span class="number">&#x27;</span>af85d512594fc84a5c65ec9970956ea5<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E103</span>	global	Big_Numbers1_40E103	$c0	b<span class="number">&#x27;</span>af85d512594fc84a5c65ec9970956ea5<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E124</span>	global	Big_Numbers1_40E124	$c0	b<span class="number">&#x27;10e21</span>da237a4a1491e769df6f4c3b419<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E145</span>	global	Big_Numbers1_40E145	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E166</span>	global	Big_Numbers1_40E166	$c0	b<span class="number">&#x27;297e7</span>ca127d2eef674c119331fe30dff<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E187</span>	global	Big_Numbers1_40E187	$c0	b<span class="number">&#x27;b</span>5d2099e49bdb07b8176dff5e23b3c14<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E1</span>A8	global	Big_Numbers1_40E1A8	$c0	b<span class="number">&#x27;83b</span>e264eb452fcf0a1c322f2c7cbf987<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E1</span>C9	global	Big_Numbers1_40E1C9	$c0	b<span class="number">&#x27;</span>a94837b18f8f43f29448b40a6e7386ba<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E1</span>EA	global	Big_Numbers1_40E1EA	$c0	b<span class="number">&#x27;71b</span>0438bf46aa26928c7f5a371d619e1<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E20</span>B	global	Big_Numbers1_40E20B	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E22</span>C	global	Big_Numbers1_40E22C	$c0	b<span class="number">&#x27;</span>ac49073a7165f41c57eb2c1806a7092e<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E24</span>D	global	Big_Numbers1_40E24D	$c0	b<span class="number">&#x27;</span>a94837b18f8f43f29448b40a6e7386ba<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E26</span>E	global	Big_Numbers1_40E26E	$c0	b<span class="number">&#x27;</span>af85d512594fc84a5c65ec9970956ea5<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E28</span>F	global	Big_Numbers1_40E28F	$c0	b<span class="number">&#x27;</span>ed108f6919ebadc8e809f8b86ef40b05<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E2</span>B0	global	Big_Numbers1_40E2B0	$c0	b<span class="number">&#x27;10e21</span>da237a4a1491e769df6f4c3b419<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E2</span>D1	global	Big_Numbers1_40E2D1	$c0	b<span class="number">&#x27;3</span>cfd436919bc3107d68b912ee647f341<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E2</span>F2	global	Big_Numbers1_40E2F2	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E313</span>	global	Big_Numbers1_40E313	$c0	b<span class="number">&#x27;65</span>c162f7c43612ba1bdf4d0f2912bbc0<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E334</span>	global	Big_Numbers1_40E334	$c0	b<span class="number">&#x27;10e21</span>da237a4a1491e769df6f4c3b419<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E355</span>	global	Big_Numbers1_40E355	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E376</span>	global	Big_Numbers1_40E376	$c0	b<span class="number">&#x27;3</span>cfd436919bc3107d68b912ee647f341<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E397</span>	global	Big_Numbers1_40E397	$c0	b<span class="number">&#x27;557460</span>d317ae874c924e9be336a83cbe<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E3</span>B8	global	Big_Numbers1_40E3B8	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E3</span>D9	global	Big_Numbers1_40E3D9	$c0	b<span class="number">&#x27;9203</span>d8a26e241e63e4b35b3527440998<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E3</span>FA	global	Big_Numbers1_40E3FA	$c0	b<span class="number">&#x27;10e21</span>da237a4a1491e769df6f4c3b419<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E41</span>B	global	Big_Numbers1_40E41B	$c0	b<span class="number">&#x27;f</span>91b2663febba8a884487f7de5e1d249<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E43</span>C	global	Big_Numbers1_40E43C	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E45</span>D	global	Big_Numbers1_40E45D	$c0	b<span class="number">&#x27;</span>d7afde3e7059cd0a0fe09eec4b0008cd<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E47</span>E	global	Big_Numbers1_40E47E	$c0	b<span class="number">&#x27;488</span>c428cd4a8d916deee7c1613c8b2fd<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E49</span>F	global	Big_Numbers1_40E49F	$c0	b<span class="number">&#x27;39</span>abe4bca904bca5a11121955a2996bf<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E4</span>C0	global	Big_Numbers1_40E4C0	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E4</span>E1	global	Big_Numbers1_40E4E1	$c0	b<span class="number">&#x27;3</span>cfd436919bc3107d68b912ee647f341<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E502</span>	global	Big_Numbers1_40E502	$c0	b<span class="number">&#x27;39</span>abe4bca904bca5a11121955a2996bf<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E523</span>	global	Big_Numbers1_40E523	$c0	b<span class="number">&#x27;4e44</span>f1ac85cd60e3caa56bfd4afb675e<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E544</span>	global	Big_Numbers1_40E544	$c0	b<span class="number">&#x27;45</span>cf8ddfae1d78741d8f1c622689e4af<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E565</span>	global	Big_Numbers1_40E565	$c0	b<span class="number">&#x27;3</span>cfd436919bc3107d68b912ee647f341<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E586</span>	global	Big_Numbers1_40E586	$c0	b<span class="number">&#x27;39</span>abe4bca904bca5a11121955a2996bf<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E5</span>A7	global	Big_Numbers1_40E5A7	$c0	b<span class="number">&#x27;4e44</span>f1ac85cd60e3caa56bfd4afb675e<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E5</span>C8	global	Big_Numbers1_40E5C8	$c0	b<span class="number">&#x27;37327b</span>b06c83cb29cefde1963ea588aa<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E5</span>E9	global	Big_Numbers1_40E5E9	$c0	b<span class="number">&#x27;</span>a705e8280082f93f07e3486636f3827a<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E60</span>A	global	Big_Numbers1_40E60A	$c0	b<span class="number">&#x27;23e65</span>a679105b85c5dc7034fded4fb5f<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E62</span>B	global	Big_Numbers1_40E62B	$c0	b<span class="number">&#x27;10e21</span>da237a4a1491e769df6f4c3b419<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E64</span>C	global	Big_Numbers1_40E64C	$c0	b<span class="number">&#x27;71b</span>0438bf46aa26928c7f5a371d619e1<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E66</span>D	global	Big_Numbers1_40E66D	$c0	b<span class="number">&#x27;</span>af85d512594fc84a5c65ec9970956ea5<span class="number">&#x27;</span></span><br><span class="line">.data:<span class="number">000000000040E68</span>E	global	Big_Numbers1_40E68E	$c0	b<span class="number">&#x27;39</span>abe4bca904bca5a11121955a2996bf<span class="number">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>找个md5网站解一解 发现是这种形式 md5(md5($pass))<br>所以这是对单字符做了两遍md5的结果<br>那么拿到最后数据 爆破一下即可<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">s = s.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">s = s[:-<span class="number">1</span>]</span><br><span class="line">enc = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    enc.append(c[-<span class="number">33</span>:-<span class="number">1</span>])</span><br><span class="line">enc = enc[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> target <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="comment"># print(target)</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        _<span class="built_in">hash</span> = md5(<span class="built_in">str</span>(<span class="built_in">chr</span>(x)).encode()).hexdigest()</span><br><span class="line">        ss = _<span class="built_in">hash</span></span><br><span class="line">        _<span class="built_in">hash</span> = md5(<span class="built_in">str</span>(ss).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span>(_<span class="built_in">hash</span> == target):</span><br><span class="line">            flag += <span class="built_in">chr</span>(x)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># Hello_Ctfer_Velcom_To_my_Mov_and_md5(md5)_world</span></span><br></pre></td></tr></table></figure>

<hr>
<hr>
<p>以上是做题的一些trick 其实还是想了解一下这题完整的逻辑<br>由于函数不多 挨个翻<br>在 sub_404CB0 看到是md5加密算法(不可能魔改md5吧…)<br>交叉引用查看哪里调用了md5<br>在 sub_404140 找到了唯三调用的点</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">v14 = *v51 + <span class="number">24</span>;</span><br><span class="line">v33 = *v51 + <span class="number">8</span>;</span><br><span class="line">v32 = v14;</span><br><span class="line"><span class="built_in">sub_404CB0</span>(v33, v14);</span><br><span class="line">*v48 = *(_DWORD *)v46;</span><br><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  v31 = *v48;</span><br><span class="line">  v30 = v31 + <span class="number">64</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)(v31 + <span class="number">64</span>) &gt; *(_DWORD *)v49 )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  v28 = *v51 + <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">while</span> ( dword_40FA30 &lt; <span class="number">10</span> &amp;&amp; dword_40FA30 &gt;= <span class="number">10</span> )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_404CB0</span>(v28, (<span class="type">char</span> *)*v50 + (<span class="type">unsigned</span> <span class="type">int</span>)*v48);</span><br><span class="line">    <span class="keyword">if</span> ( dword_40FA30 &gt;= <span class="number">10</span> || dword_40FA30 &lt; <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">sub_404CB0</span>(v28, (<span class="type">char</span> *)*v50 + (<span class="type">unsigned</span> <span class="type">int</span>)*v48);</span><br><span class="line">  &#125;</span><br><span class="line">  v27 = *v48;</span><br><span class="line">  v26 = v27 + <span class="number">64</span>;</span><br></pre></td></tr></table></figure>

<p>由于第二个第三个在一个虚假的do-while里 实则只执行了第二个md5 加上前面的md5 有效的md5调用了两次<br>同时通过 v28-&gt;v51-&gt;v14&#x2F;v33 也能发现这两次md5有关联 那么合理推测md5(md5(xxx))就很自然了<br>由于这题控制流不是那么平坦 平坦化后看逻辑还好 但是动调跳来跳去挺烦的 所以动调就免了(以后有时间再来试试)</p>
<h2 id="vm-wo"><a href="#vm-wo" class="headerlink" title="vm_wo"></a>vm_wo</h2><p>macos的ARM指令集… 因为没有mac动调不了一点…<br>题目逻辑简单<br>输入长度为29的flag后进行虚拟机操作加密 然后与一直enc比对<br>虚拟机前的opcode准备部分:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8[<span class="number">0</span>] = <span class="number">0x20D01011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v8 + <span class="number">7</span>) = <span class="number">0x300010201180702</span>LL;</span><br><span class="line">      BYTE2(v8[<span class="number">0</span>]) = *a1;</span><br><span class="line">      interpretBytecode((__int64)v8, <span class="number">15</span>);</span><br><span class="line">      v7[<span class="number">0</span>] = <span class="number">0x20D02011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v7 + <span class="number">7</span>) = <span class="number">0x400010201180602</span>LL;</span><br><span class="line">      BYTE2(v7[<span class="number">0</span>]) = vm_body[<span class="number">0</span>];</span><br><span class="line">      interpretBytecode((__int64)v7, <span class="number">15</span>);</span><br><span class="line">      v6[<span class="number">0</span>] = <span class="number">0x20D03011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v6 + <span class="number">7</span>) = <span class="number">0x500010201180502</span>LL;</span><br><span class="line">      BYTE2(v6[<span class="number">0</span>]) = vm_body[<span class="number">0</span>];</span><br><span class="line">      interpretBytecode((__int64)v6, <span class="number">15</span>);</span><br><span class="line">      v5[<span class="number">0</span>] = <span class="number">0x20D04011903001A</span>LL;</span><br><span class="line">      *(_QWORD *)((<span class="type">char</span> *)v5 + <span class="number">7</span>) = <span class="number">0x600010201180402</span>LL;</span><br><span class="line">      BYTE2(v5[<span class="number">0</span>]) = vm_body[<span class="number">0</span>];</span><br><span class="line">      interpretBytecode((__int64)v5, <span class="number">15</span>);</span><br><span class="line">      *a1++ = ((<span class="type">unsigned</span> __int8)vm_body[<span class="number">0</span>] &gt;&gt; <span class="number">5</span>) | (<span class="number">8</span> * vm_body[<span class="number">0</span>]);</span><br><span class="line">      --v2;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>最开始就是这里没有理解准确<br>以v7[0]为例</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v7[0] = 0x20D02011903001ALL; -&gt; 低8个字节 020D02011903001A</span><br><span class="line"><span class="emphasis">*(_QWORD *</span>)((char <span class="emphasis">*)v7 + 7) = 0x400010201180602LL;</span></span><br><span class="line"><span class="emphasis">注意到这里是+7 所以会覆盖掉v7[0]的最高字节</span></span><br><span class="line"><span class="emphasis">-&gt;400010201180602 020D02011903001A -&gt; 04000102011806020D02011903001A</span></span><br><span class="line"><span class="emphasis">刚好15字节</span></span><br></pre></td></tr></table></figure>

<p>这就是静态分析容易出错的点… 如果能动调的话就特别简单…<br>然后找对应的opcode(hex)<br>发现就是一个循环移位+异或的加密逻辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">0 mov vm_body[0] 3</span><br><span class="line">3 mov vm_body[1] vm_body[0]&gt;&gt;1</span><br><span class="line">6 mov vm_body[2] vm_body[0]&lt;&lt;7</span><br><span class="line">9 mov vm_body[0] vm_body[1]|vm_body[2]</span><br><span class="line">12 xor vm_body[0] vm_body[3]</span><br><span class="line">15 mov vm_body[0] 3</span><br><span class="line">18 mov vm_body[1] vm_body[0]&gt;&gt;2</span><br><span class="line">21 mov vm_body[2] vm_body[0]&lt;&lt;6</span><br><span class="line">24 mov vm_body[0] vm_body[1]|vm_body[2]</span><br><span class="line">27 xor vm_body[0] vm_body[4]</span><br><span class="line">30 mov vm_body[0] 3</span><br><span class="line">33 mov vm_body[1] vm_body[0]&gt;&gt;3</span><br><span class="line">36 mov vm_body[2] vm_body[0]&lt;&lt;5</span><br><span class="line">39 mov vm_body[0] vm_body[1]|vm_body[2]</span><br><span class="line">42 xor vm_body[0] vm_body[5]</span><br><span class="line">45 mov vm_body[0] 3</span><br><span class="line">48 mov vm_body[1] vm_body[0]&gt;&gt;4</span><br><span class="line">51 mov vm_body[2] vm_body[0]&lt;&lt;4</span><br><span class="line">54 mov vm_body[0] vm_body[1]|vm_body[2]</span><br><span class="line">57 xor vm_body[0] vm_body[6]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意下vm_body[3]处是dword的赋值 刚好对应BYTE的[3],[4],[5],[6]<br>正向爆破即可</p>
<p><strong>DASCTF{you_are_right_so_cool}</strong></p>
<h2 id="EZ加密器"><a href="#EZ加密器" class="headerlink" title="EZ加密器"></a>EZ加密器</h2><p>学习到了IDA7.5 Signsrch插件的使用<br>做的时候犯了一个错误 题目对输入的vericode没有做正确性的检查！！！<br>只检查了长度… 只要是6位都会继续… 所以后面需要爆破<br>大致流程:<br>先输入6位数字 然后base64变表加密得到新的key<br>再对input做加密 最后HEX拼接与已知比较<br>比较的密文在加密input的时候做了xor7的修改</p>
<p>关键部分的加密大致可以知道是有sbox的流加密<br>用IDA插件 Sighsrch</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.rdata:0140016080	0040	DES_fp [..64]</span><br><span class="line">.rdata:01400160C0	0030	DES permuted choice key (table) [..48]</span><br><span class="line">.rdata:0140016100	0038	DES permuted choice table (key) [..56]</span><br><span class="line">.rdata:0140016160	0020	DES_p32i [..32]</span><br><span class="line">.rdata:0140016180	0200	DES S-boxes [..512]</span><br><span class="line">.rdata:0140016380	0030	DES_ei [..48]</span><br><span class="line">.rdata:01400163C0	0040	DES initial permutation IP [..64]</span><br></pre></td></tr></table></figure>

<p>知道是DES 那么枚举输入数字爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s1 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">s2 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+/&quot;</span></span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;0723105D5C12217DCDC3601F5ECB54DA9CCEC2279F1684A13A0D716D17217F4C9EA85FF1A42795731CA3C55D3A4D7BEA&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">100000</span>,<span class="number">1000000</span>):</span><br><span class="line">    s = <span class="built_in">str</span>(i).zfill(<span class="number">6</span>)</span><br><span class="line">    key = b64encode((s.encode())).decode().translate(<span class="built_in">str</span>.maketrans(s1,s2)).encode()</span><br><span class="line">    des = DES.new(key,DES.MODE_ECB)</span><br><span class="line">    pt = des.decrypt(cipher)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;DASCTF&#x27;</span> <span class="keyword">in</span> pt:</span><br><span class="line">        <span class="built_in">print</span>(pt)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><strong>DASCTF{f771b96b71514bb6bc20f3275fa9404e}</strong></p>
<h1 id="V-N2020公开赛"><a href="#V-N2020公开赛" class="headerlink" title="V&amp;N2020公开赛"></a>V&amp;N2020公开赛</h1><h2 id="strangeCPP"><a href="#strangeCPP" class="headerlink" title="strangeCPP"></a>strangeCPP</h2><p>这几天做reversing.Kr被干碎了…</p>
<p>运行一下 发现电脑的很多信息都被他打印出来了(学习一手)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">_SYSTEM_INFO</span> SystemInfo; <span class="comment">// [rsp+28h] [rbp+8h] BYREF</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **j; <span class="comment">// [rsp+78h] [rbp+58h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v13; <span class="comment">// [rsp+98h] [rbp+78h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v10;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">94</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">j___CheckForDebuggerJustMyCode</span>(&amp;unk_7FF7D1F77033);</span><br><span class="line">  <span class="built_in">GetSystemInfo</span>(&amp;SystemInfo);</span><br><span class="line">  <span class="built_in">putchar</span>(byte_7FF7D1F71004);</span><br><span class="line">  <span class="built_in">putchar</span>(byte_7FF7D1F71005);</span><br><span class="line">  <span class="built_in">putchar</span>(byte_7FF7D1F71006);</span><br><span class="line">  <span class="built_in">putchar</span>(byte_7FF7D1F71007);</span><br><span class="line">  <span class="built_in">putchar</span>(byte_7FF7D1F71019);</span><br><span class="line">  <span class="built_in">putchar</span>(byte_7FF7D1F7101A);</span><br><span class="line">  <span class="built_in">putchar</span>(byte_7FF7D1F71005);</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Let me have a look at your computer...&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = envp; *j; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v13 = *j;</span><br><span class="line">    <span class="built_in">sub_7FF7D1F61226</span>(<span class="string">&quot;%s\n&quot;</span>, v13);</span><br><span class="line">  &#125;</span><br><span class="line">  std::ostream::<span class="keyword">operator</span>&lt;&lt;(std::cout, sub_7FF7D1F61127);</span><br><span class="line">  CPU_NUMBER = SystemInfo.dwNumberOfProcessors;</span><br><span class="line">  <span class="built_in">sub_7FF7D1F61226</span>(<span class="string">&quot;now system cpu num is %d\n&quot;</span>, SystemInfo.dwNumberOfProcessors);</span><br><span class="line">  <span class="keyword">if</span> ( CPU_NUMBER &lt; <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Are you in VM?&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">GetUserNameA</span>(Str1, &amp;pcbBuffer) )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">sub_7FF7D1F61172</span>(std::cout, <span class="string">&quot;this is useful&quot;</span>);</span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v5, sub_7FF7D1F61127);</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = std::ostream::<span class="keyword">operator</span>&lt;&lt;(std::cout, sub_7FF7D1F61127);</span><br><span class="line">  v7 = <span class="built_in">sub_7FF7D1F61172</span>(v6, <span class="string">&quot;ok,I am checking...&quot;</span>);</span><br><span class="line">  std::ostream::<span class="keyword">operator</span>&lt;&lt;(v7, sub_7FF7D1F61127);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">j_strcmp</span>(Str1, <span class="string">&quot;cxx&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="built_in">sub_7FF7D1F61172</span>(std::cout, <span class="string">&quot;flag&#123;where_is_my_true_flag?&#125;&quot;</span>);</span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v8, sub_7FF7D1F61127);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>IDA打开 查看CPU_NUMBER的交叉引用 找到一个有for的xor<br>前面对CPU_NUMBER进行了处理<br>那么直接爆破得到v5(31604766)的值 再爆破得到CPU_NUMBER(123456)的值 最后xor回去即可<br>得到: flag{MD5(theNum)}<br>根据题目要求 没有大写 那么小写md5加密123456即可</p>
<h1 id="BJDCTF-2nd"><a href="#BJDCTF-2nd" class="headerlink" title="BJDCTF 2nd"></a>BJDCTF 2nd</h1><h2 id="guessgame"><a href="#guessgame" class="headerlink" title="guessgame"></a>guessgame</h2><p>IDA打开 字符串一搜就有<br><strong>S1mple_ReV3r5e_W1th_0D_0r_IDA</strong></p>
<h2 id="easy"><a href="#easy" class="headerlink" title="easy"></a>easy</h2><p>找到_ques地址 动调set Ip 跳转即可看到画出的字符<br><strong>HACKIT4FUN</strong></p>
<h2 id="8086"><a href="#8086" class="headerlink" title="8086"></a>8086</h2><p>莫名其妙的<br>十六进制编辑器看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> Offset    0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F   Ascii</span><br><span class="line"></span><br><span class="line">00000000  4D 5A 90 00 03 00 00 00 04 00 00 00 FF FF 00 00  MZ?........</span><br><span class="line">00000010  00 00 00 00 1A 00 03 00 1E 00 00 00 01 00 1B 00  ...........</span><br><span class="line">00000020  03 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ...............</span><br><span class="line">00000030  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000040  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000050  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000080  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000090  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000000A0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000000B0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000000C0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000000D0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000000E0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000000F0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000100  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000110  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000120  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000130  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000140  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000150  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000160  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000170  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000180  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000190  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000001A0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000001B0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000001C0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000001D0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000001E0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">000001F0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000200  5D 55 5B 64 75 7E 7C 74 40 7B 7A 40 77 6A 2E 7D  ]U[du~|t@&#123;z@wj.&#125;</span><br><span class="line">00000210  2E 7E 71 40 67 6A 7A 7B 7A 40 77 7A 71 57 7E 2F  .~q@gjz&#123;z@wzqW~/</span><br><span class="line">00000220  62 3B 00 00 00 00 00 00 00 00 00 00 00 00 00 00  b;..............</span><br><span class="line">00000230  EB FE B9 22 00 8D 1E 00 00 8B F9 4F 80 31 1F E2  膻?.?..孂O€1?</span><br><span class="line">00000240  F8 8D 16 00 00 B4 09 CD 21 C3 B8 00 00 8E D8 E8  鴯..??酶..庁?</span><br><span class="line">00000250  DE FF B4 4C CD 21                                ?碙?</span><br></pre></td></tr></table></figure>

<p>只能说离谱 猜测</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">]U[du~|t@&#123;z@wj.&#125;.~q@gjz&#123;z@wzqW~/b;</span><br></pre></td></tr></table></figure>

<p>这个应该跟某个key xor后就是flag<br>爆破一下 key&#x3D;31时得到flag<br><strong>BJD{jack_de_hu1b1an_xuede_henHa0}</strong></p>
<p>汇编学的真好呐</p>
<h1 id="justCTF2020"><a href="#justCTF2020" class="headerlink" title="justCTF2020"></a>justCTF2020</h1><h2 id="Rusty"><a href="#Rusty" class="headerlink" title="Rusty"></a>Rusty</h2><p>题目友情提示：<br><strong>Looking at Rust code in disassembler&#x2F;decompiler hurts, so… look somewhere else.</strong></p>
<p>但我还是拖到IDA里面了…<br>以下分析纯错误方向…</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> <span class="title">sub_7FF6B75D23E0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  *(_OWORD *)v14 = *(_OWORD *)lpMem;</span><br><span class="line">  v15 = <span class="number">55</span>i64;</span><br><span class="line">  v6 = *(_QWORD *)lpMem;</span><br><span class="line">  <span class="keyword">if</span> ( **(_BYTE **)lpMem != <span class="string">&#x27;j&#x27;</span></span><br><span class="line">    || *((_BYTE *)v14[<span class="number">0</span>] + <span class="number">1</span>) != <span class="string">&#x27;c&#x27;</span></span><br><span class="line">    || *((_BYTE *)v14[<span class="number">0</span>] + <span class="number">2</span>) != <span class="string">&#x27;t&#x27;</span></span><br><span class="line">    || *((_BYTE *)v14[<span class="number">0</span>] + <span class="number">3</span>) != <span class="string">&#x27;f&#x27;</span></span><br><span class="line">    || *((_BYTE *)v14[<span class="number">0</span>] + <span class="number">4</span>) != <span class="string">&#x27;&#123;&#x27;</span></span><br><span class="line">    || *((_BYTE *)v14[<span class="number">0</span>] + <span class="number">54</span>) != <span class="string">&#x27;&#125;&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)v17 = &amp;off_7FF6B75F05D8;</span><br><span class="line">    *(_QWORD *)&amp;v17[<span class="number">8</span>] = <span class="number">1</span>i64;</span><br><span class="line">    *(_QWORD *)&amp;v17[<span class="number">16</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v18 = <span class="string">&quot;Are you sure??? Try somewhere else.\n&quot;</span>;</span><br><span class="line">    v19 = <span class="number">0</span>i64;</span><br><span class="line">    result = <span class="built_in">sub_7FF6B75D8690</span>((__int128 *)v17);</span><br><span class="line">    <span class="keyword">if</span> ( !v14[<span class="number">1</span>] )</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_25;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = <span class="built_in">sub_7FF6B75D2A30</span>(<span class="number">0x64</span>ui64);</span><br><span class="line">  <span class="keyword">if</span> ( !v7 )</span><br><span class="line">    <span class="built_in">sub_7FF6B75E8830</span>();</span><br><span class="line">  v8 = (<span class="type">void</span> *)v7;</span><br><span class="line">  *(_OWORD *)v7 = xmmword_7FF6B75F0460;</span><br><span class="line">  *(_OWORD *)(v7 + <span class="number">16</span>) = xmmword_7FF6B75F0470;</span><br><span class="line">  *(_OWORD *)(v7 + <span class="number">32</span>) = xmmword_7FF6B75F0480;</span><br><span class="line">  *(_OWORD *)(v7 + <span class="number">48</span>) = xmmword_7FF6B75F0490;</span><br><span class="line">  *(_OWORD *)(v7 + <span class="number">64</span>) = xmmword_7FF6B75F04A0;</span><br><span class="line">  *(_OWORD *)(v7 + <span class="number">80</span>) = xmmword_7FF6B75F04B0;</span><br><span class="line">  *(_DWORD *)(v7 + <span class="number">96</span>) = <span class="number">0x14A0108</span>;</span><br><span class="line">  *(_QWORD *)v13 = v7;</span><br><span class="line">  *(_OWORD *)&amp;v13[<span class="number">8</span>] = xmmword_7FF6B75F04C0;</span><br><span class="line">  v9 = <span class="number">7</span>i64;</span><br><span class="line">  <span class="keyword">while</span> ( v9 != <span class="number">57</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = *(<span class="type">unsigned</span> __int8 *)(v6 + (v9 - <span class="number">2</span>) % <span class="number">55</span>)<span class="comment">// v6: input!</span></span><br><span class="line">        + (<span class="type">unsigned</span> __int16)*(<span class="type">unsigned</span> __int8 *)(v6 + (v9 - <span class="number">1</span>) % <span class="number">55</span>)</span><br><span class="line">        + *(<span class="type">unsigned</span> __int8 *)(v6 + v9 % <span class="number">55</span>) == *(_WORD *)(v7 + <span class="number">2</span> * v9 - <span class="number">14</span>);</span><br><span class="line">    ++v9;</span><br><span class="line">    <span class="keyword">if</span> ( !v10 )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_QWORD *)v17 = &amp;off_7FF6B75F05D8;</span><br><span class="line">      *(_QWORD *)&amp;v17[<span class="number">8</span>] = <span class="number">1</span>i64;</span><br><span class="line">      *(_QWORD *)&amp;v17[<span class="number">16</span>] = <span class="number">0</span>i64;</span><br><span class="line">      v18 = <span class="string">&quot;Are you sure??? Try somewhere else.\n&quot;</span>;</span><br><span class="line">      v19 = <span class="number">0</span>i64;</span><br><span class="line">      <span class="built_in">sub_7FF6B75D8690</span>((__int128 *)v17);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_29;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)v17 = &amp;off_7FF6B75F0610;</span><br><span class="line">  *(_QWORD *)&amp;v17[<span class="number">8</span>] = <span class="number">1</span>i64;</span><br><span class="line">  *(_QWORD *)&amp;v17[<span class="number">16</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v18 = <span class="string">&quot;Are you sure??? Try somewhere else.\n&quot;</span>;</span><br><span class="line">  v19 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="built_in">sub_7FF6B75D8690</span>((__int128 *)v17);</span><br><span class="line">LABEL_29:</span><br><span class="line">  result = <span class="built_in">sub_7FF6B75D2A40</span>(v8);</span><br><span class="line">  <span class="keyword">if</span> ( v14[<span class="number">1</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_25:</span><br><span class="line">    v12 = v14[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sub_7FF6B75D2A40</span>(v12);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里大致能看到 “flag”  的check<br>甚至z3还可以约束求解出 “flag”<br>但是解出来很奇怪<br>类似这种奇怪字符串</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tgjs^JS^oos`tgf_&#123;?_xpu^brd`lnpkhog^<span class="number">5</span>_EBKDGL@H! <span class="string">&quot;!|kc2k</span></span><br></pre></td></tr></table></figure>

<p>很明显这是一条完全错误的道路<br>注意到这个文件的DOS头超大<br>一般的PE文件Nt的偏移也就F0左右 这个PE达到了1150！<br>提取出来写入文件 IDA打开 没办法F5 硬怼汇编<br>还好IDA识别出了很多重要的特征</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">seg000:<span class="number">008</span>A                 <span class="keyword">public</span> start</span><br><span class="line">seg000:<span class="number">008</span>A start           proc near</span><br><span class="line">seg000:<span class="number">008</span>A                 cld</span><br><span class="line">seg000:<span class="number">008B</span>                 call    sub_102C7</span><br><span class="line">seg000:<span class="number">008</span>E                 mov     ax, <span class="number">13</span>h</span><br><span class="line">seg000:<span class="number">0091</span>                 <span class="type">int</span>     <span class="number">10</span>h             ; - VIDEO - SET VIDEO MODE</span><br><span class="line">seg000:<span class="number">0091</span>                                         ; AL = mode</span><br><span class="line">seg000:<span class="number">0093</span>                 call    sub_101FF</span><br><span class="line">seg000:<span class="number">0096</span>                 mov     ax, <span class="number">0</span>A000h</span><br><span class="line">seg000:<span class="number">0099</span>                 mov     es, ax</span><br><span class="line">seg000:<span class="number">009B</span>                 assume es:nothing</span><br><span class="line">seg000:<span class="number">009B</span></span><br><span class="line">seg000:<span class="number">009B</span> loc_1009B:                              ; CODE XREF: start+<span class="number">2</span>A↓j</span><br><span class="line">seg000:<span class="number">009B</span>                                         ; start+<span class="number">4</span>A↓j ...</span><br><span class="line">seg000:<span class="number">009B</span>                 call    sub_101C7</span><br><span class="line">seg000:<span class="number">009</span>E                 call    sub_101B5</span><br><span class="line">seg000:<span class="number">00</span>A1                 call    sub_1026A</span><br><span class="line">seg000:<span class="number">00</span>A4                 call    sub_1017A</span><br><span class="line">seg000:<span class="number">00</span>A7                 lea     di, ds:<span class="number">30</span>h</span><br><span class="line">seg000:<span class="number">00</span>AB                 mov     word ptr cs:[di], <span class="number">0</span></span><br><span class="line">seg000:<span class="number">00B</span>0                 mov     ah, <span class="number">1</span></span><br><span class="line">seg000:<span class="number">00B</span>2                 <span class="type">int</span>     <span class="number">16</span>h             ; KEYBOARD - CHECK BUFFER, DO NOT CLEAR</span><br><span class="line">seg000:<span class="number">00B</span>2                                         ; Return: ZF clear <span class="keyword">if</span> character in buffer</span><br><span class="line">seg000:<span class="number">00B</span>2                                         ; AH = scan code, AL = character</span><br><span class="line">seg000:<span class="number">00B</span>2                                         ; ZF set <span class="keyword">if</span> no character in buffer</span><br><span class="line">seg000:<span class="number">00B</span>4                 jz      <span class="type">short</span> loc_1009B</span><br><span class="line">seg000:<span class="number">00B</span>6                 mov     ah, <span class="number">0</span></span><br><span class="line">seg000:<span class="number">00B</span>8                 <span class="type">int</span>     <span class="number">16</span>h             ; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY</span><br><span class="line">seg000:<span class="number">00B</span>8                                         ; Return: AH = scan code, AL = character</span><br><span class="line">seg000:<span class="number">00B</span>A                 lea     di, ds:<span class="number">60</span>h</span><br><span class="line">seg000:<span class="number">00B</span>E                 cmp     al, <span class="number">1B</span>h</span><br><span class="line">seg000:<span class="number">00</span>C0                 jz      <span class="type">short</span> loc_10134</span><br><span class="line">seg000:<span class="number">00</span>C2                 cmp     al, <span class="number">0</span>Dh</span><br><span class="line">seg000:<span class="number">00</span>C4                 jz      <span class="type">short</span> loc_10107</span><br><span class="line">seg000:<span class="number">00</span>C6                 cmp     al, <span class="number">8</span></span><br><span class="line">seg000:<span class="number">00</span>C8                 jz      <span class="type">short</span> loc_100EE</span><br><span class="line">seg000:<span class="number">00</span>CA                 mov     bx, cs:word_10032</span><br><span class="line">seg000:<span class="number">00</span>CF                 cmp     bl, byte ptr cs:word_10088</span><br><span class="line">seg000:<span class="number">00</span>D4                 jnb     <span class="type">short</span> loc_1009B</span><br><span class="line">seg000:<span class="number">00</span>D6                 add     di, cs:word_10032</span><br><span class="line">seg000:<span class="number">00</span>DB                 mov     cs:[di], al</span><br><span class="line">seg000:<span class="number">00</span>DE                 inc     cs:word_10032</span><br><span class="line">seg000:<span class="number">00E3</span>                 lea     di, ds:<span class="number">30</span>h</span><br><span class="line">seg000:<span class="number">00E7</span>                 mov     word ptr cs:[di], <span class="number">2</span>Ah ; <span class="string">&#x27;*&#x27;</span></span><br><span class="line">seg000:<span class="number">00</span>EC                 jmp     <span class="type">short</span> loc_1009B</span><br><span class="line">seg000:<span class="number">00</span>EE ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:<span class="number">00</span>EE</span><br><span class="line">seg000:<span class="number">00</span>EE loc_100EE:                              ; CODE XREF: start+<span class="number">3</span>E↑j</span><br><span class="line">seg000:<span class="number">00</span>EE                 cmp     cs:word_10032, <span class="number">0</span></span><br><span class="line">seg000:<span class="number">00F</span>4                 jbe     <span class="type">short</span> loc_1009B</span><br><span class="line">seg000:<span class="number">00F</span>6                 dec     cs:word_10032</span><br><span class="line">seg000:<span class="number">00F</span>B                 add     di, cs:word_10032</span><br><span class="line">seg000:<span class="number">0100</span>                 mov     word ptr cs:[di], <span class="number">0</span></span><br><span class="line">seg000:<span class="number">0105</span>                 jmp     <span class="type">short</span> loc_1009B</span><br><span class="line">seg000:<span class="number">0107</span> ; ---------------------------------------------------------------------------</span><br><span class="line">seg000:<span class="number">0107</span></span><br><span class="line">seg000:<span class="number">0107</span> loc_10107:                              ; CODE XREF: start+<span class="number">3</span>A↑j</span><br><span class="line">seg000:<span class="number">0107</span>                 <span class="keyword">xor</span>     bx, bx</span><br><span class="line">seg000:<span class="number">0109</span>                 push    cs</span><br><span class="line">seg000:<span class="number">010</span>A                 pop     ds</span><br><span class="line">seg000:<span class="number">010B</span>                 assume ds:seg000</span><br><span class="line">seg000:<span class="number">010B</span>                 mov     si, <span class="number">60</span>h ; <span class="string">&#x27;`&#x27;</span></span><br><span class="line">seg000:<span class="number">010</span>E                 push    cs</span><br><span class="line">seg000:<span class="number">010F</span>                 pop     es</span><br><span class="line">seg000:<span class="number">0110</span>                 assume es:seg000</span><br><span class="line">seg000:<span class="number">0110</span>                 mov     cx, cs:word_10088</span><br><span class="line">seg000:<span class="number">0115</span></span><br><span class="line">seg000:<span class="number">0115</span> loc_10115:                              ; CODE XREF: start+A8↓j</span><br><span class="line">seg000:<span class="number">0115</span>                 mov     di, <span class="number">34</span>h ; <span class="string">&#x27;4&#x27;</span></span><br><span class="line">seg000:<span class="number">0118</span>                 push    cx</span><br><span class="line">seg000:<span class="number">0119</span>                 add     di, bx</span><br><span class="line">seg000:<span class="number">011B</span>                 mov     cx, cs:word_10088</span><br><span class="line">seg000:<span class="number">0120</span>                 sub     cx, bx</span><br><span class="line">seg000:<span class="number">0122</span></span><br><span class="line">seg000:<span class="number">0122</span> loc_10122:                              ; CODE XREF: start+A3↓j</span><br><span class="line">seg000:<span class="number">0122</span>                 mov     al, [si]</span><br><span class="line">seg000:<span class="number">0124</span>                 mov     ah, es:[di]</span><br><span class="line">seg000:<span class="number">0127</span>                 <span class="keyword">xor</span>     al, ah</span><br><span class="line">seg000:<span class="number">0129</span>                 mov     es:[di], al</span><br><span class="line">seg000:<span class="number">012</span>C                 inc     di</span><br><span class="line">seg000:<span class="number">012</span>D                 loop    loc_10122</span><br><span class="line">seg000:<span class="number">012F</span>                 pop     cx</span><br><span class="line">seg000:<span class="number">0130</span>                 inc     si</span><br><span class="line">seg000:<span class="number">0131</span>                 inc     bx</span><br><span class="line">seg000:<span class="number">0132</span>                 loop    loc_10115</span><br><span class="line">seg000:<span class="number">0134</span></span><br><span class="line">seg000:<span class="number">0134</span> loc_10134:                              ; CODE XREF: start+<span class="number">36</span>↑j</span><br><span class="line">seg000:<span class="number">0134</span>                 mov     ax, <span class="number">3</span></span><br><span class="line">seg000:<span class="number">0137</span>                 <span class="type">int</span>     <span class="number">10</span>h             ; - VIDEO - SET VIDEO MODE</span><br><span class="line">seg000:<span class="number">0137</span>                                         ; AL = mode</span><br><span class="line">seg000:<span class="number">0139</span>                 mov     dx, <span class="number">0</span></span><br><span class="line">seg000:<span class="number">013</span>C                 push    cs</span><br><span class="line">seg000:<span class="number">013</span>D                 pop     ds</span><br><span class="line">seg000:<span class="number">013</span>E                 mov     si, <span class="number">60</span>h ; <span class="string">&#x27;`&#x27;</span></span><br><span class="line">seg000:<span class="number">0141</span>                 mov     cx, cs:word_10088</span><br><span class="line">seg000:<span class="number">0146</span>                 <span class="keyword">xor</span>     bx, bx</span><br><span class="line">seg000:<span class="number">0148</span>                 <span class="keyword">xor</span>     ah, ah</span><br><span class="line">seg000:<span class="number">014</span>A</span><br><span class="line">seg000:<span class="number">014</span>A loc_1014A:                              ; CODE XREF: start+C3↓j</span><br><span class="line">seg000:<span class="number">014</span>A                 lodsb</span><br><span class="line">seg000:<span class="number">014B</span>                 add     bx, ax</span><br><span class="line">seg000:<span class="number">014</span>D                 loop    loc_1014A</span><br><span class="line">seg000:<span class="number">014F</span>                 cmp     bx, cs:word_1005E</span><br><span class="line">seg000:<span class="number">0154</span>                 jnz     <span class="type">short</span> loc_10171</span><br><span class="line">seg000:<span class="number">0156</span>                 mov     si, <span class="number">34</span>h ; <span class="string">&#x27;4&#x27;</span></span><br><span class="line">seg000:<span class="number">0159</span>                 mov     cx, cs:word_10088</span><br><span class="line">seg000:<span class="number">015</span>E                 <span class="keyword">xor</span>     bx, bx</span><br><span class="line">seg000:<span class="number">0160</span>                 <span class="keyword">xor</span>     ah, ah</span><br><span class="line">seg000:<span class="number">0162</span></span><br><span class="line">seg000:<span class="number">0162</span> loc_10162:                              ; CODE XREF: start+DB↓j</span><br><span class="line">seg000:<span class="number">0162</span>                 lodsb</span><br><span class="line">seg000:<span class="number">0163</span>                 add     bx, ax</span><br><span class="line">seg000:<span class="number">0165</span>                 loop    loc_10162</span><br><span class="line">seg000:<span class="number">0167</span>                 cmp     bx, cs:word_1005C</span><br><span class="line">seg000:<span class="number">016</span>C                 jnz     <span class="type">short</span> loc_10171</span><br><span class="line">seg000:<span class="number">016</span>E                 mov     dx, <span class="number">34</span>h ; <span class="string">&#x27;4&#x27;</span></span><br><span class="line">seg000:<span class="number">0171</span></span><br><span class="line">seg000:<span class="number">0171</span> loc_10171:                              ; CODE XREF: start+CA↑j</span><br><span class="line">seg000:<span class="number">0171</span>                                         ; start+E2↑j</span><br><span class="line">seg000:<span class="number">0171</span>                 mov     ah, <span class="number">9</span></span><br><span class="line">seg000:<span class="number">0173</span>                 <span class="type">int</span>     <span class="number">21</span>h             ; DOS - PRINT STRING</span><br><span class="line">seg000:<span class="number">0173</span>                                         ; DS:DX -&gt; string terminated by <span class="string">&quot;$&quot;</span></span><br><span class="line">seg000:<span class="number">0175</span>                 mov     ax, <span class="number">4</span>C00h</span><br><span class="line">seg000:<span class="number">0178</span>                 <span class="type">int</span>     <span class="number">21</span>h             ; DOS - <span class="number">2</span>+ - <span class="function">QUIT WITH EXIT <span class="title">CODE</span> <span class="params">(EXIT)</span></span></span><br><span class="line"><span class="function">seg000:<span class="number">0178</span> start           endp                    ;</span> AL = exit code</span><br></pre></td></tr></table></figure>

<p>注意到这里有两个check</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">seg000:<span class="number">014</span>A                 lodsb</span><br><span class="line">seg000:<span class="number">014B</span>                 add     bx, ax</span><br><span class="line">seg000:<span class="number">014</span>D                 loop    loc_1014A</span><br><span class="line">seg000:<span class="number">014F</span>                 cmp     bx, cs:word_1005E</span><br><span class="line">seg000:<span class="number">0154</span>                 jnz     <span class="type">short</span> loc_10171</span><br><span class="line">seg000:<span class="number">0156</span>                 mov     si, <span class="number">34</span>h ; <span class="string">&#x27;4&#x27;</span></span><br><span class="line">seg000:<span class="number">0159</span>                 mov     cx, cs:word_10088</span><br><span class="line">seg000:<span class="number">015</span>E                 <span class="keyword">xor</span>     bx, bx</span><br><span class="line">seg000:<span class="number">0160</span>                 <span class="keyword">xor</span>     ah, ah</span><br><span class="line">seg000:<span class="number">0162</span></span><br><span class="line">seg000:<span class="number">0162</span> loc_10162:                              ; CODE XREF: start+DB↓j</span><br><span class="line">seg000:<span class="number">0162</span>                 lodsb</span><br><span class="line">seg000:<span class="number">0163</span>                 add     bx, ax</span><br><span class="line">seg000:<span class="number">0165</span>                 loop    loc_10162</span><br><span class="line">seg000:<span class="number">0167</span>                 cmp     bx, cs:word_1005C</span><br><span class="line">seg000:<span class="number">016</span>C                 jnz     <span class="type">short</span> loc_10171</span><br><span class="line">seg000:<span class="number">016</span>E                 mov     dx, <span class="number">34</span>h ; <span class="string">&#x27;4&#x27;</span></span><br></pre></td></tr></table></figure>

<p>分别跟0D9F和0FD9做了cmp<br>每个cmp前面有一个超短的loop add 猜测是累加求和 类似sum()<br>然而其他部分的汇编看着真累。。。<br>大致能找到有一处xor<br>这里可以看出是一个二重循环xor</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">seg000:<span class="number">0115</span> loc_10115:                              ; CODE XREF: start+A8↓j</span><br><span class="line">seg000:<span class="number">0115</span>                 mov     di, <span class="number">34</span>h ; <span class="string">&#x27;4&#x27;</span></span><br><span class="line">seg000:<span class="number">0118</span>                 push    cx</span><br><span class="line">seg000:<span class="number">0119</span>                 add     di, bx</span><br><span class="line">seg000:<span class="number">011B</span>                 mov     cx, cs:word_10088</span><br><span class="line">seg000:<span class="number">0120</span>                 sub     cx, bx</span><br><span class="line">seg000:<span class="number">0122</span></span><br><span class="line">seg000:<span class="number">0122</span> loc_10122:                              ; CODE XREF: start+A3↓j</span><br><span class="line">seg000:<span class="number">0122</span>                 mov     al, [si]</span><br><span class="line">seg000:<span class="number">0124</span>                 mov     ah, es:[di]</span><br><span class="line">seg000:<span class="number">0127</span>                 <span class="keyword">xor</span>     al, ah</span><br><span class="line">seg000:<span class="number">0129</span>                 mov     es:[di], al</span><br><span class="line">seg000:<span class="number">012</span>C                 inc     di</span><br><span class="line">seg000:<span class="number">012</span>D                 loop    loc_10122</span><br><span class="line">seg000:<span class="number">012F</span>                 pop     cx</span><br><span class="line">seg000:<span class="number">0130</span>                 inc     si</span><br><span class="line">seg000:<span class="number">0131</span>                 inc     bx</span><br><span class="line">seg000:<span class="number">0132</span>                 loop    loc_10115</span><br></pre></td></tr></table></figure>

<p>通过word_10088的值0x27能知道循环是 0~39<br>还原大概这个样子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">output = [<span class="number">0x3E</span>, <span class="number">0x49</span>, <span class="number">0x26</span>, <span class="number">0x52</span>, <span class="number">0x45</span>, <span class="number">0x22</span>, <span class="number">0x42</span>, <span class="number">0x10</span>, <span class="number">0x66</span>, <span class="number">0x0B</span>, <span class="number">0x6C</span>, <span class="number">0x06</span>, <span class="number">0x0D</span>, <span class="number">0x50</span>, <span class="number">0x0F</span>, <span class="number">0x4C</span>, <span class="number">0x25</span>, <span class="number">0x4C</span>, <span class="number">0x3F</span>, <span class="number">0x12</span>, <span class="number">0x56</span>, <span class="number">0x03</span>, <span class="number">0x20</span>, <span class="number">0x5A</span>, <span class="number">0x14</span>, <span class="number">0x61</span>, <span class="number">0x4A</span>, <span class="number">0x3F</span>, <span class="number">0x5D</span>, <span class="number">0x51</span>, <span class="number">0x12</span>, <span class="number">0x5C</span>, <span class="number">0x18</span>, <span class="number">0x05</span>, <span class="number">0x43</span>, <span class="number">0x39</span>, <span class="number">0x4F</span>, <span class="number">0x32</span>, <span class="number">0x0A</span>] <span class="comment"># 34h</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">input</span>)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i,<span class="built_in">len</span>(<span class="built_in">input</span>)):</span><br><span class="line">        output[j] ^= <span class="built_in">input</span>[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">sum</span>(<span class="built_in">input</span>)==<span class="number">0xD9F</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">sum</span>(output)==<span class="number">0xFD9</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(output))</span><br></pre></td></tr></table></figure>

<p>只是现在不知道input和output<br>然而巧合的是<br>“This program cannot be run in DOS mode.”的sum值恰好等于0xd9f…<br>所以这就是input…<br>那么对应得到output<br><strong>justCTF{just_a_rusty_old_DOS_stub_task}</strong></p>
<hr>
<hr>
<p>这真不是能做的题 orz</p>
<h1 id="NewStarCTF2022"><a href="#NewStarCTF2022" class="headerlink" title="NewStarCTF2022"></a>NewStarCTF2022</h1><h2 id="WEEK4"><a href="#WEEK4" class="headerlink" title="WEEK4"></a>WEEK4</h2><h3 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h3><p>考察了一点点异常处理<br>在这里tea里面:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">32</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v9 -= <span class="number">0x61C88647</span>;</span><br><span class="line">      MEMORY[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">      v11 += (v7 + (v10 &gt;&gt; <span class="number">5</span>)) ^ (v9 + v10) ^ (v8 + <span class="number">16</span> * v10);</span><br><span class="line">      v10 += (v5 + (v11 &gt;&gt; <span class="number">5</span>)) ^ (v9 + v11) ^ (v6 + <span class="number">16</span> * v11);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>filter始终返回1 handler:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">006</span>A18C9 ;   __except(loc_6A18BC) <span class="comment">// owned by 6A18A4</span></span><br><span class="line">.text:<span class="number">006</span>A18C9                 mov     esp, [ebp+ms_exc.old_esp]</span><br><span class="line">.text:<span class="number">006</span>A18CC                 mov     eax, [ebp+var_48]</span><br><span class="line">.text:<span class="number">006</span>A18CF                 <span class="keyword">xor</span>     eax, <span class="number">12345678</span>h</span><br><span class="line">.text:<span class="number">006</span>A18D4                 mov     [ebp+var_48], eax</span><br><span class="line">.text:<span class="number">006</span>A18D7                 mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0F</span>FFFFFFEh</span><br></pre></td></tr></table></figure>

<p>对key值进行了xor处理 分奇偶逆就行了 注意我们实则是i:31-&gt;0的逆向 所以先+DELTA2(xor key了的)<br>flag:<br><strong>flag{44C3A7F112DA2BE728F451C5E2D09558}</strong></p>
<h3 id="HelpMe"><a href="#HelpMe" class="headerlink" title="HelpMe"></a>HelpMe</h3><p>挺好玩的题的<br>首先ps1写了个base64encode的zip 在线网站解后保存解压 得到加密xlsm文件的代码</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$timestamp</span> = ([<span class="built_in">DateTime</span><span class="type">Offset</span>](<span class="built_in">Get-Date</span> <span class="string">&quot;Sat Oct 01 2022 20:22:21&quot;</span>)).ToUnixTimeSeconds()</span><br><span class="line"><span class="variable">$key</span> = <span class="built_in">New-Object</span> Byte[] <span class="number">16</span></span><br><span class="line"><span class="built_in">Get-Random</span> <span class="literal">-Max</span> <span class="number">256</span> <span class="literal">-SetSeed</span> <span class="variable">$timestamp</span> &gt;<span class="variable">$null</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$index</span> = <span class="number">0</span>; <span class="variable">$index</span> <span class="operator">-lt</span> <span class="number">16</span>; <span class="variable">$index</span>++) &#123;<span class="variable">$key</span>[<span class="variable">$index</span>] = [<span class="built_in">byte</span>](<span class="built_in">Get-Random</span> <span class="literal">-Max</span> <span class="number">256</span>)&#125;</span><br><span class="line"><span class="variable">$AES</span> = <span class="built_in">New-Object</span> System.Security.Cryptography.AesManaged</span><br><span class="line"><span class="variable">$AES</span>.Key = <span class="variable">$key</span></span><br><span class="line"><span class="variable">$AES</span>.Mode = <span class="string">&quot;ECB&quot;</span></span><br><span class="line"><span class="variable">$AES</span>.Padding = [<span class="type">System.Security.Cryptography.PaddingMode</span>]::PKCS7</span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;<span class="variable">$mypath</span>\mygift.xlsm&quot;</span></span><br><span class="line"><span class="variable">$bytes</span> = [<span class="type">System.IO.File</span>]::ReadAllBytes(<span class="string">&quot;<span class="variable">$file</span>&quot;</span>)</span><br><span class="line"><span class="variable">$Encryptor</span> = <span class="variable">$AES</span>.CreateEncryptor()</span><br><span class="line"><span class="variable">$encdata</span> = <span class="variable">$Encryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$bytes</span>.Length)</span><br><span class="line"><span class="variable">$Encryptor</span>.Dispose()</span><br><span class="line"><span class="variable">$AES</span>.Dispose()</span><br><span class="line"><span class="built_in">Set-Content</span> <span class="literal">-Value</span> <span class="variable">$encdata</span> <span class="literal">-Encoding</span> Byte <span class="string">&quot;<span class="variable">$file</span>.enc&quot;</span></span><br></pre></td></tr></table></figure>

<p>稍作修改: En-&gt;De 运行即可解压获得xlsm<br>打开发现有宏代码<br>看<a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/02027811de95305bcc9ce5f3.html">这篇</a><br>打开开发者选项 选择Micxxx Visualxxx<br>就可以看到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">Sub <span class="title">hack</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    MsgBox &quot;You have to pay me a lot of money now!&quot;</span></span><br><span class="line"><span class="function">    Dim shell</span></span><br><span class="line"><span class="function">    Dim talk</span></span><br><span class="line"><span class="function">    Set talk </span>= <span class="built_in">CreateObject</span>(<span class="string">&quot;SAPI.SpVoice&quot;</span>)</span><br><span class="line">    talk.Rate = <span class="number">-3</span></span><br><span class="line">    talk.Volume = <span class="number">100</span></span><br><span class="line">    talk.Speak <span class="string">&quot;You have to pay me a lot of money now&quot;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    Dim a, b, x, arr</span><br><span class="line">    a = <span class="number">20</span></span><br><span class="line">    b = <span class="number">22</span></span><br><span class="line">    x = <span class="number">21</span></span><br><span class="line">    </span><br><span class="line">    arr = <span class="built_in">Array</span>(<span class="number">2</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">21</span>, <span class="number">14</span>, <span class="number">24</span>, <span class="number">18</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">23</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">26</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">27</span>, <span class="number">25</span>, <span class="number">3</span>, <span class="number">28</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">17</span>, <span class="number">4</span>)</span><br><span class="line">    </span><br><span class="line">    Dim i</span><br><span class="line">    </span><br><span class="line">    For i = <span class="number">1</span> To <span class="number">32</span></span><br><span class="line">    If <span class="built_in">Cells</span>(<span class="number">1</span>, i).Value = <span class="string">&quot;*&quot;</span> Then Exit For</span><br><span class="line">    <span class="built_in">Cells</span>(<span class="number">2</span>, <span class="built_in">arr</span>(i - <span class="number">1</span>) + <span class="number">1</span>).Value = <span class="built_in">Cells</span>(<span class="number">1</span>, i).Value Xor x</span><br><span class="line">    x = (a * x + b) Mod <span class="number">255</span></span><br><span class="line">    <span class="built_in">Cells</span>(<span class="number">1</span>, i).Value = <span class="string">&quot;*&quot;</span></span><br><span class="line">    Next</span><br><span class="line">    talk.Speak <span class="string">&quot;I have hacked you&quot;</span></span><br><span class="line">    Set sh = <span class="built_in">CreateObject</span>(<span class="string">&quot;Wscript.Shell&quot;</span>)</span><br><span class="line">    sh.<span class="built_in">Run</span> (<span class="string">&quot;%comspec% /k tree&quot;</span>), <span class="number">3</span>, True</span><br><span class="line">    ActiveWorkbook.Close</span><br><span class="line">    alertTime = Now + <span class="built_in">TimeValue</span>(<span class="string">&quot;00:00:30&quot;</span>)</span><br><span class="line">    Application.OnTime alertTime, <span class="string">&quot;hack&quot;</span></span><br><span class="line">    </span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>

<p>跟着解就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="string">&quot;62	163	115	241	149	89	216	45	20	138	220	8	75	42	135	93	161	60	115	215	169	66	32	132	141	21	184	95	159	3	121	91&quot;</span></span><br><span class="line">enc = enc.split(<span class="string">&quot;\t&quot;</span>)</span><br><span class="line">enc = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> enc]</span><br><span class="line">a = <span class="number">20</span></span><br><span class="line">b = <span class="number">22</span></span><br><span class="line">x = <span class="number">21</span></span><br><span class="line">pos = [<span class="number">2</span>, <span class="number">19</span>, <span class="number">16</span>, <span class="number">21</span>, <span class="number">14</span>, <span class="number">24</span>, <span class="number">18</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">23</span>, <span class="number">13</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">26</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">27</span>, <span class="number">25</span>, <span class="number">3</span>, <span class="number">28</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">17</span>, <span class="number">4</span>]</span><br><span class="line">flag = [<span class="number">0</span>]*<span class="number">33</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    flag[i] = x^enc[pos[i-<span class="number">1</span>]]</span><br><span class="line">    x = (a*x+b)%<span class="number">255</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(c),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>flag{This_is_@_begin_about@hack}</strong></p>
<h2 id="WEEK5"><a href="#WEEK5" class="headerlink" title="WEEK5"></a>WEEK5</h2><h3 id="Virtual-Self"><a href="#Virtual-Self" class="headerlink" title="Virtual Self"></a>Virtual Self</h3><p>傻逼题…<br>跟着vm打印435行字节码 逐个字符手扣…<br>部分手扣如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">flag[<span class="number">3</span>] = (<span class="built_in">chr</span>(((enc[<span class="number">3</span>]+<span class="number">2</span>)^<span class="number">20</span>)-<span class="number">2</span>))</span><br><span class="line">flag[<span class="number">10</span>] = (<span class="built_in">chr</span>((enc[<span class="number">10</span>]^<span class="number">97</span>^<span class="number">3</span>)))</span><br><span class="line">flag[<span class="number">17</span>] = <span class="built_in">chr</span>(((enc[<span class="number">17</span>]^<span class="number">3</span>)+<span class="number">2</span>)^<span class="number">1</span>)</span><br><span class="line">flag[<span class="number">22</span>] = <span class="built_in">chr</span>((((enc[<span class="number">22</span>]^<span class="number">230</span>)^<span class="number">1</span>)+<span class="number">252</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">5</span>] = <span class="built_in">chr</span>((((((((enc[<span class="number">5</span>]-<span class="number">1</span>)^<span class="number">1</span>^<span class="number">74</span>)-<span class="number">112</span>)+<span class="number">23</span>)+<span class="number">1</span>)^<span class="number">74</span>)+<span class="number">23</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">0</span>] = <span class="string">&#x27;f&#x27;</span></span><br><span class="line">flag[<span class="number">7</span>] = <span class="built_in">chr</span>(((enc[<span class="number">7</span>]+<span class="number">6</span>)^<span class="number">2</span>)+<span class="number">1</span>)</span><br><span class="line">flag[<span class="number">25</span>] = <span class="built_in">chr</span>((((enc[<span class="number">25</span>]+<span class="number">2</span>)^<span class="number">1</span>)-<span class="number">50</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">23</span>] = <span class="built_in">chr</span>(((enc[<span class="number">23</span>]^<span class="number">1</span>)+<span class="number">2</span>))</span><br><span class="line">flag[<span class="number">14</span>] = <span class="built_in">chr</span>((((((enc[<span class="number">14</span>]+(<span class="number">80</span>^<span class="number">249</span>))+<span class="number">252</span>-<span class="number">2</span>*<span class="number">228</span>)))&amp;<span class="number">0xff</span>))</span><br><span class="line">flag[<span class="number">19</span>] = <span class="built_in">chr</span>(enc[<span class="number">19</span>]-<span class="number">1</span>)</span><br><span class="line">flag[<span class="number">26</span>] = <span class="built_in">chr</span>(((((enc[<span class="number">26</span>]^<span class="number">3</span>)+<span class="number">30</span>)^<span class="number">2</span>^<span class="number">177</span>)-<span class="number">58</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">20</span>] = <span class="built_in">chr</span>((((((((enc[<span class="number">20</span>]-((<span class="number">8</span>^<span class="number">149</span>)-<span class="number">70</span>))^<span class="number">1</span>)-<span class="number">16</span>)^<span class="number">2</span>))))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">2</span>] = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">flag[<span class="number">18</span>] = <span class="built_in">chr</span>(((((((enc[<span class="number">18</span>]-<span class="number">5</span>)^<span class="number">1</span>^<span class="number">3</span>)))))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">4</span>] = <span class="string">&#x27;&#123;&#x27;</span></span><br><span class="line">flag[<span class="number">6</span>] = <span class="built_in">chr</span>(((((enc[<span class="number">6</span>]+<span class="number">3</span>)^<span class="number">3</span>)-<span class="number">2</span>)^<span class="number">3</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">11</span>] = <span class="built_in">chr</span>(((((((enc[<span class="number">11</span>]+<span class="number">174</span>)^(-<span class="number">58</span>))-<span class="number">1</span>))))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">21</span>] = <span class="built_in">chr</span>((((((((enc[<span class="number">21</span>]-<span class="number">3</span>)^<span class="number">2</span>)+<span class="number">3</span>+<span class="number">236</span>+<span class="number">236</span>)^<span class="number">3</span>))))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">9</span>] = <span class="built_in">chr</span>((((((((enc[<span class="number">9</span>]+<span class="number">2</span>)^<span class="number">2</span>)-<span class="number">23</span>)))))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">28</span>] = <span class="built_in">chr</span>(((((((enc[<span class="number">28</span>]^<span class="number">28</span>)-<span class="number">1</span>)^<span class="number">28</span>)-<span class="number">3</span>)))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">15</span>] = <span class="built_in">chr</span>((((((((((enc[<span class="number">15</span>]+(<span class="number">165</span>^<span class="number">177</span>)-<span class="number">53</span>)^<span class="number">3</span>)+<span class="number">2</span>)^<span class="number">3</span>))))))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">16</span>] = <span class="built_in">chr</span>(((((enc[<span class="number">16</span>]-<span class="number">2</span>)^<span class="number">227</span>)-<span class="number">2</span>))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">8</span>] = <span class="built_in">chr</span>((((((((enc[<span class="number">8</span>]-(<span class="number">106</span>^<span class="number">43</span>))^<span class="number">43</span>)-<span class="number">1</span>)^<span class="number">43</span>))))&amp;<span class="number">0xff</span>)</span><br><span class="line">flag[<span class="number">13</span>] = <span class="built_in">chr</span>((enc[<span class="number">13</span>]^<span class="number">2</span>^<span class="number">3</span>^<span class="number">1</span>)&amp;<span class="number">0xff</span>)</span><br></pre></td></tr></table></figure>

<p>然后就能猜出flag了<br><strong>flag{Will_you_see_the_light?}</strong></p>
<h1 id="BUUCTF-N1BOOK"><a href="#BUUCTF-N1BOOK" class="headerlink" title="BUUCTF&#x2F;N1BOOK"></a>BUUCTF&#x2F;N1BOOK</h1><p>里面有go和rust的题 记得一两个月前看毫无头绪 现在看好多了</p>
<h2 id="easy-rust"><a href="#easy-rust" class="headerlink" title="easy_rust"></a>easy_rust</h2><p>由于rust代码冗长 所以我们可以通过string搜索关键字符串 比如搜索flag<br>找到输入点 发现在一个base64encode里<br>再在函数列表搜索main 进入main<br>核心逻辑就这两句:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">BASE64ENCODE</span>((__int64)v14, (__int64)(&amp;v11.private_2 + <span class="number">1</span>));</span><br><span class="line"><span class="keyword">if</span> ( (_$LT$alloc..string..<span class="type">String</span>$u20$<span class="keyword">as</span>$u20$core..cmp..<span class="built_in">PartialEq</span>$GT$::eq::<span class="title function_ invoke__">h785456d93284be99</span>(v14, &amp;v11) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br></pre></td></tr></table></figure>

<p>这是base64和check<br>发现check的两个值都在base64encode的参数里<br>进入base64encode 可以发现这样一句</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">core::panicking::panic::<span class="title function_ invoke__">hb5daa85c7c72fc62</span>(</span><br><span class="line">        <span class="string">&quot;attempt to add with overflowxkPmey0LoJt4u5A9MznQhZEH6VSUvRX=Y13fi8srlaTdwGB2+q7cg/bKjpNCFIODInput your flag:\n&quot;</span></span><br><span class="line">        <span class="string">&quot;Ufy3UbIdXc82u0z=Sfk3=MlWFailed to read lineTrue!\n&quot;</span></span><br><span class="line">        <span class="string">&quot;False!\n&quot;</span>,</span><br><span class="line">        <span class="number">28</span>LL,</span><br><span class="line">        &amp;off_23FE58);</span><br></pre></td></tr></table></figure>

<p>结合语言特性 这种就是把函数用上的参数&#x2F;字符串 都写进去了<br>很容易猜出overflow后面的是base64变表 flag后面的是密文<br>变表base64解就行了</p>
<p><strong>n1book{9o0d_j0b}</strong></p>
<h2 id="easy-go"><a href="#easy-go" class="headerlink" title="easy_go"></a>easy_go</h2><p>函数列表搜索main 进入main_main<br>查找发现没有main_init 所以放心分析main_main即可<br>代码很短<br>check len and format:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( p_string-&gt;<span class="built_in">len</span> == <span class="number">21</span></span><br><span class="line">    &amp;&amp; (*(_DWORD *)ptr != <span class="number">1868706158</span> || *((_WORD *)ptr + <span class="number">2</span>) != <span class="number">27503</span> ? (v1 = <span class="number">0</span>) : (v1 = ptr[<span class="number">6</span>] == <span class="number">123</span>),</span><br><span class="line">        v1 &amp;&amp; ptr[<span class="number">20</span>] == <span class="number">125</span>) )</span><br></pre></td></tr></table></figure>

<p>Final_Check:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>LL; i &lt; <span class="number">13</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( i &gt;= v4 )</span><br><span class="line">        runtime_panicIndex();</span><br><span class="line">      <span class="keyword">if</span> ( byte_561538[i] + byte_561518[i] * *(_BYTE *)(i + v3) != byte_561528[i] )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>找到对应值 爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0xB7</span>, <span class="number">0x9C</span>, <span class="number">0x79</span>, <span class="number">0x43</span>, <span class="number">0x9B</span>, <span class="number">0xAF</span>, <span class="number">0x94</span>, <span class="number">0xE4</span>, <span class="number">0x94</span>, <span class="number">0x71</span>, <span class="number">0xEC</span>, <span class="number">0xEA</span>, <span class="number">0x8E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line">key1 = [<span class="number">0xD3</span>, <span class="number">0x75</span>, <span class="number">0x9B</span>, <span class="number">0xF9</span>, <span class="number">0xA3</span>, <span class="number">0x87</span>, <span class="number">0xED</span>, <span class="number">0x93</span>, <span class="number">0x8D</span>, <span class="number">0xDD</span>, <span class="number">0x77</span>, <span class="number">0xED</span>, <span class="number">0x67</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line">key2 = [<span class="number">0xDB</span>, <span class="number">0x9E</span>, <span class="number">0xB7</span>, <span class="number">0x9A</span>, <span class="number">0x91</span>, <span class="number">0xCA</span>, <span class="number">0xA1</span>, <span class="number">0x6B</span>, <span class="number">0x97</span>, <span class="number">0xC1</span>, <span class="number">0x74</span>, <span class="number">0xB3</span>, <span class="number">0x90</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line">flag = <span class="string">&quot;n1book&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        check = (key2[i]+key1[i]*x)&amp;<span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span> check==enc[i]:</span><br><span class="line">            flag += <span class="built_in">chr</span>(x)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">flag += <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><strong>n1book{4Ff1n3_C1pH3R}</strong></p>
<h2 id="easy-mfc"><a href="#easy-mfc" class="headerlink" title="easy_mfc"></a>easy_mfc</h2><p>前几天做Reversing.Kr时接触过mfc的概念(被干碎了)<br>这题打开还是不好找到逻辑<br>WinMain里面貌似没有进行check操作<br>还好函数很少 挨个翻<br>翻到有个check</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">v7[<span class="number">0</span>] = <span class="number">0x928C9DBC</span>;</span><br><span class="line">v7[<span class="number">1</span>] = <span class="number">0x21864740</span>;</span><br><span class="line">v7[<span class="number">2</span>] = <span class="number">0xFD8FACF5</span>;</span><br><span class="line">v3 = *(_DWORD *)(a2 - <span class="number">12</span>) == <span class="number">26</span>;              <span class="comment">// len=26</span></span><br><span class="line">v7[<span class="number">3</span>] = <span class="number">0x3AE9E468</span>;</span><br><span class="line">v7[<span class="number">4</span>] = <span class="number">0x64B366C0</span>;</span><br><span class="line">v7[<span class="number">5</span>] = <span class="number">0x22D3797E</span>;</span><br><span class="line">v8 = <span class="number">0xF831</span>;</span><br><span class="line">v5[<span class="number">0</span>] = <span class="number">0xFDEEACD2</span>;</span><br><span class="line">v5[<span class="number">1</span>] = <span class="number">0x79FD2C2F</span>;</span><br><span class="line">v5[<span class="number">2</span>] = <span class="number">0x85D0DEC5</span>;</span><br><span class="line">v5[<span class="number">3</span>] = <span class="number">0xBB6B658</span>;</span><br><span class="line">v5[<span class="number">4</span>] = <span class="number">0x54C039F5</span>;</span><br><span class="line">v5[<span class="number">5</span>] = <span class="number">0x54E21F21</span>;</span><br><span class="line">v6 = <span class="number">0x8502</span>;</span><br><span class="line"><span class="keyword">if</span> ( v3 )</span><br><span class="line">&#123;</span><br><span class="line">  v4 = <span class="number">0</span>;                                     <span class="comment">// CHECK！</span></span><br><span class="line">  <span class="keyword">while</span> ( (*((<span class="type">unsigned</span> __int8 *)v7 + v4) ^ (<span class="type">unsigned</span> __int16)ATL::CSimpleStringT&lt;<span class="type">wchar_t</span>,<span class="number">1</span>&gt;::<span class="built_in">GetAt</span>(&amp;a2, v4)) == *((<span class="type">unsigned</span> __int8 *)v5 + v4) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ++v4 &gt;= *(_DWORD *)(a2 - <span class="number">12</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      CWnd::<span class="built_in">SetDlgItemTextW</span>(<span class="keyword">this</span>, <span class="number">-1</span>, <span class="string">L&quot;OK&quot;</span>);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">CWnd::<span class="built_in">SetDlgItemTextW</span>(<span class="keyword">this</span>, <span class="number">-1</span>, <span class="string">L&quot;Error&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这里提取出两个数组 xor回去即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enc1 = <span class="string">&quot;BC9D8C9240478621F5AC8FFD68E4E93AC066B3647E79D32231F8&quot;</span></span><br><span class="line">enc2 = <span class="string">&quot;D2ACEEFD2F2CFD79C5DED08558B6B60BF539C054211FE2540285&quot;</span></span><br><span class="line">enc1 = [<span class="built_in">int</span>(enc1[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>],<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc1)//<span class="number">2</span>)]</span><br><span class="line">enc2 = [<span class="built_in">int</span>(enc2[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>],<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc2)//<span class="number">2</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc1)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(enc1[i]^enc2[i]),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>n1book{X0r_x0R_15_s0_f1v3}</strong></p>
<hr>
<hr>
<p>立个flag 过段时间抽空认真学学mfc编程 先了解开发原理再逆向</p>
<p>这个系列还剩一道python 貌似不能直接反编译.pyc 应该是要查看字节码 过段时间再来看吧</p>
<h1 id="NPUCTF2020"><a href="#NPUCTF2020" class="headerlink" title="NPUCTF2020"></a>NPUCTF2020</h1><h2 id="BasicASM"><a href="#BasicASM" class="headerlink" title="BasicASM"></a>BasicASM</h2><p>给的一个asm文件 IDA啥也看不了 用winhex查看</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00007F</span>F7A8AC5A50  push        rbp  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A52  push        rdi  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A53  sub         rsp,<span class="number">238</span>h  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A5A  lea         rbp,[rsp+<span class="number">20</span>h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A5F  mov         rdi,rsp  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A62  mov         ecx,<span class="number">8</span>Eh  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A67  mov         eax,<span class="number">0</span>CCCCCCCCh  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A6C  rep stos    dword ptr [rdi]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A6E  mov         rax,qword ptr [__security_cookie (<span class="number">07F</span>F7A8AD3018h)]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A75  <span class="keyword">xor</span>         rax,rbp  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A78  mov         qword ptr [rbp+<span class="number">208</span>h],rax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A7F  lea         rcx,[__06A15900_ConsoleApplication@<span class="built_in">cpp</span> (<span class="number">07F</span>F7A8AD902Ah)]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A86  call        __CheckForDebuggerJustMyCode (<span class="number">07F</span>F7A8AC1122h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A8B  lea         rdx,[string <span class="string">&quot;flag&#123;this_is_a_fake_flag&#125;&quot;</span> (<span class="number">07F</span>F7A8ACF450h)]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A92  lea         rcx,[flag]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A96  call        std::basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt;::basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt; (<span class="number">07F</span>F7A8AC15E1h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A9B  nop  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5A9C  mov         dword ptr [p],<span class="number">0</span>  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AA3  mov         dword ptr [rbp+<span class="number">64</span>h],<span class="number">0</span>  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AAA  jmp         main+<span class="number">64</span>h (<span class="number">07F</span>F7A8AC5AB4h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AAC  mov         eax,dword ptr [rbp+<span class="number">64</span>h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AAF  inc         eax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AB1  mov         dword ptr [rbp+<span class="number">64</span>h],eax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AB4  movsxd      rax,dword ptr [rbp+<span class="number">64</span>h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AB8  mov         qword ptr [rbp+<span class="number">1F</span>8h],rax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5ABF  lea         rcx,[flag]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AC3  call        std::basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt;::<span class="built_in">length</span> (<span class="number">07F</span>F7A8AC122Bh)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AC8  mov         rcx,qword ptr [rbp+<span class="number">1F</span>8h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5ACF  cmp         rcx,rax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AD2  jae         main+<span class="number">1B</span>2h (<span class="number">07F</span>F7A8AC5C02h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AD8  mov         eax,dword ptr [rbp+<span class="number">64</span>h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5ADB  <span class="keyword">and</span>         eax,<span class="number">1</span>  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5ADE  cmp         eax,<span class="number">1</span>  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AE1  jne         main+<span class="number">126</span>h (<span class="number">07F</span>F7A8AC5B76h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AE7  movsxd      rax,dword ptr [rbp+<span class="number">64</span>h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AEB  mov         rdx,rax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AEE  lea         rcx,[flag]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AF2  call        std::basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt;::<span class="keyword">operator</span>[] (<span class="number">07F</span>F7A8AC1442h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AF7  movsx       eax,byte ptr [rax]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AFA  <span class="keyword">xor</span>         eax,<span class="number">42</span>h  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AFD  mov         dword ptr [p],eax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5B00  mov         dl,<span class="number">30</span>h  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5B02  lea         rcx,[rbp+<span class="number">144</span>h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5B09  call        std::<span class="built_in">setfill</span>&lt;<span class="type">char</span>&gt; (<span class="number">07F</span>F7A8AC1046h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5B0E  mov         qword ptr [rbp+<span class="number">1F</span>8h],rax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5B15  mov         edx,<span class="number">2</span>  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5B1A  lea         rcx,[rbp+<span class="number">168</span>h]  </span><br><span class="line"><span class="number">00007F</span><span class="function">F7A8AC5B21  call        <span class="title">std::setw</span> <span class="params">(<span class="number">07F</span>F7A8AC10D2h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B26  mov         qword ptr [rbp+200h],rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B2D  lea         rdx,[<span class="title">std::hex</span> <span class="params">(<span class="number">07F</span>F7A8AC1488h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B34  mov         rcx,qword ptr [<span class="title">__imp_std::cout</span> <span class="params">(<span class="number">07F</span>F7A8AD71C0h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B3B  call        qword ptr [__imp_std::basic_ostream&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt; &gt;::<span class="keyword">operator</span>&lt;&lt; <span class="params">(<span class="number">07F</span>F7A8AD7160h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B41  mov         rcx,qword ptr [rbp+200h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B48  mov         rdx,rcx  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B4B  mov         rcx,rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B4E  call        std::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,__int64&gt; <span class="params">(<span class="number">07F</span>F7A8AC12F8h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B53  mov         rcx,qword ptr [rbp+1F8h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B5A  mov         rdx,rcx  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B5D  mov         rcx,rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B60  call        std::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,<span class="type">char</span>&gt; <span class="params">(<span class="number">07F</span>F7A8AC11A4h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B65  mov         edx,dword ptr [p]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B68  mov         rcx,rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B6B  call        qword ptr [__imp_std::basic_ostream&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt; &gt;::<span class="keyword">operator</span>&lt;&lt; <span class="params">(<span class="number">07F</span>F7A8AD7158h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B71  jmp         main+1<span class="title">ADh</span> <span class="params">(<span class="number">07F</span>F7A8AC5BFDh)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B76  movsxd      rax,dword ptr [rbp+64h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B7A  mov         rdx,rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B7D  lea         rcx,[flag]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B81  call        std::basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt;::<span class="keyword">operator</span>[] <span class="params">(<span class="number">07F</span>F7A8AC1442h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B86  movsx       eax,byte ptr [rax]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B89  mov         dword ptr [p],eax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B8C  mov         dl,30h  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B8E  lea         rcx,[rbp+194h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B95  call        std::setfill&lt;<span class="type">char</span>&gt; <span class="params">(<span class="number">07F</span>F7A8AC1046h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5B9A  mov         qword ptr [rbp+1F8h],rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BA1  mov         edx,2  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BA6  lea         rcx,[rbp+1B8h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BAD  call        <span class="title">std::setw</span> <span class="params">(<span class="number">07F</span>F7A8AC10D2h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BB2  mov         qword ptr [rbp+200h],rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BB9  lea         rdx,[<span class="title">std::hex</span> <span class="params">(<span class="number">07F</span>F7A8AC1488h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BC0  mov         rcx,qword ptr [<span class="title">__imp_std::cout</span> <span class="params">(<span class="number">07F</span>F7A8AD71C0h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BC7  call        qword ptr [__imp_std::basic_ostream&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt; &gt;::<span class="keyword">operator</span>&lt;&lt; <span class="params">(<span class="number">07F</span>F7A8AD7160h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BCD  mov         rcx,qword ptr [rbp+200h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BD4  mov         rdx,rcx  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BD7  mov         rcx,rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BDA  call        std::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,__int64&gt; <span class="params">(<span class="number">07F</span>F7A8AC12F8h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BDF  mov         rcx,qword ptr [rbp+1F8h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BE6  mov         rdx,rcx  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BE9  mov         rcx,rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BEC  call        std::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,<span class="type">char</span>&gt; <span class="params">(<span class="number">07F</span>F7A8AC11A4h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BF1  mov         edx,dword ptr [p]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BF4  mov         rcx,rax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BF7  call        qword ptr [__imp_std::basic_ostream&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt; &gt;::<span class="keyword">operator</span>&lt;&lt; <span class="params">(<span class="number">07F</span>F7A8AD7158h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5BFD  jmp         main+5<span class="title">Ch</span> <span class="params">(<span class="number">07F</span>F7A8AC5AACh)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C02  mov         dword ptr [rbp+1E4h],0  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C0C  lea         rcx,[flag]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C10  call        std::basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt;::~basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt; <span class="params">(<span class="number">07F</span>F7A8AC1302h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C15  mov         eax,dword ptr [rbp+1E4h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C1B  mov         edi,eax  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C1D  lea         rcx,[rbp-20h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C21  lea         rdx,[__xt_z+540<span class="title">h</span> <span class="params">(<span class="number">07F</span>F7A8ACEFE0h)</span>]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C28  call        _<span class="title">RTC_CheckStackVars</span> <span class="params">(<span class="number">07F</span>F7A8AC1596h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C2D  mov         eax,edi  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C2F  mov         rcx,qword ptr [rbp+208h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C36  <span class="keyword">xor</span>         rcx,rbp  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C39  call        __<span class="title">security_check_cookie</span> <span class="params">(<span class="number">07F</span>F7A8AC1190h)</span>  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C3E  lea         rsp,[rbp+218h]  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C45  pop         rdi  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C46  pop         rbp  </span></span><br><span class="line"><span class="function">00007FF7A8AC5C47  ret  </span></span><br></pre></td></tr></table></figure>

<p>逻辑不难 能找到关键点 xor 42h<br>同时题目也给了output</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">662e61257b26301d7972751d6b2c6f355f3a38742d74341d61776d7d7d</span><br></pre></td></tr></table></figure>

<p>然而直接解发现得到无意义字符串<br>再仔细看汇编 发现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00007F</span>F7A8AC5AC3  call        std::basic_string&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt; &gt;::<span class="built_in">length</span> (<span class="number">07F</span>F7A8AC122Bh)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AC8  mov         rcx,qword ptr [rbp+<span class="number">1F</span>8h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5ACF  cmp         rcx,rax  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AD2  jae         main+<span class="number">1B</span>2h (<span class="number">07F</span>F7A8AC5C02h)  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AD8  mov         eax,dword ptr [rbp+<span class="number">64</span>h]  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5ADB  <span class="keyword">and</span>         eax,<span class="number">1</span>  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5ADE  cmp         eax,<span class="number">1</span>  </span><br><span class="line"><span class="number">00007F</span>F7A8AC5AE1  jne         main+<span class="number">126</span>h (<span class="number">07F</span>F7A8AC5B76h)  </span><br></pre></td></tr></table></figure>

<p>这段有个 eax&amp;1&#x3D;&#x3D;1的判断 并有条件跳转<br>结合上下知道这里是对循环次数进行了奇偶check<br>所以奇数时才xor 0x42 (jne)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="string">&quot;662e61257b26301d7972751d6b2c6f355f3a38742d74341d61776d7d7d&quot;</span></span><br><span class="line">enc = [<span class="built_in">int</span>(enc[i*<span class="number">2</span>:i*<span class="number">2</span>+<span class="number">2</span>],<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)//<span class="number">2</span>)]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x42</span>,<span class="number">0x42</span>+<span class="number">1</span>):</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">        <span class="keyword">if</span>(i&amp;<span class="number">1</span>):</span><br><span class="line">            flag += <span class="built_in">chr</span>((x^c)&amp;<span class="number">0xff</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag += <span class="built_in">chr</span>(c)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><strong>flag{d0_y0u_know_x86-64_a5m?}</strong></p>
<h2 id="Baby-Obfuscation"><a href="#Baby-Obfuscation" class="headerlink" title="Baby Obfuscation"></a>Baby Obfuscation</h2><p>花里胡哨…</p>
<p>对main进行计算 还原流程</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  _main(argc, argv, envp);</span><br><span class="line">  <span class="built_in">memset</span>(v30, <span class="number">0</span>, <span class="number">4004</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v28, <span class="number">0</span>, <span class="number">260</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">64</span>; ++i )</span><br><span class="line">    v28[i] = i + <span class="number">1</span>;</span><br><span class="line">  v31[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  v31[<span class="number">1</span>] = <span class="number">3</span>;</span><br><span class="line">  v31[<span class="number">2</span>] = <span class="number">4</span>;</span><br><span class="line">  v31[<span class="number">3</span>] = <span class="number">5</span>;</span><br><span class="line">  v30[<span class="number">1004</span>] = <span class="number">2</span>;</span><br><span class="line">  v30[<span class="number">1005</span>] = <span class="number">3</span>;</span><br><span class="line">  v30[<span class="number">1006</span>] = <span class="number">4</span>;</span><br><span class="line">  v30[<span class="number">1007</span>] = <span class="number">5</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;WHERE IS MY KEY!?&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%32s&quot;</span>, INPUT);</span><br><span class="line">  v32 = <span class="built_in">strlen</span>(INPUT);</span><br><span class="line">  v3 = <span class="built_in">GCD</span>(v28[j], v28[j]);</span><br><span class="line">  <span class="keyword">for</span> ( j = v3 / v28[j]; j &lt;= v32; ++j )        <span class="comment">// j=1~v32</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = (v28[j] + v28[j + <span class="number">1</span>]) * (v28[j] + v28[j + <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt;= (<span class="type">int</span>)(<span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">2</span>) * v28[j] * v28[j + <span class="number">1</span>]) )<span class="comment">// 永真</span></span><br><span class="line">    &#123;</span><br><span class="line">      v5 = ~INPUT[(<span class="type">int</span>)<span class="built_in">SUB_XX</span>(j, <span class="number">1</span>)];</span><br><span class="line">      v6 = <span class="built_in">SUB_XX</span>(j, <span class="number">1</span>);</span><br><span class="line">      v30[j] = ~(v5 + v31[v6 % (<span class="type">int</span>)<span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">2</span>)]);</span><br><span class="line">    &#125;</span><br><span class="line">    v7 = <span class="built_in">GCD</span>(v28[j], v28[j + <span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> ( v7 &gt; (<span class="type">int</span>)<span class="built_in">GCD</span>(v28[j + <span class="number">1</span>], ~(~v28[j + <span class="number">1</span>] + v28[j])) )<span class="comment">// 1&gt;1 永假</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = v30[j];</span><br><span class="line">      v9 = <span class="built_in">SUB_XX</span>(j, <span class="number">1</span>);</span><br><span class="line">      v30[j] = ~(~v8 + v28[v9 % (<span class="type">int</span>)<span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">2</span>)]) * v8;</span><br><span class="line">    &#125;</span><br><span class="line">    v10 = v28[j + <span class="number">1</span>];</span><br><span class="line">    v11 = <span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">1</span>) * v10;</span><br><span class="line">    v12 = v28[j];</span><br><span class="line">    v13 = <span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    v14 = <span class="built_in">GCD</span>(v12 * v13, v11);                  <span class="comment">// v14=2</span></span><br><span class="line">    v15 = <span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v14 == v15 * (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">GCD</span>(v28[j], v28[j + <span class="number">1</span>]) )<span class="comment">// v14==v15 永真</span></span><br><span class="line">    &#123;</span><br><span class="line">      v16 = <span class="built_in">SUB_XX</span>(j, <span class="number">1</span>);</span><br><span class="line">      v30[j] ^= v31[v16 % (<span class="type">int</span>)<span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">2</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    v17 = <span class="built_in">QPOW</span>(n_3, v28[j]);                    </span><br><span class="line">    v18 = v17 &lt; v28[j] + <span class="number">1</span>;                     <span class="comment">// v18=0</span></span><br><span class="line">    v19 = <span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">F0X3</span>(v19 &gt;= j, v18) ) <span class="comment">// v19&gt;=j : 1  F3(1,0) 最后0</span></span><br><span class="line">    &#123;</span><br><span class="line">      v20 = ~INPUT[(<span class="type">int</span>)<span class="built_in">SUB_XX</span>(j, <span class="number">1</span>)];</span><br><span class="line">      v21 = <span class="built_in">SUB_XX</span>(j, <span class="number">1</span>);</span><br><span class="line">      v30[j] ^= ~(v20 + v31[v21 % (<span class="type">int</span>)<span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">2</span>)]);</span><br><span class="line">    &#125;</span><br><span class="line">    v22 = <span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    v23 = <span class="built_in">GCD</span>(v28[j], v28[j]);</span><br><span class="line">    v30[j] *= v22 + (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">QPOW</span>(<span class="number">2</span>, v23 / v28[j]);<span class="comment">// v30[j]*=10</span></span><br><span class="line">  &#125;</span><br><span class="line">  v24 = <span class="built_in">QPOW</span>(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">SUB_XX</span>(v24, <span class="number">1</span>) != v32 )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">  v25 = <span class="built_in">GCD</span>(v28[k], v28[k]);</span><br><span class="line">  <span class="keyword">for</span> ( k = v25 / v28[k]; k &lt;= v32; ++k )       <span class="comment">// k=1~v32</span></span><br><span class="line">  &#123;</span><br><span class="line">    v26 = v30[k];</span><br><span class="line">    <span class="keyword">if</span> ( v26 == (<span class="type">int</span>)<span class="built_in">SUB_XX</span>(A0X6[k], <span class="number">1</span>) / <span class="number">10</span> )</span><br><span class="line">      ++V0X2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( V0X2 == v32 )                            <span class="comment">// len=15 16</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nPASS&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">LABEL_23:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nDENIED&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后注意一个点 长度应该为15 因为他j从1开始的 所以后面提取的enc也要从1索引开始<br>逆回去即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">780</span>,<span class="number">780</span>,<span class="number">850</span>,<span class="number">590</span>,<span class="number">800</span>,<span class="number">640</span>,<span class="number">1150</span>,<span class="number">460</span>,<span class="number">980</span>,<span class="number">960</span>,<span class="number">1170</span>,<span class="number">530</span>,<span class="number">970</span>,<span class="number">1080</span>,<span class="number">1250</span>]</span><br><span class="line">enc = [x//<span class="number">10</span> <span class="keyword">for</span> x <span class="keyword">in</span> enc]</span><br><span class="line">key = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    x = enc[j]</span><br><span class="line">    x ^= key[j%<span class="number">4</span>]</span><br><span class="line">    x = (~x)&amp;<span class="number">0xff</span></span><br><span class="line">    x -= key[j%<span class="number">4</span>]</span><br><span class="line">    x &amp;= <span class="number">0xff</span></span><br><span class="line">    x = (~x)&amp;<span class="number">0xff</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(x),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># pass</span></span><br></pre></td></tr></table></figure>

<p><strong>NPUCTF{0bfu5er}</strong></p>
<h2 id="芜湖🛫"><a href="#芜湖🛫" class="headerlink" title="芜湖🛫"></a>芜湖🛫</h2><p>真服了…<br>没有任何输入运行会得到一首歌词…<br>程序中可以找到base64的表 也能看出对一些进行了base64decode 进而得到这一串中文<br>实在想不到是base64隐写<br>好吧 知道这点后想办法把base64decode前的base64串提取出来<br>程序关键代码:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">34</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; A1[i]; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = A2[<span class="number">42</span> * i + j];</span><br><span class="line">      v2 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">7</span>; ++k )</span><br><span class="line">        v2 = F1((v3 &gt;&gt; (<span class="number">7</span> - k)) &amp; <span class="number">1</span>, (<span class="number">97</span> &gt;&gt; (<span class="number">7</span> - k)) &amp; <span class="number">1</span>) ^ (<span class="number">2</span> * v2);</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=((__int64)&amp;A3 + <span class="number">32</span> * i, v2);</span><br><span class="line">    &#125;</span><br><span class="line">    F2((__int64)v7, (__int64)&amp;A3 + <span class="number">32</span> * i);</span><br><span class="line">    v0 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="type">char</span>&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, v7);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v0, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v7);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>就在这句:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">F2</span>((__int64)v7, (__int64)&amp;A3 + <span class="number">32</span> * i);</span><br></pre></td></tr></table></figure>
<p>下断点 可以看到A3的地址 我的大概在 5583D5E4DFH左右<br>这地址在堆上 IDA内存中翻翻 找到<br><img src="https://s2.loli.net/2024/01/04/5DfGocJ3RINlFEs.png" alt="img"></p>
<p>我只能说nb<br>得到 55y85YmN6YeN5aSN55qE6aOO5pmvLG&#x3D;&#x3D;<br>类似的可以手动把所有的收集完<br>最后得到:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;55y85YmN6YeN5aSN55qE6aOO5pmvLG==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5riQ5riQ5qih57OK5LqG57qm5a6aLO==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5pif56m65LiL5rWB5rWq55qE5L2gLH==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5LuN54S256eY5a+G55qE6Led56a7LA==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5rip5bqm5raI5aSx55qE556s6Ze0LH==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5peg5rOV6Kem5pG455qE5piO5aSpLF==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5rKh5pyJ5byV5Yqb55qE5LiW55WMLG==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5rKh5pyJ6ISa5Y2w55qE5YWJ5bm0LD==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6L+Y5Zyo562J552A5L2g5Ye6546wLH==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5pel5pel5aSc5aSc6Ieq6L2s55qE6KGM5pifLE==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5Yiw5aSE6YGu5ruh5Yir5Lq655qE6IOM5b2xLG==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6K6p6aOO5ZC55pWj5re35Lmx55qE5ZG85ZC4LG==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5b+r5b+r5riF6YaSfn==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6Z2Z6Z2Z54Wn5Lqu5Y6f5p2l55qE6Ieq5bexLL==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5aSp56m65rSS5ruh5b+954S255qE5YWJ5piOLE==&quot;</span>,</span><br><span class="line"><span class="string">&quot;55y85Lit5Y+q6KaB57ua54OC55qE5aSp6ZmFLG==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5YaN6aOe6KGMIW==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5oiR5YuH5pWi5Zyw5oqs6LW35aS0LM==&quot;</span>,</span><br><span class="line"><span class="string">&quot;55yL552A6Iyr6Iyr55qE5a6H5a6ZLH==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5aSa5bCR5pyq55+l55qE5pif55CDLJ==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5pyJ5rKh5pyJ6YCa5ZCR5pyq5p2l6Lev5Y+jLD==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5Lqy54ix55qE5LyZ5Ly0LB==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6K6p5oiR5Lus5LiA6LW354K554eDLG==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5YuH5rCU5ZKM5L+h5b+1LO==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5Zyo6YGl6L+c55qE5aSp6L65LG==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6ZO25rKz6L6557yYLH==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5pyJ5LiA54mH56We5aWH55qE5b2p6Jm55rW3LC==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5ZKM5oiR5LiA6LW35YaS6ZmpLB==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6aOe5ZCR5Y+m5LiA5Liq5LiW55WMLC==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5Zyo6YGl6L+c55qE5aSp6L65LB==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6ZO25rKz6L6557yYLC==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5pyJ5LiA54mH56We5aWH55qE5b2p6Jm55rW3LB==&quot;</span>,</span><br><span class="line"><span class="string">&quot;5ZKM5oiR5LiA6LW35YaS6ZmpLH==&quot;</span>,</span><br><span class="line"><span class="string">&quot;6aOe5ZCR5Y+m5LiA5Liq5LiW55WMLN==&quot;</span>,</span><br><span class="line"><span class="string">&quot;c3VwZXIgbWFnaWMgd29ybGR+fg==&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后直接上MISC base64隐写脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">path = <span class="string">r&#x27;base.txt&#x27;</span></span><br><span class="line">file = <span class="built_in">open</span>(path)</span><br><span class="line">a = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">aaa = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    text = file.readline()  <span class="comment"># 只读取一行内容</span></span><br><span class="line">    <span class="comment"># 判断是否读取到内容</span></span><br><span class="line">    text = text.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    text = text.replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    text = text.replace(<span class="string">&#x27;,&#x27;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> text:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> text.count(<span class="string">&#x27;=&#x27;</span>) == <span class="number">1</span>:</span><br><span class="line">        aaa = aaa + \</span><br><span class="line">            <span class="built_in">str</span>(<span class="string">&#x27;&#123;:02b&#125;&#x27;</span>.<span class="built_in">format</span>((a.find(text[<span class="built_in">len</span>(text)-<span class="number">2</span>])) % <span class="number">4</span>))</span><br><span class="line">    <span class="keyword">if</span> text.count(<span class="string">&#x27;=&#x27;</span>) == <span class="number">2</span>:</span><br><span class="line">        aaa = aaa + \</span><br><span class="line">            <span class="built_in">str</span>(<span class="string">&#x27;&#123;:04b&#125;&#x27;</span>.<span class="built_in">format</span>((a.find(text[<span class="built_in">len</span>(text)-<span class="number">3</span>])) % <span class="number">16</span>))</span><br><span class="line">file.close()</span><br><span class="line">t = <span class="string">&quot;&quot;</span></span><br><span class="line">ttt = <span class="built_in">len</span>(aaa)</span><br><span class="line">ttt = ttt//<span class="number">8</span>*<span class="number">8</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,ttt,<span class="number">8</span>):</span><br><span class="line">    t = t + <span class="built_in">chr</span>(<span class="built_in">int</span>( aaa[i:i+<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"><span class="comment"># npuctf&#123;Fly1ng!!!&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>npuctf{Fly1ng!!!}</strong></p>
<hr>
<hr>
<p>reverse里面混misc是真难绷…<br>这题唯一作用就是练习了在堆上找数据…</p>
<h1 id="安洵杯2019"><a href="#安洵杯2019" class="headerlink" title="安洵杯2019"></a>安洵杯2019</h1><h2 id="crackMe"><a href="#crackMe" class="headerlink" title="crackMe"></a>crackMe</h2><p>挺好的题<br>考点: 异常处理+base64变表(看作2次变表)+SM4算法</p>
<p>main:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl __noreturn <span class="title">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE v3[<span class="number">6</span>]; <span class="comment">// [esp-4h] [ebp-D0h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;please Input the flag:\n&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf_s</span>(<span class="string">&quot;%s&quot;</span>, &amp;INPUT);</span><br><span class="line">  <span class="built_in">MessageBoxW</span>(<span class="number">0</span>, <span class="string">L&quot;Exception&quot;</span>, <span class="string">L&quot;Warning&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  *(_DWORD *)v3 = sub_50100F;</span><br><span class="line">  MEMORY[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">j_FINAL_CHECK</span>(*(<span class="type">int</span> *)&amp;v3[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里很容易想到触发异常 进行ExceptionFilter和处理<br>但是直接找找不着</p>
<p>注意到运行exe会弹出 hook 弹窗 提示我们可能进行了hook操作<br>动调or瞎翻&#x2F;查看交叉引用<br>找到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __stdcall <span class="title">CHANGE_BASE64_TABLE_AND_ADD_EXCEPTION_HANDLER</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3, <span class="type">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// [esp+D8h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">j_strlen</span>(BASE64_table_41A080); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( BASE64_table_41A080[i] &lt;= <span class="number">122</span> &amp;&amp; BASE64_table_41A080[i] &gt;= <span class="number">97</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      BASE64_table_41A080[i] -= <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( BASE64_table_41A080[i] &lt;= <span class="number">90</span> &amp;&amp; BASE64_table_41A080[i] &gt;= <span class="number">65</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      BASE64_table_41A080[i] += <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">MessageBoxA</span>(<span class="number">0</span>, <span class="string">&quot;hooked&quot;</span>, <span class="string">&quot;successed&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">AddVectoredExceptionHandler</span>(<span class="number">0</span>, Handler);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里对base64的table进行了大小写互换 同时出现了hook字样<br>后面跟了个ExceptionHandler<br>这样我们前面的分析就能说得通了<br>查看handler</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __stdcall <span class="title">Handler_0</span><span class="params">(_DWORD **a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> SM4_KEY[<span class="number">20</span>]; <span class="comment">// [esp+D0h] [ebp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( **a1 == <span class="number">0xC0000005</span> )                     <span class="comment">// 异常</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">qmemcpy</span>(SM4_KEY, <span class="string">&quot;where_are_u_now?&quot;</span>, <span class="number">16</span>);</span><br><span class="line">    <span class="built_in">sub_501172</span>((<span class="type">int</span>)&amp;unk_50A218, (<span class="type">int</span>)SM4_KEY);</span><br><span class="line">    <span class="built_in">SetUnhandledExceptionFilter</span>(TopLevelExceptionFilter);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的0xC0000005就是访问非法内存的异常<br>这里跟进 sub_501172</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title">SM4233</span><span class="params">(<span class="type">int</span> a1, <span class="type">unsigned</span> <span class="type">int</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+D0h] [ebp-B8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [esp+DCh] [ebp-ACh]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+E0h] [ebp-A8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+E4h] [ebp-A4h]</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">35</span>]; <span class="comment">// [esp+E8h] [ebp-A0h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [esp+174h] [ebp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [esp+178h] [ebp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// [esp+17Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// [esp+180h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;                                       <span class="comment">// 还是SM4吧~</span></span><br><span class="line">  v8 = _byteswap_ulong(*a2);</span><br><span class="line">  v9 = _byteswap_ulong(a2[<span class="number">1</span>]);</span><br><span class="line">  v10 = _byteswap_ulong(a2[<span class="number">2</span>]);</span><br><span class="line">  v11 = _byteswap_ulong(a2[<span class="number">3</span>]);</span><br><span class="line">  v4 = v8 ^ <span class="number">0xA3B1BAC6</span>;</span><br><span class="line">  v5 = dword_507A68[<span class="number">1</span>] ^ v9;</span><br><span class="line">  v6 = dword_507A68[<span class="number">2</span>] ^ v10;</span><br><span class="line">  result = <span class="number">12</span>;</span><br><span class="line">  v7[<span class="number">0</span>] = dword_507A68[<span class="number">3</span>] ^ v11;</span><br><span class="line">  <span class="keyword">while</span> ( v3 &lt; <span class="number">0x20</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7[v3 + <span class="number">1</span>] = *(&amp;v4 + v3) ^ <span class="built_in">sub_5014E0</span>(dword_507A78[v3] ^ v7[v3] ^ v7[v3 - <span class="number">1</span>] ^ *(&amp;v5 + v3));</span><br><span class="line">    *(_DWORD *)(a1 + <span class="number">4</span> * v3) = v7[v3 + <span class="number">1</span>];</span><br><span class="line">    result = ++v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很容易识别出是SM4加密算法的特征</p>
<p>注意到还有个 TopLevelExceptionFilter</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_502C30</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [esp+D3h] [ebp-11h]</span></span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// [esp+DCh] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="type">int</span>)a1;</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)*a1 == <span class="number">0xC0000005</span> )           <span class="comment">// 异常</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">j_strlen</span>(Str2); i += <span class="number">2</span> )   <span class="comment">// 相邻swap</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = Str2[i];</span><br><span class="line">      Str2[i] = Str2[i + <span class="number">1</span>];</span><br><span class="line">      Str2[i + <span class="number">1</span>] = v2;</span><br><span class="line">    &#125;</span><br><span class="line">    Str1 = <span class="built_in">j_BASE64ENCODE</span>(byte_50A180);</span><br><span class="line">    *(_DWORD *)(a1[<span class="number">1</span>] + <span class="number">176</span>) = *(_DWORD *)(*a1 + <span class="number">20</span>);</span><br><span class="line">    *(_DWORD *)(a1[<span class="number">1</span>] + <span class="number">164</span>) = *(_DWORD *)(*a1 + <span class="number">24</span>);</span><br><span class="line">    *(_DWORD *)(a1[<span class="number">1</span>] + <span class="number">172</span>) = *(_DWORD *)(*a1 + <span class="number">28</span>);</span><br><span class="line">    *(_DWORD *)(a1[<span class="number">1</span>] + <span class="number">168</span>) = *(_DWORD *)(*a1 + <span class="number">32</span>);</span><br><span class="line">    *(_DWORD *)(a1[<span class="number">1</span>] + <span class="number">156</span>) = *(_DWORD *)(*a1 + <span class="number">36</span>);</span><br><span class="line">    *(_DWORD *)(a1[<span class="number">1</span>] + <span class="number">160</span>) = *(_DWORD *)(*a1 + <span class="number">40</span>);</span><br><span class="line">    *(_DWORD *)(a1[<span class="number">1</span>] + <span class="number">184</span>) = j_FINAL_CHECK;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里对Str2进行了两个一组的相邻swap<br>同时对byte_50A180进行了base64加密<br>查看base64加密函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BYTE *__cdecl <span class="title">BASE64ENCODE</span><span class="params">(<span class="type">char</span> *Str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+E4h] [ebp-5Ch]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [esp+F0h] [ebp-50h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+FCh] [ebp-44h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+108h] [ebp-38h]</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> i; <span class="comment">// [esp+114h] [ebp-2Ch]</span></span><br><span class="line">  _BYTE *v7; <span class="comment">// [esp+120h] [ebp-20h]</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> v8; <span class="comment">// [esp+12Ch] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+138h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="built_in">j_strlen</span>(Str);</span><br><span class="line">  <span class="keyword">if</span> ( v8 % <span class="number">3</span> )</span><br><span class="line">    v9 = <span class="number">4</span> * (v8 / <span class="number">3</span>) + <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v9 = <span class="number">4</span> * (v8 / <span class="number">3</span>);</span><br><span class="line">  v7 = <span class="built_in">malloc</span>(__CFADD__(v9, <span class="number">1</span>) ? <span class="number">-1</span> : v9 + <span class="number">1</span>);</span><br><span class="line">  v7[v9] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v8; i += <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">3</span>; ++j )</span><br><span class="line">      v3 |= (<span class="type">unsigned</span> __int8)Str[j + i] &lt;&lt; (<span class="number">8</span> * (<span class="number">2</span> - j));</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">4</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( k &gt;= <span class="number">4</span> - (i + <span class="number">3</span> - v8) &amp;&amp; i + <span class="number">3</span> &gt; v8 )</span><br><span class="line">        v7[v5] = <span class="string">&#x27;!&#x27;</span>;                           <span class="comment">// 把&quot;=&quot;填充改为&quot;!&quot;了</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v7[v5] = BASE64_table_41A080[<span class="built_in">sub_5010FF</span>((v3 &gt;&gt; (<span class="number">6</span> * (<span class="number">3</span> - k))) &amp; <span class="number">0x3F</span>)];<span class="comment">// 这里变了！！！！！！！！！</span></span><br><span class="line">                                                <span class="comment">// (a1 + 24) % 64;</span></span><br><span class="line">                                                <span class="comment">// 所以等价于再把base64表移动24位...</span></span><br><span class="line">      ++v5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我第一遍看以为它只是把填充字符改了<br>后面一直解的不对劲 再细看才发现这个sub_5010FF！</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (a1 + <span class="number">24</span>) % <span class="number">64</span>;</span><br></pre></td></tr></table></figure>

<p>所以相当于把base64的table整体向左移了24位<br>所以变表应该为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/abcdefghijklmnopqrstuvwx</span><br></pre></td></tr></table></figure>

<p>回到sub_502C30<br>base64加密完后有个check</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __noreturn <span class="title">FINAL_CHECK</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">j_strcmp</span>(Str1, Str2) )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;right\n&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;wrong\n&quot;</span>);</span><br><span class="line">  <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将base64加密的Str1和变换后的Str2比对</p>
<p>回溯一下 看这里:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Str1 = <span class="built_in">j_BASE64ENCODE</span>(byte_50A180);</span><br></pre></td></tr></table></figure>

<p>查看byte_50A180的交叉引用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_502EA0</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( *a1 == <span class="number">0xC0000005</span> )                      <span class="comment">// 异常处理</span></span><br><span class="line">    <span class="built_in">sub_501131</span>((<span class="type">int</span>)&amp;unk_50A218, <span class="number">1</span>, <span class="number">16</span>, (<span class="type">int</span>)&amp;INPUT, (<span class="type">int</span>)byte_50A180);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里跟进去发现是SM4的主体部分 前面的那个具有SM4特征的应该是init函数<br>那么流程就清楚了<br>输入-&gt;hook(变表+设置异常处理)-&gt;触发异常-&gt;SM4-&gt;魔改base64-&gt;check<br>那么我们把Str2 swap   base64table 处理好<br>逆回去解就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Str2: U1ATIOpkOyWSvGm/YOYFR4==</span><br><span class="line">table: yzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/abcdefghijklmnopqrstuvwx</span><br></pre></td></tr></table></figure>

<p>base64逆回去得到:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">59d095290df2400614f48d276906874e</span><br></pre></td></tr></table></figure>

<p>SM4 以where_are_u_now?为key逆回去 得到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SM4foRExcepioN?!</span><br></pre></td></tr></table></figure>
<p><strong>flag{SM4foRExcepioN?!}</strong></p>
<hr>
<hr>
<p>总结 每个函数都点一点… <del>怎么就把那个移24位的函数看漏了呢…</del></p>
<h2 id="Game"><a href="#Game" class="headerlink" title="Game"></a>Game</h2><p>用插件去除ollvm混淆 控制流平坦化后<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+30h] [rbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+38h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">56</span>]; <span class="comment">// [rsp+40h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">gets</span>(v6, argv);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">general_inspection</span>((<span class="built_in">int</span> (*)[<span class="number">9</span>])sudoku) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    <span class="built_in">check</span>((<span class="built_in">int</span> (*)[<span class="number">9</span>])sudoku);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">blank_num</span>((<span class="built_in">int</span> (*)[<span class="number">9</span>])sudoku);</span><br><span class="line">    v4 = <span class="built_in">mem_alloc</span>(v5);</span><br><span class="line">    <span class="built_in">trace</span>(sudoku, v4, v5);</span><br><span class="line">    <span class="built_in">check</span>((<span class="built_in">int</span> (*)[<span class="number">9</span>])sudoku);</span><br><span class="line">    <span class="built_in">check1</span>(v6);                                 <span class="comment">// 对输入作了变换</span></span><br><span class="line">    <span class="built_in">check3</span>(v6);                                 <span class="comment">// 解一个数独</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据check3里面的解出数独得到我们变换后的输入为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4693641762894685722843556137219876255986</span></span><br></pre></td></tr></table></figure>

<p>看check1</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">check1</span><span class="params">(<span class="type">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [rsp+6Eh] [rbp-12h]</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+6Fh] [rbp-11h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+70h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="built_in">strlen</span>(a1) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1) &gt;&gt; <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = a1[v5];</span><br><span class="line">    a1[v5] = a1[i];</span><br><span class="line">    a1[i] = v3;</span><br><span class="line">    ++v5;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(a1); j += <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = a1[j];</span><br><span class="line">    a1[j] = a1[j + <span class="number">1</span>];</span><br><span class="line">    a1[j + <span class="number">1</span>] = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="built_in">strlen</span>(a1); ++k )</span><br><span class="line">    a1[k] = -(a1[k] ^ <span class="number">0xF3</span>) - <span class="number">21</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟着逆回去就好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;4693641762894685722843556137219876255986&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag))</span><br><span class="line">flag = <span class="built_in">list</span>(flag)</span><br><span class="line">flag = [<span class="built_in">ord</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> flag]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    flag[k] = -(flag[k]+<span class="number">21</span>)^<span class="number">0xf3</span></span><br><span class="line">    flag[k] &amp;= <span class="number">0xff</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(flag),<span class="number">2</span>):</span><br><span class="line">    tmp = flag[j]</span><br><span class="line">    flag[j] = flag[j+<span class="number">1</span>]</span><br><span class="line">    flag[j+<span class="number">1</span>] = tmp</span><br><span class="line">v5 = <span class="number">40</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    v5 -= <span class="number">1</span></span><br><span class="line">    v3 = flag[v5]</span><br><span class="line">    flag[v5] = flag[i]</span><br><span class="line">    flag[i] = v3</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># KDEEIFGKIJ@AFGEJAEF@FDKADFGIJFA@FDE@JG@J</span></span><br></pre></td></tr></table></figure>

<p><strong>flag{KDEEIFGKIJ@AFGEJAEF@FDKADFGIJFA@FDE@JG@J}</strong></p>
<h1 id="安洵杯2021"><a href="#安洵杯2021" class="headerlink" title="安洵杯2021"></a>安洵杯2021</h1><h2 id="sign-in"><a href="#sign-in" class="headerlink" title="sign_in"></a>sign_in</h2><p>IDA捣鼓半天 一大堆未识别的麻烦死了<br>直接od跑一跑 dump出来看 清晰多了</p>
<p>根据关键字符串找到加密函数:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_401D10</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE v1[<span class="number">125</span>]; <span class="comment">// [esp+4Ch] [ebp-140h] BYREF</span></span><br><span class="line">  __int16 v2; <span class="comment">// [esp+C9h] [ebp-C3h]</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [esp+CBh] [ebp-C1h]</span></span><br><span class="line">  <span class="type">int</span> v4[<span class="number">4</span>]; <span class="comment">// [esp+CCh] [ebp-C0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5[<span class="number">32</span>]; <span class="comment">// [esp+DCh] [ebp-B0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">36</span>]; <span class="comment">// [esp+15Ch] [ebp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+180h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+184h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+188h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="built_in">sizeof</span>(v5));</span><br><span class="line">  v4[<span class="number">0</span>] = <span class="number">68</span>;</span><br><span class="line">  v4[<span class="number">1</span>] = <span class="number">48</span>;</span><br><span class="line">  v4[<span class="number">2</span>] = <span class="number">103</span>;</span><br><span class="line">  v4[<span class="number">3</span>] = <span class="number">51</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v1, <span class="number">0</span>, <span class="built_in">sizeof</span>(v1));</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">sub_402200</span>(<span class="string">&quot;Now please input your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_4023D0</span>(<span class="string">&quot;%s&quot;</span>, v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">    v6[i] ^= v6[(i + <span class="number">1</span>) % <span class="number">32</span>];</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( i &lt; <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( j % <span class="number">6</span> &gt;= <span class="number">3</span> )</span><br><span class="line">      v1[<span class="number">32</span> * (<span class="number">3</span> - j % <span class="number">3</span>) + i] = v6[i];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v1[<span class="number">32</span> * (j % <span class="number">3</span>) + i] = v6[i];</span><br><span class="line">    ++i;</span><br><span class="line">    ++j;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">32</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v1[<span class="number">32</span> * i + j] )</span><br><span class="line">        v5[v7++] = (<span class="type">unsigned</span> __int8)v1[<span class="number">32</span> * i + j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_401055</span>(v5, v4, <span class="number">32</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">sub_40105F</span>(v5) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sub_402200</span>(<span class="string">&quot;congratulations !!!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sub_402200</span>(<span class="string">&quot;sorry , you&#x27;re wrong&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xxtea部分:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__cdecl <span class="title">sub_401AE0</span><span class="params">(_DWORD *a1, <span class="type">int</span> a2, <span class="type">unsigned</span> <span class="type">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+4Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+50h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+54h] [ebp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+58h] [ebp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [esp+5Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [esp+60h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = dword_42CA44 + <span class="number">1144219440</span>;</span><br><span class="line">  v7 = <span class="number">0x34</span> / a3 + <span class="number">6</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = a1[a3 - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v8 += v5;</span><br><span class="line">    v6 = (v8 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a3 - <span class="number">1</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      a1[i] += ((v9 ^ *(_DWORD *)(a2 + <span class="number">4</span> * (v6 ^ i &amp; <span class="number">3</span>))) + (a1[i + <span class="number">1</span>] ^ v8)) ^ (((<span class="number">16</span> * v9) ^ (a1[i + <span class="number">1</span>] &gt;&gt; <span class="number">3</span>))</span><br><span class="line">                                                                               + ((<span class="number">4</span> * a1[i + <span class="number">1</span>]) ^ (v9 &gt;&gt; <span class="number">5</span>)));</span><br><span class="line">      v9 = a1[i];</span><br><span class="line">    &#125;</span><br><span class="line">    a1[a3 - <span class="number">1</span>] += ((v9 ^ *(_DWORD *)(a2 + <span class="number">4</span> * (v6 ^ i &amp; <span class="number">3</span>))) + (*a1 ^ v8)) ^ (((<span class="number">16</span> * v9) ^ (*a1 &gt;&gt; <span class="number">3</span>))</span><br><span class="line">                                                                            + ((<span class="number">4</span> * *a1) ^ (v9 &gt;&gt; <span class="number">5</span>)));</span><br><span class="line">    result = a1;</span><br><span class="line">    v9 = a1[a3 - <span class="number">1</span>];</span><br><span class="line">    --v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v7 );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里dword_42CA44不知道 但是我们可以爆破<br>利用xxtea解密后是unsigned int8 来约束 爆破得到 77<br>再解一个xor</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">60</span>,<span class="number">64</span>,<span class="number">43</span>,<span class="number">102</span>,<span class="number">111</span>,<span class="number">79</span>,<span class="number">92</span>,<span class="number">29</span>,<span class="number">66</span>,<span class="number">26</span>,<span class="number">43</span>,<span class="number">87</span>,<span class="number">54</span>,<span class="number">68</span>,<span class="number">51</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">107</span>,<span class="number">92</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">28</span>,<span class="number">92</span>,<span class="number">26</span>,<span class="number">43</span>,<span class="number">9</span>,<span class="number">50</span>,<span class="number">110</span>,<span class="number">21</span>,<span class="number">90</span>,<span class="number">44</span>,<span class="number">37</span>]</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line">v1 = [<span class="number">0</span>]*<span class="number">128</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="number">32</span>:</span><br><span class="line">    <span class="keyword">if</span> j%<span class="number">6</span>&gt;=<span class="number">3</span>:</span><br><span class="line">        v1[<span class="number">32</span>*(<span class="number">3</span>-(j%<span class="number">3</span>))+i] = i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        v1[<span class="number">32</span>*(j%<span class="number">3</span>)+i] = i+<span class="number">1</span></span><br><span class="line">    j += <span class="number">1</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        <span class="keyword">if</span>(v1[<span class="number">32</span>*i+j]!=<span class="number">0</span>):</span><br><span class="line">            <span class="built_in">print</span>(v1[<span class="number">32</span>*i+j],end=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pos = [<span class="number">1</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">19</span>,<span class="number">25</span>,<span class="number">31</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">18</span>,<span class="number">20</span>,<span class="number">24</span>,<span class="number">26</span>,<span class="number">30</span>,<span class="number">32</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">17</span>,<span class="number">21</span>,<span class="number">23</span>,<span class="number">27</span>,<span class="number">29</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">16</span>,<span class="number">22</span>,<span class="number">28</span>]</span><br><span class="line">flag = [<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    flag[pos[i]-<span class="number">1</span>] = enc[i]</span><br><span class="line">flag[-<span class="number">1</span>] ^= flag[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">    flag[i] ^= flag[i+<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(x),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>flag:<br><strong>Th4_1mp0rtant_th2n9_is_t0_le@rn!</strong></p>
<h1 id="MTCTF2021"><a href="#MTCTF2021" class="headerlink" title="MTCTF2021"></a>MTCTF2021</h1><h2 id="wow"><a href="#wow" class="headerlink" title="wow"></a>wow</h2><p>夹杂着一个天堂之门 lazydump出来静态分析<br>一个魔改的xxtea 主要是rounds改为了12 然后n&#x3D;9 解就完了</p>
<h2 id="Superflat"><a href="#Superflat" class="headerlink" title="Superflat"></a>Superflat</h2><p>mov混淆<br>工具demovfuscator一直一直安不好…<br>这里学习使用pintool来进行求解<br>学习:<br><a target="_blank" rel="noopener" href="https://s0uthwood.github.io/post/all-solves-during-a-weekend/">s0uthwood</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/level5uiharu/p/16963907.html">pintool</a></p>
<p>这里有个小坑 64位ubuntu需要安装兼容32位的gcc才能make ia32…</p>
<p>ida硬看汇编 可以发现getchar和putchar字样<br>猜测是逐字符判断 这种都可以祭出pintool<br>原理: 利用正确与错误分别对应的指令执行条数不同 (类似侧信道攻击)<br>首先要满足42位len的check 然后尝试发现(用已知第一个字符为f)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa: Count 584288</span><br><span class="line">faaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa: Count 589176</span><br></pre></td></tr></table></figure>

<p>所以可以利用这个点来进行爆破<br>pintool用法:<br>在 <code>pin-3.30-98830-g1d7b601b3-gcc-linux/source/tools/ManualExamples</code> 下运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;flag&#123;d06f0bcc-93e0-9c5b-161e-e146417&quot;</span>+<span class="number">5</span>*<span class="string">&quot;a&quot;</span>+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">table = <span class="string">&quot;012f3456789abcde-&quot;</span></span><br><span class="line"></span><br><span class="line">now = <span class="number">36</span></span><br><span class="line">prev_cnt = <span class="number">759287</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span>(now&gt;=<span class="number">41</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> table:</span><br><span class="line">        cmd = <span class="string">&quot;echo &quot;</span>+flag[:now]+x+flag[now+<span class="number">1</span>:]+<span class="string">&quot; | ../../../pin -t obj-ia32/inscount0.so -o superflat.log -- ./superflat; cat ./superflat.log&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(flag[:now]+x+flag[now+<span class="number">1</span>:])</span><br><span class="line">        output = subprocess.check_output(cmd,shell=<span class="literal">True</span>,stderr=subprocess.PIPE)   </span><br><span class="line">        now_cnt = <span class="built_in">int</span>(output.split(<span class="string">b&#x27;\n&#x27;</span>)[<span class="number">1</span>].split()[<span class="number">1</span>].decode())</span><br><span class="line"><span class="comment">#        print(output,now_cnt)</span></span><br><span class="line">        <span class="keyword">if</span> now_cnt-prev_cnt&gt;<span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[+]RIGHT!    <span class="subst">&#123;x&#125;</span>&#x27;</span>)</span><br><span class="line">            flag = flag[:now]+x+flag[now+<span class="number">1</span>:]</span><br><span class="line">            now += <span class="number">1</span></span><br><span class="line">            prev_cnt = now_cnt</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] WRONG!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这里贴的是后半部分的 从头开始的话改一改now prev_cnt 即可<br>爆破得到flag<br><strong>flag{d06f0bcc-93e0-9c5b-161e-e1464176d395}</strong></p>
<h1 id="GKCTF2021"><a href="#GKCTF2021" class="headerlink" title="GKCTF2021"></a>GKCTF2021</h1><h2 id="QQQQT"><a href="#QQQQT" class="headerlink" title="QQQQT"></a>QQQQT</h2><p>虽说整个题目莫名其妙的(指虽然能找到base58以及密文 但是不知道怎么调用到的 网上没找到一篇讲到调用原理的…)<br>但是借此机会了解一下QT<br>了解一下 对象树 信号&#x2F;槽通信 的概念<br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/ics-articles/328193.html">+</a></p>
<h2 id="App-debug"><a href="#App-debug" class="headerlink" title="App-debug"></a>App-debug</h2><p>jadx打开 发现load了.so库 IDA查看<br>找到 Java_com_example_myapplication_MainActivity_check<br>发现TEA加密<br>先看TEA加密<br>重点在于发现key[]是修改过的 这种交叉引用即可查看到正确的值<br>逆出来两个整数</p>
<p>这种load c的库的apk最烦人的点就在于层之间接口的数据传递<br>这题:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sub_3FE20</span>(a1, a3, (__int64)v6);</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">sub_40040</span>((__int64)v6) == <span class="number">8</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;unk_C80E0 + i) = *(_BYTE *)<span class="built_in">sub_40064</span>((__int64)v6, i);</span><br><span class="line">  v5 = <span class="built_in">TEA</span>((<span class="type">unsigned</span> <span class="type">int</span> *)&amp;unk_C80E0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_3FE20:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v9 = <span class="built_in">sub_40094</span>(a1, <span class="string">&quot;java/lang/String&quot;</span>);</span><br><span class="line">  v8 = <span class="built_in">sub_400CC</span>(a1, <span class="string">&quot;GB2312&quot;</span>);</span><br><span class="line">  v7 = <span class="built_in">sub_40104</span>(a1, v9, <span class="string">&quot;getBytes&quot;</span>, <span class="string">&quot;(Ljava/lang/String;)[B&quot;</span>);</span><br><span class="line">  v6 = <span class="built_in">sub_4014C</span>(a1, a2, v7, v8);</span><br><span class="line">  v5 = <span class="built_in">sub_4024C</span>(a1, v6);</span><br></pre></td></tr></table></figure>

<p>所以知道是long_to_bytes&#x2F;bytes_to_long 这种<br>这两个数字转出来分别是<br>TcKG 和 0gF<br>注意下端序 以及sub_40040的len check要满足&#x3D;&#x3D;8 所以末尾再补个空格 apk验证正确<br>“GKcTFg0 “<br>但是md5的时候又要把空格去掉…<br>flag:<br><strong>flag{77bca47fe645ca1bd1ac93733171c9c4}</strong></p>
<h1 id="GWCTF2019"><a href="#GWCTF2019" class="headerlink" title="GWCTF2019"></a>GWCTF2019</h1><h2 id="babyvm"><a href="#babyvm" class="headerlink" title="babyvm"></a>babyvm</h2><p>vm opcode<br>记得几个月前看还没什么头绪 也静不下心来逆向 在计组知识学习深入后再来看就好多了</p>
<p>main:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3[<span class="number">2</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3[<span class="number">1</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input something:&quot;</span>);</span><br><span class="line">  <span class="built_in">SETUP</span>((__int64)v3);</span><br><span class="line">  <span class="built_in">EXECUTE_OPCODE</span>((__int64)v3);</span><br><span class="line">  <span class="built_in">FALSE_FINAL_CHECK</span>();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;And the flag is GWHT&#123;true flag&#125;&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SETUP:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">SETUP</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  *(_DWORD *)a1 = <span class="number">0</span>;</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">4</span>) = <span class="number">0x12</span>;</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">8</span>) = <span class="number">0</span>;</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">12</span>) = <span class="number">0</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">16</span>) = &amp;OPCODE;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">24</span>) = <span class="number">0xF1</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">32</span>) = F1_sub_56088D000B5F;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">40</span>) = <span class="number">0xF2</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">48</span>) = F2_XOR;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">56</span>) = <span class="number">0xF5</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">64</span>) = F5_INPUT_AND_CHECK_LEN;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">72</span>) = <span class="number">0xF4</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">80</span>) = F4_sub_55E3A8C00956;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">88</span>) = <span class="number">0xF7</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">96</span>) = F7_MUL;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">104</span>) = <span class="number">0xF8</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">112</span>) = F8_SWAP;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">120</span>) = <span class="number">0xF6</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">128</span>) = F6_LINERAL_CAL;</span><br><span class="line">  INPUT = <span class="built_in">malloc</span>(<span class="number">0x512</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(INPUT, <span class="number">0</span>, <span class="number">0x512</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到执行opcode的时候写了个0xF4停止 但是此时发现没出现过前文的mul等函数<br>这是因为第一个0xF4后面一堆0过后还会继续执行第二阶段</p>
<p>查看每个函数<br>F1: 设置寄存器&#x2F;赋值</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">F1_sub_56088D000B5F</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> *v2; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v2 = (<span class="type">int</span> *)(*(_QWORD *)(a1 + <span class="number">16</span>) + <span class="number">2LL</span>);</span><br><span class="line">  <span class="keyword">switch</span> ( *(_BYTE *)(*(_QWORD *)(a1 + <span class="number">16</span>) + <span class="number">1LL</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE1</span>:</span><br><span class="line">      *(_DWORD *)a1 = *((<span class="type">char</span> *)INPUT + *v2);   <span class="comment">// reg1</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE2</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>) = *((<span class="type">char</span> *)INPUT + *v2);<span class="comment">// reg2</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE3</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">8</span>) = *((<span class="type">char</span> *)INPUT + *v2);<span class="comment">// reg3</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE4</span>:</span><br><span class="line">      *((_BYTE *)INPUT + *v2) = *(_DWORD *)a1;  <span class="comment">// input[] = reg1</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE5</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">12</span>) = *((<span class="type">char</span> *)INPUT + *v2);<span class="comment">// reg4</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE7</span>:</span><br><span class="line">      *((_BYTE *)INPUT + *v2) = *(_DWORD *)(a1 + <span class="number">4</span>);<span class="comment">// input[] = reg2</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">16</span>) += <span class="number">6LL</span>;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他的都没什么难点<br>这里有个地方感觉reg对应不算很清晰<br>但也能猜到是swap(reg1,reg2) 只是有可能是带着地址的指针交换</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">F8_SWAP</span><span class="params">(<span class="type">int</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v2 = *a1;</span><br><span class="line">  *a1 = a1[<span class="number">1</span>];</span><br><span class="line">  a1[<span class="number">1</span>] = v2;</span><br><span class="line">  ++*((_QWORD *)a1 + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>python提取opcode打印字节码:<br>要注意到reg2最初是赋了值的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">opcode = [<span class="number">0xF5</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x26</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x29</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF5</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE3</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE3</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE3</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF4</span>,-<span class="number">1</span>]</span><br><span class="line">enc = [<span class="number">0x69</span>, <span class="number">0x45</span>, <span class="number">0x2A</span>, <span class="number">0x37</span>, <span class="number">0x09</span>, <span class="number">0x17</span>, <span class="number">0xC5</span>, <span class="number">0x0B</span>, <span class="number">0x5C</span>, <span class="number">0x72</span>, <span class="number">0x33</span>, <span class="number">0x76</span>, <span class="number">0x33</span>, <span class="number">0x21</span>, <span class="number">0x74</span>, <span class="number">0x31</span>, <span class="number">0x5F</span>, <span class="number">0x33</span>, <span class="number">0x73</span>, <span class="number">0x72</span>]</span><br><span class="line"><span class="comment"># enc = &quot;Fz&#123;aM&#123;aM|&#125;fMt~suM !!&quot;</span></span><br><span class="line">pc = <span class="number">0</span></span><br><span class="line">line = <span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;mov reg2 12h&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> opcode[pc] != -<span class="number">1</span>:</span><br><span class="line">    line+=<span class="number">1</span></span><br><span class="line">    op = opcode[pc]</span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0x0</span>):</span><br><span class="line">        pc+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0xF5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;INPUT_AND_CHECKLEN&quot;</span>)</span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0xF1</span>):</span><br><span class="line">        <span class="keyword">case</span> = opcode[pc+<span class="number">1</span>]</span><br><span class="line">        v2 = opcode[pc+<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">case</span>==<span class="number">0xE1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;mov reg1 input[<span class="subst">&#123;v2&#125;</span>]&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">case</span>==<span class="number">0xE2</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;mov reg2 input[<span class="subst">&#123;v2&#125;</span>]&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">case</span>==<span class="number">0xE3</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;mov reg3 input[<span class="subst">&#123;v2&#125;</span>]&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">case</span>==<span class="number">0xE4</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;mov input[<span class="subst">&#123;v2&#125;</span>] reg1&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">case</span>==<span class="number">0xE5</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;mov reg4 input[<span class="subst">&#123;v2&#125;</span>]&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">case</span>==<span class="number">0xE6</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;mov input[<span class="subst">&#123;v2&#125;</span>] reg2&quot;</span>)</span><br><span class="line">        pc += <span class="number">6</span></span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0xF2</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;xor reg1 reg2&quot;</span>)</span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0xF4</span>):</span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0xF7</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;mul reg1 reg4&quot;</span>)</span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0xF8</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;swap reg1 reg2&quot;</span>) </span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0xF6</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;mov reg1 3*reg1 + 2*reg2 + reg3&quot;</span>)</span><br><span class="line">        pc += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>打印出来:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">mov reg2 12h</span><br><span class="line">INPUT_AND_CHECKLEN</span><br><span class="line">mov reg1 input[0]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[32] reg1</span><br><span class="line">mov reg1 input[1]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[33] reg1</span><br><span class="line">mov reg1 input[2]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[34] reg1</span><br><span class="line">mov reg1 input[3]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[35] reg1</span><br><span class="line">mov reg1 input[4]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[36] reg1</span><br><span class="line">mov reg1 input[5]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[37] reg1</span><br><span class="line">mov reg1 input[6]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[38] reg1</span><br><span class="line">mov reg1 input[7]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[39] reg1</span><br><span class="line">mov reg1 input[8]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[40] reg1</span><br><span class="line">mov reg1 input[9]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[41] reg1</span><br><span class="line">mov reg1 input[10]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[42] reg1</span><br><span class="line">mov reg1 input[11]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[43] reg1</span><br><span class="line">mov reg1 input[12]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[44] reg1</span><br><span class="line">mov reg1 input[13]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[45] reg1</span><br><span class="line">mov reg1 input[14]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[46] reg1</span><br><span class="line">mov reg1 input[15]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[47] reg1</span><br><span class="line">mov reg1 input[16]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[48] reg1</span><br><span class="line">mov reg1 input[17]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[49] reg1</span><br><span class="line">mov reg1 input[18]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[50] reg1</span><br><span class="line">mov reg1 input[19]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[51] reg1</span><br><span class="line">INPUT_AND_CHECKLEN</span><br><span class="line">mov reg1 input[0]</span><br><span class="line">mov reg2 input[1]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[0] reg1</span><br><span class="line">mov reg1 input[1]</span><br><span class="line">mov reg2 input[2]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[1] reg1</span><br><span class="line">mov reg1 input[2]</span><br><span class="line">mov reg2 input[3]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[2] reg1</span><br><span class="line">mov reg1 input[3]</span><br><span class="line">mov reg2 input[4]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[3] reg1</span><br><span class="line">mov reg1 input[4]</span><br><span class="line">mov reg2 input[5]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[4] reg1</span><br><span class="line">mov reg1 input[5]</span><br><span class="line">mov reg2 input[6]</span><br><span class="line">xor reg1 reg2</span><br><span class="line">mov input[5] reg1</span><br><span class="line">mov reg1 input[6]</span><br><span class="line">mov reg2 input[7]</span><br><span class="line">mov reg3 input[8]</span><br><span class="line">mov reg4 input[12]</span><br><span class="line">mov reg1 3*reg1 + 2*reg2 + reg3</span><br><span class="line">mul reg1 reg4</span><br><span class="line">mov input[6] reg1</span><br><span class="line">mov reg1 input[7]</span><br><span class="line">mov reg2 input[8]</span><br><span class="line">mov reg3 input[9]</span><br><span class="line">mov reg4 input[12]</span><br><span class="line">mov reg1 3*reg1 + 2*reg2 + reg3</span><br><span class="line">mul reg1 reg4</span><br><span class="line">mov input[7] reg1</span><br><span class="line">mov reg1 input[8]</span><br><span class="line">mov reg2 input[9]</span><br><span class="line">mov reg3 input[10]</span><br><span class="line">mov reg4 input[12]</span><br><span class="line">mov reg1 3*reg1 + 2*reg2 + reg3</span><br><span class="line">mul reg1 reg4</span><br><span class="line">mov input[8] reg1</span><br><span class="line">mov reg1 input[13]</span><br><span class="line">mov reg2 input[19]</span><br><span class="line">swap reg1 reg2</span><br><span class="line">mov input[13] reg1</span><br><span class="line">mov reg1 input[14]</span><br><span class="line">mov reg2 input[18]</span><br><span class="line">swap reg1 reg2</span><br><span class="line">mov input[14] reg1</span><br><span class="line">mov reg1 input[15]</span><br><span class="line">mov reg2 input[17]</span><br><span class="line">swap reg1 reg2</span><br><span class="line">mov input[15] reg1</span><br></pre></td></tr></table></figure>

<p>可以清晰看到有两次input<br>第一遍逆向出来是假的flag</p>
<p>第二遍逐步分析:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">input[0] = input[0]^input[1]</span><br><span class="line">input[1] = input[1]^input[2]</span><br><span class="line">input[2] = input[2]^input[3]</span><br><span class="line">input[3] = input[3]^input[4]</span><br><span class="line">input[4] = input[4]^input[5]</span><br><span class="line">input[5] = input[5]^input[6]</span><br><span class="line">input[6] = (3*input[6]+2*input[7]+input[8])*input[12]</span><br><span class="line">input[7] = (3*input[7]+2*input[8]+input[9])*input[12]</span><br><span class="line">input[8] = (3*input[8]+2*input[9]+input[10])*input[12]</span><br><span class="line">input[13] = input[19]  swap?</span><br><span class="line">input[14] = input[18]</span><br><span class="line">input[15] = input[17]</span><br></pre></td></tr></table></figure>

<p>这里就可以发现swap那个函数应该是带着指针的 bytecode有一点小问题 但不是很影响做题<br>这样的话我们就从后开始逆<br>先swap 然后发现input[12]&#x2F;input[9]&#x2F;input[10]是没有改变的 所以可以爆破得到input[8] 从而得到7,6<br>这样就可以xor回去得到5,4,3,2,1,0<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] START&quot;</span>)</span><br><span class="line">    enc[<span class="number">13</span>],enc[<span class="number">19</span>] = enc[<span class="number">19</span>],enc[<span class="number">13</span>]</span><br><span class="line">    enc[<span class="number">14</span>],enc[<span class="number">18</span>] = enc[<span class="number">18</span>],enc[<span class="number">14</span>]</span><br><span class="line">    enc[<span class="number">15</span>],enc[<span class="number">17</span>] = enc[<span class="number">17</span>],enc[<span class="number">15</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        y = <span class="number">3</span>*x+<span class="number">2</span>*enc[<span class="number">9</span>]+enc[<span class="number">10</span>]</span><br><span class="line">        y *= enc[<span class="number">12</span>]</span><br><span class="line">        y &amp;= <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span>(y==enc[<span class="number">8</span>]):</span><br><span class="line">            enc[<span class="number">8</span>] = x</span><br><span class="line">            <span class="built_in">print</span>(enc[<span class="number">8</span>])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        y = <span class="number">3</span>*x+<span class="number">2</span>*enc[<span class="number">8</span>]+enc[<span class="number">9</span>]</span><br><span class="line">        y *= enc[<span class="number">12</span>]</span><br><span class="line">        y &amp;= <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span>(y==enc[<span class="number">7</span>]):</span><br><span class="line">            enc[<span class="number">7</span>] = x</span><br><span class="line">            <span class="built_in">print</span>(enc[<span class="number">7</span>])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        y = <span class="number">3</span>*x+<span class="number">2</span>*enc[<span class="number">7</span>]+enc[<span class="number">8</span>]</span><br><span class="line">        y *= enc[<span class="number">12</span>]</span><br><span class="line">        y &amp;= <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span>(y==enc[<span class="number">6</span>]):</span><br><span class="line">            enc[<span class="number">6</span>]=x</span><br><span class="line">            <span class="built_in">print</span>(enc[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        enc[i] ^= enc[i+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(c),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">dec()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Y0u_hav3_r3v3rs3_1t!</span></span><br></pre></td></tr></table></figure>

<p><strong>GWHT{Y0u_hav3_r3v3rs3_1t!}</strong></p>
<hr>
<hr>
<p>这题是最基本的vm类型 还没加jump跳转指令<br>关键在于分析opcode和对应的操作数以及每个函数抽象出的意义</p>
<h1 id="HGAME2022"><a href="#HGAME2022" class="headerlink" title="HGAME2022"></a>HGAME2022</h1><h2 id="week4-ezvm"><a href="#week4-ezvm" class="headerlink" title="week4 ezvm"></a>week4 ezvm</h2><p>这道vm很怪 特别怪…<br>直接解析指令很离谱… 各种寄存器&#x2F;堆栈&#x2F;xor_key&#x2F;enc交织在一起 真的分析不明白<br>大概打印一下 可以发现关键加密两个点<br>mul 2<br>xor xxx<br>字节码上这两个是挨着的 猜测就是乘2再xor<br>直接动调看(注意getchar那里要一次行输完…)<br>发现确实乘2 后紧跟着就是 xor<br>每次xor的不一样 可以动调记录 也可以找几个后在dword_49F020数组找对应项<br>得到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xor_key = [<span class="number">0x0000005E</span>, <span class="number">0x00000046</span>, <span class="number">0x00000061</span>, <span class="number">0x00000043</span>, <span class="number">0x0000000E</span>, <span class="number">0x00000053</span>, <span class="number">0x00000049</span>, <span class="number">0x0000001F</span>, <span class="number">0x00000051</span>, <span class="number">0x0000005E</span>, <span class="number">0x00000036</span>, <span class="number">0x00000037</span>, <span class="number">0x00000029</span>, <span class="number">0x00000041</span>, <span class="number">0x00000063</span>, <span class="number">0x0000003B</span>, <span class="number">0x00000064</span>, <span class="number">0x0000003B</span>, <span class="number">0x00000015</span>, <span class="number">0x00000018</span>, <span class="number">0x0000005B</span>, <span class="number">0x0000003E</span>, <span class="number">0x00000022</span>, <span class="number">0x00000050</span>, <span class="number">0x00000046</span>, <span class="number">0x0000005E</span>, <span class="number">0x00000035</span>, <span class="number">0x0000004E</span>, <span class="number">0x00000043</span>, <span class="number">0x00000023</span>, <span class="number">0x00000060</span>, <span class="number">0x0000003B</span>, <span class="number">0x00000000</span>]</span><br></pre></td></tr></table></figure>

<p>同样的 enc数组也可以在dword_49F020里面翻 应该也可以等变换完了步过来找<br>这里记录一下<br>首先通过xor_key知道flag位数 然后等32次变换完后 发现原本存储输入的变成了加密后的<br>那么在数组第一个点下硬件断点 等触发<br>发现在这里:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_401904</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// edx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v0 = dword_49F030++;</span><br><span class="line">  result = ++dword_49F024;</span><br><span class="line">  dword_49F020[dword_49F024 + <span class="number">9</span>] = dword_49F020[v0 + <span class="number">209</span>];</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时可以根据v0的值找到dword_49F020数组中的位置 也就能找到enc[]了</p>
<p>得到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x0000008E</span>, <span class="number">0x00000088</span>, <span class="number">0x000000A3</span>, <span class="number">0x00000099</span>, <span class="number">0x000000C4</span>, <span class="number">0x000000A5</span>, <span class="number">0x000000C3</span>, <span class="number">0x000000DD</span>, <span class="number">0x00000019</span>, <span class="number">0x000000EC</span>, <span class="number">0x0000006C</span>, <span class="number">0x0000009B</span>, <span class="number">0x000000F3</span>, <span class="number">0x0000001B</span>, <span class="number">0x0000008B</span>, <span class="number">0x0000005B</span>, <span class="number">0x0000003E</span>, <span class="number">0x0000009B</span>, <span class="number">0x000000F1</span>, <span class="number">0x00000086</span>, <span class="number">0x000000F3</span>, <span class="number">0x000000F4</span>, <span class="number">0x000000A4</span>, <span class="number">0x000000F8</span>, <span class="number">0x000000F8</span>, <span class="number">0x00000098</span>, <span class="number">0x000000AB</span>, <span class="number">0x00000086</span>, <span class="number">0x00000089</span>, <span class="number">0x00000061</span>, <span class="number">0x00000022</span>, <span class="number">0x000000C1</span>, <span class="number">0x00000002</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>逆向解密得到flag<br><strong>hgame{Ea$Y-Vm-t0-PrOTeCT_cOde!!}</strong></p>
<hr>
<hr>
<p>还是希望能够打印出正确的字节码来看 但是网上就找不到一篇这么做的…  等以后再来补吧~<br>也行吧 vm最初的方法就是动调… 这种不好解析汇编指令的动调也不失为一种好方法</p>
<h1 id="FSCTF2023"><a href="#FSCTF2023" class="headerlink" title="FSCTF2023"></a>FSCTF2023</h1><h2 id="ezbroke"><a href="#ezbroke" class="headerlink" title="ezbroke"></a>ezbroke</h2><p>PE修复+vm<br>vm很简单 重点是PE修复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> Offset    0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F   Ascii</span><br><span class="line"></span><br><span class="line">00000000  54 47 90 00 03 00 00 00 04 00 00 00 FF FF 00 00  TG?........</span><br><span class="line">00000010  B8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00  ?......@.......</span><br><span class="line">00000020  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000030  00 00 00 00 00 00 00 00 00 00 00 00 70 00 00 00  ............p...</span><br><span class="line">00000040  0E 1F BA 0E 00 B4 09 CD 21 B8 01 4C CD 21 54 68  ?.???L?Th</span><br><span class="line">00000050  69 73 20 70 72 6F 67 72 61 6D 20 63 61 6E 6E 6F  is.program.canno</span><br><span class="line">00000060  74 20 62 65 20 72 75 6E 20 69 6E 20 44 4F 53 20  t.be.run.in.DOS.</span><br><span class="line">00000070  6D 6F 64 65 2E 0D 0D 0A 24 00 00 00 00 00 00 00  mode....$.......</span><br><span class="line">00000080  50 45 00 00 4C 01 03 00 9B 10 21 65 00 BC 04 00  PE..L.?!e.?.</span><br><span class="line">00000090  1A 05 00 00 E0 00 27 01 0B 01 02 21 00 F0 00 00  ..?&#x27;!.?.</span><br><span class="line">000000A0  00 10 00 00 00 90 04 00 20 80 05 00 00 A0 04 00  ....?..€..?.</span><br><span class="line">000000B0  00 90 05 00 00 00 40 00 00 10 00 00 00 02 00 00  .?...@.......</span><br><span class="line">000000C0  04 00 00 00 01 00 00 00 04 00 00 00 00 00 00 00  .............</span><br><span class="line">000000D0  00 A0 05 00 00 10 00 00 00 00 00 00 03 00 00 00  .?...........</span><br><span class="line">000000E0  00 00 20 00 00 10 00 00 00 00 10 00 00 10 00 00  .............</span><br><span class="line">000000F0  00 00 00 00 10 00 00 00 00 00 00 00 00 00 00 00  ...............</span><br><span class="line">00000100  EC 94 05 00 B4 00 00 00 00 90 05 00 EC 04 00 00  鞌.?...?.?..</span><br><span class="line">00000110  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000120  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000130  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000140  F0 8B 05 00 18 00 00 00 00 00 00 00 00 00 00 00  饗............</span><br><span class="line">00000150  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000160  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span><br><span class="line">00000170  00 00 00 00 00 00 00 00 54 55 54 30 00 00 00 00  ........TUT0....</span><br><span class="line">00000180  00 90 04 00 00 10 00 00 00 00 00 00 00 02 00 00  .?...........</span><br><span class="line">00000190  00 00 00 00 00 00 00 00 00 00 00 00 80 00 00 E0  ............€..?</span><br><span class="line">000001A0  54 55 54 31 00 00 00 00 00 F0 00 00 00 A0 04 00  TUT1.....?..?.</span><br><span class="line">000001B0  00 EE 00 00 00 02 00 00 00 00 00 00 00 00 00 00  .?............</span><br><span class="line">000001C0  00 00 00 00 40 00 00 E0 2E 72 73 72 63 00 00 00  ....@..?rsrc...</span><br><span class="line">000001D0  00 10 00 00 00 90 05 00 00 06 00 00 00 F0 00 00  ....?.....?.</span><br><span class="line">000001E0  00 00 00 00 00 00 00 00 00 00 00 00 40 00 00 C0  ............@..?</span><br><span class="line">000001F0  33 2E 39 36 00 54 55 54 21 0D 09 0E 0A CE 64 10  3.96.TUT!...蝑</span><br></pre></td></tr></table></figure>

<p>除了MZ签名和UPX段的以外 还有PE头偏移也要改(3C处) 改为80<br>upx解就行了<br>然后一个超简单的虚拟机 这种vm…<br>得到字节码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">0 read ---&gt; stack[]</span><br><span class="line">1 mov a1[0] stack[0]</span><br><span class="line">7 xor a1[0] (a1[1]^0x17)</span><br><span class="line">8 mov stack[32] a1[0]</span><br><span class="line">14 mov a1[0] stack[1]</span><br><span class="line">20 xor a1[0] (a1[1]^0x17)</span><br><span class="line">21 mov stack[33] a1[0]</span><br><span class="line">27 mov a1[0] stack[2]</span><br><span class="line">33 xor a1[0] (a1[1]^0x17)</span><br><span class="line">34 mov stack[34] a1[0]</span><br><span class="line">40 mov a1[0] stack[3]</span><br><span class="line">46 xor a1[0] (a1[1]^0x17)</span><br><span class="line">47 mov stack[35] a1[0]</span><br><span class="line">53 mov a1[0] stack[4]</span><br><span class="line">59 xor a1[0] (a1[1]^0x17)</span><br><span class="line">60 mov stack[36] a1[0]</span><br><span class="line">66 mov a1[0] stack[5]</span><br><span class="line">72 xor a1[0] (a1[1]^0x17)</span><br><span class="line">73 mov stack[37] a1[0]</span><br><span class="line">79 mov a1[0] stack[6]</span><br><span class="line">85 xor a1[0] (a1[1]^0x17)</span><br><span class="line">86 mov stack[38] a1[0]</span><br><span class="line">92 mov a1[0] stack[7]</span><br><span class="line">98 xor a1[0] (a1[1]^0x17)</span><br><span class="line">99 mov stack[39] a1[0]</span><br><span class="line">105 mov a1[0] stack[8]</span><br><span class="line">111 xor a1[0] (a1[1]^0x17)</span><br><span class="line">112 mov stack[40] a1[0]</span><br><span class="line">118 mov a1[0] stack[9]</span><br><span class="line">124 xor a1[0] (a1[1]^0x17)</span><br><span class="line">125 mov stack[41] a1[0]</span><br><span class="line">131 mov a1[0] stack[10]</span><br><span class="line">137 xor a1[0] (a1[1]^0x17)</span><br><span class="line">138 mov stack[42] a1[0]</span><br><span class="line">144 mov a1[0] stack[11]</span><br><span class="line">150 xor a1[0] (a1[1]^0x17)</span><br><span class="line">151 mov stack[43] a1[0]</span><br><span class="line">157 mov a1[0] stack[12]</span><br><span class="line">163 xor a1[0] (a1[1]^0x17)</span><br><span class="line">164 mov stack[44] a1[0]</span><br></pre></td></tr></table></figure>

<p>这… 提取出enc 注意到a1[1]&#x3D;&#x3D;&#x3D;0 所以就一个xor 0x17…<br>得到flag<br><strong>FSCTF{Y0u successfu11y br0k3 my pr0t3ct10n!!!}</strong></p>
<h1 id="SWPU2019"><a href="#SWPU2019" class="headerlink" title="SWPU2019"></a>SWPU2019</h1><h2 id="EasiestRe"><a href="#EasiestRe" class="headerlink" title="EasiestRe"></a>EasiestRe</h2><p>参考资料:<br><a href="https://bbs.kanxue.com/thread-95082-1.htm" target="_blank">+</a><br><a href="https://www.nssctf.cn/note/set/2071" target="_blank">++</a><br><a href="https://blog.csdn.net/weixin_53349587/article/details/122279966" target="_blank">+++</a></p>
<p>第一次接触双进程保护的题<br>通过这道题学会了好多好多…</p>
<p>IDA打开 结合IsDebug…的判断 知道这是一道双进程保护的题目<br>通过判断是否处于调试状态来执行对应操作 这种加上异常处理就可以很好的混淆程序流</p>
<p>这题的子进程就是sub_403922<br>注意到主进程也就是main的这里:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt; <span class="number">35</span> &amp;&amp; (<span class="type">unsigned</span> __int8)Buffer[i] == <span class="number">144</span>; ++i )</span><br></pre></td></tr></table></figure>

<p>这里是在统计nop个数！<br>也就是根据子进程触发的__int3处的nop数来决定下步操作<br>有4,5,7,30 的情况<br>重点关注7,30 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    <span class="built_in">WriteProcessMemory</span>(ProcessInformation.hProcess, lpBaseAddress, v16, <span class="number">7u</span>, NumberOfBytesWritten);</span><br><span class="line">                    <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">7</span> )</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="built_in">ReadProcessMemory</span>(ProcessInformation.hProcess, lpBaseAddress, Buffer, <span class="number">7u</span>, NumberOfBytesRead);</span><br><span class="line">                      dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                  <span class="keyword">case</span> <span class="number">30</span>:</span><br><span class="line">                    <span class="built_in">WriteProcessMemory</span>(ProcessInformation.hProcess, lpBaseAddress, v15, <span class="number">0x1E</span>u, NumberOfBytesWritten);</span><br><span class="line">                    <span class="keyword">if</span> ( NumberOfBytesWritten[<span class="number">0</span>] == <span class="number">30</span> )</span><br><span class="line">                      dwContinueStatus = <span class="number">65538</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>这里对响应的nop点进行了代码的替换 从write&#x2F;read 操作内存以及v15,v16转成16进制就是响应操作码可知道</p>
<p>对应7的点在00408AF8处<br>ida_patch替换对应字节后反汇编得到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> <span class="title">sub_68A40</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v1[<span class="number">52</span>]; <span class="comment">// [esp+8h] [ebp-138h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2[<span class="number">10</span>]; <span class="comment">// [esp+D8h] [ebp-68h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">56</span>]; <span class="comment">// [esp+100h] [ebp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+138h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">j__memset</span>(Str, <span class="number">0</span>, <span class="number">0x32</span>u);</span><br><span class="line">  v2[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  v2[<span class="number">1</span>] = <span class="number">3</span>;</span><br><span class="line">  v2[<span class="number">2</span>] = <span class="number">7</span>;</span><br><span class="line">  v2[<span class="number">3</span>] = <span class="number">14</span>;</span><br><span class="line">  v2[<span class="number">4</span>] = <span class="number">30</span>;</span><br><span class="line">  v2[<span class="number">5</span>] = <span class="number">57</span>;</span><br><span class="line">  v2[<span class="number">6</span>] = <span class="number">120</span>;</span><br><span class="line">  v2[<span class="number">7</span>] = <span class="number">251</span>;</span><br><span class="line">  <span class="built_in">j__memset</span>(v1, <span class="number">0</span>, <span class="number">0xC8</span>u);</span><br><span class="line">  <span class="built_in">sub_61497</span>(<span class="string">&quot;Please Input Flag:\n&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_61956</span>(<span class="string">&quot;%s&quot;</span>, Str);</span><br><span class="line">  v4 = <span class="built_in">j__strlen</span>(Str);</span><br><span class="line">  <span class="keyword">if</span> ( v4 &gt;= <span class="number">24</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_6247D</span>(Str, (<span class="type">int</span>)v2, (<span class="type">int</span>)v1);           <span class="comment">// encrypt</span></span><br><span class="line">    <span class="built_in">sub_6384B</span>((<span class="type">int</span>)v1);                         <span class="comment">// check的上面的a3...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_61497</span>(<span class="string">&quot;you are too short!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Orphan comments:</span></span><br><span class="line"><span class="comment">强行debugbreak...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>在进入sub_6247D后可以找到sub_6460B中对应30nop处<br>同样处理后得到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> __cdecl <span class="title">sub_687E0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 i; <span class="comment">// [esp+3h] [ebp-9h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8u</span>; ++i )</span><br><span class="line">    *(_DWORD *)(a2 + <span class="number">4</span> * i) = <span class="number">41</span> * *(_DWORD *)(a1 + <span class="number">4</span> * i) % <span class="number">491u</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样分析就好分析多了<br>加密函数:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> __cdecl <span class="title">sub_68860</span><span class="params">(<span class="type">char</span> *Str, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// [esp+Fh] [ebp-4Dh]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+10h] [ebp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+10h] [ebp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+14h] [ebp-48h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v8; <span class="comment">// [esp+1Bh] [ebp-41h]</span></span><br><span class="line">  <span class="type">int</span> v9[<span class="number">4</span>]; <span class="comment">// [esp+20h] [ebp-3Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">9</span>]; <span class="comment">// [esp+30h] [ebp-2Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [esp+54h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v11 = <span class="number">0x1234</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v10, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">  v9[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  v9[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="built_in">j__strlen</span>(Str);</span><br><span class="line">  <span class="built_in">sub_6460B</span>(a2, (<span class="type">int</span>)v10);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v8; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i )</span><br><span class="line">      Str[i] ^= *(_BYTE *)(a3 + <span class="number">4</span> * i - <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      *Str ^= v11;</span><br><span class="line">    v4 = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">j__memset</span>(v9, <span class="number">0</span>, <span class="number">8u</span>);</span><br><span class="line">    __debugbreak();</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">8</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (v4 &amp; Str[i]) != <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        *((_BYTE *)v9 + j) = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)j &gt;= <span class="number">8</span> )</span><br><span class="line">          <span class="built_in">j____report_rangecheckfailure</span>();</span><br><span class="line">        *((_BYTE *)v9 + j) = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v4 *= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">8</span>; ++k )</span><br><span class="line">      *(_DWORD *)(a3 + <span class="number">4</span> * i) += v10[<span class="number">7</span> - k] * *((<span class="type">unsigned</span> __int8 *)v9 + k);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的a3初始为空 v10是传入的a2经过线性变换得到<br>流程就是xor后再poly转一下得到a3<br>结束enc后 进入下面的函数 需要在汇编代码中找到check点<br>在loc_6845A可以找到比对字符串 这里有个疑问 不知道为什么要从中间半截开始取…<br>理论可以怼那一大段汇编…<br>好吧 这里能看出来: 简单方法就是找cmp后的jz&#x2F;jnz</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov     eax, [ebp+var_20]</span><br><span class="line">mov     ecx, [ebp+var_28]</span><br><span class="line">mov     edx, [ebp+var_20]</span><br><span class="line">mov     eax, [ecx+eax*<span class="number">4</span>]</span><br><span class="line">cmp     eax, [ebp+edx*<span class="number">4</span>+var_124]</span><br><span class="line">jnz     <span class="type">short</span> loc_68657</span><br></pre></td></tr></table></figure>

<p>注意check的是a3的值<br>根据这个逻辑逆回去:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">v2 = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>,<span class="number">30</span>,<span class="number">57</span>,<span class="number">120</span>,<span class="number">251</span>]</span><br><span class="line">enc = [<span class="number">0x3d1</span>,<span class="number">0x2f0</span>,<span class="number">0x52</span>,<span class="number">0x475</span>,<span class="number">0x1d2</span>,<span class="number">0x2f0</span>,<span class="number">0x224</span>,<span class="number">0x51c</span>,<span class="number">0x4e6</span>,<span class="number">0x29f</span>,<span class="number">0x2ee</span>,<span class="number">0x39b</span>,<span class="number">0x3f9</span>,<span class="number">0x32b</span>,<span class="number">0x2f2</span>,<span class="number">0x5b5</span>,<span class="number">0x24c</span>,<span class="number">0x45a</span>,<span class="number">0x34c</span>,<span class="number">0x56d</span>,<span class="number">0x0a</span>,<span class="number">0x4e6</span>,<span class="number">0x476</span>,<span class="number">0x2d9</span>]</span><br><span class="line">v10 = [<span class="number">41</span>*x%<span class="number">491</span> <span class="keyword">for</span> x <span class="keyword">in</span> v2]</span><br><span class="line"></span><br><span class="line">a3 = [<span class="number">0</span>]*<span class="number">24</span></span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>&lt;&lt;<span class="number">9</span>):</span><br><span class="line">        s = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(s)&lt;<span class="number">8</span>):</span><br><span class="line">            s = <span class="string">&#x27;0&#x27;</span>*(<span class="number">8</span>-<span class="built_in">len</span>(s))+s</span><br><span class="line">        tot = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            tot += <span class="built_in">int</span>(s[j])*v10[j]</span><br><span class="line">        <span class="keyword">if</span>(tot==enc[i]):</span><br><span class="line">            flag.append(x)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>((flag[<span class="number">0</span>]^<span class="number">0x1234</span>)&amp;<span class="number">0xff</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>((flag[i]^enc[i-<span class="number">1</span>])&amp;<span class="number">0xff</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">## swpuctf&#123;y0u_@re_s0_coo1&#125;</span></span><br></pre></td></tr></table></figure>
<p>flag:<br><strong>swpuctf{y0u_@re_s0_coo1}</strong></p>
<hr>
<hr>
<p>题目本身不是重点 重要的是通过这道题逐步接触了解双进程&#x2F;int3等知识点!</p>
<h1 id="HGAME2023"><a href="#HGAME2023" class="headerlink" title="HGAME2023"></a>HGAME2023</h1><h2 id="week4-vm"><a href="#week4-vm" class="headerlink" title="week4 vm"></a>week4 vm</h2><p>又是vmopcode 这题在基础的opcode上加入了je&#x2F;jne&#x2F;cmp&#x2F;jmp的跳转<br>需要注意一个点: jmp跳转后pc不重置为opcode[pc+1] 我们是继续打印后面的指令<br>我们打印完bytecode自己分析时再考虑跳转</p>
<p>每个函数:<br>F0</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">F0</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v2; <span class="comment">// [rsp+0h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v2 = OPCODE[a1[<span class="number">6</span>] + <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> ( v2 )                                     <span class="comment">// a1[]当作寄存器</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( v2 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        INPUT[a1[<span class="number">2</span>]] = *a1;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        a1[OPCODE[a1[<span class="number">6</span>] + <span class="number">2</span>]] = a1[OPCODE[a1[<span class="number">6</span>] + <span class="number">3</span>]];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        a1[OPCODE[a1[<span class="number">6</span>] + <span class="number">2</span>]] = OPCODE[a1[<span class="number">6</span>] + <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *a1 = INPUT[a1[<span class="number">2</span>]];</span><br><span class="line">  &#125;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(a1[<span class="number">6</span>] + <span class="number">4</span>);</span><br><span class="line">  a1[<span class="number">6</span>] = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>F1:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">F1</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v2; <span class="comment">// [rsp+0h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v2 = OPCODE[a1[<span class="number">6</span>] + <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> ( v2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( v2 )                               <span class="comment">// 入栈</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        tmp[++a1[<span class="number">7</span>]] = *a1;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        tmp[++a1[<span class="number">7</span>]] = a1[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        tmp[++a1[<span class="number">7</span>]] = a1[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    tmp[++a1[<span class="number">7</span>]] = *a1;</span><br><span class="line">  &#125;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(a1[<span class="number">6</span>] + <span class="number">2</span>);</span><br><span class="line">  a1[<span class="number">6</span>] = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>F2:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">F2</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v2; <span class="comment">// [rsp+0h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v2 = OPCODE[a1[<span class="number">6</span>] + <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> ( v2 )                                     <span class="comment">// 出栈</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( v2 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">        a1[<span class="number">1</span>] = tmp[a1[<span class="number">7</span>]--];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">        a1[<span class="number">2</span>] = tmp[a1[<span class="number">7</span>]--];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">        a1[<span class="number">3</span>] = tmp[a1[<span class="number">7</span>]--];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *a1 = tmp[a1[<span class="number">7</span>]--];</span><br><span class="line">  &#125;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(a1[<span class="number">6</span>] + <span class="number">2</span>);</span><br><span class="line">  a1[<span class="number">6</span>] = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>F3:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_7FF7D1EE14D0</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">1</span>] )   <span class="comment">// 寄存器运算</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0u</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>]) += *(_DWORD *)(a1</span><br><span class="line">                                                                             + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">3</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>]) -= *(_DWORD *)(a1</span><br><span class="line">                                                                             + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">3</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>]) *= *(_DWORD *)(a1</span><br><span class="line">                                                                             + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">3</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>]) ^= *(_DWORD *)(a1</span><br><span class="line">                                                                             + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">3</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4u</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>]) &lt;&lt;= *(_DWORD *)(a1</span><br><span class="line">                                                                              + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">3</span>]);</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>]) &amp;= <span class="number">0xFF00</span>u;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5u</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>]) &gt;&gt;= *(_DWORD *)(a1</span><br><span class="line">                                                                              + <span class="number">4</span>i64 * OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">3</span>]);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">4</span>);</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">24</span>) = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>F4:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">F4</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)a1 == *(_DWORD *)(a1 + <span class="number">4</span>) )   <span class="comment">// reg0==reg1</span></span><br><span class="line">    *(_BYTE *)(a1 + <span class="number">32</span>) = <span class="number">0</span>;                    <span class="comment">// 比较位</span></span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)a1 != *(_DWORD *)(a1 + <span class="number">4</span>) )</span><br><span class="line">    *(_BYTE *)(a1 + <span class="number">32</span>) = <span class="number">1</span>;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)(*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">1</span>);</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">24</span>) = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>F5:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">F5</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">                                                <span class="comment">// pc = opcode[pc+1]</span></span><br><span class="line">  result = OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">1</span>];</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">24</span>) = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>F6:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">F6</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( *(_BYTE *)(a1 + <span class="number">32</span>) )                    <span class="comment">// 比较位是1： 不相等 不跳转</span></span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">else</span>                                          <span class="comment">// 相等 跳转</span></span><br><span class="line">    result = OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">1</span>];</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">24</span>) = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>F7:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">F7</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( *(_BYTE *)(a1 + <span class="number">32</span>) )                    <span class="comment">// 不相等 跳转</span></span><br><span class="line">    result = OPCODE[*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(*(_DWORD *)(a1 + <span class="number">24</span>) + <span class="number">2</span>);</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">24</span>) = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印bytecode:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">opcode = [<span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x32</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x64</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x28</span>, <span class="number">0x04</span>, <span class="number">0x06</span>, <span class="number">0x5F</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x96</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x07</span>, <span class="number">0x88</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x28</span>, <span class="number">0x04</span>, <span class="number">0x07</span>, <span class="number">0x63</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>]</span><br><span class="line"></span><br><span class="line">pc = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> opcode[pc] != <span class="number">0xFF</span>:</span><br><span class="line">    op = opcode[pc]</span><br><span class="line">    <span class="keyword">if</span>(op==<span class="number">0</span>):</span><br><span class="line">        v2 = opcode[pc+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span>(v2):</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">1</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    mov input[reg2] reg0&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">2</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    mov reg<span class="subst">&#123;opcode[pc+<span class="number">2</span>]&#125;</span> reg<span class="subst">&#123;opcode[pc+<span class="number">3</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">3</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    mov reg<span class="subst">&#123;opcode[pc+<span class="number">2</span>]&#125;</span> <span class="subst">&#123;opcode[pc+<span class="number">3</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    mov reg0 input[reg2]&quot;</span>)</span><br><span class="line">        pc += <span class="number">4</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span>(op==<span class="number">1</span>):</span><br><span class="line">        v2 = opcode[pc+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span>(v2):</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">1</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    push reg0&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">2</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    push reg2&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">3</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    push reg3&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    push reg0&quot;</span>)</span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span>(op==<span class="number">2</span>):</span><br><span class="line">        v2 = opcode[pc+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span>(v2):</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">1</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    pop reg1&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">2</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    pop reg2&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span>(v2==<span class="number">3</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    pop reg3&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    pop reg0&quot;</span>)</span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span>(op==<span class="number">3</span>):</span><br><span class="line">        v1 = opcode[pc+<span class="number">1</span>]</span><br><span class="line">        v2 = opcode[pc+<span class="number">2</span>]</span><br><span class="line">        v3 = opcode[pc+<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span>(v1==<span class="number">0</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    add reg<span class="subst">&#123;v2&#125;</span> reg<span class="subst">&#123;v3&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(v1==<span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    sub reg<span class="subst">&#123;v2&#125;</span> reg<span class="subst">&#123;v3&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(v1==<span class="number">2</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    mul reg<span class="subst">&#123;v2&#125;</span> reg<span class="subst">&#123;v3&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(v1==<span class="number">3</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    xor reg<span class="subst">&#123;v2&#125;</span> reg<span class="subst">&#123;v3&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(v1==<span class="number">4</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    shl reg<span class="subst">&#123;v2&#125;</span> reg<span class="subst">&#123;v3&#125;</span>\n      and reg<span class="subst">&#123;v2&#125;</span> 0xFF00u&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(v1==<span class="number">5</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    shr reg<span class="subst">&#123;v2&#125;</span> reg<span class="subst">&#123;v3&#125;</span>&quot;</span>)</span><br><span class="line">        pc += <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span>(op==<span class="number">4</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    cmp reg0 reg1&quot;</span>)</span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span>(op==<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    jmp <span class="subst">&#123;opcode[pc+<span class="number">1</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># pc = opcode[pc+1]</span></span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span>(op==<span class="number">6</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    je <span class="subst">&#123;opcode[pc+<span class="number">1</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span>(op==<span class="number">7</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;pc&#125;</span>    jne <span class="subst">&#123;opcode[pc+<span class="number">1</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打印出来是这个样子:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>    mov reg2 <span class="number">0</span></span><br><span class="line"><span class="number">4</span>    add reg2 reg3</span><br><span class="line"><span class="number">8</span>    mov reg0 input[reg2]</span><br><span class="line"><span class="number">12</span>    mov reg1 reg0</span><br><span class="line"><span class="number">16</span>    mov reg2 <span class="number">50</span></span><br><span class="line"><span class="number">20</span>    add reg2 reg3</span><br><span class="line"><span class="number">24</span>    mov reg0 input[reg2]</span><br><span class="line"><span class="number">28</span>    add reg1 reg0</span><br><span class="line"><span class="number">32</span>    mov reg2 <span class="number">100</span></span><br><span class="line"><span class="number">36</span>    add reg2 reg3</span><br><span class="line"><span class="number">40</span>    mov reg0 input[reg2]</span><br><span class="line"><span class="number">44</span>    <span class="keyword">xor</span> reg1 reg0</span><br><span class="line"><span class="number">48</span>    mov reg0 <span class="number">8</span></span><br><span class="line"><span class="number">52</span>    mov reg2 reg1</span><br><span class="line"><span class="number">56</span>    shl reg1 reg0</span><br><span class="line">      <span class="keyword">and</span> reg1 <span class="number">0xFF00</span>u</span><br><span class="line"><span class="number">60</span>    shr reg2 reg0</span><br><span class="line"><span class="number">64</span>    add reg1 reg2</span><br><span class="line"><span class="number">68</span>    mov reg0 reg1</span><br><span class="line"><span class="number">72</span>    push reg0</span><br><span class="line"><span class="number">74</span>    mov reg0 <span class="number">1</span></span><br><span class="line"><span class="number">78</span>    add reg3 reg0</span><br><span class="line"><span class="number">82</span>    mov reg0 reg3</span><br><span class="line"><span class="number">86</span>    mov reg1 <span class="number">40</span></span><br><span class="line"><span class="number">90</span>    cmp reg0 reg1</span><br><span class="line"><span class="number">91</span>    je <span class="number">95</span></span><br><span class="line"><span class="number">93</span>    jmp <span class="number">0</span></span><br><span class="line"><span class="number">95</span>    mov reg3 <span class="number">0</span></span><br><span class="line"><span class="number">99</span>    pop reg1</span><br><span class="line"><span class="number">101</span>    mov reg2 <span class="number">150</span></span><br><span class="line"><span class="number">105</span>    add reg2 reg3</span><br><span class="line"><span class="number">109</span>    mov reg0 input[reg2]</span><br><span class="line"><span class="number">113</span>    cmp reg0 reg1</span><br><span class="line"><span class="number">114</span>    jne <span class="number">136</span></span><br><span class="line"><span class="number">116</span>    mov reg0 <span class="number">1</span></span><br><span class="line"><span class="number">120</span>    add reg3 reg0</span><br><span class="line"><span class="number">124</span>    mov reg0 reg3</span><br><span class="line"><span class="number">128</span>    mov reg1 <span class="number">40</span></span><br><span class="line"><span class="number">132</span>    cmp reg0 reg1</span><br><span class="line"><span class="number">133</span>    jne <span class="number">99</span></span><br></pre></td></tr></table></figure>

<p>然后就慢慢手撕汇编吧<br>分析如下:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个loop 0~93 循环40次</span></span><br><span class="line"><span class="number">0</span>     mov reg2 <span class="number">0</span></span><br><span class="line"><span class="number">4</span>     add reg2 reg3</span><br><span class="line"><span class="number">8</span>     mov reg0 input[reg2]</span><br><span class="line"><span class="number">12</span>    mov reg1 reg0</span><br><span class="line"><span class="comment">// reg1 = input[i]</span></span><br><span class="line"><span class="number">16</span>    mov reg2 <span class="number">50</span></span><br><span class="line"><span class="number">20</span>    add reg2 reg3</span><br><span class="line"><span class="comment">// reg2 = 50+i</span></span><br><span class="line"><span class="number">24</span>    mov reg0 input[reg2]</span><br><span class="line"><span class="number">28</span>    add reg1 reg0</span><br><span class="line"><span class="comment">// reg1 += input[50+i]</span></span><br><span class="line"><span class="number">32</span>    mov reg2 <span class="number">100</span></span><br><span class="line"><span class="number">36</span>    add reg2 reg3</span><br><span class="line"><span class="number">40</span>    mov reg0 input[reg2]</span><br><span class="line"><span class="comment">// reg0 = input[100+i]</span></span><br><span class="line"><span class="number">44</span>    <span class="keyword">xor</span> reg1 reg0</span><br><span class="line"><span class="comment">// reg1 ^= reg0</span></span><br><span class="line"><span class="comment">// reg1 = (input[i]+input[50+i])^input[100+i]</span></span><br><span class="line"><span class="comment">// 注意到原本的Input不止40个数据 所以只有前40个是被输入覆盖 后面还是有数据的</span></span><br><span class="line"><span class="number">48</span>    mov reg0 <span class="number">8</span></span><br><span class="line"><span class="number">52</span>    mov reg2 reg1</span><br><span class="line"><span class="number">56</span>    shl reg1 reg0</span><br><span class="line">      <span class="keyword">and</span> reg1 <span class="number">0xFF00</span>u</span><br><span class="line"><span class="number">60</span>    shr reg2 reg0</span><br><span class="line"><span class="number">64</span>    add reg1 reg2</span><br><span class="line"><span class="number">68</span>    mov reg0 reg1</span><br><span class="line"><span class="number">72</span>    push reg0</span><br><span class="line"><span class="comment">// reg0 = (reg1&lt;&lt;8)&amp;0xFF00 + reg1&gt;&gt;8</span></span><br><span class="line"><span class="comment">// 其实就是reg1的高低位互换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里是一个ecx的check 相当于reg0++ 然后cmp reg0 40 达到循环次数就跳出</span></span><br><span class="line"><span class="comment">// reg0++;reg3++;cmp reg0 40;</span></span><br><span class="line"><span class="number">74</span>    mov reg0 <span class="number">1</span></span><br><span class="line"><span class="number">78</span>    add reg3 reg0</span><br><span class="line"><span class="number">82</span>    mov reg0 reg3</span><br><span class="line"><span class="number">86</span>    mov reg1 <span class="number">40</span></span><br><span class="line"><span class="number">90</span>    cmp reg0 reg1</span><br><span class="line"><span class="number">91</span>    je <span class="number">95</span></span><br><span class="line"><span class="number">93</span>    jmp <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环check</span></span><br><span class="line"><span class="number">95</span>    mov reg3 <span class="number">0</span></span><br><span class="line"><span class="comment">// loop:99~133</span></span><br><span class="line"><span class="comment">//这段check是将上面运算保存在tmp栈中的数据取出来与input[]做比较check</span></span><br><span class="line"><span class="comment">// tmp[]数组是逆序取 Input[]是正序取</span></span><br><span class="line"><span class="number">99</span>    pop reg1</span><br><span class="line"><span class="number">101</span>   mov reg2 <span class="number">150</span></span><br><span class="line"><span class="number">105</span>   add reg2 reg3</span><br><span class="line"><span class="number">109</span>   mov reg0 input[reg2]</span><br><span class="line"><span class="number">113</span>   cmp reg0 reg1</span><br><span class="line"><span class="comment">// reg0 = input[150+i]</span></span><br><span class="line"><span class="number">114</span>   jne <span class="number">136</span>   <span class="comment">// Fail</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reg3++;reg0++;cmp reg0 40;</span></span><br><span class="line"></span><br><span class="line"><span class="number">116</span>   mov reg0 <span class="number">1</span></span><br><span class="line"><span class="number">120</span>   add reg3 reg0</span><br><span class="line"><span class="number">124</span>   mov reg0 reg3</span><br><span class="line"><span class="number">128</span>   mov reg1 <span class="number">40</span></span><br><span class="line"><span class="number">132</span>   cmp reg0 reg1</span><br><span class="line"><span class="number">133</span>   jne <span class="number">99</span></span><br></pre></td></tr></table></figure>

<p>注意到初始的input数组有200个 前40用来getchar 后面的用来check和进行运算<br>所以提取出[-50:-10] 逆序后逆回去即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x0000009B</span>, <span class="number">0x000000A8</span>, <span class="number">0x00000002</span>, <span class="number">0x000000BC</span>, <span class="number">0x000000AC</span>, <span class="number">0x0000009C</span>, <span class="number">0x000000CE</span>, <span class="number">0x000000FA</span>, <span class="number">0x00000002</span>, <span class="number">0x000000B9</span>, <span class="number">0x000000FF</span>, <span class="number">0x0000003A</span>, <span class="number">0x00000074</span>, <span class="number">0x00000048</span>, <span class="number">0x00000019</span>, <span class="number">0x00000069</span>, <span class="number">0x000000E8</span>, <span class="number">0x00000003</span>, <span class="number">0x000000CB</span>, <span class="number">0x000000C9</span>, <span class="number">0x000000FF</span>, <span class="number">0x000000FC</span>, <span class="number">0x00000080</span>, <span class="number">0x000000D6</span>, <span class="number">0x0000008D</span>, <span class="number">0x000000D7</span>, <span class="number">0x00000072</span>, <span class="number">0x00000000</span>, <span class="number">0x000000A7</span>, <span class="number">0x0000001D</span>, <span class="number">0x0000003D</span>, <span class="number">0x00000099</span>, <span class="number">0x00000088</span>, <span class="number">0x00000099</span>, <span class="number">0x000000BF</span>, <span class="number">0x000000E8</span>, <span class="number">0x00000096</span>, <span class="number">0x0000002E</span>, <span class="number">0x0000005D</span>, <span class="number">0x00000057</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x000000C9</span>, <span class="number">0x000000A9</span>, <span class="number">0x000000BD</span>, <span class="number">0x0000008B</span>, <span class="number">0x00000017</span>, <span class="number">0x000000C2</span>, <span class="number">0x0000006E</span>, <span class="number">0x000000F8</span>, <span class="number">0x000000F5</span>, <span class="number">0x0000006E</span>, <span class="number">0x00000063</span>, <span class="number">0x00000063</span>, <span class="number">0x000000D5</span>, <span class="number">0x00000046</span>, <span class="number">0x0000005D</span>, <span class="number">0x00000016</span>, <span class="number">0x00000098</span>, <span class="number">0x00000038</span>, <span class="number">0x00000030</span>, <span class="number">0x00000073</span>, <span class="number">0x00000038</span>, <span class="number">0x000000C1</span>, <span class="number">0x0000005E</span>, <span class="number">0x000000ED</span>, <span class="number">0x000000B0</span>, <span class="number">0x00000029</span>, <span class="number">0x0000005A</span>, <span class="number">0x00000018</span>, <span class="number">0x00000040</span>, <span class="number">0x000000A7</span>, <span class="number">0x000000FD</span>, <span class="number">0x0000000A</span>, <span class="number">0x0000001E</span>, <span class="number">0x00000078</span>, <span class="number">0x0000008B</span>, <span class="number">0x00000062</span>, <span class="number">0x000000DB</span>, <span class="number">0x0000000F</span>, <span class="number">0x0000008F</span>, <span class="number">0x0000009C</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00004800</span>, <span class="number">0x0000F100</span>, <span class="number">0x00004000</span>, <span class="number">0x00002100</span>, <span class="number">0x00003501</span>, <span class="number">0x00006400</span>, <span class="number">0x00007801</span>, <span class="number">0x0000F900</span>, <span class="number">0x00001801</span>, <span class="number">0x00005200</span>, <span class="number">0x00002500</span>, <span class="number">0x00005D01</span>, <span class="number">0x00004700</span>, <span class="number">0x0000FD00</span>, <span class="number">0x00006901</span>, <span class="number">0x00005C00</span>, <span class="number">0x0000AF01</span>, <span class="number">0x0000B200</span>, <span class="number">0x0000EC01</span>, <span class="number">0x00005201</span>, <span class="number">0x00004F01</span>, <span class="number">0x00001A01</span>, <span class="number">0x00005000</span>, <span class="number">0x00008501</span>, <span class="number">0x0000CD00</span>, <span class="number">0x00002300</span>, <span class="number">0x0000F800</span>, <span class="number">0x00000C00</span>, <span class="number">0x0000CF00</span>, <span class="number">0x00003D01</span>, <span class="number">0x00004501</span>, <span class="number">0x00008200</span>, <span class="number">0x0000D201</span>, <span class="number">0x00002901</span>, <span class="number">0x0000D501</span>, <span class="number">0x00000601</span>, <span class="number">0x0000A201</span>, <span class="number">0x0000DE00</span>, <span class="number">0x0000A601</span>, <span class="number">0x0000CA01</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>]</span><br><span class="line">tmp = enc[-<span class="number">50</span>:-<span class="number">10</span>]</span><br><span class="line">tmp = tmp[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    x = ((tmp[i]&lt;&lt;<span class="number">8</span>)&amp;<span class="number">0xFF00</span>)+(tmp[i]&gt;&gt;<span class="number">8</span>)</span><br><span class="line">    x ^= enc[<span class="number">100</span>+i]</span><br><span class="line">    x -= enc[<span class="number">50</span>+i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(x),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># hgame&#123;y0ur_rever5e_sk1ll_i5_very_g0od!!&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>hgame{y0ur_rever5e_sk1ll_i5_very_g0od!!}</strong></p>
<hr>
<hr>
<p>总结: 重点在于jmp&#x2F;jne&#x2F;je时我们的pc是要继续跟着+2的 而不是直接跳转到opcode[pc+1]的地址<br>准确来说应该不能命名为pc 看成eip更妥当<br>pc是指令地址 在opcode执行时是跟着跳转的  eip储存的是当前语句的位置 是顺序走的<br>所以应该把打印opcode的pc全部换成eip才符合原理</p>
<p>然后就是手撕汇编的时候要注意到初始数组的多重功能</p>
<p>vm+opcode确实很好玩(也很累…) 做这种可以很好地<del>复习计组</del>理解原理&#x2F;提升逆向基本功&#x2F;<del>锻炼耐心</del></p>
<h1 id="红帽杯2019"><a href="#红帽杯2019" class="headerlink" title="红帽杯2019"></a>红帽杯2019</h1><h2 id="xx"><a href="#xx" class="headerlink" title="xx"></a>xx</h2><p>几个月前做第一段都没看懂 那段循环增加的xor也没看懂<br>现在再来看就好多了</p>
<p>IDA打开<br>开始有一个len&#x3D;19的check<br>后面有个奇怪的Code:qwertyuiopasdfghjklzxcvbnm1234567890<br>然而逆向时并没有发现有啥用…<br>关键点:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line"> &#123;</span><br><span class="line">   v10 = *((_BYTE *)v9 + (<span class="type">char</span> *)INPUT - (<span class="type">char</span> *)v5);</span><br><span class="line">   v11 = <span class="number">0</span>;</span><br><span class="line">   *(_BYTE *)v9 = v10;</span><br><span class="line">   v12 = <span class="number">0</span>i64;</span><br><span class="line">   v13 = <span class="number">-1</span>i64;</span><br><span class="line">   <span class="keyword">do</span></span><br><span class="line">     ++v13;</span><br><span class="line">   <span class="keyword">while</span> ( *(_BYTE *)(v6 + v13) );</span><br><span class="line">   <span class="keyword">if</span> ( v13 )</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">do</span></span><br><span class="line">     &#123;</span><br><span class="line">       <span class="keyword">if</span> ( v10 == *(_BYTE *)(v6 + v12) )      <span class="comment">// find index???</span></span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       ++v11;</span><br><span class="line">       ++v12;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">while</span> ( v11 &lt; v13 );</span><br><span class="line">   &#125;</span><br><span class="line">   v14 = <span class="number">-1</span>i64;</span><br><span class="line">   <span class="keyword">do</span></span><br><span class="line">     ++v14;</span><br><span class="line">   <span class="keyword">while</span> ( *(_BYTE *)(v6 + v14) );</span><br><span class="line">   <span class="keyword">if</span> ( v11 == v14 )</span><br><span class="line">     _exit(v6);</span><br><span class="line">   v9 = (__int128 *)((<span class="type">char</span> *)v9 + <span class="number">1</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">while</span> ( (<span class="type">char</span> *)v9 - (<span class="type">char</span> *)v5 &lt; <span class="number">4</span> );        <span class="comment">// &lt;4 ==&gt; 取前4位作为xxtea的key</span></span><br></pre></td></tr></table></figure>

<p>这里结合动调可以知道后面xxtea的key就是取的input的前4位<br>xxtea</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v17 = <span class="built_in">XXTEA</span>((__int64)INPUT, v3, (<span class="type">unsigned</span> __int8 *)&amp;KEY, &amp;Size);<span class="comment">// KEY: INPUT的前四个字母 盲猜flag?</span></span><br></pre></td></tr></table></figure>

<p>这里就猜flag吧<br>再后面有个对xxtea加密的input数组的换序<br>换序完了就是一段两个月前没看明白的xor</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( v20[<span class="number">23</span>] = enc_input1[<span class="number">21</span>]; v21 &lt; v18; ++v22 )</span><br><span class="line">  &#123;</span><br><span class="line">    v23 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">if</span> ( v21 / <span class="number">3</span> &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v24 = *v22;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v24 ^= v20[v23++];</span><br><span class="line">        *v22 = v24;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v23 &lt; v21 / <span class="number">3</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    ++v21;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这个逆向就这么写:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//decrypt</span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> v21:1-&gt;23</span></span><br><span class="line"><span class="comment"> 从v21=3开始</span></span><br><span class="line"><span class="comment"> v23:0-&gt;(v21//3)-1</span></span><br><span class="line"><span class="comment">     v20[v22] ^= v20[v23]</span></span><br><span class="line"><span class="comment"> v21==v22 同步</span></span><br><span class="line"><span class="comment"> 前面先改变会影响后面xor的值 所以倒序逆向</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">23</span>;i++)&#123;</span><br><span class="line">     <span class="type">int</span> v23 = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">if</span>(i/<span class="number">3</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">         <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;(i/<span class="number">3</span>);j++)&#123;</span><br><span class="line">             enc[i] ^= enc[j];</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>这步逆回去后换个序得到:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">206</span>,<span class="number">188</span>,<span class="number">64</span>,<span class="number">165</span>,<span class="number">178</span>,<span class="number">244</span>,<span class="number">231</span>,<span class="number">178</span>,<span class="number">157</span>,<span class="number">169</span>,<span class="number">18</span>,<span class="number">18</span>,<span class="number">200</span>,<span class="number">174</span>,<span class="number">91</span>,<span class="number">16</span>,<span class="number">6</span>,<span class="number">61</span>,<span class="number">29</span>,<span class="number">215</span>,<span class="number">248</span>,<span class="number">220</span>,<span class="number">220</span>,<span class="number">112</span>]</span><br></pre></td></tr></table></figure>

<p>然后小端序取一下:<br>得到:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x40cea5bc</span>,<span class="number">0xe7b2b2f4</span>,<span class="number">0x129d12a9</span>,<span class="number">0x5bc810ae</span>,<span class="number">0x1d6d73d</span>,<span class="number">0xdcf870dc</span></span><br></pre></td></tr></table></figure>

<p>这里python莫名其妙的坑了我半天… 以后数组赋初值的时候赋[0]*xxx 最好别直接 enc2&#x3D;enc …<br>莫名其妙调试了好久<br>然后key是flag<br>这里不是很清楚是小端序拆成字节还是其他组合 动调跟进xxtea<br>发现开头做了一系列字节拼接操作<br>又注意到在主加密部分<br>v18[]的类型是DWORD 所以key数组(一个小坑):</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]= &#123;<span class="number">0x67616c66</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>解xxtea 稍稍改下位移常数<br>最后解出flag<br><strong>flag{CXX_and_++tea}</strong></p>
<hr>
<hr>
<p>其实从这里也看得出来key:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = v15 + <span class="number">1</span>; i &lt; <span class="number">0x10</span>; ++i )</span><br><span class="line">  *((_BYTE *)&amp;KEY + i) = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>做的时候还有一个比较疑惑的点<br>输入的是19个字符 但是最后加密却是6组DWORD<br>xxtea解密发现是将0 19 0 0 0 接在后面一起加密的<br>也就是将SIZE也作为了加密的一部分?<br>那么是在程序的哪个地方实现的呢？<br>以后有空&#x2F;感兴趣时再来看吧 火车上不是很想逆了(头晕…)</p>
<h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>代码分析太长了…<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/U-L-G-A-N-O-Y/articles/-/NOZOMIZO">here~</a></p>
<h1 id="CISCN-2022-东北"><a href="#CISCN-2022-东北" class="headerlink" title="CISCN 2022 东北"></a>CISCN 2022 东北</h1><h2 id="hana"><a href="#hana" class="headerlink" title="hana"></a>hana</h2><p>易语言…<br>在NCTF2023初次接触易语言的题目 完全不会… 这p语言写的是真抽象<br>在了解了一点点易语言的逆向知识后 再来看看这道</p>
<p>这题甚至还是在mfc上加上易语言 真的难看啊…<br>main</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __stdcall <span class="title">sub_476208</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3, <span class="type">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">CWinThread</span> *Thread; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">-1</span>;</span><br><span class="line">  Thread = <span class="built_in">AfxGetThread</span>();</span><br><span class="line">  v6 = *((_DWORD *)<span class="built_in">AfxGetModuleState</span>() + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">sub_47A455</span>(a1, a2, a3, a4) &amp;&amp; (!v6 || (*(<span class="built_in">int</span> (__thiscall **)(<span class="type">int</span>))(*(_DWORD *)v6 + <span class="number">132</span>))(v6)) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (*(<span class="built_in">int</span> (__thiscall **)(<span class="keyword">struct</span> CWinThread *))(*(_DWORD *)Thread + <span class="number">80</span>))(Thread) )<span class="comment">// INPUT AND CHECK</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = (*(<span class="built_in">int</span> (__thiscall **)(<span class="keyword">struct</span> CWinThread *))(*(_DWORD *)Thread + <span class="number">84</span>))(Thread);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 = *((_DWORD *)Thread + <span class="number">7</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v7 )</span><br><span class="line">        (*(<span class="built_in">void</span> (__thiscall **)(<span class="type">int</span>))(*(_DWORD *)v7 + <span class="number">88</span>))(v7);</span><br><span class="line">      v8 = (*(<span class="built_in">int</span> (__thiscall **)(<span class="keyword">struct</span> CWinThread *))(*(_DWORD *)Thread + <span class="number">104</span>))(Thread);</span><br><span class="line">    &#125;</span><br><span class="line">    v4 = v8;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">AfxWinTerm</span>();</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动调可以找到输入和check点<br>找到这个函数(需要p一下 开始IDA没有识别)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_4010B0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  lpMem = (<span class="type">void</span> *)((<span class="type">void</span> *(*)(<span class="type">int</span>, ...))sub_401446)(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  v0 = lpMem;</span><br><span class="line">  <span class="keyword">if</span> ( !lpMem )</span><br><span class="line">    v0 = &amp;unk_48049C;</span><br><span class="line">  <span class="keyword">if</span> ( ((_DWORD (*)(<span class="type">int</span>, ...))sub_401446)(<span class="number">1</span>, v0, <span class="number">0</span>, <span class="number">0x80000004</span>) == <span class="number">38</span> )<span class="comment">// len=38?</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = lpMem;</span><br><span class="line">    <span class="keyword">if</span> ( !lpMem )</span><br><span class="line">      v1 = &amp;unk_48049C;</span><br><span class="line">    v12 = (<span class="type">void</span> *)((<span class="type">void</span> *(*)(<span class="type">int</span>, ...))sub_401446)(<span class="number">1</span>, v1, <span class="number">0</span>, <span class="number">0x80000004</span>);</span><br><span class="line">    v2 = (<span class="type">void</span> *)((<span class="type">void</span> *(*)(<span class="type">int</span>, ...))sub_40144C)(<span class="number">1</span>, &amp;unk_48049D, <span class="number">0</span>, <span class="number">0x80000005</span>);</span><br><span class="line">    v10 = v2;</span><br><span class="line">    <span class="keyword">if</span> ( !v2 )</span><br><span class="line">      v2 = &amp;unk_4804BB;</span><br><span class="line">    v9 = (<span class="type">void</span> *)((<span class="type">void</span> *(*)(<span class="type">int</span>, ...))sub_401446)(<span class="number">1</span>, v2, <span class="number">0</span>, <span class="number">0x80000005</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v10 )</span><br><span class="line">      <span class="built_in">sub_401440</span>(v10);</span><br><span class="line">    v3 = v9;</span><br><span class="line">    <span class="keyword">if</span> ( !v9 )</span><br><span class="line">      v3 = &amp;unk_48049C;</span><br><span class="line">    v8 = v3;</span><br><span class="line">    v4 = v12;</span><br><span class="line">    <span class="keyword">if</span> ( !v12 )</span><br><span class="line">      v4 = &amp;unk_4804BB;</span><br><span class="line">    ((<span class="built_in">void</span> (*)(<span class="type">int</span>, ...))sub_40144C)(<span class="number">3</span>, v4, <span class="number">0</span>, <span class="number">0x80000005</span>, v8, <span class="number">0</span>, <span class="number">0x80000004</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0x80000301</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v12 )</span><br><span class="line">      <span class="built_in">sub_401440</span>(v12);</span><br><span class="line">    <span class="keyword">if</span> ( v9 )</span><br><span class="line">      <span class="built_in">sub_401440</span>(v9);</span><br><span class="line">    <span class="built_in">JUMPOUT</span>(<span class="number">0x40122D</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = (<span class="type">void</span> *)((<span class="type">void</span> *(*)(<span class="type">int</span>, ...))sub_40144C)(<span class="number">1</span>, &amp;unk_48049D, <span class="number">0</span>, <span class="number">0x80000005</span>);</span><br><span class="line">  v5 = v13;</span><br><span class="line">  <span class="keyword">if</span> ( !v13 )</span><br><span class="line">    v5 = &amp;unk_4804BB;</span><br><span class="line">  v11 = (<span class="type">void</span> *)((<span class="type">void</span> *(*)(<span class="type">int</span>, ...))sub_401446)(<span class="number">1</span>, v5, <span class="number">0</span>, <span class="number">0x80000005</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v13 )</span><br><span class="line">    <span class="built_in">sub_401440</span>(v13);</span><br><span class="line">  v6 = v11;</span><br><span class="line">  <span class="keyword">if</span> ( !v11 )</span><br><span class="line">    v6 = &amp;unk_48049C;</span><br><span class="line">  ((<span class="built_in">void</span> (*)(<span class="type">int</span>, ...))sub_401446)(<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, v6, <span class="number">0</span>, <span class="number">0x80000004</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v11 )</span><br><span class="line">    <span class="built_in">sub_401440</span>(v11);</span><br><span class="line">  <span class="keyword">if</span> ( lpMem )</span><br><span class="line">    <span class="built_in">sub_401440</span>(lpMem);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动调+静态瞎搞一通<br>sub_401446发现是类似回调函数这种<br>然后学到了一个点: 在汇编中看可以看到回调的函数!<br>以len&#x3D;38那儿为例:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00401110</span>                 push    eax</span><br><span class="line">.text:<span class="number">00401111</span>                 push    <span class="number">1</span></span><br><span class="line">.text:<span class="number">00401116</span>                 mov     ebx, offset sub_401590</span><br><span class="line">.text:<span class="number">0040111B</span>                 call    sub_401446</span><br><span class="line">.text:<span class="number">00401120</span>                 add     esp, <span class="number">10</span>h</span><br><span class="line">.text:<span class="number">00401123</span>                 mov     [ebp+var_C], eax</span><br><span class="line">.text:<span class="number">00401126</span>                 jmp     <span class="type">short</span> loc_401129</span><br></pre></td></tr></table></figure>

<p>汇编中可以看到 mov     ebx, offset sub_401590<br>这个sub_401590就是gets和strlen!<br>有些师傅的IDA给显示出来了 我的是没显示的 但也不是很影响</p>
<p>虽然但是 这IDA好多识别不对啊…<br>能找到enc点 在这里</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sub_40144C</span>(<span class="number">3</span>, (<span class="type">char</span>)v3, <span class="number">0</span>, <span class="number">0x80000005</span>, v7, <span class="number">0</span>, <span class="number">0x80000004</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0x80000301</span>);<span class="comment">// enc</span></span><br></pre></td></tr></table></figure>

<p>跟进查看</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v6 != <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">sub_45A100</span>(a2[<span class="number">3</span>], <span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span> *)a2[<span class="number">3</span>]), RC4_KEY);<span class="comment">// RC4预处理</span></span><br><span class="line">  v7 = <span class="built_in">malloc</span>(v5);</span><br><span class="line">  v13 = v7;</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">qmemcpy</span>(v7, v4, v5);</span><br><span class="line">    v12 = v5;</span><br><span class="line">    <span class="built_in">sub_45A1D0</span>((<span class="type">int</span>)v7, v5, (<span class="type">int</span>)RC4_KEY);    <span class="comment">// 类RC4</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就是个RC4 预处理可以直接动调提取出表<br>关键在于找到加密后的check点！<br>真没找到…<br>看网上唯一一篇wp也没复现成功<br>就先借数据吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enc = [0x56, 0xEC,</span><br><span class="line">	0xA0, 0xDC, 0x57, 0x07, 0xF4, 0xA3, 0xE9, 0x77, 0xBF, 0x93,</span><br><span class="line">	0xBC, 0x86, 0x52, 0xA5, 0x14, 0x6A, 0xA5, 0xBD, 0xB5, 0xD2,</span><br><span class="line">	0x7F, 0x0B, 0x9B, 0x67, 0x1D, 0x08, 0xEF, 0xC9, 0x32, 0x5D,</span><br><span class="line">	0x43, 0xED, 0x1E, 0x01, 0x4B, 0x7B]</span><br></pre></td></tr></table></figure>

<p>最后解出<br><strong>flag{08360c3f9f994e199427d9c7ed14ef23}</strong></p>
<hr>
<hr>
<p>IDA瞎翻还真能翻到…<br>unk_4804C3处就是enc数组</p>
<p>交叉引用找到唯一一处</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00401249</span></span><br><span class="line">.text:<span class="number">00401249</span> loc_401249:                             ; CODE XREF: sub_4010B0+<span class="number">196</span>↑j</span><br><span class="line">.text:<span class="number">00401249</span>                 mov     eax, offset unk_4804C3</span><br><span class="line">.text:<span class="number">0040124</span>E                 <span class="keyword">xor</span>     ecx, ecx</span><br><span class="line">.text:<span class="number">00401250</span>                 test    eax, eax</span><br><span class="line">.text:<span class="number">00401252</span>                 jz      <span class="type">short</span> loc_401257</span><br><span class="line">.text:<span class="number">00401254</span>                 mov     ecx, [eax+<span class="number">4</span>]</span><br></pre></td></tr></table></figure>

<p>但这前后也看不出任何check的逻辑啊…<br>日后再来逆吧…</p>
<h1 id="西湖论剑2022"><a href="#西湖论剑2022" class="headerlink" title="西湖论剑2022"></a>西湖论剑2022</h1><h2 id="EasyVT"><a href="#EasyVT" class="headerlink" title="EasyVT"></a>EasyVT</h2><a href="/VT%E5%A4%84%E7%90%86%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/" title="VT处理器虚拟化技术学习">VT</a>

<h2 id="babyRe"><a href="#babyRe" class="headerlink" title="babyRe"></a>babyRe</h2><p>考点:<br>IAT表hook + sha1 + base8 + RC4</p>
<p>学习:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://equinox-shame.github.io/2023/03/01/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%20BabyRe%20%E5%A4%8D%E7%8E%B0/#">+</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ctfiot.com/97742.html">++</a></li>
</ul>
<p>开局一个奇奇怪怪的main 只调用了一个GetLastError<br>翻string跟踪input 能找到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rdata:<span class="number">00406164</span>                 dd offset sub_401000</span><br><span class="line">.rdata:<span class="number">00406168</span>                 dd offset sub_401050</span><br><span class="line">.rdata:<span class="number">0040616</span>C                 dd offset sub_4010A0</span><br></pre></td></tr></table></figure>

<p>每个里面都是先调用一个函数 然后在atexit里又调用另一个函数<br>猜测atexit的顺序是栈 也就是这三个函数的第一个调用完了后再从里到外调用atexit<br>在这3*2+main这7个函数下断点<br>顺序:<br>1170-&gt;1230-&gt;12B0-&gt;main-&gt;1670 因为不符合check直接退了 但也能印证猜测 所以<br>1170-&gt;1230-&gt;12B0-&gt;main-&gt;1670-&gt;15C0-&gt;10E0<br>挨个看<br>1170:<br>input and check is_digit</p>
<p>1230:<br>set table</p>
<p>12B0:<br>重点!<br><img src="https://s2.loli.net/2024/01/24/wjebRFKkmsa3dL7.png" alt="IAT_HOOK.png"></p>
<p>也就是说这里把IAT表中GetLastError替换成了sub_4019D0<br>所以接下来的main相当于调用sub_4019D0</p>
<p>这里的分析是可以通过LoadLibrary和”GetLastError”以及对应指针的替换看出来的(做题角度并不一定要分析到IAT这么准确)</p>
<p>19D0:<br>覆盖sha1的常量值</p>
<p>1670:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">sub_401670</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_4090A2);</span><br><span class="line">  <span class="built_in">sub_401720</span>(INPUT, (<span class="type">int</span>)&amp;unk_4081C0);          <span class="comment">// base8</span></span><br><span class="line">  result = <span class="built_in">memcmp</span>(&amp;unk_4081D0, a16230465152334, <span class="number">0x60</span>u);<span class="comment">// base8加密后的enc的[16:] 说明前6位flag未知</span></span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    <span class="built_in">ExitProcess</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对input base8加密<br>注意到enc是存入&amp;4081C0 而后面的check是&amp;4081D0开始的0x60个<br>所以enc的[:16]是没有验证的 对应就是Input[:6]是不知道的 (base8 pt和ct的bit关系: 3-&gt;8)</p>
<p>15C0:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_4015C0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_4090A2);</span><br><span class="line">  <span class="built_in">sha1_sub_401CC0</span>((<span class="type">int</span>)&amp;unk_4081C0, <span class="number">112</span>, <span class="number">0</span>, Buffer);<span class="comment">// 对base8加密的enc[:16] sha1 </span></span><br><span class="line">  result = <span class="built_in">memcmp</span>(Buffer, a67339fc92b4875, <span class="number">0x28</span>u);<span class="comment">// 67339fc92b4875b8c073c76994ef1ca4ce632d26 这里能还原flag[:6]</span></span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    <span class="built_in">ExitProcess</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sha1<br>注意这里从&amp;4081C0开始取112个字符 也就是base8加密后的enc[:112]<br>所以是可以通过这里还原flag[:6] 只是sha1是魔改过的…</p>
<p>14E0:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">sub_4014E0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [esp+0h] [ebp-E8h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_4090A2);</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;unk_4084C0, &amp;unk_4081C0, <span class="number">0x70</span>u);</span><br><span class="line">  <span class="built_in">sub_401B60</span>(&amp;unk_4083C0, &amp;unk_408182, <span class="number">6</span>);      <span class="comment">// RC4 input从408158开始 这里的RC4key就取的是flag的最后6位</span></span><br><span class="line">  <span class="built_in">sub_401A40</span>(&amp;unk_4083C0, &amp;unk_4084C0, <span class="number">112</span>);    <span class="comment">// 4084C0取的是base8加密的enc的前112个字符</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">memcmp</span>(&amp;unk_4084C0, &amp;unk_408090, <span class="number">0x70</span>u) )</span><br><span class="line">    <span class="built_in">ExitProcess</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_4025A0</span>(<span class="string">&quot;Good, flag is DASCTF&#123;your input&#125;&quot;</span>, v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面的input是重命名过的 真实地址是408158 可以大致算算前面一共得到了6+36&#x3D;42&#x3D;2Ah的flag<br>刚好58+2A&#x3D;82 所以这里就是取得flag末6位作为RC4的key 然后取base8加密enc[:112]</p>
<p>整体分析完了 接下来就是如何逆向<br>flag[6:-6]可以直接<a target="_blank" rel="noopener" href="https://try8.cn/tool/code/base8#google_vignette">在线网站</a>解base8<br>注意到flag[-6:]是作为key  那么我们可以爆破这个key 根据密文反解RC4同时check is_digit来筛选key<br>理论上key的可能值应该就不多了 然后结合RC4还原的明文与flag[6:-6]比较 因为112-&gt;42 所以RC4还原的应该多出前6位<br>那么RC4_DEC+key就是flag了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x3F</span>, <span class="number">0x95</span>, <span class="number">0xBB</span>, <span class="number">0xF2</span>, <span class="number">0x57</span>, <span class="number">0xF1</span>, <span class="number">0x7A</span>, <span class="number">0x5A</span>, <span class="number">0x22</span>, <span class="number">0x61</span>, <span class="number">0x51</span>, <span class="number">0x43</span>, <span class="number">0xA2</span>, <span class="number">0xFA</span>, <span class="number">0x9B</span>, <span class="number">0x6F</span>, <span class="number">0x44</span>, <span class="number">0x63</span>, <span class="number">0xC0</span>, <span class="number">0x08</span>, <span class="number">0x12</span>, <span class="number">0x65</span>, <span class="number">0x5C</span>, <span class="number">0x8A</span>, <span class="number">0x8C</span>, <span class="number">0x4C</span>, <span class="number">0xED</span>, <span class="number">0x5E</span>, <span class="number">0xCA</span>, <span class="number">0x76</span>, <span class="number">0xB9</span>, <span class="number">0x85</span>, <span class="number">0xAF</span>, <span class="number">0x05</span>, <span class="number">0x38</span>, <span class="number">0xED</span>, <span class="number">0x42</span>, <span class="number">0x3E</span>, <span class="number">0x42</span>, <span class="number">0xDF</span>, <span class="number">0x5D</span>, <span class="number">0xBE</span>, <span class="number">0x05</span>, <span class="number">0x8B</span>, <span class="number">0x35</span>, <span class="number">0x6D</span>, <span class="number">0xF3</span>, <span class="number">0x1C</span>, <span class="number">0xCF</span>, <span class="number">0xF8</span>, <span class="number">0x6A</span>, <span class="number">0x73</span>, <span class="number">0x25</span>, <span class="number">0xE4</span>, <span class="number">0xB7</span>, <span class="number">0xB9</span>, <span class="number">0x36</span>, <span class="number">0xFB</span>, <span class="number">0x02</span>, <span class="number">0x11</span>, <span class="number">0xA0</span>, <span class="number">0xF0</span>, <span class="number">0x57</span>, <span class="number">0xAB</span>, <span class="number">0x21</span>, <span class="number">0xC6</span>, <span class="number">0xC7</span>, <span class="number">0x46</span>, <span class="number">0x99</span>, <span class="number">0xBD</span>, <span class="number">0x1E</span>, <span class="number">0x61</span>, <span class="number">0x5E</span>, <span class="number">0xEE</span>, <span class="number">0x55</span>, <span class="number">0x18</span>, <span class="number">0xEE</span>, <span class="number">0x03</span>, <span class="number">0x29</span>, <span class="number">0x84</span>, <span class="number">0x7F</span>, <span class="number">0x94</span>, <span class="number">0x5F</span>, <span class="number">0xB4</span>, <span class="number">0x6A</span>, <span class="number">0x29</span>, <span class="number">0xD8</span>, <span class="number">0x6C</span>, <span class="number">0xE4</span>, <span class="number">0xC0</span>, <span class="number">0x9D</span>, <span class="number">0x6B</span>, <span class="number">0xCC</span>, <span class="number">0xD5</span>, <span class="number">0x94</span>, <span class="number">0x5C</span>, <span class="number">0xDD</span>, <span class="number">0xCC</span>, <span class="number">0xD5</span>, <span class="number">0x3D</span>, <span class="number">0xC0</span>, <span class="number">0xEF</span>, <span class="number">0x0C</span>, <span class="number">0x29</span>, <span class="number">0xE5</span>, <span class="number">0xB0</span>, <span class="number">0x93</span>, <span class="number">0xF1</span>, <span class="number">0xB3</span>, <span class="number">0xDE</span>, <span class="number">0xB0</span>, <span class="number">0x70</span>]</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ARC4</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(<span class="number">1000000</span>):</span><br><span class="line">    rc4 = ARC4.new(<span class="built_in">str</span>(i).zfill(<span class="number">6</span>).encode())</span><br><span class="line">    pt = rc4.decrypt(<span class="built_in">bytes</span>(enc))</span><br><span class="line">    <span class="keyword">if</span> pt.isdigit():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;key = &quot;</span>,i)</span><br><span class="line">        <span class="built_in">print</span>(pt)</span><br></pre></td></tr></table></figure>

<p>得到key&#x3D;807391 对应RC4_DEC&#x3D;561516915572239428449843076691286116796614 拼接得到flag<br><strong>DASCTF{561516915572239428449843076691286116796614807391}</strong></p>
<h2 id="DualPersonality"><a href="#DualPersonality" class="headerlink" title="DualPersonality"></a>DualPersonality</h2><p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.fup1p1.cn/archives/reverse2022%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E5%A4%8D%E7%8E%B0">+</a></li>
</ul>
<p>32位和64位的切换 天堂之门<br>直接静态nop掉0数据后F5<br>main:<br><img src="/Reverse-Other/images/image.png" alt="main"></p>
<p>可以看出开始作了一个xor加密 只是这里的v3我一直找不到 静态&#x2F;动调都找不出来…<br>继续看汇编<br><img src="/Reverse-Other/images/image-1.png" alt="401455"><br><img src="/Reverse-Other/images/image-2.png" alt="40700C"></p>
<p>相当于是调用了401200处<br><img src="/Reverse-Other/images/image-3.png" alt="401200"></p>
<p>这里是因为我用的32分析所以是ROL4 但这里是64位的 所以应该是ROL8 但不影响 知道是算术左移就行 然后64位应该走else分支</p>
<p>然后main下面的<code>if ( !sub_401120(7u, (int)&amp;loc_401290) )</code><br>调用了<br><img src="/Reverse-Other/images/image-4.png" alt="401290"></p>
<p>要注意到这里的407014是后面最后一次加密的key值</p>
<p>然后就是最后一次加密 简单的xor key是经过上面函数修改后的</p>
<p>程序多次切换32&#x2F;64 所以数据处理要注意!!! 一定要zfill(2)啊啊啊！！！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exp ... 难绷</span></span><br><span class="line">enc = [<span class="number">0xAA</span>, <span class="number">0x4F</span>, <span class="number">0x0F</span>, <span class="number">0xE2</span>, <span class="number">0xE4</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x54</span>, <span class="number">0x2C</span>, <span class="number">0x2B</span>, <span class="number">0x84</span>, <span class="number">0x7E</span>, <span class="number">0xBC</span>, <span class="number">0x8F</span>, <span class="number">0x8B</span>, <span class="number">0x78</span>, <span class="number">0xD3</span>, <span class="number">0x73</span>, <span class="number">0x88</span>, <span class="number">0x5E</span>, <span class="number">0xAE</span>, <span class="number">0x47</span>, <span class="number">0x85</span>, <span class="number">0x70</span>, <span class="number">0x31</span>, <span class="number">0xB3</span>,<span class="number">0x09</span>, <span class="number">0xCE</span>, <span class="number">0x13</span>, <span class="number">0xF5</span>, <span class="number">0x0D</span>, <span class="number">0xCA</span>]</span><br><span class="line">key = [<span class="number">0x9D</span>,<span class="number">0x44</span>,<span class="number">0x37</span>,<span class="number">0xB5</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encodekey</span>():</span><br><span class="line">    key[<span class="number">0</span>] &amp;= key[<span class="number">1</span>]</span><br><span class="line">    key[<span class="number">1</span>] |= key[<span class="number">2</span>]</span><br><span class="line">    key[<span class="number">2</span>] ^= key[<span class="number">3</span>]</span><br><span class="line">    key[<span class="number">3</span>] = (~key[<span class="number">3</span>])&amp;<span class="number">0xff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec1</span>(): <span class="comment"># decode enc4</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        enc[i] ^= key[i%<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ROR</span>(<span class="params">x,n</span>):</span><br><span class="line">    <span class="keyword">return</span> (x&gt;&gt;n|(x&lt;&lt;(<span class="number">64</span>-n)))&amp;<span class="number">0xffffffffffffffff</span> </span><br><span class="line">    </span><br><span class="line">encodekey()</span><br><span class="line">dec1()</span><br><span class="line">s = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    s.append(<span class="built_in">hex</span>(c)[<span class="number">2</span>:].zfill(<span class="number">2</span>)) <span class="comment"># !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span><br><span class="line">enc = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    ss = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        ss += s[i*<span class="number">8</span>+<span class="number">7</span>-j]</span><br><span class="line">    enc.append(ss)</span><br><span class="line">enc = [<span class="built_in">int</span>(x,<span class="number">16</span>) <span class="keyword">for</span> x <span class="keyword">in</span> enc]</span><br><span class="line">enc[<span class="number">0</span>] = ROR(enc[<span class="number">0</span>],<span class="number">12</span>)</span><br><span class="line">enc[<span class="number">1</span>] = ROR(enc[<span class="number">1</span>],<span class="number">34</span>)</span><br><span class="line">enc[<span class="number">2</span>] = ROR(enc[<span class="number">2</span>],<span class="number">56</span>)</span><br><span class="line">enc[<span class="number">3</span>] = ROR(enc[<span class="number">3</span>],<span class="number">14</span>)</span><br><span class="line">final_enc = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    x = enc[i]&amp;<span class="number">0x00000000ffffffff</span></span><br><span class="line">    final_enc.append(x)</span><br><span class="line">    x = enc[i]&amp;<span class="number">0xffffffff00000000</span></span><br><span class="line">    x &gt;&gt;= <span class="number">32</span></span><br><span class="line">    final_enc.append(x)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">v3 = <span class="number">0x5DF966AE</span></span><br><span class="line">d = v3 - <span class="number">0x21524111</span></span><br><span class="line">pt = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    d &amp;= <span class="number">0xffffffff</span></span><br><span class="line">    pt.append((final_enc[i]-d)&amp;<span class="number">0xffffffff</span>)</span><br><span class="line">    d ^= final_enc[i]</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] ANS&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> pt:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(c).decode()[::-<span class="number">1</span>],end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<p><strong>DASCTF{6cc1e44811647d38a15017e389b3f704}</strong></p>
<h1 id="未知来源"><a href="#未知来源" class="headerlink" title="未知来源"></a>未知来源</h1><h2 id="ctfshow-reverse-比赛原题-snake"><a href="#ctfshow-reverse-比赛原题-snake" class="headerlink" title="ctfshow-reverse-比赛原题-snake"></a>ctfshow-reverse-比赛原题-snake</h2><p>py反编译</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.9.0</span></span><br><span class="line"><span class="comment"># Python bytecode version base 3.7.0 (3394)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 3.6.12 (default, Feb  9 2021, 09:19:15) </span></span><br><span class="line"><span class="comment"># [GCC 8.3.0]</span></span><br><span class="line"><span class="comment"># Embedded file name: snake.py</span></span><br><span class="line"><span class="keyword">import</span> hashlib, sys, random, time</span><br><span class="line">maze = [</span><br><span class="line"> [</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>]]</span><br><span class="line">s = <span class="built_in">str</span>(<span class="built_in">input</span>())</span><br><span class="line">seed = time.time()</span><br><span class="line">random.seed(seed)</span><br><span class="line">random.seed(random.randint(<span class="number">0</span>, <span class="number">999999</span>))</span><br><span class="line">maze[<span class="number">1</span>][<span class="number">1</span>] = random.randint(<span class="number">987</span>, <span class="number">1000</span>)</span><br><span class="line">maze[<span class="number">3</span>][<span class="number">4</span>] = random.randint(<span class="number">345</span>, <span class="number">356</span>)</span><br><span class="line">maze[<span class="number">7</span>][<span class="number">7</span>] = random.randint(<span class="number">107</span>, <span class="number">116</span>)</span><br><span class="line">maze[<span class="number">11</span>][<span class="number">8</span>] = random.randint(<span class="number">833</span>, <span class="number">856</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        tmp = <span class="number">12</span> * i + j</span><br><span class="line">        <span class="keyword">if</span> maze[i][j] == <span class="number">0</span>:</span><br><span class="line">            maze[i][j] = <span class="number">3456</span> + tmp</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> tmp % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            random.seed(maze[<span class="number">1</span>][<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(tmp):</span><br><span class="line">                random.randint(<span class="number">0</span>, <span class="number">999</span>)</span><br><span class="line"></span><br><span class="line">            maze[i][j] = random.randint(<span class="number">0</span>, <span class="number">999</span>)</span><br><span class="line">        <span class="keyword">elif</span> tmp % <span class="number">4</span> == <span class="number">1</span>:</span><br><span class="line">            random.seed(maze[<span class="number">3</span>][<span class="number">4</span>])</span><br><span class="line">            <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(tmp):</span><br><span class="line">                random.randint(<span class="number">555</span>, <span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line">            maze[i][j] = random.randint(<span class="number">555</span>, <span class="number">1234</span>)</span><br><span class="line">        <span class="keyword">elif</span> tmp % <span class="number">4</span> == <span class="number">2</span>:</span><br><span class="line">            random.seed(maze[<span class="number">7</span>][<span class="number">7</span>])</span><br><span class="line">            <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(tmp):</span><br><span class="line">                random.randint(<span class="number">777</span>, <span class="number">888</span>)</span><br><span class="line"></span><br><span class="line">            maze[i][j] = random.randint(<span class="number">777</span>, <span class="number">888</span>)</span><br><span class="line">        <span class="keyword">elif</span> tmp % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">            random.seed(maze[<span class="number">11</span>][<span class="number">8</span>])</span><br><span class="line">            <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(tmp):</span><br><span class="line">                random.randint(<span class="number">369</span>, <span class="number">777</span>)</span><br><span class="line"></span><br><span class="line">            maze[i][j] = random.randint(<span class="number">369</span>, <span class="number">777</span>)</span><br><span class="line"></span><br><span class="line">maze[<span class="number">11</span>][<span class="number">11</span>] = <span class="number">9</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) != <span class="number">56</span>:</span><br><span class="line">    sys.exit(-<span class="number">1</span>)</span><br><span class="line">idx1 = <span class="number">0</span></span><br><span class="line">idx2 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">        idx1 -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">            idx1 += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> i == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">                idx2 -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> i == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                    idx2 += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= maze[idx1][idx2] &lt;= <span class="number">1234</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Where are you going?&#x27;</span>)</span><br><span class="line">        sys.exit(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> maze[idx1][idx2] != <span class="number">9</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;You lost in the maze!&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> xx <span class="keyword">in</span> maze:</span><br><span class="line">    <span class="keyword">for</span> xxx <span class="keyword">in</span> xx:</span><br><span class="line">        result += <span class="built_in">str</span>(xxx)</span><br><span class="line"></span><br><span class="line">hash_res = hashlib.sha256(result.encode(<span class="string">&#x27;latin-1&#x27;</span>)).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(hash_res)</span><br><span class="line"><span class="keyword">if</span> hash_res == <span class="string">&#x27;f1793dcf5ad3858512b944ac34413725a27c63e25618858231e88b9686466b00&#x27;</span>:</span><br><span class="line">    flag1 = <span class="built_in">str</span>(maze[<span class="number">1</span>][<span class="number">1</span>]) + <span class="built_in">str</span>(maze[<span class="number">7</span>][<span class="number">7</span>]) + <span class="built_in">str</span>(maze[<span class="number">11</span>][<span class="number">8</span>]) + <span class="built_in">str</span>(maze[<span class="number">3</span>][<span class="number">4</span>])</span><br><span class="line">    flag2 = hashlib.sha256(s.encode(<span class="string">&#x27;latin-1&#x27;</span>)).hexdigest()</span><br><span class="line">    flag = flag2[::-<span class="number">1</span>] + flag1[::-<span class="number">1</span>]</span><br><span class="line">    final_flag = hashlib.sha256(flag.encode(<span class="string">&#x27;latin-1&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;flag&#123;&#x27;</span> + final_flag[<span class="number">0</span>:<span class="number">32</span>] + <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看着貌似随机很多 但是发现好多seed没用 有用的seed就是maze[1][1]&#x2F;maze[7][7]&#x2F;maze[11][8]&#x2F;maze[3][4]<br>题目给了范围枚举爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">987</span>,<span class="number">1001</span>):</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> trange(<span class="number">345</span>,<span class="number">357</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">107</span>,<span class="number">117</span>):</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">833</span>,<span class="number">857</span>):</span><br><span class="line">                        maze = [</span><br><span class="line">                            [</span><br><span class="line">                            ]</span><br><span class="line">                        ]</span><br><span class="line">                        _ += <span class="number">1</span></span><br><span class="line">                        <span class="comment"># print(_)</span></span><br><span class="line">                        seed = time.time()</span><br><span class="line">                        random.seed(seed)</span><br><span class="line">                        random.seed(random.randint(<span class="number">0</span>, <span class="number">999999</span>))</span><br><span class="line">                        maze[<span class="number">1</span>][<span class="number">1</span>] = a</span><br><span class="line">                        maze[<span class="number">3</span>][<span class="number">4</span>] = b</span><br><span class="line">                        maze[<span class="number">7</span>][<span class="number">7</span>] = c</span><br><span class="line">                        maze[<span class="number">11</span>][<span class="number">8</span>] = d</span><br><span class="line">                        ...</span><br><span class="line">                        maze[<span class="number">11</span>][<span class="number">11</span>] = <span class="number">9</span></span><br><span class="line">                        <span class="comment"># print(maze)</span></span><br><span class="line">                        result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                        <span class="keyword">for</span> xx <span class="keyword">in</span> maze:</span><br><span class="line">                            <span class="keyword">for</span> xxx <span class="keyword">in</span> xx:</span><br><span class="line">                                result += <span class="built_in">str</span>(xxx)</span><br><span class="line"></span><br><span class="line">                        hash_res = hashlib.sha256(result.encode(<span class="string">&#x27;latin-1&#x27;</span>)).hexdigest()</span><br><span class="line">                        <span class="keyword">if</span> hash_res == <span class="string">&#x27;f1793dcf5ad3858512b944ac34413725a27c63e25618858231e88b9686466b00&#x27;</span>:</span><br><span class="line">                            <span class="built_in">print</span>(maze)</span><br><span class="line">                            exit()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maze = [[<span class="number">937</span>, <span class="number">3457</span>, <span class="number">3458</span>, <span class="number">3459</span>, <span class="number">3460</span>, <span class="number">3461</span>, <span class="number">3462</span>, <span class="number">3463</span>, <span class="number">3464</span>, <span class="number">3465</span>, <span class="number">3466</span>, <span class="number">3467</span>], [<span class="number">360</span>, <span class="number">671</span>, <span class="number">3470</span>, <span class="number">3471</span>, <span class="number">954</span>, <span class="number">741</span>, <span class="number">815</span>, <span class="number">3475</span>, <span class="number">3476</span>, <span class="number">3477</span>, <span class="number">3478</span>, <span class="number">3479</span>], [<span class="number">3480</span>, <span class="number">1232</span>, <span class="number">836</span>, <span class="number">3483</span>, <span class="number">934</span>, <span class="number">3485</span>, <span class="number">886</span>, <span class="number">588</span>, <span class="number">487</span>, <span class="number">830</span>, <span class="number">3490</span>, <span class="number">3491</span>], [<span class="number">3492</span>, <span class="number">3493</span>, <span class="number">854</span>, <span class="number">696</span>, <span class="number">744</span>, <span class="number">3497</span>, <span class="number">3498</span>, <span class="number">3499</span>, <span class="number">3500</span>, <span class="number">1066</span>, <span class="number">3502</span>, <span class="number">3503</span>], [<span class="number">3504</span>, <span class="number">3505</span>, <span class="number">3506</span>, <span class="number">3507</span>, <span class="number">3508</span>, <span class="number">3509</span>, <span class="number">781</span>, <span class="number">447</span>, <span class="number">677</span>, <span class="number">598</span>, <span class="number">3514</span>, <span class="number">3515</span>], [<span class="number">3516</span>, <span class="number">3517</span>, <span class="number">3518</span>, <span class="number">3519</span>, <span class="number">3520</span>, <span class="number">3521</span>, <span class="number">793</span>, <span class="number">3523</span>, <span class="number">3524</span>, <span class="number">3525</span>, <span class="number">3526</span>, <span class="number">3527</span>], [<span class="number">3528</span>, <span class="number">580</span>, <span class="number">787</span>, <span class="number">622</span>, <span class="number">63</span>, <span class="number">3533</span>, <span class="number">861</span>, <span class="number">618</span>, <span class="number">269</span>, <span class="number">1118</span>, <span class="number">791</span>, <span class="number">3539</span>], [<span class="number">3540</span>, <span class="number">993</span>, <span class="number">3542</span>, <span class="number">3543</span>, <span class="number">665</span>, <span class="number">3545</span>, <span class="number">3546</span>, <span class="number">400</span>, <span class="number">3548</span>, <span class="number">3549</span>, <span class="number">807</span>, <span class="number">3551</span>], [<span class="number">3552</span>, <span class="number">650</span>, <span class="number">3554</span>, <span class="number">3555</span>, <span class="number">297</span>, <span class="number">3557</span>, <span class="number">3558</span>, <span class="number">3559</span>, <span class="number">3560</span>, <span class="number">801</span>, <span class="number">845</span>, <span class="number">3563</span>], [<span class="number">3564</span>, <span class="number">1222</span>, <span class="number">872</span>, <span class="number">3567</span>, <span class="number">298</span>, <span class="number">1072</span>, <span class="number">827</span>, <span class="number">640</span>, <span class="number">847</span>, <span class="number">1046</span>, <span class="number">3574</span>, <span class="number">3575</span>], [<span class="number">3576</span>, <span class="number">3577</span>, <span class="number">817</span>, <span class="number">599</span>, <span class="number">3580</span>, <span class="number">3581</span>, <span class="number">3582</span>, <span class="number">3583</span>, <span class="number">3584</span>, <span class="number">3585</span>, <span class="number">3586</span>, <span class="number">3587</span>], [<span class="number">3588</span>, <span class="number">3589</span>, <span class="number">3590</span>, <span class="number">506</span>, <span class="number">926</span>, <span class="number">1161</span>, <span class="number">853</span>, <span class="number">687</span>, <span class="number">440</span>, <span class="number">1026</span>, <span class="number">860</span>, <span class="number">9</span>]]</span><br></pre></td></tr></table></figure>

<p>然后C++写个dfs跑就得了</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> a[<span class="number">100</span>][<span class="number">100</span>];</span><br><span class="line"><span class="type">int</span> dx[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">int</span> dy[<span class="number">4</span>]=&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="type">char</span> ccc[<span class="number">4</span>]=&#123;<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,<span class="string">&#x27;a&#x27;</span>&#125;;</span><br><span class="line"><span class="type">int</span> vis[<span class="number">13</span>][<span class="number">13</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,string jl,<span class="type">int</span> cnt)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">12</span>&amp;&amp;y==<span class="number">12</span>&amp;&amp;cnt==<span class="number">56</span>)&#123;</span><br><span class="line">		cout&lt;&lt;<span class="string">&quot;[+] Find! \n&quot;</span>;</span><br><span class="line">		cout&lt;&lt;jl&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">		<span class="type">int</span> nx=x+dx[i],ny=y+dy[i];</span><br><span class="line">		<span class="keyword">if</span>(nx&gt;=<span class="number">1</span>&amp;&amp;nx&lt;=<span class="number">12</span>&amp;&amp;ny&gt;=<span class="number">1</span>&amp;&amp;ny&lt;=<span class="number">12</span>&amp;&amp;a[nx][ny]&lt;=<span class="number">1234</span>&amp;&amp;!vis[nx][ny])&#123;</span><br><span class="line">			vis[nx][ny]=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">dfs</span>(nx,ny,jl+ccc[i],cnt+<span class="number">1</span>);</span><br><span class="line">			vis[nx][ny]=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> ma[<span class="number">1006</span>]=&#123;...&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">12</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">12</span>;j++)</span><br><span class="line">			a[i][j] = ma[(i<span class="number">-1</span>)*<span class="number">12</span>+j<span class="number">-1</span>];</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="string">&quot;&quot;</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>路径:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = sdsdsddwwddsdddssaaassddddssasaaaaawwwaaasssdsdsdddddddd</span><br></pre></td></tr></table></figure>

<p>最后flag<br><strong>flag{e1df25dac4906584fe2d6f155b60e233}</strong></p>
<h2 id="NSSCTF-2022-Spring-Recruit-easy-Pe"><a href="#NSSCTF-2022-Spring-Recruit-easy-Pe" class="headerlink" title="[NSSCTF 2022 Spring Recruit]easy Pe"></a>[NSSCTF 2022 Spring Recruit]easy Pe</h2><p>2024年做的第一道逆向题~<br>虽说有来源 但是懒得新建分类了</p>
<p>这题挺有意思的 用CFFEXPLOERER看可以看到有t.exe以外的resource<br>点击运行exe可以发现在执行cmdshell之前有一个短暂的gui界面</p>
<p>IDA打开exe<br>WinMain的341行可以找到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sub_401A18</span>(&amp;lpText, v37);</span><br><span class="line">StartupInfo.dwXCountChars = <span class="number">0</span>;</span><br><span class="line">StartupInfo.dwYCountChars = <span class="number">1</span>;</span><br><span class="line">StartupInfo.hStdError = <span class="number">0</span>;</span><br><span class="line">StartupInfo.dwYSize = v50 != <span class="number">0</span> ? (DWORD)lpText : <span class="number">0</span>;</span><br><span class="line"><span class="built_in">ShellExecuteExA</span>((SHELLEXECUTEINFOA *)&amp;StartupInfo.lpDesktop);</span><br></pre></td></tr></table></figure>

<p>这里就是最终呈现给我们的shell窗口<br>动调 在这前面很容易看到一堆messagebox<br>注意到有很多lpathname这种<br>在256行</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="built_in">sub_401EC1</span>(v36);</span><br><span class="line">  <span class="built_in">sub_405040</span>(v36);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">SetCurrentDirectoryA</span>(lpPathName[<span class="number">0</span>]) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">SetCurrentDirectoryA</span>(v36[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">FREE</span>((<span class="type">void</span> *)v36[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">FREE</span>(v28[<span class="number">0</span>]);</span><br><span class="line">LABEL_42:</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这里动调可以发现lpPathName[0]指向C:&#x2F;&#x2F;USER&#x2F;xxx&#x2F;AppData&#x2F;local&#x2F;tmp 下的一个文件<br>我电脑上就是这个路径 C:\Users\asus\AppData\Local\Temp\7zS24E6.tmp<br>打开发现有一个bat2exe.exe 还有一个bat  点击bat运行发现就是我们之前看到的shell窗口</p>
<p>顾名思义这个bat2exe是将.bat转成.exe 那么我们查看.bat内容 直接右键打不开 转成.txt打开</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">set</span> /p input =please input flag:</span><br><span class="line"><span class="built_in">set</span> input|findstr <span class="string">&quot;\&lt;123123\&gt;&quot;</span></span><br><span class="line">cls</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%errorlevel%&quot;</span> == <span class="string">&quot;0&quot;</span> ( goto 0 ) ELSE (goto 1)</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">:0</span><br><span class="line"><span class="built_in">echo</span> good_job!</span><br><span class="line">pause</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">:1</span><br><span class="line"><span class="built_in">echo</span> sorry...</span><br><span class="line">pause</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p>很清晰 flag就是123123<br>同时输入完后的cls也印证了前面输入完被清空的现象<br><strong>NSSCTF{123123}</strong></p>
<hr>
<hr>
<p>总的来说还是一道很新颖的题的<br>我的解题突破口就在于发现lpathname这种敏感变量<br>PE千变万化 还要继续加油学习!</p>
<h2 id="ctfshow-卷王杯-babyoc"><a href="#ctfshow-卷王杯-babyoc" class="headerlink" title="ctfshow-卷王杯-babyoc"></a>ctfshow-卷王杯-babyoc</h2><p>一道Object-C的题 一些独特的语法 记录一下<br>网上粗略学了一下Object-C 然而进IDA还是看不怎么懂…</p>
<p>在主函数很容易找到输入点 enc check<br>函数列表翻翻还能找到xor add 这种运算<br>看enc<br>分奇偶位进行了处理<br>程序这么写的:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; *(_QWORD *)(a1 + <span class="number">16</span>); i += <span class="number">2LL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v13 = <span class="built_in">objc_get_class</span>(<span class="string">&quot;flagChar&quot;</span>, v10, v12);</span><br><span class="line">    v14 = (__int64 (__fastcall *)(__int64, <span class="type">char</span> **))<span class="built_in">objc_msg_lookup</span>(v13, off_55EC019DFA50);</span><br><span class="line">    v30 = <span class="built_in">v14</span>(v13, off_55EC019DFA50);</span><br><span class="line">    v15 = (<span class="built_in">void</span> (__fastcall *)(__int64, <span class="type">char</span> **, _QWORD))<span class="built_in">objc_msg_lookup</span>(v30, off_55EC019DFA60);</span><br><span class="line">    <span class="built_in">v15</span>(v30, off_55EC019DFA60, (<span class="type">unsigned</span> __int16)(<span class="number">1249</span> * i));</span><br><span class="line">    v16 = (<span class="built_in">void</span> (__fastcall *)(__int64, <span class="type">char</span> **, _QWORD))<span class="built_in">objc_msg_lookup</span>(v30, off_55EC019DFA80);</span><br><span class="line">    v17 = (__int64 (__fastcall *)(__int64, <span class="type">char</span> **, <span class="type">unsigned</span> __int64))<span class="built_in">objc_msg_lookup</span>(a3, off_55EC019DFA70);</span><br><span class="line">    v18 = <span class="built_in">v17</span>(a3, off_55EC019DFA70, i);</span><br><span class="line">    <span class="built_in">v16</span>(v30, off_55EC019DFA80, v18);</span><br><span class="line">    v19 = *(_QWORD *)(a1 + <span class="number">8</span>);</span><br><span class="line">    v20 = (<span class="built_in">void</span> (__fastcall *)(__int64, <span class="type">char</span> **, __int64))<span class="built_in">objc_msg_lookup</span>(v19, off_55EC019DFA90);</span><br><span class="line">    v10 = off_55EC019DFA90;</span><br><span class="line">    <span class="built_in">v20</span>(v19, off_55EC019DFA90, v30);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这是真看着头大<br>看汇编发现一些 I: Y: 这种字符<br>查看交叉引用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.data:<span class="number">000055</span>EC019DF590 C2 F0 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aR                            ; <span class="string">&quot;R&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF598 B8 F1 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aQ1608_0                      ; <span class="string">&quot;Q16@0:8&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5A0 E3 C3 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset sub_55EC019DC3E3</span><br><span class="line">.data:<span class="number">000055</span>EC019DF5A8 C4 F0 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aI                            ; <span class="string">&quot;I:&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5B0 C0 F1 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aV2408q16                     ; <span class="string">&quot;v24@0:8Q16&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5B8 C4 C3 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset sub_55EC019DC3C4</span><br><span class="line">.data:<span class="number">000055</span>EC019DF5C0 C7 F0 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aY                            ; <span class="string">&quot;Y:&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5C8 C0 F1 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aV2408q16                     ; <span class="string">&quot;v24@0:8Q16&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5D0 <span class="number">9</span>A C3 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset sub_55EC019DC39A</span><br><span class="line">.data:<span class="number">000055</span>EC019DF5D8 CA F0 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aA                            ; <span class="string">&quot;A:&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5E0 C0 F1 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aV2408q16                     ; <span class="string">&quot;v24@0:8Q16&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5E8 <span class="number">70</span> C3 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset sub_55EC019DC370</span><br><span class="line">.data:<span class="number">000055</span>EC019DF5F0 CD F0 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aB                            ; <span class="string">&quot;B:&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF5F8 D0 F1 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aC2408q16_0                   ; <span class="string">&quot;C24@0:8Q16&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF600 <span class="number">4F</span> C3 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset sub_55EC019DC34F</span><br><span class="line">.data:<span class="number">000055</span>EC019DF608 D0 F0 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset asc_55EC019DF0D0              ; <span class="string">&quot;X:&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF610 C0 F1 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset aV2408q16                     ; <span class="string">&quot;v24@0:8Q16&quot;</span></span><br><span class="line">.data:<span class="number">000055</span>EC019DF618 <span class="number">25</span> C3 <span class="number">9</span>D <span class="number">01</span> EC <span class="number">55</span> <span class="number">00</span> <span class="number">00</span>       dq offset sub_55EC019DC325</span><br></pre></td></tr></table></figure>

<p>可以发现 R&#x2F;I&#x2F;… 这些是类 后面的第三项是类中的方法(应该是) 第二项是类似签名这种<br>那么我们对于每个只需要关注它所调用的方法即可<br>发现正是前面找到的xor&#x2F;add&#x2F;mov等操作</p>
<p>知道这点后 逐个分析还原加密逻辑 逆向回去即可<br>注意 enc是sub_55EC019DC7A6 刚刚分析的奇偶xor是在input下调用的</p>
<p>input下的加密就作了 xor 0x4E1*i 的操作<br>注意到Y对应的 *(_QWORD *)(a1 + 8) &#x3D; a3 ^ *(_QWORD *)(a1 + 16);<br>事实上这里静态还是很麻烦的 但是Linux要运行Object-C也比较麻烦…<br>好像明白了 cal里的第二个循环看似正序 其实</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( j = <span class="number">0LL</span>; ; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(_QWORD *)(a1 + <span class="number">16</span>) - <span class="number">1LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( j &gt;= result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v10 = *(_QWORD *)(a1 + <span class="number">8</span>);</span><br><span class="line">    v11 = (__int64 (__fastcall *)(__int64, <span class="type">char</span> **, <span class="type">unsigned</span> __int64))<span class="built_in">objc_msg_lookup</span>(v10, OBJECT_AT_INDEX);</span><br><span class="line">    v12 = <span class="built_in">v11</span>(v10, OBJECT_AT_INDEX, *(_QWORD *)(a1 + <span class="number">16</span>) - j - <span class="number">1</span>);</span><br><span class="line">    v13 = (<span class="built_in">void</span> (__fastcall *)(__int64, <span class="type">char</span> **, __int64))<span class="built_in">objc_msg_lookup</span>(v12, A_XOR);</span><br><span class="line">    v14 = *(_QWORD *)(a1 + <span class="number">8</span>);</span><br><span class="line">    v15 = (__int64 (__fastcall *)(__int64, <span class="type">char</span> **, <span class="type">unsigned</span> __int64))<span class="built_in">objc_msg_lookup</span>(v14, OBJECT_AT_INDEX);</span><br><span class="line">    v16 = <span class="built_in">v15</span>(v14, OBJECT_AT_INDEX, *(_QWORD *)(a1 + <span class="number">16</span>) - j - <span class="number">2</span>);</span><br><span class="line">    v17 = (__int64 (__fastcall *)(__int64, <span class="type">char</span> **))<span class="built_in">objc_msg_lookup</span>(v16, R_MOV);</span><br><span class="line">    v18 = <span class="built_in">v17</span>(v16, R_MOV);</span><br><span class="line">    <span class="built_in">v13</span>(v12, A_XOR, v18);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>注意取得是 *(_QWORD *)(a1 + 16) - j - 1<br>*(_QWORD *)(a1 + 16)  - 1 是len 也就是取得 len-1  len-2  …  woc  所以是倒序…<br>注意A对应的xor</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_55EC019DC370</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = a1;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">8</span>) ^= a3;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以这里是 [len-1-j] ^&#x3D; [len-1-j-1]</p>
<p>但是奇偶项加密的+ ^ 顺序静态还是没找出来… 动调应该能秒出  但是我懒得安依赖库了…</p>
<p>最后解密长这样:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="number">1270</span>, <span class="number">2767</span>, <span class="number">5549</span>, <span class="number">9672</span>, <span class="number">11938</span>, <span class="number">16093</span>, <span class="number">29864</span>, <span class="number">30379</span>, <span class="number">22184</span>, <span class="number">20690</span>, <span class="number">25002</span>,</span><br><span class="line">        <span class="number">65039</span>, <span class="number">65793</span>, <span class="number">97983</span>, <span class="number">100411</span>, <span class="number">67904</span>, <span class="number">88053</span>, <span class="number">28147</span>, <span class="number">18776</span>, <span class="number">71764</span>, <span class="number">127654</span>,</span><br><span class="line">        <span class="number">39994</span>, <span class="number">30276</span>, <span class="number">33151</span>, <span class="number">49377</span>, <span class="number">62682</span>, <span class="number">128398</span>, <span class="number">32406</span>]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x4E1</span> * i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">28</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        data[i] ^= data[i - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data[i] -= data[i - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        data[i] ^= data[i + <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data[i] -= data[i + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(data[i] ^ key[i]), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ctfshow{babyＯｂｊＣ,你真的解出来了TQL}</strong></p>
<h2 id="SUCTF2019-hardCpp"><a href="#SUCTF2019-hardCpp" class="headerlink" title="SUCTF2019 hardCpp"></a>SUCTF2019 hardCpp</h2><p>ollvm解混淆平坦化后是这种:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  v28 = <span class="number">0</span>;</span><br><span class="line">  v27 = argc;</span><br><span class="line">  v26 = argv;</span><br><span class="line">  v25 = <span class="built_in">time</span>(<span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;func(?)=\&quot;01abfc750a0c942167651c40d088531d\&quot;?&quot;</span>);</span><br><span class="line">  s = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="built_in">fgets</span>(v20, <span class="number">21</span>, stdin);</span><br><span class="line">  v18 = <span class="built_in">time</span>(<span class="number">0LL</span>);</span><br><span class="line">  v17 = v18 - v25;</span><br><span class="line">  v29 = v18 - v25;</span><br><span class="line">  <span class="keyword">if</span> ( v18 - v25 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Let the silent second hand take the place of my doubt...&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v16 = <span class="built_in">strlen</span>(&amp;s);</span><br><span class="line">  v30 = v16 != <span class="number">21</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v16 != <span class="number">21</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt; <span class="number">21</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v14 = v17 ^ v20[i - <span class="number">1</span>];</span><br><span class="line">    v13[<span class="number">0</span>] = main::$_0::<span class="built_in">operator</span>()(v23, (<span class="type">unsigned</span> <span class="type">int</span>)v14);</span><br><span class="line">    v12[<span class="number">0</span>] = main::$_1::<span class="built_in">operator</span>()(v21, (<span class="type">unsigned</span> <span class="type">int</span>)*(&amp;s + v17 + i - <span class="number">1</span>));</span><br><span class="line">    v3 = main::$_1::<span class="built_in">operator</span>() <span class="built_in">const</span>(<span class="type">char</span>)::&#123;<span class="built_in">lambda</span>(<span class="type">int</span>)#<span class="number">1</span>&#125;::<span class="built_in">operator</span>()(v12, <span class="number">7LL</span>);</span><br><span class="line">    v14 = main::$_0::<span class="built_in">operator</span>() <span class="built_in">const</span>(<span class="type">char</span>)::&#123;<span class="built_in">lambda</span>(<span class="type">char</span>)#<span class="number">1</span>&#125;::<span class="built_in">operator</span>()(v13, (<span class="type">unsigned</span> <span class="type">int</span>)v3);</span><br><span class="line">    v11[<span class="number">0</span>] = main::$_2::<span class="built_in">operator</span>()(v24, (<span class="type">unsigned</span> <span class="type">int</span>)v14);</span><br><span class="line">    v10[<span class="number">0</span>] = main::$_2::<span class="built_in">operator</span>()(v24, (<span class="type">unsigned</span> <span class="type">int</span>)*(&amp;s + v17 + i - <span class="number">1</span>));</span><br><span class="line">    v4 = main::$_2::<span class="built_in">operator</span>() <span class="built_in">const</span>(<span class="type">char</span>)::&#123;<span class="built_in">lambda</span>(<span class="type">char</span>)#<span class="number">1</span>&#125;::<span class="built_in">operator</span>()(v10, <span class="number">18LL</span>);</span><br><span class="line">    v9[<span class="number">0</span>] = main::$_3::<span class="built_in">operator</span>()(v22, (<span class="type">unsigned</span> <span class="type">int</span>)v4);</span><br><span class="line">    v5 = main::$_3::<span class="built_in">operator</span>() <span class="built_in">const</span>(<span class="type">char</span>)::&#123;<span class="built_in">lambda</span>(<span class="type">char</span>)#<span class="number">1</span>&#125;::<span class="built_in">operator</span>()(v9, <span class="number">3LL</span>);</span><br><span class="line">    v8[<span class="number">0</span>] = main::$_0::<span class="built_in">operator</span>()(v23, (<span class="type">unsigned</span> <span class="type">int</span>)v5);</span><br><span class="line">    v6 = main::$_0::<span class="built_in">operator</span>() <span class="built_in">const</span>(<span class="type">char</span>)::&#123;<span class="built_in">lambda</span>(<span class="type">char</span>)#<span class="number">1</span>&#125;::<span class="built_in">operator</span>()(v8, <span class="number">2LL</span>);</span><br><span class="line">    v14 = main::$_2::<span class="built_in">operator</span>() <span class="built_in">const</span>(<span class="type">char</span>)::&#123;<span class="built_in">lambda</span>(<span class="type">char</span>)#<span class="number">1</span>&#125;::<span class="built_in">operator</span>()(v11, (<span class="type">unsigned</span> <span class="type">int</span>)v6);</span><br><span class="line">    <span class="keyword">if</span> ( enc[i - <span class="number">1</span>] != v14 )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You win&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重点分析下那些lambda<br>第1,2个都是直接返回a2<br>第3个是取模<br>第4个比较重要:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main::$_0::<span class="built_in">operator</span>() <span class="built_in">const</span>(<span class="type">char</span>)::&#123;<span class="built_in">lambda</span>(<span class="type">char</span>)#<span class="number">1</span>&#125;::<span class="built_in">operator</span>()(__int64 a1, <span class="type">char</span> a2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+23h] [rbp-1Dh]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [rsp+2Ah] [rbp-16h]</span></span><br><span class="line">  <span class="type">bool</span> v12; <span class="comment">// [rsp+2Bh] [rbp-15h]</span></span><br><span class="line"></span><br><span class="line">  v11 = <span class="number">1</span>;</span><br><span class="line">  v12 = y_6 &lt; <span class="number">10</span>;</span><br><span class="line">  v9 = a2;</span><br><span class="line">  v8 = a1;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">-1418698808</span>;</span><br><span class="line">  v7 = <span class="number">-1418698808</span>;</span><br><span class="line">  v6 = <span class="number">618368500</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v3 = (<span class="type">char</span> *)a1;</span><br><span class="line">  *((_BYTE *)&amp;v3 - <span class="number">16</span>) = a2;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)(*((<span class="type">char</span> *)&amp;v3 - <span class="number">16</span>) + *v3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里进行的是字符串相加的操作!<br>第5个还是返回<br>第6个也还是返回<br>第7个是异或18<br>第8个还是返回<br>第9个是相乘<br>第10个还是返回<br>第11个字符串相加<br>第12个xor</p>
<p>注意一个小细节 v20[i - 1] 和 &amp;s + zero + i - 1<br>s是在v20前面一位的 所以相当于是0~20相邻两个进行加密处理<br>大致得到这样的加密代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">21</span>):</span><br><span class="line">    v14 = a[i]</span><br><span class="line">    v13 = v14</span><br><span class="line">    v12 = a[i-<span class="number">1</span>]</span><br><span class="line">    v3 = v12%<span class="number">7</span></span><br><span class="line">    v14 = v13+v3</span><br><span class="line">    v10 = a[i-<span class="number">1</span>]</span><br><span class="line">    v4 = v10^<span class="number">18</span></span><br><span class="line">    v9 = v4</span><br><span class="line">    v5 = v9*<span class="number">3</span></span><br><span class="line">    v6 = v5+<span class="number">2</span></span><br><span class="line">    v14 ^= v6</span><br><span class="line">    check = enc[i-<span class="number">1</span>]==v14</span><br><span class="line"></span><br><span class="line">check = (a[i]+a[i-<span class="number">1</span>]%<span class="number">7</span>)^((a[i-<span class="number">1</span>]^<span class="number">18</span>)*<span class="number">3</span>+<span class="number">2</span>)==enc[i-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>爆破下s即可<br>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0xF3</span>, <span class="number">0x2E</span>, <span class="number">0x18</span>, <span class="number">0x36</span>, <span class="number">0xE1</span>, <span class="number">0x4C</span>, <span class="number">0x22</span>, <span class="number">0xD1</span>, <span class="number">0xF9</span>, <span class="number">0x8C</span>, <span class="number">0x40</span>, <span class="number">0x76</span>, <span class="number">0xF4</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0xA3</span>, <span class="number">0x90</span>, <span class="number">0x0E</span>, <span class="number">0xA5</span>]</span><br><span class="line"><span class="comment"># check = (a[i]+a[i-1]%7)^((a[i-1]^18)*3+2)==enc[i-1]</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">    a = []</span><br><span class="line">    a.append(s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        x = enc[i]^(((a[-<span class="number">1</span>]^<span class="number">18</span>)*<span class="number">3</span>+<span class="number">2</span>))</span><br><span class="line">        a.append(((x-a[-<span class="number">1</span>]%<span class="number">7</span>))&amp;<span class="number">0xff</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bytes</span>(a))</span><br><span class="line"><span class="string">b&#x27;#flag&#123;mY-CurR1ed_Fns&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>flag:<br><strong>flag{mY-CurR1ed_Fns}</strong></p>
<hr>
<hr>
<p>顺便记录一下另一个基于angr符号执行的deflat.py<br>用法:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 deflat.py hardCpp 0x4007E0</span><br><span class="line">python3 deflat.py xxx startaddr</span><br></pre></td></tr></table></figure>

<p>虽说感觉弄完后还没有D810插件弄得清晰 但是也了解一下用法 工具互补<br>这个deflat.py有个好处是他的汇编也是跟着优化了的 所以动调的话还是用这个工具来平坦化舒适的多</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://n0zom1z0.github.io/Reverse-Other/" data-id="clt7z1ktd001lq4th5kc90ap4" data-title="Reverse-Other" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/Crypto-ECC/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Crypto-ECC
        
      </div>
    </a>
  
  
    <a href="/ISCTF2023/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">ISCTF2023</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Crypto/">CTF-Crypto</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Re/">CTF-Re</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Reverse/">CTF-Reverse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-WP/">CTF-WP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF-Web/">CTF-Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReverseEngineering/">ReverseEngineering</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WHK/">WHK</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/osu/">osu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF-Crypto/" rel="tag">CTF-Crypto</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF-Crypto/" style="font-size: 10px;">CTF-Crypto</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/%E5%AF%86%E7%A0%81%E5%AD%A6%E8%84%9A%E6%9C%AC/">密码学脚本</a>
          </li>
        
          <li>
            <a href="/Crypto-Other-2/">Crypto-Other-2</a>
          </li>
        
          <li>
            <a href="/Hack-The-Box/">Hack-The-Box</a>
          </li>
        
          <li>
            <a href="/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C%E9%9D%B6%E5%9C%BA/">春秋云镜靶场</a>
          </li>
        
          <li>
            <a href="/VT%E5%A4%84%E7%90%86%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">VT处理器虚拟化技术学习</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 ULGANOY<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>
<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="一些杂题(密码)&#x2F; 比赛的密码题">
<meta property="og:type" content="article">
<meta property="og:title" content="Crypto-Other">
<meta property="og:url" content="http://n0zom1z0.github.io/Crypto-Other/index.html">
<meta property="og:site_name" content="N0zoM1z0">
<meta property="og:description" content="一些杂题(密码)&#x2F; 比赛的密码题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/12/17/Wqow4KuZbeg2RxG.jpg">
<meta property="article:published_time" content="2023-12-04T05:01:10.000Z">
<meta property="article:modified_time" content="2023-12-20T09:47:18.573Z">
<meta property="article:author" content="N0zoM1z0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/12/17/Wqow4KuZbeg2RxG.jpg">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Crypto-Other</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/N0zoM1z0">项目</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/web-CTFshow/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/Groebner%E5%9F%BA/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://n0zom1z0.github.io/Crypto-Other/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://n0zom1z0.github.io/Crypto-Other/&text=Crypto-Other"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://n0zom1z0.github.io/Crypto-Other/&is_video=false&description=Crypto-Other"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Crypto-Other&body=Check out this article: http://n0zom1z0.github.io/Crypto-Other/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://n0zom1z0.github.io/Crypto-Other/&name=Crypto-Other&description=&lt;p&gt;一些杂题(密码)&amp;#x2F; 比赛的密码题&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://n0zom1z0.github.io/Crypto-Other/&t=Crypto-Other"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#tsgctf2020"><span class="toc-number">1.</span> <span class="toc-text">tsgctf2020</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#beginners-crypto"><span class="toc-number">1.1.</span> <span class="toc-text">beginners_crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution1"><span class="toc-number">1.1.1.</span> <span class="toc-text">Solution1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution2"><span class="toc-number">1.1.2.</span> <span class="toc-text">Solution2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#modulus-amittendus"><span class="toc-number">1.2.</span> <span class="toc-text">modulus_amittendus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sweet-like-Apple-Pie"><span class="toc-number">1.3.</span> <span class="toc-text">Sweet like Apple Pie</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HITCON2019"><span class="toc-number">2.</span> <span class="toc-text">HITCON2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lost-Modulus-Again"><span class="toc-number">2.1.</span> <span class="toc-text">Lost Modulus Again</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Very-Simple-Haskell"><span class="toc-number">2.2.</span> <span class="toc-text">Very Simple Haskell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ISITDTU2019"><span class="toc-number">3.</span> <span class="toc-text">ISITDTU2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Easy-RSA-1"><span class="toc-number">3.1.</span> <span class="toc-text">Easy_RSA_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Easy-RSA-2"><span class="toc-number">3.2.</span> <span class="toc-text">Easy_RSA_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Old-Story"><span class="toc-number">3.3.</span> <span class="toc-text">Old_Story</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#KAPO2019"><span class="toc-number">4.</span> <span class="toc-text">KAPO2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lenstra-Lenstra-Lovasz"><span class="toc-number">4.1.</span> <span class="toc-text">Lenstra-Lenstra-Lovász</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moeCTF2023"><span class="toc-number">5.</span> <span class="toc-text">moeCTF2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flag-exchange"><span class="toc-number">5.1.</span> <span class="toc-text">flag_exchange</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#miniLCTF2021"><span class="toc-number">6.</span> <span class="toc-text">miniLCTF2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#asr"><span class="toc-number">6.1.</span> <span class="toc-text">asr</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ASISCTF2022"><span class="toc-number">7.</span> <span class="toc-text">ASISCTF2022</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mindseat"><span class="toc-number">7.1.</span> <span class="toc-text">Mindseat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chaffymasking"><span class="toc-number">7.2.</span> <span class="toc-text">chaffymasking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mariana"><span class="toc-number">7.3.</span> <span class="toc-text">Mariana</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ImaginaryCTF-2023"><span class="toc-number">8.</span> <span class="toc-text">ImaginaryCTF 2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sus"><span class="toc-number">8.1.</span> <span class="toc-text">sus</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF2023"><span class="toc-number">9.</span> <span class="toc-text">强网杯2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#not-only-rsa"><span class="toc-number">9.1.</span> <span class="toc-text">not_only_rsa</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Crypto-Other
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">N0zoM1z0</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-12-04T05:01:10.000Z" class="dt-published" itemprop="datePublished">2023-12-04</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/CTF-Crypto/">CTF-Crypto</a>
    </div>


      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>一些杂题(密码)&#x2F; 比赛的密码题</p>
<span id="more"></span>

<h1 id="tsgctf2020"><a href="#tsgctf2020" class="headerlink" title="tsgctf2020"></a>tsgctf2020</h1><h2 id="beginners-crypto"><a href="#beginners-crypto" class="headerlink" title="beginners_crypto"></a>beginners_crypto</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()) &lt;= <span class="number">50</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">str</span>(<span class="built_in">int</span>.from_bytes(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), byteorder=<span class="string">&#x27;big&#x27;</span>) &lt;&lt; <span class="number">10000</span>).endswith(<span class="string">&#x27;1002773875431658367671665822006771085816631054109509173556585546508965236428620487083647585179992085437922318783218149808537210712780660412301729655917441546549321914516504576&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>搁着开始没搞懂题目意思…<br>这其实就等价于 给出 <code>m*2**10000 = s (mod 10**175)</code>…<br>由于不互素 不能直接将逆元乘过去<br>两种方法:</p>
<h3 id="Solution1"><a href="#Solution1" class="headerlink" title="Solution1"></a>Solution1</h3><p>观察他们的gcd发现可以全部除掉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x =  (<span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">10000</span>,<span class="number">10</span>**<span class="number">175</span>))</span><br><span class="line">n = <span class="number">10</span>**<span class="number">175</span></span><br><span class="line"><span class="built_in">print</span>(gcd(x,n))</span><br><span class="line"><span class="built_in">print</span>(gcd(s,n))</span><br><span class="line">GCD = gcd(s,n)</span><br><span class="line">s //= GCD</span><br><span class="line">x //= GCD</span><br><span class="line">n //= GCD</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">m = modinv(x,n)*s%n</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>
<h3 id="Solution2"><a href="#Solution2" class="headerlink" title="Solution2"></a>Solution2</h3><p>可以改变模数 比如<code>10**175 -&gt; 5**175</code>这种<br>也就是选择新模数为原来模数的因子 且满足大于m的比特数即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">5</span>**<span class="number">175</span></span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">m = modinv(<span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">10000</span>,n),n)*s%n</span><br><span class="line"><span class="built_in">print</span>(n2s(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>
<p>flag: TSGCTF{0K4y_Y0U_are_r3aDy_t0_Go_aNd_dO_M0r3_CryPt}</p>
<h2 id="modulus-amittendus"><a href="#modulus-amittendus" class="headerlink" title="modulus_amittendus"></a>modulus_amittendus</h2><p>题目给的是rugby代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">require &#x27;openssl&#x27;</span><br><span class="line">require &#x27;json&#x27;</span><br><span class="line"></span><br><span class="line">def modinv(a, m)</span><br><span class="line">  m0, inv, x0 = m, 1, 0</span><br><span class="line">  while a &gt; 1</span><br><span class="line">    inv -= (a / m) * x0</span><br><span class="line">    a, m = m, a % m</span><br><span class="line">    inv, x0 = x0, inv</span><br><span class="line">  end</span><br><span class="line">  inv += m0 if inv &lt; 0</span><br><span class="line">  inv</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">class RSA</span><br><span class="line">  def initialize</span><br><span class="line">    @p = OpenSSL::BN::generate_prime(1024, true).to_i</span><br><span class="line">    @q = OpenSSL::BN::generate_prime(1024, true).to_i</span><br><span class="line">    @n = @p * @q</span><br><span class="line">    @e = 65537</span><br><span class="line">    @d = modinv(@e, (@p - 1) * (@q - 1))</span><br><span class="line">    @exp1 = @d % (@p - 1)</span><br><span class="line">    @exp2 = @d % (@q - 1)</span><br><span class="line">    @cf = modinv(@q, @p)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def encrypt(m)</span><br><span class="line">    m.pow(@e, @n)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def decrypt(c)</span><br><span class="line">    m1 = c.pow(@exp1, @p)</span><br><span class="line">    m2 = c.pow(@exp2, @q)</span><br><span class="line">    (m2 + @cf * (m1 - m2) % @p * @q) % @n</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def pubkey</span><br><span class="line">    privkey.to_a[..2].to_h</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def privkey</span><br><span class="line">    &#123;</span><br><span class="line">      e: @e,</span><br><span class="line">      n: @d,</span><br><span class="line">      cf: @cf,</span><br><span class="line">      p: @p,</span><br><span class="line">      q: @q,</span><br><span class="line">      exp1: @exp1,</span><br><span class="line">      exp2: @exp2,</span><br><span class="line">    &#125;</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">flag = File.read(&#x27;flag.txt&#x27;).unpack(&quot;H*&quot;)[0].hex</span><br><span class="line">rsa = RSA.new</span><br><span class="line">p rsa.encrypt(flag)</span><br><span class="line"></span><br><span class="line">File.write(&#x27;pubkey.json&#x27;, JSON.dump(rsa.pubkey))</span><br></pre></td></tr></table></figure>

<p>题目给了 d,e,c,modinv(q,p)要求m<br>没什么思路 瞄一眼WP 说是模仿的 HITCON2019LostModuleAgain 确实跟<a target="_blank" rel="noopener" href="https://github.com/pcw109550/write-up/blob/master/2019/HITCON/Lost_Modulus_Again/README.md">原题</a>一模一样 </p>
<p>只是原题给了 modinv(p,q)和modinv(q,p)这里只给了一个?<br>干脆复现原题吧</p>
<h2 id="Sweet-like-Apple-Pie"><a href="#Sweet-like-Apple-Pie" class="headerlink" title="Sweet like Apple Pie"></a>Sweet like Apple Pie</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line">getcontext().prec = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pi</span>():</span><br><span class="line">    lasts, t, s, n, na, d, da = <span class="number">0</span>, Decimal(<span class="number">3</span>), <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">24</span></span><br><span class="line">    <span class="keyword">while</span> s != lasts:</span><br><span class="line">        lasts = s</span><br><span class="line">        n, na = n + na, na + <span class="number">8</span></span><br><span class="line">        d, da = d + da, da + <span class="number">32</span></span><br><span class="line">        t = (t * n) / d</span><br><span class="line">        s += t</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sin</span>(<span class="params">x</span>):</span><br><span class="line">    x = Decimal(x) % pi()</span><br><span class="line">    p, factor = <span class="number">0</span>, x</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        p += factor</span><br><span class="line">        factor *= - (x ** <span class="number">2</span>) / ((<span class="number">2</span> * n + <span class="number">2</span>) * (<span class="number">2</span> * n + <span class="number">3</span>))</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">int</span>.from_bytes(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span>(flag &lt; <span class="number">2</span> ** <span class="number">500</span>)</span><br><span class="line"><span class="built_in">print</span>(sin(flag))</span><br></pre></td></tr></table></figure>

<p>output.txt</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.162452474092990408037062573408259688253995107643493293584426591003988903469791005222132158897198623144937279539555347413553688190959907095952250683633029959235933436782707275021817801890433801800730214807785288112267446678747104887584191096749196212784470161670299495426679759221652356130008110761143</span><br></pre></td></tr></table></figure>

<p>??? 完全不会… 这能还原?<br>只能看题解了<br><a target="_blank" rel="noopener" href="https://ctftime.org/writeup/22580">https://ctftime.org/writeup/22580</a></p>
<p>orz<br>题解思路大致学到了 代码实现还有点小问题(题解的solve也跑不出来啊…O0o?)</p>
<h1 id="HITCON2019"><a href="#HITCON2019" class="headerlink" title="HITCON2019"></a>HITCON2019</h1><h2 id="Lost-Modulus-Again"><a href="#Lost-Modulus-Again" class="headerlink" title="Lost Modulus Again"></a>Lost Modulus Again</h2><p>题目就不贴了 就是RSA 已知e,d,modinv(p,q),modinv(q,p)求m<br>数据:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Key([e = <span class="number">1048583</span>, n = <span class="number">20899585599499852848600179189763086698516108548228367107221738096450499101070075492197700491683249172909869748620431162381087017866603003080844372390109407618883775889949113518883655204495367156356586733638609604914325927159037673858380872827051492954190012228501796895529660404878822550757780926433386946425164501187561418082866346427628551763297010068329425460680225523270632454412376673863754258135691783420342075219153761633410012733450586771838248239221434791288928709490210661095249658730871114233033907339401132548352479119599592161475582267434069666373923164546185334225821332964035123667137917080001159691927</span>, x = <span class="number">22886390627173202444468626406642274959028635116543626995297684671305848436910064602418012808595951325519844918478912090039470530649857775854959462500919029371215000179065185673136642143061689849338228110909931445119687113803523924040922470616407096745128917352037282612768345609735657018628096338779732460743</span>, y = <span class="number">138356012157150927033117814862941924437637775040379746970778376921933744927520585574595823734209547857047013402623714044512594300691782086053475259157899010363944831564630625623351267412232071416191142966170634950729938561841853176635423819365023039470901382901261884795304947251115006930995163847675576699331</span>])</span><br><span class="line">c = <span class="number">0x32074de818f2feeb788e36d7d3ee09f0000381584a72b2fba0dcc9a2ebe5fd79cf2d6fd40c4dbfea27d3489704f2c1a30b17a783baa67229d02043c5bc9bdb995ae984d80a96bd79370ea2c356f39f85a12d16983598c1fb772f9183441fea5dfeb5b26455df75de18ce70a6a9e9dbc0a4ca434ba94cf4d1e5347395cf7aafa756c8a5bd6fd166bc30245a4bded28f5baac38d024042a166369f7515e8b0c479a1965b5988b350064648738f6585c0a0d1463bd536d11a105bb926b44236593b5c6c71ef5b132cd9c211e8ad9131aa53ffde88f5b0df18e7c45bcdb6244edcaa8d386196d25297c259fca3be37f0f2015f40cb5423a918c51383390dfd5a8703</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>不得不说出的真的很好<br>脚本套多了真的会忽略这些大小估计 整除关系 转化方程… 这些思想在这道题体现的很充分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">q*x = 1+k1*p</span><br><span class="line">p*y = 1+k2*q</span><br><span class="line">=&gt; q*(x+k2) = p*(y+k1)</span><br><span class="line">notice that x&lt;p y&lt;q k1&lt;q k2&lt;p</span><br><span class="line">and p,q are coprime</span><br><span class="line">=&gt; q|(y+k1) &amp; 0&lt;y+k1&lt;2q =&gt; y+k1=q</span><br><span class="line">the same as p =&gt; x+k2=p</span><br><span class="line">suprisingly, we actually have k1*k2+1=x*y   </span><br><span class="line">soshite</span><br><span class="line">=&gt; phi = (p-1)*(q-1)</span><br><span class="line">       = (x+k2-1)*(y+k1-1)</span><br><span class="line">       = (x-1)*(y-1)+k1*(x-1)+k2*(y-1)+k1*k2</span><br><span class="line"></span><br><span class="line">use the equal k1*k2+1=x*y above</span><br><span class="line">=&gt; (x-1)*k1**2+(x*y-1-phi+(x-1)*(y-1))*k1+(y-1)*(x*y-1)=0</span><br><span class="line">这样代入phi的所有可能值求解一个关于k1的二次方程 利用k1为整数的限制就能得到phi</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">1048583</span></span><br><span class="line">d = <span class="number">20899585599499852848600179189763086698516108548228367107221738096450499101070075492197700491683249172909869748620431162381087017866603003080844372390109407618883775889949113518883655204495367156356586733638609604914325927159037673858380872827051492954190012228501796895529660404878822550757780926433386946425164501187561418082866346427628551763297010068329425460680225523270632454412376673863754258135691783420342075219153761633410012733450586771838248239221434791288928709490210661095249658730871114233033907339401132548352479119599592161475582267434069666373923164546185334225821332964035123667137917080001159691927</span></span><br><span class="line">x = <span class="number">22886390627173202444468626406642274959028635116543626995297684671305848436910064602418012808595951325519844918478912090039470530649857775854959462500919029371215000179065185673136642143061689849338228110909931445119687113803523924040922470616407096745128917352037282612768345609735657018628096338779732460743</span></span><br><span class="line">y = <span class="number">138356012157150927033117814862941924437637775040379746970778376921933744927520585574595823734209547857047013402623714044512594300691782086053475259157899010363944831564630625623351267412232071416191142966170634950729938561841853176635423819365023039470901382901261884795304947251115006930995163847675576699331</span></span><br><span class="line">c = <span class="number">0x32074de818f2feeb788e36d7d3ee09f0000381584a72b2fba0dcc9a2ebe5fd79cf2d6fd40c4dbfea27d3489704f2c1a30b17a783baa67229d02043c5bc9bdb995ae984d80a96bd79370ea2c356f39f85a12d16983598c1fb772f9183441fea5dfeb5b26455df75de18ce70a6a9e9dbc0a4ca434ba94cf4d1e5347395cf7aafa756c8a5bd6fd166bc30245a4bded28f5baac38d024042a166369f7515e8b0c479a1965b5988b350064648738f6585c0a0d1463bd536d11a105bb926b44236593b5c6c71ef5b132cd9c211e8ad9131aa53ffde88f5b0df18e7c45bcdb6244edcaa8d386196d25297c259fca3be37f0f2015f40cb5423a918c51383390dfd5a8703</span></span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot,gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># First to calculate possible phis</span></span><br><span class="line">phis = []</span><br><span class="line">kphi = d*e-<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,e):</span><br><span class="line">    <span class="keyword">if</span>(kphi%k==<span class="number">0</span>):</span><br><span class="line">        phi = kphi//k</span><br><span class="line">        <span class="keyword">if</span>(gcd(e,phi)==<span class="number">1</span>):</span><br><span class="line">            phis.append(phi)</span><br><span class="line"><span class="comment"># print(len(phis)) # 923</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Then use</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> phi <span class="keyword">in</span> phis:</span><br><span class="line">    a = (x-<span class="number">1</span>)</span><br><span class="line">    b = (x*y-<span class="number">1</span>-phi+(x-<span class="number">1</span>)*(y-<span class="number">1</span>))</span><br><span class="line">    cc = (y-<span class="number">1</span>)*(x*y-<span class="number">1</span>)</span><br><span class="line">    delta = b*b-<span class="number">4</span>*a*cc</span><br><span class="line">    <span class="keyword">if</span>(iroot(delta,<span class="number">2</span>)[<span class="number">1</span>]==<span class="literal">True</span>):</span><br><span class="line">        <span class="built_in">print</span>(phi)</span><br><span class="line">        k1 = (-b+iroot(delta,<span class="number">2</span>)[<span class="number">0</span>])//(<span class="number">2</span>*a)</span><br><span class="line">        k2 = (-b-iroot(delta,<span class="number">2</span>)[<span class="number">0</span>])//(<span class="number">2</span>*a)</span><br><span class="line">        <span class="built_in">print</span>(k1,k2)</span><br><span class="line"></span><br><span class="line">phi  = <span class="number">22509077260984027608263845908083202879597081619164800783060781115945741547031252889863077300004310236160814653393991988068104999928735140821504649764471313283345921984799288521496479399032837319974588038186917872597078510975400908137738190304700710900604891709265153418588830065918981914371070605822998222526936764035473024951172438654405051015158373989943636215751206002298354662255322404681649160859586893385153685796114347024559211776931935054744445492193990127160520676232531227390204623950157430966169435920800794748331292066769479560454753704770229274680560878024797177827265072368595931697411659251440631501728</span></span><br><span class="line">k1 = <span class="number">28208949439955302309848635580625081491778513331790561038922122543347871461021445160004265905257374948095564180270338913034580463560285897071083488435445872411686139458980129711508020003449180850634252661246277255619651792037014931213229280933988207275950107375275346841229515570544044065150714741967440182598</span></span><br><span class="line">q = y+k1</span><br><span class="line"><span class="keyword">assert</span> isPrime(q)</span><br><span class="line">p = phi//(q-<span class="number">1</span>)+<span class="number">1</span></span><br><span class="line">n = p*q</span><br><span class="line"><span class="comment"># print(n)</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br><span class="line"><span class="comment"># hitcon&#123;1t_is_50_easy_t0_find_th3_modulus_back@@!!@!@!@@!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Very-Simple-Haskell"><a href="#Very-Simple-Haskell" class="headerlink" title="Very Simple Haskell"></a>Very Simple Haskell</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Data.Char</span><br><span class="line"><span class="keyword">import</span> System.IO</span><br><span class="line"></span><br><span class="line"><span class="title">n</span> :: <span class="type">Integer</span></span><br><span class="line"><span class="title">n</span> = <span class="number">134896036104102133446208954973118530800743044711419303630456535295204304771800100892609593430702833309387082353959992161865438523195671760946142657809228938824313865760630832980160727407084204864544706387890655083179518455155520501821681606874346463698215916627632418223019328444607858743434475109717014763667</span></span><br><span class="line"></span><br><span class="line"><span class="title">k</span> :: <span class="type">Int</span></span><br><span class="line"><span class="title">k</span> = <span class="number">131</span></span><br><span class="line"></span><br><span class="line"><span class="title">primes</span> :: [<span class="type">Integer</span>]</span><br><span class="line"><span class="title">primes</span> = take k $ sieve (<span class="number">2</span> : [<span class="number">3</span>, <span class="number">5</span>..])</span><br><span class="line">  <span class="keyword">where</span></span><br><span class="line">    sieve (p:xs) = p : sieve [x|x &lt;- xs, x `mod` p &gt; <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="title">stringToInteger</span> :: <span class="type">String</span> -&gt; <span class="type">Integer</span></span><br><span class="line"><span class="title">stringToInteger</span> str = foldl (\x y -&gt; (toInteger $ ord y) + x*<span class="number">256</span>) <span class="number">0</span> str</span><br><span class="line"></span><br><span class="line"><span class="title">integerToString</span> :: <span class="type">Integer</span> -&gt; <span class="type">String</span></span><br><span class="line"><span class="title">integerToString</span> num = f num <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">        f <span class="number">0</span> str = str</span><br><span class="line">        f num str = f (div num <span class="number">256</span>) $ (:) (chr $ fromIntegral $ num `mod` <span class="number">256</span>) str</span><br><span class="line"></span><br><span class="line"><span class="title">numToBits</span> :: <span class="type">Integer</span> -&gt; [<span class="type">Int</span>]</span><br><span class="line"><span class="title">numToBits</span> num = f num []</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">        f <span class="number">0</span> arr = arr</span><br><span class="line">        f x arr = f (div x <span class="number">2</span>) ((fromInteger $ x `mod` <span class="number">2</span>) : arr)</span><br><span class="line"></span><br><span class="line"><span class="title">extendBits</span> :: <span class="type">Int</span> -&gt; [<span class="type">Int</span>] -&gt; [<span class="type">Int</span>]</span><br><span class="line"><span class="title">extendBits</span> blockLen arr</span><br><span class="line">    | len == <span class="number">0</span> = arr</span><br><span class="line">    | len &gt; <span class="number">0</span> = (replicate (blockLen-len) <span class="number">0</span>) ++ arr</span><br><span class="line">    <span class="keyword">where</span> len = (length arr) `mod` blockLen</span><br><span class="line"></span><br><span class="line"><span class="title">calc</span> :: <span class="type">Integer</span> -&gt; [<span class="type">Int</span>] -&gt; <span class="type">Integer</span></span><br><span class="line"><span class="title">calc</span> num [] = num</span><br><span class="line"><span class="title">calc</span> num arr = calc result restArr</span><br><span class="line">    <span class="keyword">where</span></span><br><span class="line">        num2 = num*num `mod` n</span><br><span class="line">        (block, restArr) = splitAt k arr</span><br><span class="line">        zipped = zipWith (\x y -&gt; ((fromIntegral x)*y) `mod` n) block primes  </span><br><span class="line">        mul = product $ filter (/=<span class="number">0</span>) zipped</span><br><span class="line">        result = num2*mul `mod` n</span><br><span class="line"></span><br><span class="line"><span class="title">magic</span> :: <span class="type">String</span> -&gt; <span class="type">String</span></span><br><span class="line"><span class="title">magic</span> input = result</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">        num = stringToInteger input</span><br><span class="line">        bits = numToBits num</span><br><span class="line">        extended = reverse $ extendBits <span class="number">8</span> bits</span><br><span class="line">        oriLen = length extended</span><br><span class="line">        extendedBits = extendBits k extended</span><br><span class="line">        oriLenBits = numToBits $ fromIntegral oriLen</span><br><span class="line">        extendedOriLenBits = extendBits k oriLenBits</span><br><span class="line">        finalBits = extendedOriLenBits ++ extendedBits</span><br><span class="line">        result = show $ calc <span class="number">1</span> (reverse finalBits)</span><br><span class="line"></span><br><span class="line"><span class="title">main</span> = <span class="keyword">do</span></span><br><span class="line">    flag &lt;- readFile <span class="string">&quot;flag&quot;</span></span><br><span class="line">    putStrLn.show $ length flag</span><br><span class="line">    putStrLn $ magic (<span class="string">&quot;the flag is hitcon&#123;&quot;</span> ++ flag ++ <span class="string">&quot;&#125;&quot;</span>) </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>output</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">84329776255618646348016649734028295037597157542985867506958273359305624184282146866144159754298613694885173220275408231387000884549683819822991588176788392625802461171856762214917805903544785532328453620624644896107723229373581460638987146506975123149045044762903664396325969329482406959546962473688947985096</span><br></pre></td></tr></table></figure>

<p>AI将haskell转成python代码 是一个 Naccache-Stern Knapsack Cryptosystem<br><a href="https://eprint.iacr.org/2017/421.pdf" target="_balnk">here</a><br>emm 先放这 以后再来看</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">primes=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>,<span class="number">83</span>,<span class="number">89</span>,<span class="number">97</span>,<span class="number">101</span>,<span class="number">103</span>,<span class="number">107</span>,<span class="number">109</span>,<span class="number">113</span>,<span class="number">127</span>,<span class="number">131</span>,<span class="number">137</span>,<span class="number">139</span>,<span class="number">149</span>,<span class="number">151</span>,<span class="number">157</span>,<span class="number">163</span>,<span class="number">167</span>,<span class="number">173</span>,<span class="number">179</span>,<span class="number">181</span>,<span class="number">191</span>,<span class="number">193</span>,<span class="number">197</span>,<span class="number">199</span>,<span class="number">211</span>,<span class="number">223</span>,<span class="number">227</span>,<span class="number">229</span>,<span class="number">233</span>,<span class="number">239</span>,<span class="number">241</span>,<span class="number">251</span>,<span class="number">257</span>,<span class="number">263</span>,<span class="number">269</span>,<span class="number">271</span>,<span class="number">277</span>,<span class="number">281</span>,<span class="number">283</span>,<span class="number">293</span>,<span class="number">307</span>,<span class="number">311</span>,<span class="number">313</span>,<span class="number">317</span>,<span class="number">331</span>,<span class="number">337</span>,<span class="number">347</span>,<span class="number">349</span>,<span class="number">353</span>,<span class="number">359</span>,<span class="number">367</span>,<span class="number">373</span>,<span class="number">379</span>,<span class="number">383</span>,<span class="number">389</span>,<span class="number">397</span>,<span class="number">401</span>,<span class="number">409</span>,<span class="number">419</span>,<span class="number">421</span>,<span class="number">431</span>,<span class="number">433</span>,<span class="number">439</span>,<span class="number">443</span>,<span class="number">449</span>,<span class="number">457</span>,<span class="number">461</span>,<span class="number">463</span>,<span class="number">467</span>,<span class="number">479</span>,<span class="number">487</span>,<span class="number">491</span>,<span class="number">499</span>,<span class="number">503</span>,<span class="number">509</span>,<span class="number">521</span>,<span class="number">523</span>,<span class="number">541</span>,<span class="number">547</span>,<span class="number">557</span>,<span class="number">563</span>,<span class="number">569</span>,<span class="number">571</span>,<span class="number">577</span>,<span class="number">587</span>,<span class="number">593</span>,<span class="number">599</span>,<span class="number">601</span>,<span class="number">607</span>,<span class="number">613</span>,<span class="number">617</span>,<span class="number">619</span>,<span class="number">631</span>,<span class="number">641</span>,<span class="number">643</span>,<span class="number">647</span>,<span class="number">653</span>,<span class="number">659</span>,<span class="number">661</span>,<span class="number">673</span>,<span class="number">677</span>,<span class="number">683</span>,<span class="number">691</span>,<span class="number">701</span>,<span class="number">709</span>,<span class="number">719</span>,<span class="number">727</span>,<span class="number">733</span>,<span class="number">739</span>,<span class="number">743</span>,<span class="number">751</span>,<span class="number">757</span>,<span class="number">761</span>,<span class="number">769</span>,<span class="number">773</span>,<span class="number">787</span>,<span class="number">797</span>,<span class="number">809</span>,<span class="number">811</span>,<span class="number">821</span>,<span class="number">823</span>,<span class="number">827</span>,<span class="number">829</span>,<span class="number">839</span>,<span class="number">853</span>,<span class="number">857</span>,<span class="number">859</span>,<span class="number">863</span>,<span class="number">877</span>,<span class="number">881</span>,<span class="number">883</span>,<span class="number">887</span>,<span class="number">907</span>,<span class="number">911</span>,<span class="number">919</span>,<span class="number">929</span>,<span class="number">937</span>,<span class="number">941</span>,<span class="number">947</span>,<span class="number">953</span>,<span class="number">967</span>,<span class="number">971</span>,<span class="number">977</span>,<span class="number">983</span>,<span class="number">991</span>,<span class="number">997</span>]</span><br><span class="line">n = <span class="number">134896036104102133446208954973118530800743044711419303630456535295204304771800100892609593430702833309387082353959992161865438523195671760946142657809228938824313865760630832980160727407084204864544706387890655083179518455155520501821681606874346463698215916627632418223019328444607858743434475109717014763667</span></span><br><span class="line"></span><br><span class="line">enc=<span class="number">84329776255618646348016649734028295037597157542985867506958273359305624184282146866144159754298613694885173220275408231387000884549683819822991588176788392625802461171856762214917805903544785532328453620624644896107723229373581460638987146506975123149045044762903664396325969329482406959546962473688947985096</span></span><br><span class="line">bit2int = <span class="keyword">lambda</span> x: <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, x)), <span class="number">2</span>)</span><br><span class="line">m = <span class="number">129105988525739869308153101831605950072860268575706582195774923614094296354415364173823406181109200888049609207238266506466864447780824680862439187440797565555486108716502098901182492654356397840996322893263870349262138909453630565384869193972124927953237311411285678188486737576555535085444384901167109670365</span></span><br><span class="line">z = enc * libnum.invmod(m, n) % n</span><br><span class="line">bits = [(z % p == <span class="number">0</span>) * <span class="number">1</span> <span class="keyword">for</span> p <span class="keyword">in</span> primes]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>*<span class="number">20</span>, <span class="number">8</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(bit2int(bits[<span class="number">5</span>:][i:i+<span class="number">8</span>])))</span><br></pre></td></tr></table></figure>


<h1 id="ISITDTU2019"><a href="#ISITDTU2019" class="headerlink" title="ISITDTU2019"></a>ISITDTU2019</h1><h2 id="Easy-RSA-1"><a href="#Easy-RSA-1" class="headerlink" title="Easy_RSA_1"></a>Easy_RSA_1</h2><p>题目给了n,e,c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = 137709853388874260067664060306224801065880567280896538344708662296491187670268243771581008615887329285442080267493172576517227603581814922784005894668293664250883858847270414696279127204843462302026428548409668060539273696154323753582118715764251826181439387752900169898505518594134423187783089073450520527969</span><br><span class="line">e = 85605944479801539190292577400294315989703364683792339737453887619652946907819548388390076584246192710348319524405250340541547224543819349494488596679810310694697763188201375896240755682682520811114377302206659716598003967368992125832908158096663258971132148617761060030524535044970322206572134828548118438019</span><br><span class="line">c = 22066874366908131522623165919721031154048372827959879486746669804284618882326621205522887800063326155288431192110879403482210420111408801477749097399368616494107231276644736023482237804800287810317122448198973027350599454646050497733117161743355379588761228932055556016302337519814538743706899009493572298224</span><br></pre></td></tr></table></figure>
<p>可以发现这里n(1024)和e(1023)的bit数差的很小<br>这里学习到一手 <code>Boneh-Durfee-Attack</code> 这个攻击的适用条件比维纳攻击宽一点<br>满足 d &lt; N^0.292 时可以使用<br>直接套模板了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Config</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting debug to true will display more informations</span></span><br><span class="line"><span class="string">about the lattice, the bounds, the vectors...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Setting strict to true will stop the algorithm (and</span></span><br><span class="line"><span class="string">return (-1, -1)) if we don&#x27;t have a correct</span></span><br><span class="line"><span class="string">upperbound on the determinant. Note that this</span></span><br><span class="line"><span class="string">doesn&#x27;t necesseraly mean that no solutions</span></span><br><span class="line"><span class="string">will be found since the theoretical upperbound is</span></span><br><span class="line"><span class="string">usualy far away from actual results. That is why</span></span><br><span class="line"><span class="string">you should probably use `strict = False`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">strict = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">This is experimental, but has provided remarkable results</span></span><br><span class="line"><span class="string">so far. It tries to reduce the lattice as much as it can</span></span><br><span class="line"><span class="string">while keeping its efficiency. I see no reason not to use</span></span><br><span class="line"><span class="string">this option, but if things don&#x27;t work, you should try</span></span><br><span class="line"><span class="string">disabling it</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">helpful_only = <span class="literal">True</span></span><br><span class="line">dimension_min = <span class="number">7</span> <span class="comment"># stop removing if lattice reaches that dimension</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment"># Functions</span></span><br><span class="line"><span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display stats on helpful vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helpful_vectors</span>(<span class="params">BB, modulus</span>):</span><br><span class="line">    nothelpful = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">if</span> BB[ii,ii] &gt;= modulus:</span><br><span class="line">            nothelpful += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(nothelpful, <span class="string">&quot;/&quot;</span>, BB.dimensions()[<span class="number">0</span>], <span class="string">&quot; vectors are not helpful&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display matrix picture with 0 and X</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_overview</span>(<span class="params">BB, bound</span>):</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">        a = (<span class="string">&#x27;%02d &#x27;</span> % ii)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(BB.dimensions()[<span class="number">1</span>]):</span><br><span class="line">            a += <span class="string">&#x27;0&#x27;</span> <span class="keyword">if</span> BB[ii,jj] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> BB.dimensions()[<span class="number">0</span>] &lt; <span class="number">60</span>:</span><br><span class="line">                a += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            a += <span class="string">&#x27;~&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># tries to remove unhelpful vectors</span></span><br><span class="line"><span class="comment"># we start at current = n-1 (last vector)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_unhelpful</span>(<span class="params">BB, monomials, bound, current</span>):</span><br><span class="line">    <span class="comment"># end of our recursive function</span></span><br><span class="line">    <span class="keyword">if</span> current == -<span class="number">1</span> <span class="keyword">or</span> BB.dimensions()[<span class="number">0</span>] &lt;= dimension_min:</span><br><span class="line">        <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we start by checking from the end</span></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(current, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="comment"># if it is unhelpful:</span></span><br><span class="line">        <span class="keyword">if</span> BB[ii, ii] &gt;= bound:</span><br><span class="line">            affected_vectors = <span class="number">0</span></span><br><span class="line">            affected_vector_index = <span class="number">0</span></span><br><span class="line">            <span class="comment"># let&#x27;s check if it affects other vectors</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(ii + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                <span class="comment"># if another vector is affected:</span></span><br><span class="line">                <span class="comment"># we increase the count</span></span><br><span class="line">                <span class="keyword">if</span> BB[jj, ii] != <span class="number">0</span>:</span><br><span class="line">                    affected_vectors += <span class="number">1</span></span><br><span class="line">                    affected_vector_index = jj</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:0</span></span><br><span class="line">            <span class="comment"># if no other vectors end up affected</span></span><br><span class="line">            <span class="comment"># we remove it</span></span><br><span class="line">            <span class="keyword">if</span> affected_vectors == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vector&quot;</span>, ii)</span><br><span class="line">                BB = BB.delete_columns([ii])</span><br><span class="line">                BB = BB.delete_rows([ii])</span><br><span class="line">                monomials.pop(ii)</span><br><span class="line">                BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line">            <span class="comment"># level:1</span></span><br><span class="line">            <span class="comment"># if just one was affected we check</span></span><br><span class="line">            <span class="comment"># if it is affecting someone else</span></span><br><span class="line">            <span class="keyword">elif</span> affected_vectors == <span class="number">1</span>:</span><br><span class="line">                affected_deeper = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(affected_vector_index + <span class="number">1</span>, BB.dimensions()[<span class="number">0</span>]):</span><br><span class="line">                    <span class="comment"># if it is affecting even one vector</span></span><br><span class="line">                    <span class="comment"># we give up on this one</span></span><br><span class="line">                    <span class="keyword">if</span> BB[kk, affected_vector_index] != <span class="number">0</span>:</span><br><span class="line">                        affected_deeper = <span class="literal">False</span></span><br><span class="line">                <span class="comment"># remove both it if no other vector was affected and</span></span><br><span class="line">                <span class="comment"># this helpful vector is not helpful enough</span></span><br><span class="line">                <span class="comment"># compared to our unhelpful one</span></span><br><span class="line">                <span class="keyword">if</span> affected_deeper <span class="keyword">and</span> <span class="built_in">abs</span>(bound - BB[affected_vector_index, affected_vector_index]) &lt; <span class="built_in">abs</span>(bound - BB[ii, ii]):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;* removing unhelpful vectors&quot;</span>, ii, <span class="string">&quot;and&quot;</span>, affected_vector_index)</span><br><span class="line">                    BB = BB.delete_columns([affected_vector_index, ii])</span><br><span class="line">                    BB = BB.delete_rows([affected_vector_index, ii])</span><br><span class="line">                    monomials.pop(affected_vector_index)</span><br><span class="line">                    monomials.pop(ii)</span><br><span class="line">                    BB = remove_unhelpful(BB, monomials, bound, ii-<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> BB</span><br><span class="line">    <span class="comment"># nothing happened</span></span><br><span class="line">    <span class="keyword">return</span> BB</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot; </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">* 0,0   if it fails</span></span><br><span class="line"><span class="string">* -1,-1 if `strict=true`, and determinant doesn&#x27;t bound</span></span><br><span class="line"><span class="string">* x0,y0 the solutions of `pol`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">boneh_durfee</span>(<span class="params">pol, modulus, mm, tt, XX, YY</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Boneh and Durfee revisited by Herrmann and May</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    finds a solution if:</span></span><br><span class="line"><span class="string">    * d &lt; N^delta</span></span><br><span class="line"><span class="string">    * |x| &lt; e^delta</span></span><br><span class="line"><span class="string">    * |y| &lt; e^0.5</span></span><br><span class="line"><span class="string">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># substitution (Herrman and May)</span></span><br><span class="line">    PR.&lt;u, x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    Q = PR.quotient(x*y + <span class="number">1</span> - u) <span class="comment"># u = xy + 1</span></span><br><span class="line">    polZ = Q(pol).lift()</span><br><span class="line"></span><br><span class="line">    UU = XX*YY + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts</span></span><br><span class="line">    gg = []</span><br><span class="line">    <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(mm + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(mm - kk + <span class="number">1</span>):</span><br><span class="line">            xshift = x^ii * modulus^(mm - kk) * polZ(u, x, y)^kk</span><br><span class="line">            gg.append(xshift)</span><br><span class="line">    gg.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># x-shifts list of monomials</span></span><br><span class="line">    monomials = []</span><br><span class="line">    <span class="keyword">for</span> polynomial <span class="keyword">in</span> gg:</span><br><span class="line">        <span class="keyword">for</span> monomial <span class="keyword">in</span> polynomial.monomials():</span><br><span class="line">            <span class="keyword">if</span> monomial <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">                monomials.append(monomial)</span><br><span class="line">    monomials.sort()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts (selected by Herrman and May)</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            yshift = y^jj * polZ(u, x, y)^kk * modulus^(mm - kk)</span><br><span class="line">            yshift = Q(yshift).lift()</span><br><span class="line">            gg.append(yshift) <span class="comment"># substitution</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># y-shifts list of monomials</span></span><br><span class="line">    <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, tt + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> kk <span class="keyword">in</span> <span class="built_in">range</span>(floor(mm/tt) * jj, mm + <span class="number">1</span>):</span><br><span class="line">            monomials.append(u^kk * y^jj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># construct lattice B</span></span><br><span class="line">    nn = <span class="built_in">len</span>(monomials)</span><br><span class="line">    BB = Matrix(ZZ, nn)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">        BB[ii, <span class="number">0</span>] = gg[ii](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ii + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> monomials[jj] <span class="keyword">in</span> gg[ii].monomials():</span><br><span class="line">                BB[ii, jj] = gg[ii].monomial_coefficient(monomials[jj]) * monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Prototype to reduce the lattice</span></span><br><span class="line">    <span class="keyword">if</span> helpful_only:</span><br><span class="line">        <span class="comment"># automatically remove</span></span><br><span class="line">        BB = remove_unhelpful(BB, monomials, modulus^mm, nn-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># reset dimension</span></span><br><span class="line">        nn = BB.dimensions()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> nn == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;failure&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>,<span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check if vectors are helpful</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        helpful_vectors(BB, modulus^mm)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># check if determinant is correctly bounded</span></span><br><span class="line">    det = BB.det()</span><br><span class="line">    bound = modulus^(mm*nn)</span><br><span class="line">    <span class="keyword">if</span> det &gt;= bound:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Try with highers m and t.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> debug:</span><br><span class="line">            diff = (log(det) - log(bound)) / log(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;size det(L) - size e^(m*n) = &quot;</span>, floor(diff))</span><br><span class="line">        <span class="keyword">if</span> strict:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># display the lattice basis</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        matrix_overview(BB, modulus^mm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LLL</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span>)</span><br><span class="line"></span><br><span class="line">    BB = BB.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;LLL is done!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;looking for independent vectors in the lattice&quot;</span>)</span><br><span class="line">    found_polynomials = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> pol1_idx <span class="keyword">in</span> <span class="built_in">range</span>(nn - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> pol2_idx <span class="keyword">in</span> <span class="built_in">range</span>(pol1_idx + <span class="number">1</span>, nn):</span><br><span class="line">            <span class="comment"># for i and j, create the two polynomials</span></span><br><span class="line">            PR.&lt;w,z&gt; = PolynomialRing(ZZ)</span><br><span class="line">            pol1 = pol2 = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> jj <span class="keyword">in</span> <span class="built_in">range</span>(nn):</span><br><span class="line">                pol1 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol1_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line">                pol2 += monomials[jj](w*z+<span class="number">1</span>,w,z) * BB[pol2_idx, jj] / monomials[jj](UU,XX,YY)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># resultant</span></span><br><span class="line">            PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">            rr = pol1.resultant(pol2)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># are these good polynomials?</span></span><br><span class="line">            <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;found them, using vectors&quot;</span>, pol1_idx, <span class="string">&quot;and&quot;</span>, pol2_idx)</span><br><span class="line">                found_polynomials = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> found_polynomials:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_polynomials:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    rr = rr(q, q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solutions</span></span><br><span class="line">    soly = rr.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(soly) == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Your prediction (delta) is too small&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    soly = soly[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    ss = pol1(q, soly)</span><br><span class="line">    solx = ss.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">return</span> solx, soly</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>(<span class="params">N,e</span>):</span><br><span class="line">    <span class="comment">############################################</span></span><br><span class="line">    <span class="comment"># How To Use This Script</span></span><br><span class="line">    <span class="comment">##########################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># The problem to solve (edit the following values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span></span><br><span class="line">    delta = <span class="number">.18</span> <span class="comment"># this means that d &lt; N^delta</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Lattice (tweak those values)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span></span><br><span class="line">    m = <span class="number">4</span> <span class="comment"># size of the lattice (bigger the better/slower)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># you need to be a lattice master to tweak these</span></span><br><span class="line">    t = <span class="built_in">int</span>((<span class="number">1</span>-<span class="number">2</span>*delta) * m)  <span class="comment"># optimization from Herrmann and May</span></span><br><span class="line">    X = <span class="number">2</span>*floor(N^delta)  <span class="comment"># this _might_ be too much</span></span><br><span class="line">    Y = floor(N^(<span class="number">1</span>/<span class="number">2</span>))    <span class="comment"># correct if p, q are ~ same size</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Don&#x27;t touch anything below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Problem put in equation</span></span><br><span class="line">    P.&lt;x,y&gt; = PolynomialRing(ZZ)</span><br><span class="line">    A = <span class="built_in">int</span>((N+<span class="number">1</span>)/<span class="number">2</span>)</span><br><span class="line">    pol = <span class="number">1</span> + x * (A + y)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Find the solutions!</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Checking bounds</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== checking values ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta:&quot;</span>, delta)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* delta &lt; 0.292&quot;</span>, delta &lt; <span class="number">0.292</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of e:&quot;</span>, <span class="built_in">int</span>(log(e)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* size of N:&quot;</span>, <span class="built_in">int</span>(log(N)/log(<span class="number">2</span>)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;* m:&quot;</span>, m, <span class="string">&quot;, t:&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># boneh_durfee</span></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== running algorithm ===&quot;</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line"></span><br><span class="line">    solx, soly = boneh_durfee(pol, e, m, t, X, Y)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># found a solution?</span></span><br><span class="line">    <span class="keyword">if</span> solx &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== solution found ===&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;x:&quot;</span>, solx)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;y:&quot;</span>, soly)</span><br><span class="line"></span><br><span class="line">        d = <span class="built_in">int</span>(pol(solx, soly) / e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;private key found:&quot;</span>, d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=== no solution was found ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> debug:</span><br><span class="line">        <span class="built_in">print</span>((<span class="string">&quot;=== %s seconds ===&quot;</span> % (time.time() - start_time)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># the modulus</span></span><br><span class="line">    N = <span class="number">137709853388874260067664060306224801065880567280896538344708662296491187670268243771581008615887329285442080267493172576517227603581814922784005894668293664250883858847270414696279127204843462302026428548409668060539273696154323753582118715764251826181439387752900169898505518594134423187783089073450520527969</span></span><br><span class="line">    <span class="comment"># the public exponent</span></span><br><span class="line">    e = <span class="number">85605944479801539190292577400294315989703364683792339737453887619652946907819548388390076584246192710348319524405250340541547224543819349494488596679810310694697763188201375896240755682682520811114377302206659716598003967368992125832908158096663258971132148617761060030524535044970322206572134828548118438019</span></span><br><span class="line">    example(N,e)</span><br></pre></td></tr></table></figure>
<p>得到 <code>d = 106354342195162244579308763693125372187924746644745144997173096990722844612139</code><br>即可 <code>ISITDTU&#123;Thank5_f0r_4tt3nd1ng_0ur_C0nt3st&#125;</code></p>
<h2 id="Easy-RSA-2"><a href="#Easy-RSA-2" class="headerlink" title="Easy_RSA_2"></a>Easy_RSA_2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;##################################&#x27;</span></span><br><span class="line">p1 = getPrime(<span class="number">512</span>)</span><br><span class="line">p2 = gmpy2.next_prime(p1)</span><br><span class="line">q1 = getPrime(<span class="number">512</span>)</span><br><span class="line">q2 = gmpy2.next_prime(q1)</span><br><span class="line">n = p1*p2*q1*q2</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p1-<span class="number">1</span>)*(p2-<span class="number">1</span>)*(q1-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi)</span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag),e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(p1+q2,<span class="number">65537</span>,n)</span><br><span class="line"><span class="comment">#5043622010330564722783560796388733110223192234657313797979729183216316602247790170027393145104828283812158304519218370476380897023249898720267053051908498011845198383126598688185743313040451851234309071530873683667360872515868401870834371902623509762498919172464493397284930232415029297203698778851121422456149280629701148108649396642433199634388011535777204188207597427548981195309015900421249473588077922607729093939587454170211363784480831197764238579460361668878037335596700513382133341370374840639374005225742007557272153800433699784092511039693877686425832957477808359462507401596842526527374816943302475357302</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">pow</span>(p2+q1,<span class="number">65537</span>,n)</span><br><span class="line"><span class="comment">#7919283184559406259028604751155413696993375814336862337694645459367829841130544291770103966362177145582007048754925168845793555136985754996486596987205043932984314934297789456823769422776642272151478021108135062833657996366160688598742804847633068533451034898357435150319123770512604358033881809960916484049603490477616900480883862825416570459592254659007024761917196293369565486538943942938968226701375668351560376904094935919442322484791587819687743780031411339960372463937311578960714219580981945254129150844798674023932645363519148439092971133029751088847668041720574694350298717079140377388740434213791727288722</span></span><br><span class="line"><span class="built_in">print</span> n </span><br><span class="line"><span class="comment">#8573641536164485111081609341110540574423426701587222458588002464807917555910942077276167528046769327390058096169685188870928286845342631974847171845103806710768418462668311621275704636581042137915505959767806384415314024549489538717607173007829067492516776714817262226691787436227002924225311861164296655909746846329870548266285498682510415418053656271623482202491805513797215793596385014264449282551352796096361524482384994633912515104414237252657058698433260597636367614328512751722615849959987780969423318207123668118325176544879335267439096589035064596631756303300860315257404427016819145298919974287174103934503</span></span><br><span class="line"><span class="built_in">print</span> c </span><br><span class="line"><span class="comment">#8436043641135865531308468859210199431445831063674810351906331674115825605849862045115409554309732867926457428348729196827592921108183774070414343257409618631078896543782150761081732376735501920417229787663210936174854000594130785353102718054331606096192133481536724402629697019651921188121029927710787682993814748802295545306899075962041017278877203965796981792702098381465051289581518257202127401748725944229037078896857591660248467597356051123218945757343652461844056927461929195427880969904210166880623689090977714615839624798930450630919330253477634839161931755642681718034910946900928731231093352169252474939674</span></span><br></pre></td></tr></table></figure>
<p>貌似可以费马分解？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p1和p2 q1和q2 都相差很小</span><br><span class="line">p1*q1 p2*q2    p1*q2 p2*q1    都很接近</span><br><span class="line">费马分解!</span><br><span class="line">将 p1*q1,p2*q2    p1,q2,p2*q1  分别作为两组因子</span><br><span class="line">分解n能得到这4个的值 再求gcd就可以得到p1,p2,q1,q2了!</span><br></pre></td></tr></table></figure>

<p>实际跑了跑 发现好慢啊…<br>先贴着吧 以后想想怎么用上给的另外两个条件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from Crypto.Util.number import *</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd,iroot,is_square,sqrt</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">n = <span class="number">8573641536164485111081609341110540574423426701587222458588002464807917555910942077276167528046769327390058096169685188870928286845342631974847171845103806710768418462668311621275704636581042137915505959767806384415314024549489538717607173007829067492516776714817262226691787436227002924225311861164296655909746846329870548266285498682510415418053656271623482202491805513797215793596385014264449282551352796096361524482384994633912515104414237252657058698433260597636367614328512751722615849959987780969423318207123668118325176544879335267439096589035064596631756303300860315257404427016819145298919974287174103934503</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Fermat_Factorize</span>(<span class="params">n</span>):</span><br><span class="line">    factor_list = []</span><br><span class="line">    a = <span class="built_in">int</span>(sqrt(n))+<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        b2 = a*a-n</span><br><span class="line">        <span class="keyword">if</span>(is_square(b2)):</span><br><span class="line">            b = <span class="built_in">int</span>(iroot(b2,<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">            factor_list.append([a-b,a+b])</span><br><span class="line">            <span class="built_in">print</span>(factor_list)</span><br><span class="line">        a = a+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(factor_list)==<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> factor_list</span><br><span class="line"></span><br><span class="line">t0 = time()</span><br><span class="line">factort_list = Fermat_Factorize(n)</span><br><span class="line"><span class="built_in">print</span>(factort_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;=========================================\n&#x27;</span>,time()-t0)</span><br></pre></td></tr></table></figure>

<h2 id="Old-Story"><a href="#Old-Story" class="headerlink" title="Old_Story"></a>Old_Story</h2><p>题目描述:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is an old story about wheat and chessboard, and it&#x27;s easy, right?</span><br></pre></td></tr></table></figure>
<p>cipher.txt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[524288, 4194304, 16384, 1024, 4194304, 32, 262144, 2097152, 4194304, 16777216, 70368744177664, 2251799813685248, 8192, 8388608, 8192, 4503599627370496, 16777216, 36028797018963968, 16384, 2199023255552, 67108864, 1048576, 2097152, 18014398509481984, 33554432, 68719476736, 4, 17179869184, 536870912, 549755813888, 262144, 4294967296, 16384, 128, 288230376151711744, 137438953472, 16777216, 36028797018963968, 1024, 4503599627370496, 16384, 68719476736, 262144, 4611686018427387904]</span><br></pre></td></tr></table></figure>
<p>这  属于脑洞题了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> ct</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">b64table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">h = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> ct:</span><br><span class="line">    h += b64table[c.bit_length() - <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">flag = b64decode(h)</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">&quot;ISITDTU&#123;r1c3_che55b0ard_4nd_bs64&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>


<h1 id="KAPO2019"><a href="#KAPO2019" class="headerlink" title="KAPO2019"></a>KAPO2019</h1><h2 id="Lenstra-Lenstra-Lovasz"><a href="#Lenstra-Lenstra-Lovasz" class="headerlink" title="Lenstra-Lenstra-Lovász"></a>Lenstra-Lenstra-Lovász</h2><p>task.sage</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long <span class="keyword">as</span> b2l</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">    p = random_prime(<span class="number">2</span> ** <span class="number">1024</span>)</span><br><span class="line">    q = random_prime(<span class="number">2</span> ** <span class="number">1024</span>)</span><br><span class="line">    e = random_prime(<span class="number">200</span>, <span class="literal">False</span>, <span class="number">150</span>)</span><br><span class="line">    d = inverse_mod(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> [n, e, p, q, d]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n, e, p, q, d = generate()</span><br><span class="line">    key = [n, e, p, q, d]</span><br><span class="line"></span><br><span class="line">    flag = b2l(<span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>).read())</span><br><span class="line">    ct = <span class="built_in">pow</span>(flag, e, n)</span><br><span class="line"></span><br><span class="line">    secret = d % (p-<span class="number">1</span>)</span><br><span class="line">    bits = secret.nbits()</span><br><span class="line">    bias = bits // <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    secret = secret &gt;&gt; (bits//<span class="number">2</span> - bias)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> (n, e, secret)</span><br><span class="line">    <span class="built_in">print</span> (ct)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>enc.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(6455822262099728871488017333002213763928974244728225916053004114762757288446279146632134559883137763509202760259665317867526185880602417384903035043373123172755205541848380033846647830559956562300790213183285570408285813940654388322823643901338114411098146713766948059574036750169834145669828812062836846441826158939413816441792342997972511615875337134161543579227974534136317577528234543157933263750295100350176275449872173516777290564027194224977405688960141636944708509979113636374750606901261856017099651198201404715950047463077544354559113250673461981023710617386807665904679700243253715051955720384474605996461, 42209220078437574866361422834065152842384701674177020659394975551630638228773791512185847142423481006715264054186715352545791966183624550240806137742117804368809490341638374030752315967)</span><br><span class="line">5283729370502224111594887226837880395316054773227004499787302073503878519636633822827217253857874355522588395812835740811362707153363560194601186826283559964747701769601487977762111123819420098096415036853595000842267748990264765099199777366178415275775930611456486254983609977806288992648707705283164998069127159450643405479857352132413567941113596062821699046442601516070886895831454313645493977658887986960438243972899363731335524071661232212596476620001731293273701784412244890405468701582192239044191141716454262551899911176914268204608240121498434944371667705131307108367792229003968794133948069333063516311066</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>emmm e&#x3D;151<br>dp高位泄露 搜了一圈发现都是从这位<a href="https://github.com/pcw109550/write-up/tree/master/2019/KAPO/Lenstra-Lenstra-Lovasz" target="_blank">佬</a>这里开始的 orz 直接跟着source学习吧<br>记录一下推导过程:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dp === d % p-1</span><br><span class="line">d == dp+k1*(p-1)</span><br><span class="line">e*d == k2*(p-1)*(q-1)+1</span><br><span class="line">=&gt; e*(dp+k1*(p-1)) == k2*(p-1)*(q-1)+1</span><br><span class="line">mod p-1</span><br><span class="line">=&gt; e*dp === 1 mod p-1</span><br><span class="line">=&gt; e*dp == _k*(p-1)+1</span><br><span class="line">mod p (※)</span><br><span class="line">=&gt; e*dp+k_-1 === 0 mod p</span><br><span class="line">notice that e*dp == _k*(p-1)+1 and dp&lt;p-1</span><br><span class="line">=&gt; _k&lt;e (和dp泄露原理一样!)</span><br><span class="line">so we can enumerate _k from 1 to e</span><br><span class="line">to use coppersmith (for the reason that unknown bits&lt;=410 and beta=1/2, so we can find small roots &lt; N**1/4(512bits))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(n, secret) = (<span class="number">6455822262099728871488017333002213763928974244728225916053004114762757288446279146632134559883137763509202760259665317867526185880602417384903035043373123172755205541848380033846647830559956562300790213183285570408285813940654388322823643901338114411098146713766948059574036750169834145669828812062836846441826158939413816441792342997972511615875337134161543579227974534136317577528234543157933263750295100350176275449872173516777290564027194224977405688960141636944708509979113636374750606901261856017099651198201404715950047463077544354559113250673461981023710617386807665904679700243253715051955720384474605996461</span>, <span class="number">42209220078437574866361422834065152842384701674177020659394975551630638228773791512185847142423481006715264054186715352545791966183624550240806137742117804368809490341638374030752315967</span>)</span><br><span class="line">ct = <span class="number">5283729370502224111594887226837880395316054773227004499787302073503878519636633822827217253857874355522588395812835740811362707153363560194601186826283559964747701769601487977762111123819420098096415036853595000842267748990264765099199777366178415275775930611456486254983609977806288992648707705283164998069127159450643405479857352132413567941113596062821699046442601516070886895831454313645493977658887986960438243972899363731335524071661232212596476620001731293273701784412244890405468701582192239044191141716454262551899911176914268204608240121498434944371667705131307108367792229003968794133948069333063516311066</span></span><br><span class="line">e = <span class="number">151</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">k</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = e*((secret*<span class="number">2</span>**<span class="number">410</span>)+x)+k-<span class="number">1</span></span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^<span class="number">409</span>,beta=<span class="number">0.4</span>)</span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;dp= <span class="subst">&#123;secret*<span class="number">2</span>**<span class="number">409</span>+roots[<span class="number">0</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;=================================&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e):</span><br><span class="line">    attack(k)</span><br><span class="line"><span class="comment"># dp= 111610627483329456042773469243525292052790452506522007088578106283136307535942428003600535113613729808907790947325623821175745420979563394756953617513882387710361103999394612618576932519125987576858649069903834459634170735915011161895680193594023143108156113045675433885394403477072411701711342985242940069663</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后就是简单的dp泄露题目了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,e+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span>((dp*e-<span class="number">1</span>+k)%k==<span class="number">0</span>):</span><br><span class="line">        p = (dp*e-<span class="number">1</span>+k)//k</span><br><span class="line">        q = n//p</span><br><span class="line">        <span class="keyword">if</span>(p*q==n):</span><br><span class="line">            <span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">            <span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line">            d = modinv(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(ct,d,n)))</span><br></pre></td></tr></table></figure>

<p>flag: POKA{You_4r3_Crypt0_N00000B_XDD}</p>
<p>这位佬真的tql orz</p>
<h1 id="moeCTF2023"><a href="#moeCTF2023" class="headerlink" title="moeCTF2023"></a>moeCTF2023</h1><h2 id="flag-exchange"><a href="#flag-exchange" class="headerlink" title="flag_exchange"></a>flag_exchange</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fs:</span><br><span class="line">    flag = fs.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diffie_hellman</span>(<span class="params">p, flag</span>):</span><br><span class="line">    alice_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    alice_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, alice_privKey, p)</span><br><span class="line">    bob_privKey = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    bob_pubKey = <span class="built_in">pow</span>(<span class="number">7</span>, bob_privKey, p)</span><br><span class="line"></span><br><span class="line">    superkey = <span class="built_in">pow</span>(bob_pubKey, alice_privKey, p)</span><br><span class="line">    m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> (m * superkey) % p, alice_pubKey, bob_pubKey</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chall</span>(<span class="params"><span class="built_in">input</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>], <span class="built_in">print</span>:<span class="type">Callable</span>[[<span class="built_in">str</span>],<span class="literal">None</span>]</span>):</span><br><span class="line">    p = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;P = &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> p.bit_length() &gt;= <span class="number">1024</span>:</span><br><span class="line">        c, alice_pubKey, bob_pubKey = diffie_hellman(p, flag)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Alice&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(alice_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bob&#x27;s public key: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(bob_pubKey))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Ciphertext: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid P&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>给一个P保证P-1光滑 这样离散对数直接求就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> modinv</span><br><span class="line">p = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sieve_base)):</span><br><span class="line">    p*=sieve_base[i]</span><br><span class="line">    <span class="keyword">if</span>(p.bit_length()&gt;=<span class="number">1024</span> <span class="keyword">and</span> isPrime(p+<span class="number">1</span>)):</span><br><span class="line">        <span class="built_in">print</span>(p+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">20404068993016374194542464172774607695659797117423121913227131032339026169175929902244453757410468728842929862271605567818821685490676661985389839958622802465986881376139404138376153096103140834665563646740160279755212317501356863003638612390661668406235422311783742390510526587257026500302696834793248526734305801634165948702506367176701233298064616663553716975429048751575597150417381063934255689124486029492908966644747931</span></span><br><span class="line">A = <span class="number">10535907278790700538391290444921305217259385431263711692801040936511190666531116700305186920599844299554256714210210829717476920248418057857281038962186002736577757264399457937073280966879708966646259512918943865328709139377854814605040022146158670388299143718823490062168338902733222126015956430817934114854967961103604652093740121364332358685392900872098860796503201407589428414466539049626631184008892730055415169100769732</span></span><br><span class="line">B = <span class="number">16348489331356867301630771825154767170233294861057688783357728790213156540287376598857687580984409669161724312800129242584879634810196465793194307910350584763235456209835940884693137265638231235038196296978539087935504760585844080798763164306369527171514584826163061235753126778212519635905807390933273873667058848266096108542464516152013945119362646618506147214283108243842818817447082449655146411335921417161043077611902804</span></span><br><span class="line">c = <span class="number">7632994523412492260557179922189823901916021592995792231423394289817118356542879338257864183368725535825022550174733859623962587355640726058879305520054662785703521463831735133391030853928379496146944314205140328897640874120866187629354584127754485292965951151063241820133235042448633627434068969391854258102614435821987664948230501326316243932358798360818637206571054067460923260493428092446138441830565932807827179355927283</span></span><br><span class="line"><span class="comment"># _A = discrete_log(mod(A,p),mod(7,p))</span></span><br><span class="line"><span class="comment"># _super = pow(B,_A,p)</span></span><br><span class="line"></span><br><span class="line">_<span class="built_in">super</span> = <span class="number">5598697508050553831301016186451810766892175075227457781663609137315994994339946099771767989549360029474161927222425134451542335224836812568338804744981790630968653314082988409623033093913313149007040705162350558420312224001860502897319860524983780294087905883722904658909173858938483002561143035786870483434405455082101246235125472463011482817487767144926351669559368591298053399981071648084262851031724505873554319182541246</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(modinv(_<span class="built_in">super</span>,p)*c%p))</span><br><span class="line"><span class="comment"># moectf&#123;diffie_he11man_key_exChange_is_not_so_hard_2WPIBung92WPIBung9?WP&#125;</span></span><br></pre></td></tr></table></figure>


<h1 id="miniLCTF2021"><a href="#miniLCTF2021" class="headerlink" title="miniLCTF2021"></a>miniLCTF2021</h1><h2 id="asr"><a href="#asr" class="headerlink" title="asr"></a>asr</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(bytes_to_long(flag) , e , n))</span><br><span class="line">_q = <span class="built_in">int</span>(<span class="built_in">bin</span>(q)[<span class="number">2</span>:][::-<span class="number">1</span>] , <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(p ^ _q)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">142640215238537871365683719891541306935180737226071087966538112975312943506714964164341655541156886519552359173518384366335764339838818638439617545046906731685628758140658162759582216079833807742803333237267119228131836589616600586722503125595590784393805677472708123448256012705645099262323873911736910168311</span></span><br><span class="line"><span class="string">141992115210477059329798383810995602331919683555539663737474122431362785313684902184569357178889736223104558359787247242121836892146092641430333220915928891299001128364434856756544237628623127350186698031711524123158225428351095110283324920060240308834304841350657100420648385312630518518518978998617676378512</span></span><br><span class="line"><span class="string">2687108833541074884027968939992825896836389810177573543799115292760866858835988113613745599976930175463756036625174575759254321939315015594803646458939874</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这题学到了一种搜索技巧 高低位一起dfs<br>贴个代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> primefac <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    d =modinv(e,phi)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(<span class="built_in">pow</span>(c,d,n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_p_q</span>():</span><br><span class="line">    p_low = [<span class="number">0</span>]</span><br><span class="line">    q_high = [<span class="number">0</span>]</span><br><span class="line">    q_low = [<span class="number">0</span>]</span><br><span class="line">    p_high = [<span class="number">0</span>]</span><br><span class="line">    maskx = <span class="number">1</span></span><br><span class="line">    maskn = <span class="number">2</span></span><br><span class="line">    si = <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        x_lowbits = (x &amp; maskx) &gt;&gt; i</span><br><span class="line">        n_lowbits = (n % maskn)</span><br><span class="line">        tmppp_low = []</span><br><span class="line">        tmpqq_low = []</span><br><span class="line">        tmppp_high =[]</span><br><span class="line">        tmpqq_high =[]</span><br><span class="line">        x_highbits = (x &gt;&gt; (<span class="number">511</span>-i)) &amp; <span class="number">1</span></span><br><span class="line">        n_highbits = (n)&gt;&gt; (<span class="number">1022</span> - <span class="number">2</span>*i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(p_low)):</span><br><span class="line">            <span class="keyword">for</span> pp_low <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                <span class="keyword">for</span> qq_low <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                    <span class="keyword">for</span> pp_high <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                        <span class="keyword">for</span> qq_high <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                            <span class="keyword">if</span> pp_low ^ qq_high == x_lowbits <span class="keyword">and</span> qq_low ^ pp_high == x_highbits:</span><br><span class="line">                                temp1 = ((pp_low * maskn //<span class="number">2</span> + p_low[j]) * (qq_low * maskn // <span class="number">2</span> + q_low[j])) % maskn </span><br><span class="line">                                temp2 = (((pp_high &lt;&lt; (<span class="number">511</span>-i)) + p_high[j]) * ((qq_high &lt;&lt; (<span class="number">511</span>-i)) + q_high[j]))&gt;&gt;(<span class="number">1022</span>-<span class="number">2</span>*i)</span><br><span class="line">                                <span class="keyword">if</span> temp1 == n_lowbits :</span><br><span class="line">                                    <span class="keyword">if</span> n_highbits-temp2 &gt;= <span class="number">0</span>  <span class="keyword">and</span> n_highbits-temp2 &lt;=(<span class="number">2</span>&lt;&lt;i+<span class="number">1</span>):</span><br><span class="line">                                        tmppp_low.append(pp_low * maskn //<span class="number">2</span> + p_low[j])</span><br><span class="line">                                        tmpqq_low.append(qq_low * maskn //<span class="number">2</span> + q_low[j])</span><br><span class="line">                                        tmppp_high.append((pp_high&lt;&lt;(<span class="number">511</span>-i))+p_high[j])</span><br><span class="line">                                        tmpqq_high.append((qq_high&lt;&lt;(<span class="number">511</span>-i))+q_high[j])</span><br><span class="line"></span><br><span class="line">        maskn *= <span class="number">2</span></span><br><span class="line">        maskx *= <span class="number">2</span></span><br><span class="line">        p_low = tmppp_low</span><br><span class="line">        q_low = tmpqq_low</span><br><span class="line">        p_high = tmppp_high</span><br><span class="line">        q_high = tmpqq_high</span><br><span class="line">        <span class="built_in">print</span>(i,<span class="built_in">len</span>(p_low))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> p_low:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> p_high:</span><br><span class="line">            <span class="keyword">if</span> n %(a+b) ==<span class="number">0</span>:</span><br><span class="line">                p = a + b</span><br><span class="line">                <span class="built_in">print</span>(p)</span><br><span class="line">                q = n//p</span><br><span class="line">                <span class="keyword">return</span> p,q</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    n = <span class="number">142640215238537871365683719891541306935180737226071087966538112975312943506714964164341655541156886519552359173518384366335764339838818638439617545046906731685628758140658162759582216079833807742803333237267119228131836589616600586722503125595590784393805677472708123448256012705645099262323873911736910168311</span></span><br><span class="line">    c = <span class="number">141992115210477059329798383810995602331919683555539663737474122431362785313684902184569357178889736223104558359787247242121836892146092641430333220915928891299001128364434856756544237628623127350186698031711524123158225428351095110283324920060240308834304841350657100420648385312630518518518978998617676378512</span></span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    x = <span class="number">2687108833541074884027968939992825896836389810177573543799115292760866858835988113613745599976930175463756036625174575759254321939315015594803646458939874</span> </span><br><span class="line">    p , q = get_p_q()</span><br><span class="line">    flag = get_flag()</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># miniLCTF&#123;reverse_1s_als0_e1sy&#125;</span></span><br></pre></td></tr></table></figure>
<p>至于为什么要高低位一起dfs 这样的话限制更多 更能充分利用p^reverse(q) 的条件</p>
<p>这代码确实写的挺棒的 学习了 orz</p>
<h1 id="ASISCTF2022"><a href="#ASISCTF2022" class="headerlink" title="ASISCTF2022"></a>ASISCTF2022</h1><h2 id="Mindseat"><a href="#Mindseat" class="headerlink" title="Mindseat"></a>Mindseat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> params, flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>(<span class="params">nbit, k</span>): <span class="comment"># Pubkey function</span></span><br><span class="line">	_p = <span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		p, q = [_p + (getRandomNBitInteger(nbit - k) &lt;&lt; k) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;01&#x27;</span>]</span><br><span class="line">		<span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">			<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">				s = getRandomRange(<span class="number">2</span>, p * q)</span><br><span class="line">				<span class="keyword">if</span> <span class="built_in">pow</span>(s, (p - <span class="number">1</span>) // <span class="number">2</span>, p) * <span class="built_in">pow</span>(s, (q - <span class="number">1</span>) // <span class="number">2</span>, q) == (p - <span class="number">1</span>) * (q - <span class="number">1</span>):</span><br><span class="line">					pubkey = p * q, s</span><br><span class="line">					<span class="keyword">return</span> pubkey</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">pubkey, m</span>):</span><br><span class="line">	n, s = pubkey</span><br><span class="line">	r = getRandomRange(<span class="number">2</span>, n)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">pow</span>(s, m, n) * <span class="built_in">pow</span>(r, <span class="number">2</span> ** k, n) % n</span><br><span class="line"></span><br><span class="line">flag = flag.lstrip(<span class="string">b&#x27;ASIS&#123;&#x27;</span>).rstrip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">nbit, k = params</span><br><span class="line">PUBKEYS = [keygen(nbit, k) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">flag = [bytes_to_long(flag[i*<span class="number">8</span>:i*<span class="number">8</span> + <span class="number">8</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">ENCS = [encrypt(PUBKEYS[_], flag[_]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PUBKEYS = <span class="subst">&#123;PUBKEYS&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;ENCS = <span class="subst">&#123;ENCS&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">PUBKEYS = [(<span class="number">10342840547250370454282840290754052390564265157174829726645242904324433774727630591803186632486959590968595230902808369991240437077297674551123187830095873</span>, <span class="number">5179654005441544601140101875149402241567866059199512232495766031194848985776186595289740052214499657697650832860279375151687044465018028876445070588827777</span>), (<span class="number">6015512135462554031390611730578383462516861987731833360559070749140159284050335604168414434218196369921956160353365713819898567416920672209509202941444097</span>, <span class="number">2116441415129068001049624780654272734931672052541246678702416144768611225693039503554945326959705314527114860312641379671935648337975482830939466425225421</span>), (<span class="number">6396980904648302374999086102690071222661654639262566535518341836426544747072554109709902085144158785649143907600058913175220229111171441332366557866622977</span>, <span class="number">1760317994074087854211747561546045780795134924237097786412713825282874589650448491771874326890983429137451463523250670379970999252639812107914977960011738</span>), (<span class="number">9158217300815233129401608406766983222991414185115152402477702381950519098200234724856258589693986849049556254969769863821366592458050807400542885348638721</span>, <span class="number">6564146847894132872802575925374338252984765675686108816080170162797938388434600448954826704720292576935713424103133182090390089661059813982670332877677256</span>)]</span><br><span class="line">ENCS = [<span class="number">4595268033054096192076432659360373235610019564489694608733743330870893803828258295069937060360520598446948290913045781945314108935153236291467160667601985</span>, <span class="number">3390637292181370684803039833768819598968576813582112632809296088618666221278429695211004046274005776653775480723833818255766663573061866194380012311184611</span>, <span class="number">5197599582013327040903216369733466147938613487439777125659892779696104407398257678982801768761973934713675657188014051286238194316997970299887749668838196</span>, <span class="number">5093835186720390391696398671365109925058893544530286148616117890366909889206952477053316867658405460457795493886317792695055944930027477761411273933822112</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先可以通过n末尾0的个数来确定k 得到k&#x3D;134<br>然后就可以copper分解p,q<br>注意到有 <code>p-1 = p0*2**k</code><br>而且加密是一个dlp问题 所以我们希望利用p-1光滑来求解离散对数<br>将 <code>c===s^m * r^(2**k) mod n</code> 做变形<br>得到  <code>c^p0 === s^(m*p0) * r^(p-1) mod n</code><br>那么我们如果modp的话 就可以把r这一项消掉了<br>解dlp得到 mp0 即可得到m</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="number">134</span></span><br><span class="line"><span class="keyword">for</span> PUBKEY <span class="keyword">in</span> PUBKEYS:</span><br><span class="line">    n = <span class="built_in">int</span>(PUBKEY[<span class="number">0</span>])</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    unk_bits = n.bit_length()//<span class="number">2</span>-k</span><br><span class="line">    f = x*<span class="number">2</span>**k+<span class="number">1</span></span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(unk_bits+<span class="number">1</span>),beta = <span class="number">0.4</span>)</span><br><span class="line">    <span class="built_in">print</span>(roots)</span><br><span class="line">    <span class="keyword">for</span> root <span class="keyword">in</span> roots:</span><br><span class="line">        p0 = <span class="built_in">int</span>(root)</span><br><span class="line">        p = p0*<span class="number">2</span>**k+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> is_prime(p):</span><br><span class="line">            ps.append(p)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">ps = [<span class="number">95553042292789874700903619680433024548766742921219411688127033417325711720449</span>, <span class="number">97465437469424293753701354915129486026538223057283543854406758660981557035009</span>, <span class="number">93874713528665486923249914973058040339864593786031505872542450888415920521217</span>, <span class="number">102692834149450074746796719675178138708750556898826303720138266777336682643457</span>]</span><br><span class="line">ss = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> PUBKEYS]</span><br><span class="line">ms = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    c = ENCS[i]</span><br><span class="line">    p = ps[i]</span><br><span class="line">    s = ss[i]</span><br><span class="line">    p0 = (p-<span class="number">1</span>)//(<span class="number">2</span>**k)</span><br><span class="line">    cp0 = <span class="built_in">pow</span>(c,p0,p)</span><br><span class="line">    mp0 = discrete_log(mod(cp0,p),mod(s,p))</span><br><span class="line">    m = mp0//p0</span><br><span class="line">    ms.append(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(ms))</span><br><span class="line"><span class="built_in">print</span>(ms)</span><br><span class="line"></span><br><span class="line"><span class="comment"># N3w_CTF_nEW_Joye_Libert_CrYpt0_5</span></span><br></pre></td></tr></table></figure>

<h2 id="chaffymasking"><a href="#chaffymasking" class="headerlink" title="chaffymasking"></a>chaffymasking</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>(): </span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">inp, length</span>):</span><br><span class="line">	result = inp + os.urandom(length - <span class="built_in">len</span>(inp))</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">byte_xor</span>(<span class="params">a, b</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">bytes</span>(_a ^ _b <span class="keyword">for</span> _a,_b <span class="keyword">in</span> <span class="built_in">zip</span>(a,b)) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chaffy_mask</span>(<span class="params">salt, LTC, m, n</span>):</span><br><span class="line">	q = n ** <span class="number">2</span></span><br><span class="line">	half1_salt = salt[:m // <span class="number">8</span>]</span><br><span class="line">	half2_salt = salt[m // <span class="number">8</span>:]</span><br><span class="line">	xor_salts = <span class="built_in">int</span>.from_bytes(byte_xor(half1_salt, half2_salt), <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> xor_salts == <span class="number">0</span>:</span><br><span class="line">		half1_salt = byte_xor(half1_salt, os.urandom(m))</span><br><span class="line">	half1_binStr = <span class="string">&quot;&#123;:08b&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(half1_salt.<span class="built_in">hex</span>(),<span class="number">16</span>))</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">len</span>(half1_binStr) &lt; m):</span><br><span class="line">		half1_binStr = <span class="string">&quot;0&quot;</span> * (m - <span class="built_in">len</span>(half1_binStr)%m) + half1_binStr</span><br><span class="line">	half2_binStr = <span class="string">&quot;&#123;:08b&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(half2_salt.<span class="built_in">hex</span>(),<span class="number">16</span>))</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">len</span>(half2_binStr) &lt; m):</span><br><span class="line">		half2_binStr = <span class="string">&quot;0&quot;</span> * (m - <span class="built_in">len</span>(half2_binStr)%m) + half2_binStr</span><br><span class="line">	</span><br><span class="line">	vec_1 = np.array(<span class="built_in">list</span>(half1_binStr), dtype=<span class="built_in">int</span>)</span><br><span class="line">	vec_1 = np.reshape(vec_1, (m,<span class="number">1</span>))</span><br><span class="line">	vec_2 = np.array(<span class="built_in">list</span>(half2_binStr), dtype=<span class="built_in">int</span>)</span><br><span class="line">	vec_2 = np.reshape(vec_2, (m,<span class="number">1</span>))</span><br><span class="line">	</span><br><span class="line">	out_1 = LTC.dot(vec_1) % q</span><br><span class="line">	out_2 = LTC.dot(vec_2) % q</span><br><span class="line">	</span><br><span class="line">	flag_vector = np.array([<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> FLAG])</span><br><span class="line">	flag_vector = np.reshape(flag_vector, (n,<span class="number">1</span>))</span><br><span class="line">	masked_flag = (flag_vector ^ out_1 ^ out_2) % <span class="number">256</span></span><br><span class="line">	masked_flag = np.reshape(masked_flag, (n,))</span><br><span class="line">	masked_flag = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">hex</span>(_)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> masked_flag])</span><br><span class="line">	<span class="keyword">return</span> masked_flag.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;|&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot; Welcome to chaffymask combat, we implemented a masking method to   &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; hide our secret. Masking is done by your 1024 bit input salt. Also &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; I noticed that there is a flaw in my method. Can you abuse it and  &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; get the flag? In each step you should send salt and get the mask.  &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	m, n = <span class="number">512</span>, <span class="number">64</span> </span><br><span class="line">	IVK = [</span><br><span class="line">	<span class="number">3826</span>, <span class="number">476</span>, <span class="number">3667</span>, <span class="number">2233</span>, <span class="number">1239</span>, <span class="number">1166</span>, <span class="number">2119</span>, <span class="number">2559</span>, <span class="number">2376</span>, <span class="number">1208</span>, <span class="number">2165</span>, <span class="number">2897</span>, <span class="number">830</span>, <span class="number">529</span>, <span class="number">346</span>, <span class="number">150</span>, <span class="number">2188</span>, <span class="number">4025</span>, </span><br><span class="line">	<span class="number">3667</span>, <span class="number">1829</span>, <span class="number">3987</span>, <span class="number">952</span>, <span class="number">3860</span>, <span class="number">2574</span>, <span class="number">959</span>, <span class="number">1394</span>, <span class="number">1481</span>, <span class="number">2822</span>, <span class="number">3794</span>, <span class="number">2950</span>, <span class="number">1190</span>, <span class="number">777</span>, <span class="number">604</span>, <span class="number">82</span>, <span class="number">49</span>, <span class="number">710</span>, <span class="number">1765</span>, </span><br><span class="line">	<span class="number">3752</span>, <span class="number">2970</span>, <span class="number">952</span>, <span class="number">803</span>, <span class="number">873</span>, <span class="number">2647</span>, <span class="number">2643</span>, <span class="number">1096</span>, <span class="number">1202</span>, <span class="number">2236</span>, <span class="number">1492</span>, <span class="number">3372</span>, <span class="number">2106</span>, <span class="number">1868</span>, <span class="number">535</span>, <span class="number">161</span>, <span class="number">3143</span>, <span class="number">3370</span>, </span><br><span class="line">	<span class="number">1</span>, <span class="number">1643</span>, <span class="number">2147</span>, <span class="number">2368</span>, <span class="number">3961</span>, <span class="number">1339</span>, <span class="number">552</span>, <span class="number">2641</span>, <span class="number">3222</span>, <span class="number">2505</span>, <span class="number">3449</span>, <span class="number">1540</span>, <span class="number">2024</span>, <span class="number">618</span>, <span class="number">1904</span>, <span class="number">314</span>, <span class="number">1306</span>, <span class="number">3173</span>, </span><br><span class="line">	<span class="number">4040</span>, <span class="number">1488</span>, <span class="number">1339</span>, <span class="number">2545</span>, <span class="number">2167</span>, <span class="number">394</span>, <span class="number">46</span>, <span class="number">3169</span>, <span class="number">897</span>, <span class="number">4085</span>, <span class="number">4067</span>, <span class="number">3461</span>, <span class="number">3444</span>, <span class="number">118</span>, <span class="number">3185</span>, <span class="number">2267</span>, <span class="number">3239</span>, <span class="number">3612</span>, </span><br><span class="line">	<span class="number">2775</span>, <span class="number">580</span>, <span class="number">3579</span>, <span class="number">3623</span>, <span class="number">1721</span>, <span class="number">189</span>, <span class="number">650</span>, <span class="number">2755</span>, <span class="number">1434</span>, <span class="number">35</span>, <span class="number">3167</span>, <span class="number">323</span>, <span class="number">589</span>, <span class="number">3410</span>, <span class="number">652</span>, <span class="number">2746</span>, <span class="number">2787</span>, <span class="number">3665</span>, <span class="number">828</span>, </span><br><span class="line">	<span class="number">3200</span>, <span class="number">1450</span>, <span class="number">3147</span>, <span class="number">720</span>, <span class="number">3741</span>, <span class="number">1055</span>, <span class="number">505</span>, <span class="number">2929</span>, <span class="number">1423</span>, <span class="number">3629</span>, <span class="number">3</span>, <span class="number">1269</span>, <span class="number">4066</span>, <span class="number">125</span>, <span class="number">2432</span>, <span class="number">3306</span>, <span class="number">4015</span>, <span class="number">2350</span>, </span><br><span class="line">	<span class="number">2154</span>, <span class="number">2623</span>, <span class="number">1304</span>, <span class="number">493</span>, <span class="number">763</span>, <span class="number">1765</span>, <span class="number">2608</span>, <span class="number">695</span>, <span class="number">30</span>, <span class="number">2462</span>, <span class="number">294</span>, <span class="number">3656</span>, <span class="number">3231</span>, <span class="number">3647</span>, <span class="number">3776</span>, <span class="number">3457</span>, <span class="number">2285</span>, <span class="number">2992</span>, </span><br><span class="line">	<span class="number">3997</span>, <span class="number">603</span>, <span class="number">2342</span>, <span class="number">2283</span>, <span class="number">3029</span>, <span class="number">3299</span>, <span class="number">1690</span>, <span class="number">3281</span>, <span class="number">3568</span>, <span class="number">1927</span>, <span class="number">2909</span>, <span class="number">1797</span>, <span class="number">1675</span>, <span class="number">3245</span>, <span class="number">2604</span>, <span class="number">1272</span>, <span class="number">1146</span>, </span><br><span class="line">	<span class="number">3301</span>, <span class="number">13</span>, <span class="number">3712</span>, <span class="number">2691</span>, <span class="number">1097</span>, <span class="number">1396</span>, <span class="number">3694</span>, <span class="number">3866</span>, <span class="number">2066</span>, <span class="number">1946</span>, <span class="number">3476</span>, <span class="number">1182</span>, <span class="number">3409</span>, <span class="number">3510</span>, <span class="number">2920</span>, <span class="number">2743</span>, <span class="number">1126</span>, <span class="number">2154</span>, </span><br><span class="line">	<span class="number">3447</span>, <span class="number">1442</span>, <span class="number">2021</span>, <span class="number">1748</span>, <span class="number">1075</span>, <span class="number">1439</span>, <span class="number">3932</span>, <span class="number">3438</span>, <span class="number">781</span>, <span class="number">1478</span>, <span class="number">1708</span>, <span class="number">461</span>, <span class="number">50</span>, <span class="number">1881</span>, <span class="number">1353</span>, <span class="number">2959</span>, <span class="number">1225</span>, <span class="number">1923</span>, </span><br><span class="line">	<span class="number">1414</span>, <span class="number">4046</span>, <span class="number">3416</span>, <span class="number">2845</span>, <span class="number">1498</span>, <span class="number">4036</span>, <span class="number">3899</span>, <span class="number">3878</span>, <span class="number">766</span>, <span class="number">3975</span>, <span class="number">1355</span>, <span class="number">2602</span>, <span class="number">3588</span>, <span class="number">3508</span>, <span class="number">3660</span>, <span class="number">3237</span>, <span class="number">3018</span>, </span><br><span class="line">	<span class="number">1619</span>, <span class="number">2797</span>, <span class="number">1823</span>, <span class="number">1185</span>, <span class="number">3225</span>, <span class="number">1270</span>, <span class="number">87</span>, <span class="number">979</span>, <span class="number">124</span>, <span class="number">1239</span>, <span class="number">1763</span>, <span class="number">2672</span>, <span class="number">3951</span>, <span class="number">984</span>, <span class="number">869</span>, <span class="number">3897</span>, <span class="number">327</span>, <span class="number">912</span>, <span class="number">1826</span>, </span><br><span class="line">	<span class="number">3354</span>, <span class="number">1485</span>, <span class="number">2942</span>, <span class="number">746</span>, <span class="number">833</span>, <span class="number">3968</span>, <span class="number">1437</span>, <span class="number">3590</span>, <span class="number">2151</span>, <span class="number">1523</span>, <span class="number">98</span>, <span class="number">164</span>, <span class="number">3119</span>, <span class="number">1161</span>, <span class="number">3804</span>, <span class="number">1850</span>, <span class="number">3027</span>, <span class="number">1715</span>, </span><br><span class="line">	<span class="number">3847</span>, <span class="number">2407</span>, <span class="number">2549</span>, <span class="number">467</span>, <span class="number">2029</span>, <span class="number">2808</span>, <span class="number">1782</span>, <span class="number">1134</span>, <span class="number">1953</span>, <span class="number">47</span>, <span class="number">1406</span>, <span class="number">3828</span>, <span class="number">1277</span>, <span class="number">2864</span>, <span class="number">2392</span>, <span class="number">3458</span>, <span class="number">2877</span>, <span class="number">1851</span>, </span><br><span class="line">	<span class="number">1033</span>, <span class="number">798</span>, <span class="number">2187</span>, <span class="number">54</span>, <span class="number">2800</span>, <span class="number">890</span>, <span class="number">3759</span>, <span class="number">4085</span>, <span class="number">3801</span>, <span class="number">3128</span>, <span class="number">3788</span>, <span class="number">2926</span>, <span class="number">1983</span>, <span class="number">55</span>, <span class="number">2173</span>, <span class="number">2579</span>, <span class="number">904</span>, <span class="number">1019</span>, </span><br><span class="line">	<span class="number">2108</span>, <span class="number">3054</span>, <span class="number">284</span>, <span class="number">2428</span>, <span class="number">2371</span>, <span class="number">2045</span>, <span class="number">907</span>, <span class="number">1379</span>, <span class="number">2367</span>, <span class="number">351</span>, <span class="number">3678</span>, <span class="number">1087</span>, <span class="number">2821</span>, <span class="number">152</span>, <span class="number">1783</span>, <span class="number">1993</span>, <span class="number">3183</span>, <span class="number">1317</span>, </span><br><span class="line">	<span class="number">2726</span>, <span class="number">2609</span>, <span class="number">1255</span>, <span class="number">144</span>, <span class="number">2415</span>, <span class="number">2498</span>, <span class="number">721</span>, <span class="number">668</span>, <span class="number">355</span>, <span class="number">94</span>, <span class="number">1997</span>, <span class="number">2609</span>, <span class="number">1945</span>, <span class="number">3011</span>, <span class="number">2405</span>, <span class="number">713</span>, <span class="number">2811</span>, <span class="number">4076</span>, </span><br><span class="line">	<span class="number">2367</span>, <span class="number">3218</span>, <span class="number">1353</span>, <span class="number">3957</span>, <span class="number">2056</span>, <span class="number">881</span>, <span class="number">3420</span>, <span class="number">1994</span>, <span class="number">1329</span>, <span class="number">892</span>, <span class="number">1577</span>, <span class="number">688</span>, <span class="number">134</span>, <span class="number">371</span>, <span class="number">774</span>, <span class="number">3855</span>, <span class="number">1461</span>, <span class="number">1536</span>, </span><br><span class="line">	<span class="number">1824</span>, <span class="number">1164</span>, <span class="number">1675</span>, <span class="number">46</span>, <span class="number">1267</span>, <span class="number">3652</span>, <span class="number">67</span>, <span class="number">3816</span>, <span class="number">3169</span>, <span class="number">2116</span>, <span class="number">3930</span>, <span class="number">2979</span>, <span class="number">3166</span>, <span class="number">3944</span>, <span class="number">2252</span>, <span class="number">2988</span>, <span class="number">34</span>, <span class="number">873</span>, </span><br><span class="line">	<span class="number">1643</span>, <span class="number">1159</span>, <span class="number">2822</span>, <span class="number">1235</span>, <span class="number">2604</span>, <span class="number">888</span>, <span class="number">2036</span>, <span class="number">3053</span>, <span class="number">971</span>, <span class="number">1585</span>, <span class="number">2439</span>, <span class="number">2599</span>, <span class="number">1447</span>, <span class="number">1773</span>, <span class="number">984</span>, <span class="number">261</span>, <span class="number">3233</span>, <span class="number">2861</span>, </span><br><span class="line">	<span class="number">618</span>, <span class="number">465</span>, <span class="number">3016</span>, <span class="number">3081</span>, <span class="number">1230</span>, <span class="number">1027</span>, <span class="number">3177</span>, <span class="number">459</span>, <span class="number">3041</span>, <span class="number">513</span>, <span class="number">1505</span>, <span class="number">3410</span>, <span class="number">3167</span>, <span class="number">177</span>, <span class="number">958</span>, <span class="number">2118</span>, <span class="number">326</span>, <span class="number">31</span>, <span class="number">2663</span>, </span><br><span class="line">	<span class="number">2026</span>, <span class="number">2549</span>, <span class="number">3026</span>, <span class="number">2364</span>, <span class="number">1540</span>, <span class="number">3236</span>, <span class="number">2644</span>, <span class="number">4050</span>, <span class="number">735</span>, <span class="number">280</span>, <span class="number">798</span>, <span class="number">169</span>, <span class="number">3808</span>, <span class="number">2384</span>, <span class="number">3497</span>, <span class="number">1759</span>, <span class="number">2415</span>, <span class="number">3444</span>, </span><br><span class="line">	<span class="number">1562</span>, <span class="number">3472</span>, <span class="number">1151</span>, <span class="number">1984</span>, <span class="number">2454</span>, <span class="number">3167</span>, <span class="number">1538</span>, <span class="number">941</span>, <span class="number">1561</span>, <span class="number">3071</span>, <span class="number">845</span>, <span class="number">2824</span>, <span class="number">58</span>, <span class="number">1467</span>, <span class="number">3807</span>, <span class="number">2191</span>, <span class="number">1858</span>, <span class="number">106</span>, </span><br><span class="line">	<span class="number">3847</span>, <span class="number">1326</span>, <span class="number">3868</span>, <span class="number">2787</span>, <span class="number">1624</span>, <span class="number">795</span>, <span class="number">3214</span>, <span class="number">1932</span>, <span class="number">3496</span>, <span class="number">457</span>, <span class="number">2595</span>, <span class="number">3043</span>, <span class="number">772</span>, <span class="number">2436</span>, <span class="number">2160</span>, <span class="number">3428</span>, <span class="number">2005</span>, <span class="number">2597</span>, </span><br><span class="line">	<span class="number">1932</span>, <span class="number">101</span>, <span class="number">3528</span>, <span class="number">1698</span>, <span class="number">3663</span>, <span class="number">900</span>, <span class="number">3298</span>, <span class="number">1872</span>, <span class="number">1179</span>, <span class="number">3987</span>, <span class="number">3695</span>, <span class="number">3561</span>, <span class="number">1762</span>, <span class="number">3785</span>, <span class="number">3005</span>, <span class="number">2574</span>, <span class="number">6</span>, <span class="number">1524</span>, </span><br><span class="line">	<span class="number">2738</span>, <span class="number">1753</span>, <span class="number">2350</span>, <span class="number">558</span>, <span class="number">800</span>, <span class="number">3782</span>, <span class="number">722</span>, <span class="number">886</span>, <span class="number">2176</span>, <span class="number">3050</span>, <span class="number">221</span>, <span class="number">1925</span>, <span class="number">564</span>, <span class="number">1271</span>, <span class="number">2535</span>, <span class="number">3113</span>, <span class="number">1310</span>, <span class="number">2098</span>, </span><br><span class="line">	<span class="number">3011</span>, <span class="number">964</span>, <span class="number">3281</span>, <span class="number">6</span>, <span class="number">1326</span>, <span class="number">741</span>, <span class="number">189</span>, <span class="number">2632</span>, <span class="number">373</span>, <span class="number">1176</span>, <span class="number">548</span>, <span class="number">64</span>, <span class="number">1445</span>, <span class="number">2376</span>, <span class="number">1524</span>, <span class="number">2690</span>, <span class="number">1316</span>, <span class="number">2304</span>, <span class="number">1336</span>, </span><br><span class="line">	<span class="number">2257</span>, <span class="number">3227</span>, <span class="number">2542</span>, <span class="number">3911</span>, <span class="number">3460</span></span><br><span class="line">	]</span><br><span class="line"></span><br><span class="line">	LTC = np.zeros([n, m], dtype=(<span class="built_in">int</span>))</span><br><span class="line">	LTC[<span class="number">0</span>,:] = IVK</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n):</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m // n + <span class="number">1</span>):</span><br><span class="line">			LTC[i,j*n:(j+<span class="number">1</span>)*n] = np.roll(IVK[j*n:(j+<span class="number">1</span>)*n], i)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">		pr(border, <span class="string">&quot;Give me your salt: &quot;</span>)</span><br><span class="line">		SALT = sc()[:-<span class="number">1</span>]</span><br><span class="line">		SALT = pad(SALT, m // <span class="number">4</span>)</span><br><span class="line">		MASKED_FLAG = chaffy_mask(SALT, LTC, m, n)</span><br><span class="line">		pr(border, <span class="string">f&#x27;masked_flag = <span class="subst">&#123;MASKED_FLAG&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>看着很复杂 其实前面全部可以照搬过来 最后得到flag xor回去即可…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">out_1 = LTC.dot(vec_1) % q</span><br><span class="line">out_2 = LTC.dot(vec_2) % q</span><br><span class="line"></span><br><span class="line">enc = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    enc.append(<span class="built_in">int</span>(masked_flag[<span class="number">2</span>*i:<span class="number">2</span>*i+<span class="number">2</span>],<span class="number">16</span>))</span><br><span class="line">enc_vec = np.reshape(enc,(n,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">flagV = (enc_vec^out_1^out_2) % <span class="number">256</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">bytes</span>(<span class="built_in">list</span>(flagV.reshape(-<span class="number">1</span>)))&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment"># ASIS&#123;Lattice_based_hash_collision_it_was_sooooooooooooooo_easY!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Mariana"><a href="#Mariana" class="headerlink" title="Mariana"></a>Mariana</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># from flag import flag</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">die</span>(<span class="params">*args</span>):</span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pr</span>(<span class="params">*args</span>):</span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sc</span>():</span><br><span class="line">	<span class="keyword">return</span> sys.stdin.buffer.readline()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	border = <span class="string">&quot;|&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot;Welcome to MARIANA cryptography battle, the mission is solving super&quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot;hard special DLP problem in real world, are you ready to fight?     &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	NBIT = <span class="number">32</span></span><br><span class="line">	STEP = <span class="number">40</span></span><br><span class="line"></span><br><span class="line">	pr(border, <span class="string">&quot;In each step solve the given equation and send the solution for x.  &quot;</span>, border)</span><br><span class="line">	c = <span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span> c &lt;= STEP:</span><br><span class="line">		nbit = NBIT * c</span><br><span class="line">		p = getPrime(nbit)</span><br><span class="line">		g = getRandomRange(<span class="number">3</span>, p)</span><br><span class="line">		pr(border, <span class="string">f&#x27;p = <span class="subst">&#123;p&#125;</span>&#x27;</span>)</span><br><span class="line">		pr(border, <span class="string">f&#x27;g = <span class="subst">&#123;g&#125;</span>&#x27;</span>)</span><br><span class="line">		pr(border, <span class="string">&#x27;Send the solution x = &#x27;</span>)</span><br><span class="line">		ans = sc()</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			x = <span class="built_in">int</span>(ans)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			die(border, <span class="string">&#x27;Given number is not integer!&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> x &gt;= p:</span><br><span class="line">			die(border, <span class="string">&quot;Kidding me!? Your solution must be smaller than p :P&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">pow</span>(g, x, p) - x) % p == <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">if</span> c == STEP:</span><br><span class="line">				die(border, <span class="string">f&quot;Congratz! the flag is: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				pr(border, <span class="string">&quot;Good job, try to solve the next level!&quot;</span>)</span><br><span class="line">				c += <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(border, <span class="string">&quot;Try harder and smarter to find the solution!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>

<p>az send x&#x3D; -(p-1)即可<br>因为 <code>g^(-(p-1)) === (g^(p-1))^(-1) === 1 === 1-p === -(p-1) mod p</code></p>
<h1 id="ImaginaryCTF-2023"><a href="#ImaginaryCTF-2023" class="headerlink" title="ImaginaryCTF 2023"></a>ImaginaryCTF 2023</h1><h2 id="sus"><a href="#sus" class="headerlink" title="sus"></a>sus</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, isPrime, bytes_to_long</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sus</span>(<span class="params">sz, d</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(sz)</span><br><span class="line">        pp = <span class="built_in">sum</span>([p**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(d)])</span><br><span class="line">        <span class="keyword">if</span> isPrime(pp):</span><br><span class="line">            <span class="keyword">return</span> p, pp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p, q = sus(<span class="number">512</span>, <span class="number">3</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span> * <span class="number">3</span>)</span><br><span class="line">n = p * q * r</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(<span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read().strip())</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="number">1125214074953003550338693571791155006090796212726975350140792193817691133917160305053542782925680862373280169090301712046464465620409850385467397784321453675396878680853302837289474127359729865584385059201707775238870232263306676727868754652536541637937452062469058451096996211856806586253080405693761350527787379604466148473842686716964601958192702845072731564672276539223958840687948377362736246683236421110649264777630992389514349446404208015326249112846962181797559349629761850980006919766121844428696162839329082145670839314341690501211334703611464066066160436143122967781441535203415038656670887399283874866947000313980542931425158634358276922283935422468847585940180566157146439137197351555650475378438394062212134921921469936079889107953354092227029819250669352732749370070996858744765757449980454966317942024199049138183043402199967786003097786359894608611331234652313102498596516590920508269648305903583314189707679</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">27126515219921985451218320201366564737456358918573497792847882486241545924393718080635287342203823068993908455514036540227753141033250259348250042460824265354495259080135197893797181975792914836927018186710682244471711855070708553557141164725366015684184788037988219652565179002870519189669615988416860357430127767472945833762628172190228773085208896682176968903038031026206396635685564975604545616032008575709303331751883115339943537730056794403071865003610653521994963115230275035006559472462643936356750299150351321395319301955415098283861947785178475071537482868994223452727527403307442567556712365701010481560424826125138571692894677625407372483041209738234171713326474989489802947311918341152810838321622423351767716922856007838074781678539986694993211304216853828611394630793531337147512240710591162375077547224679647786450310708451590432452046103209161611561606066902404405369379357958777252744114825323084960942810</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>真好题！<br>DAS11月赛也出了个一样的 当时只是套脚本出的flag 完全没理解算法原理<br>最近学校群论也讲了剩余类环 有限域的乘法群&#x2F;元素个数 等内容也学了 再来看 就看得懂了<br>先放出题人的思路:<br><img src="https://s2.loli.net/2023/12/17/Wqow4KuZbeg2RxG.jpg" alt="img"></p>
<p>下面结合本人粗浅的群论知识来具体阐述一下</p>
<p>首先根据pp的构造形式很容易联想到 p ^ 3 - 1 这种形式<br>按照出题人的思路(这一步怎么想得到的啊。。。)<br>我们希望能构造一个阶为p^3 - 1的群同时希望是一个循环群<br>生成元为g 那么 o(g)&#x3D;p^3 - 1<br><code>o(g ^ n) = o(g ^ p*(p^2+p+1)*r) = p-1</code><br>想要利用这个性质 接下来产生两个问题:</p>
<ul>
<li>如何建立阶为p ^ 3 - 1 的循环群</li>
<li>怎么利用 o(g ^ n) &#x3D; p-1</li>
</ul>
<p>第一个问题在学了域上的多项式后很好解决<br>我们只需要找一个多项式环F[x]上的三次不可约多项式f(x)<br>那么F[x]&#x2F;f(x) 构成一个域F’ 且F’的乘法群阶数为p ^ 3 - 1 且刚好是一个循环群<br>这里的F[x]本来应该取Fp[x]的 但这里我们没有p只能构造modN意义下的Zn[x]<br>记P&#x3D;Fp[x]&#x2F;f(x) N&#x3D;Zn[x]&#x2F;f(x) 这里P是N的子环</p>
<p>第二个问题 怎么利用这个 o(g ^ n) &#x3D; p-1 呢？<br>从性质出发 o(t)&#x3D;p-1 &#x3D;&gt; t ^ (p-1) &#x3D; 1<br>而由多项式剩余类环性质 deg(g ^ n)&lt;&#x3D;2<br>所以 g ^ n &#x3D; ax ^ 2+bx+c 的形式<br>在P环中看<br>任意c 都有 c ^ (p-1) &#x3D; 1<br>又由阶的幂次公式&#x3D;&gt;阶为p-1的只有φ(p-1)个<br>而 c都有p-1个取值使得o(c)&#x3D;p-1<br>说明 g ^ n 的形式只能为<br><code>0x^2+0x+c</code> !!!!!!!!!!!!!!!!!!!</p>
<p>那么放到环N中看 就说明二次项和一次项系数都是p的倍数！<br>那么求gcd就有可能得到p!!!!!!!!!!!!!!!!orz orz orz</p>
<p>脚本就用官方的好了(<del>自己也写不怎么来</del>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">1125214074953003550338693571791155006090796212726975350140792193817691133917160305053542782925680862373280169090301712046464465620409850385467397784321453675396878680853302837289474127359729865584385059201707775238870232263306676727868754652536541637937452062469058451096996211856806586253080405693761350527787379604466148473842686716964601958192702845072731564672276539223958840687948377362736246683236421110649264777630992389514349446404208015326249112846962181797559349629761850980006919766121844428696162839329082145670839314341690501211334703611464066066160436143122967781441535203415038656670887399283874866947000313980542931425158634358276922283935422468847585940180566157146439137197351555650475378438394062212134921921469936079889107953354092227029819250669352732749370070996858744765757449980454966317942024199049138183043402199967786003097786359894608611331234652313102498596516590920508269648305903583314189707679</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">27126515219921985451218320201366564737456358918573497792847882486241545924393718080635287342203823068993908455514036540227753141033250259348250042460824265354495259080135197893797181975792914836927018186710682244471711855070708553557141164725366015684184788037988219652565179002870519189669615988416860357430127767472945833762628172190228773085208896682176968903038031026206396635685564975604545616032008575709303331751883115339943537730056794403071865003610653521994963115230275035006559472462643936356750299150351321395319301955415098283861947785178475071537482868994223452727527403307442567556712365701010481560424826125138571692894677625407372483041209738234171713326474989489802947311918341152810838321622423351767716922856007838074781678539986694993211304216853828611394630793531337147512240710591162375077547224679647786450310708451590432452046103209161611561606066902404405369379357958777252744114825323084960942810</span></span><br><span class="line">k = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">R = Zmod(n)[<span class="string">&quot;x&quot;</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    Q = R.quo(R.random_element(k))</span><br><span class="line">    pp = gcd(ZZ(<span class="built_in">list</span>(Q.random_element() ^ n)[<span class="number">1</span>]), n)</span><br><span class="line">    <span class="keyword">if</span> pp != <span class="number">1</span>:</span><br><span class="line">        qq = <span class="built_in">sum</span>([pp**i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k)])</span><br><span class="line">        rr = n // (pp * qq)</span><br><span class="line">        <span class="keyword">assert</span> n == pp * qq * rr</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">phi = (pp - <span class="number">1</span>) * (qq - <span class="number">1</span>) * (rr - <span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment"># ictf&#123;idk_if_it_solvable_if_q_is_2+p+p^2_instead&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<hr>
<p>写的时候发现有些知识掌握的还不是很清楚<del>期末复习得加油了</del></p>
<h1 id="强网杯2023"><a href="#强网杯2023" class="headerlink" title="强网杯2023"></a>强网杯2023</h1><h2 id="not-only-rsa"><a href="#not-only-rsa" class="headerlink" title="not_only_rsa"></a>not_only_rsa</h2><p>n分解为p^5 发现gcd(e,phi)&#x3D;e<br>那么只能硬开根<br>遇到这种只能硬开的才发现自己以前的脚本好low… 跑半天没跑出来<br><a target="_blank" rel="noopener" href="https://tover.xyz/p/n-root-in-F/">这篇</a>总结了常用的几个有限域开方模板<br>直接套都能出<br>这里要将product那里稍微改一改 不然会和itertools的混淆?<br>直接套 nthRSA_p:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sage10</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> not work for gcd(e//r, phi) \ne 1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">root1</span>(<span class="params">n, p, k=<span class="number">1</span></span>):</span><br><span class="line">  F = Zmod(p^k)</span><br><span class="line">  P = Integer(<span class="built_in">pow</span>(p, k))</span><br><span class="line">  phi = euler_phi(P)</span><br><span class="line">  <span class="keyword">assert</span> phi % n == <span class="number">0</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    g = F.random_element()</span><br><span class="line">    u0 = Integer(<span class="built_in">pow</span>(g, phi//n, P))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">pow</span>(u0, n, P) == <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">return</span> u0</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nth_p</span>(<span class="params">y, n, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_prime(p)</span><br><span class="line">  F = Zmod(p^k)</span><br><span class="line">  x0 = F(y).nth_root(n)</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    u0 = F(<span class="number">1</span>).nth_root(n) </span><br><span class="line">  <span class="keyword">except</span>: <span class="comment"># if NotImplementedError...</span></span><br><span class="line">    u0 = root1(n, p, k)</span><br><span class="line">  x = []</span><br><span class="line">  u = []</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    u += [u0^(i+<span class="number">1</span>)]</span><br><span class="line">    x += [Integer(x0 * u[i])]</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">set</span>(x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nthRSA_p</span>(<span class="params">c, e, p, k=<span class="number">1</span></span>):</span><br><span class="line">  <span class="keyword">assert</span> is_prime(p)</span><br><span class="line">  P = Integer(<span class="built_in">pow</span>(p, k))</span><br><span class="line">  phi = euler_phi(P)</span><br><span class="line"></span><br><span class="line">  rs = []</span><br><span class="line">  ei = e</span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = gcd(phi, ei)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    rs += [r]</span><br><span class="line">    ei //= r</span><br><span class="line"><span class="comment">#   r = product(rs)</span></span><br><span class="line">  r = <span class="number">1</span></span><br><span class="line">  <span class="keyword">for</span> x <span class="keyword">in</span> rs:</span><br><span class="line">    r *= x</span><br><span class="line">  dr = (e // r).inverse_mod(phi)</span><br><span class="line">  cr = <span class="built_in">pow</span>(c, dr, P)</span><br><span class="line">  <span class="keyword">return</span> nth_p(cr, r, p, k)</span><br><span class="line"></span><br><span class="line">n = <span class="number">6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849</span></span><br><span class="line">e = <span class="number">641747</span></span><br><span class="line">c = <span class="number">730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943</span></span><br><span class="line">p = <span class="number">91027438112295439314606669837102361953591324472804851543344131406676387779969</span></span><br><span class="line"><span class="keyword">assert</span> n == p^<span class="number">5</span></span><br><span class="line">res = nthRSA_p(c, e, p, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> res:</span><br><span class="line">    flag = libnum.n2s(<span class="built_in">int</span>(x))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;c19c3ec0-d489-4bbb-83fc-bc0419a6822a&#125;</span></span><br></pre></td></tr></table></figure>

<p>本地跑17.682381629943848秒就能出</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/N0zoM1z0">项目</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#tsgctf2020"><span class="toc-number">1.</span> <span class="toc-text">tsgctf2020</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#beginners-crypto"><span class="toc-number">1.1.</span> <span class="toc-text">beginners_crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution1"><span class="toc-number">1.1.1.</span> <span class="toc-text">Solution1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution2"><span class="toc-number">1.1.2.</span> <span class="toc-text">Solution2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#modulus-amittendus"><span class="toc-number">1.2.</span> <span class="toc-text">modulus_amittendus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sweet-like-Apple-Pie"><span class="toc-number">1.3.</span> <span class="toc-text">Sweet like Apple Pie</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HITCON2019"><span class="toc-number">2.</span> <span class="toc-text">HITCON2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lost-Modulus-Again"><span class="toc-number">2.1.</span> <span class="toc-text">Lost Modulus Again</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Very-Simple-Haskell"><span class="toc-number">2.2.</span> <span class="toc-text">Very Simple Haskell</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ISITDTU2019"><span class="toc-number">3.</span> <span class="toc-text">ISITDTU2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Easy-RSA-1"><span class="toc-number">3.1.</span> <span class="toc-text">Easy_RSA_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Easy-RSA-2"><span class="toc-number">3.2.</span> <span class="toc-text">Easy_RSA_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Old-Story"><span class="toc-number">3.3.</span> <span class="toc-text">Old_Story</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#KAPO2019"><span class="toc-number">4.</span> <span class="toc-text">KAPO2019</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lenstra-Lenstra-Lovasz"><span class="toc-number">4.1.</span> <span class="toc-text">Lenstra-Lenstra-Lovász</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moeCTF2023"><span class="toc-number">5.</span> <span class="toc-text">moeCTF2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flag-exchange"><span class="toc-number">5.1.</span> <span class="toc-text">flag_exchange</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#miniLCTF2021"><span class="toc-number">6.</span> <span class="toc-text">miniLCTF2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#asr"><span class="toc-number">6.1.</span> <span class="toc-text">asr</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ASISCTF2022"><span class="toc-number">7.</span> <span class="toc-text">ASISCTF2022</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mindseat"><span class="toc-number">7.1.</span> <span class="toc-text">Mindseat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#chaffymasking"><span class="toc-number">7.2.</span> <span class="toc-text">chaffymasking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mariana"><span class="toc-number">7.3.</span> <span class="toc-text">Mariana</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ImaginaryCTF-2023"><span class="toc-number">8.</span> <span class="toc-text">ImaginaryCTF 2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sus"><span class="toc-number">8.1.</span> <span class="toc-text">sus</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF2023"><span class="toc-number">9.</span> <span class="toc-text">强网杯2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#not-only-rsa"><span class="toc-number">9.1.</span> <span class="toc-text">not_only_rsa</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://n0zom1z0.github.io/Crypto-Other/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://n0zom1z0.github.io/Crypto-Other/&text=Crypto-Other"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://n0zom1z0.github.io/Crypto-Other/&is_video=false&description=Crypto-Other"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Crypto-Other&body=Check out this article: http://n0zom1z0.github.io/Crypto-Other/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://n0zom1z0.github.io/Crypto-Other/&title=Crypto-Other"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://n0zom1z0.github.io/Crypto-Other/&name=Crypto-Other&description=&lt;p&gt;一些杂题(密码)&amp;#x2F; 比赛的密码题&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://n0zom1z0.github.io/Crypto-Other/&t=Crypto-Other"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    N0zoM1z0
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
      --><li><a href="/">首页</a></li><!--
    --><!--
      --><li><a href="/about/">关于</a></li><!--
    --><!--
      --><li><a href="/archives/">归档</a></li><!--
    --><!--
      --><li><a target="_blank" rel="noopener" href="http://github.com/N0zoM1z0">项目</a></li><!--
    --><!--
      --><li><a href="/search/">搜索</a></li><!--
    -->
      </ul>
      <ul>
        
          <!-- 不蒜子统计 -->
          <span id="busuanzi_container_site_pv">
              Friend Link: Kasaki·Nozomi
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  Yoroizuka·Mizore
          </span>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
